{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "",
  "home_page_url": "https://dribble-njr.github.io/blog/blog/",
  "feed_url": "https://dribble-njr.github.io/blog/blog/feed.json",
  "description": "Personal frontend knowledge base",
  "favicon": "https://dribble-njr.github.io/blog/blog/favicon.ico",
  "items": [
    {
      "title": "String and Array",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/03-string-array.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/03-string-array.html",
      "summary": "String（字符串） String 是 Java 中用于表示字符串的引用类型，位于 java.lang 包中。 创建方式 不可变性（Immutable） String 对象一旦创建，内容就无法修改。 为什么不可变： 安全性（防止文件路径、URL 等被恶意修改） 线程安全（无需同步） 可以缓存 hashCode（提高 HashMap 性能） 支持字符串...",
      "content_html": "<h2>String（字符串）</h2>\n<p><code>String</code> 是 Java 中用于表示字符串的<strong>引用类型</strong>，位于 <code>java.lang</code> 包中。</p>\n<h3>创建方式</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token comment\">// 字面量方式（推荐）</span>\n<span class=\"token class-name\">String</span> s1 <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 使用字符串常量池</span>\n\n<span class=\"token comment\">// 构造器方式</span>\n<span class=\"token class-name\">String</span> s2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 强制在堆中创建新对象</span>\n\n<span class=\"token comment\">// 从字符数组或字节数组创建</span>\n<span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> chars <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token char\">'H'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'e'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'l'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'l'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'o'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> s3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>chars<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h3>不可变性（Immutable）</h3>\n<p><code>String</code> 对象一旦创建，内容就<strong>无法修改</strong>。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>\ns <span class=\"token operator\">=</span> s <span class=\"token operator\">+</span> <span class=\"token string\">\" World\"</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 并非修改原对象，而是创建了新对象</span>\n</code></pre></div><p><strong>为什么不可变：</strong></p>\n<ol>\n<li>安全性（防止文件路径、URL 等被恶意修改）</li>\n<li>线程安全（无需同步）</li>\n<li>可以缓存 hashCode（提高 HashMap 性能）</li>\n<li>支持字符串常量池</li>\n</ol>\n<h3>字符串常量池（String Pool）</h3>\n<p>JVM 在堆内存中维护一个字符串常量池，缓存字符串字面量。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">String</span> s1 <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> s2 <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>s1 <span class=\"token operator\">==</span> s2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// true（指向常量池中的同一对象）</span>\n\n<span class=\"token class-name\">String</span> s3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>s1 <span class=\"token operator\">==</span> s3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// false（new 强制在堆中创建新对象）</span>\n\n<span class=\"token comment\">// intern() 方法：将字符串放入常量池</span>\n<span class=\"token class-name\">String</span> s4 <span class=\"token operator\">=</span> s3<span class=\"token punctuation\">.</span><span class=\"token function\">intern</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>s1 <span class=\"token operator\">==</span> s4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// true</span>\n</code></pre></div><h3>常用方法</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 长度与字符访问</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                    <span class=\"token comment\">// 11</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                   <span class=\"token comment\">// 'H'</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                   <span class=\"token comment\">// false</span>\n\n<span class=\"token comment\">// 子串与查找</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>             <span class=\"token comment\">// \"Hello\"</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"World\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">// 6</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"World\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// true</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>         <span class=\"token comment\">// true</span>\n\n<span class=\"token comment\">// 比较</span>\ns1<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>s2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">// 比较内容</span>\ns1<span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 忽略大小写</span>\n<span class=\"token string\">\"apple\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">compareTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"banana\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 字典序比较</span>\n\n<span class=\"token comment\">// 替换与转换</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"World\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Java\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// \"Hello Java\"</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">// \"hello world\"</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">// \"HELLO WORLD\"</span>\n<span class=\"token string\">\"  hello  \"</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">// \"hello\"</span>\n\n<span class=\"token comment\">// 分割与拼接</span>\ns<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                  <span class=\"token comment\">// [\"Hello\", \"World\"]</span>\n<span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\", \"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// \"a, b\"</span>\n</code></pre></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>字符串比较使用 <code>.equals()</code>，不要使用 <code>==</code>。</p>\n</div>\n<h3>字符串格式化</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token comment\">// String.format()</span>\n<span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Name: %s, Age: %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Alice\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">25</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// printf()</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Name: %s, Age: %d%n\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bob\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p>常用格式说明符：<code>%s</code>（字符串）、<code>%d</code>（整数）、<code>%f</code>（浮点数）、<code>%.2f</code>（保留 2 位小数）</p>\n<h3>文本块（Java 13+）</h3>\n<p>Java 13+ 支持<strong>文本块（Text Blocks）</strong>，使用 <code>\"\"\"</code> 三引号表示多行字符串。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">String</span> json <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"\n    {\n        \"name\": \"Alice\",\n        \"age\": 25\n    }\n    \"\"\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 支持变量格式化（Java 15+）</span>\n<span class=\"token class-name\">String</span> html <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">\"\"\"\n    &lt;html&gt;\n        &lt;body&gt;&lt;h1&gt;%s&lt;/h1&gt;&lt;/body&gt;\n    &lt;/html&gt;\n    \"\"\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">formatted</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p><strong>特性：</strong> 保留换行和缩进、无需转义双引号、自动去除公共前导空白</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>Java 文本块不支持类似 JavaScript <code>${variable}</code> 的语法糖，需要使用 <code>.formatted()</code> 或 <code>String.format()</code>。</p>\n</div>\n<h3>字符串拼接</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token comment\">// + 运算符（简单场景）</span>\n<span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"World\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// StringBuilder（推荐，线程不安全）</span>\n<span class=\"token class-name\">StringBuilder</span> sb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsb<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"World\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> sb<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// StringBuffer（线程安全，性能略低）</span>\n<span class=\"token class-name\">StringBuffer</span> buf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbuf<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"World\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p><strong>性能：</strong> 循环中不要使用 <code>+</code>，应使用 <code>StringBuilder</code>。</p>\n<h3>String vs StringBuilder vs StringBuffer</h3>\n<p>| 特性     | String     | StringBuilder | StringBuffer |<br>\n|</p>\n",
      "date_published": "2026-01-25T00:00:00.000Z",
      "date_modified": "2026-02-13T08:07:26.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "Abstract Classes and Interfaces",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/09-abstract-and-interface.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/09-abstract-and-interface.html",
      "summary": "抽象类（Abstract Class） 抽象类是不能被实例化的类，使用 abstract 关键字定义，通常包含抽象方法（只有声明没有实现）。 基本语法 抽象类的特点 不能实例化 可以有构造方法（供子类调用） 可以有抽象方法和具体方法 子类必须实现所有抽象方法（除非子类也是抽象类） 模板方法模式 抽象类常用于定义算法框架，让子类实现具体步骤。 接口（In...",
      "content_html": "<h2>抽象类（Abstract Class）</h2>\n<p>抽象类是<strong>不能被实例化的类</strong>，使用 <code>abstract</code> 关键字定义，通常包含抽象方法（只有声明没有实现）。</p>\n<h3>基本语法</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 抽象方法：没有方法体</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeSound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 具体方法：有实现</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" is sleeping\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Dog</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dog</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 必须实现抽象方法</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">makeSound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" barks: Woof!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 使用</span>\n<span class=\"token class-name\">Animal</span> dog <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Buddy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndog<span class=\"token punctuation\">.</span><span class=\"token function\">makeSound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 输出：Buddy barks: Woof!</span>\ndog<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 输出：Buddy is sleeping</span>\n</code></pre></div><h3>抽象类的特点</h3>\n<ol>\n<li>\n<p><strong>不能实例化</strong></p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">Animal</span> animal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ❌ 编译错误</span>\n<span class=\"token class-name\">Animal</span> dog <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dog</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Buddy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// ✅ 可以，多态</span>\n</code></pre></div></li>\n<li>\n<p><strong>可以有构造方法</strong>（供子类调用）</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div></li>\n<li>\n<p><strong>可以有抽象方法和具体方法</strong></p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Shape</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">double</span> <span class=\"token function\">area</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 抽象方法</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">printInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>                <span class=\"token comment\">// 具体方法</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Area: \"</span> <span class=\"token operator\">+</span> <span class=\"token function\">area</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div></li>\n<li>\n<p><strong>子类必须实现所有抽象方法</strong>（除非子类也是抽象类）</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Circle</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Shape</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">double</span> radius<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">double</span> <span class=\"token function\">area</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  <span class=\"token comment\">// 必须实现</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> radius <span class=\"token operator\">*</span> radius<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div></li>\n</ol>\n<h3>模板方法模式</h3>\n<p>抽象类常用于定义算法框架，让子类实现具体步骤。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DataProcessor</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 模板方法：定义算法框架</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">readData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">processData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 抽象方法，子类实现</span>\n        <span class=\"token function\">writeData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Reading data...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">void</span> <span class=\"token function\">processData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 交给子类实现</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">writeData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Writing data...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CSVProcessor</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">DataProcessor</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">processData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Processing CSV data...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 使用</span>\n<span class=\"token class-name\">DataProcessor</span> processor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CSVProcessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nprocessor<span class=\"token punctuation\">.</span><span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 输出：</span>\n<span class=\"token comment\">// Reading data...</span>\n<span class=\"token comment\">// Processing CSV data...</span>\n<span class=\"token comment\">// Writing data...</span>\n</code></pre></div><h2>接口（Interface）</h2>\n<p>接口是<strong>完全抽象的类型</strong>，定义一组行为规范（方法签名），实现类必须提供这些方法的具体实现。</p>\n<h3>基本语法</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Flyable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 接口中的方法默认是 public abstract</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">fly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> <span class=\"token function\">getMaxAltitude</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Bird</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Flyable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bird is flying\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getMaxAltitude</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 使用</span>\n<span class=\"token class-name\">Flyable</span> bird <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bird</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbird<span class=\"token punctuation\">.</span><span class=\"token function\">fly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h3>接口的特点</h3>\n<ol>\n<li>\n<p><strong>所有方法默认是 <code>public abstract</code></strong></p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Drawable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 等同于 public abstract void draw();</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div></li>\n<li>\n<p><strong>所有变量默认是 <code>public static final</code></strong>（常量）</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Constants</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> <span class=\"token constant\">MAX_SIZE</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 等同于 public static final int MAX_SIZE = 100;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div></li>\n<li>\n<p><strong>支持多实现</strong></p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Duck</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Flyable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Swimmable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">swim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div></li>\n<li>\n<p><strong>接口可以继承接口</strong></p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Mammal</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">breathe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div></li>\n</ol>\n<h3>默认方法（Java 8+）</h3>\n<p>接口可以提供默认实现，实现类可以选择是否覆盖。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Vehicle</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 默认方法</span>\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">honk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Beep beep!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Vehicle</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Car starting...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// 不覆盖 honk()，使用默认实现</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">Car</span> car <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncar<span class=\"token punctuation\">.</span><span class=\"token function\">honk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 输出：Beep beep!</span>\n</code></pre></div><h3>静态方法（Java 8+）</h3>\n<p>接口可以有静态方法，通过接口名调用。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MathUtils</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">MathUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 直接调用</span>\n</code></pre></div><h3>私有方法（Java 9+）</h3>\n<p>接口可以有私有方法，用于复用代码。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Logger</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INFO\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">default</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logError</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ERROR\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 私有方法，避免代码重复</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> level<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[\"</span> <span class=\"token operator\">+</span> level <span class=\"token operator\">+</span> <span class=\"token string\">\"] \"</span> <span class=\"token operator\">+</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>抽象类 vs 接口</h2>\n<h3>关键区别</h3>\n<p>| 特性         | 抽象类                       | 接口                         |<br>\n|</p>\n",
      "date_published": "2026-02-13T00:00:00.000Z",
      "date_modified": "2026-02-13T07:45:52.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "Agent Skills Overview",
      "url": "https://dribble-njr.github.io/blog/blog/ai/skills/01-agent-skills-overview.html",
      "id": "https://dribble-njr.github.io/blog/blog/ai/skills/01-agent-skills-overview.html",
      "summary": "Overview Agent Skills 是一种轻量、开放的格式，用于赋予 AI 智能体新的能力和专业知识。它们是包含指令、脚本和资源的文件夹，提供了规范化的知识和工作流， 智能体可以发现并使用它们来更准确、高效地完成任务。 从技术角度看，Skills 是 AI Agent 可以调用的可复用功能单元，类似于编程中的函数或插件。 通过 Skills，A...",
      "content_html": "<h2>Overview</h2>\n<p>Agent Skills 是一种轻量、开放的格式，用于赋予 AI 智能体新的能力和专业知识。它们是<strong>包含指令、脚本和资源的文件夹</strong>，提供了规范化的知识和工作流，<br>\n智能体可以发现并使用它们来更准确、高效地完成任务。</p>\n<p>从技术角度看，Skills 是 AI Agent 可以调用的<strong>可复用功能单元</strong>，类似于编程中的函数或插件。</p>\n<p>通过 Skills，Agent 可以：</p>\n<ul>\n<li>执行特定任务（如创建 Git commit、生成 PDF、分析代码）</li>\n<li>访问外部工具和服务</li>\n<li>扩展自身能力而无需修改核心代码</li>\n</ul>\n<h2>What are skills?</h2>\n<p>一个标准的 Skill 通常包含以下文件：</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>my-skill/\n├── SKILL.md          # Required: instructions + metadata (name and description)\n├── scripts/          # Optional: executable code\n├── references/       # Optional: documentation\n└── assets/           # Optional: templates, resources\n</code></pre></div><p>Skills 使用渐进式披露来高效管理上下文：</p>\n<ol>\n<li>发现阶段：启动时，Agent 仅加载每个可用 skill 的名称和描述——刚好足够判断该 skill 何时可能相关。</li>\n<li>激活阶段：当任务与某个 skill 的描述匹配时，Agent 会将完整的 <code>SKILL.md</code> 指令读入上下文。</li>\n<li>执行阶段：Agent 按照指令执行操作，根据需要加载引用的文件或运行捆绑的代码。</li>\n</ol>\n<p>这种方式让智能体保持快速响应，同时能够按需获取更多上下文信息。</p>\n<div class=\"language-markdown\" data-ext=\"md\" data-title=\"md\"><pre class=\"language-markdown\"><code></code></pre></div>",
      "date_published": "2026-02-06T00:00:00.000Z",
      "date_modified": "2026-02-12T11:21:52.000Z",
      "authors": [],
      "tags": [
        "ai"
      ]
    },
    {
      "title": "Composition",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/08-composition.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/08-composition.html",
      "summary": "组合（Composition） 组合是指一个类包含另一个类的实例作为成员变量，通过委托的方式复用代码，而不是通过继承。 基本示例 组合 vs 继承 关键区别 继承的问题 使用组合改进 何时使用继承，何时使用组合 使用继承的场景 继承适用于真正的 \"is-a\" 关系： 子类是父类的特化版本（Dog is Animal） 需要多态行为（统一处理不同子类） ...",
      "content_html": "<h2>组合（Composition）</h2>\n<p>组合是指<strong>一个类包含另一个类的实例作为成员变量</strong>，通过委托的方式复用代码，而不是通过继承。</p>\n<h3>基本示例</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token comment\">// 组合：Car \"has-a\" Engine</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Engine</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> type<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Engine</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> type<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">+</span> <span class=\"token string\">\" engine starting...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">+</span> <span class=\"token string\">\" engine stopping...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Car</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Engine</span> engine<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 组合：Car 包含 Engine</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> brand<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> brand<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> engineType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>brand <span class=\"token operator\">=</span> brand<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>engine <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Engine</span><span class=\"token punctuation\">(</span>engineType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 创建 Engine 实例</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>brand <span class=\"token operator\">+</span> <span class=\"token string\">\" car starting...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        engine<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 委托给 Engine</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        engine<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 委托给 Engine</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>brand <span class=\"token operator\">+</span> <span class=\"token string\">\" car stopped.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 使用</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Car</span> car <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Toyota\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"V6\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        car<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 输出：</span>\n        <span class=\"token comment\">// Toyota car starting...</span>\n        <span class=\"token comment\">// V6 engine starting...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>组合 vs 继承</h2>\n<h3>关键区别</h3>\n<p>| 特性     | 继承（Inheritance）          | 组合（Composition）            |<br>\n|</p>\n",
      "date_published": "2026-02-12T00:00:00.000Z",
      "date_modified": "2026-02-12T09:56:03.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "Inheritance and Polymorphism",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/07-inheritance-and-polymorphism.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/07-inheritance-and-polymorphism.html",
      "summary": "继承（Inheritance） 使用 extends 关键字实现继承。 与 TypeScript 的区别 Object 类 所有 Java 类都隐式继承 Object 类。 常用方法：toString()、equals()、hashCode()、getClass() 等。 方法重写（Override） 子类可以重写父类的方法，提供自己的实现。 方法重写...",
      "content_html": "<h2>继承（Inheritance）</h2>\n<p>使用 <code>extends</code> 关键字实现继承。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Animal</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" is eating\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Dog</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Animal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Dog</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 调用父类构造方法</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">bark</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" is barking\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>与 TypeScript 的区别</h3>\n<p>| 特性       | Java                                     | TypeScript                                 |<br>\n|</p>\n",
      "date_published": "2026-02-02T00:00:00.000Z",
      "date_modified": "2026-02-03T06:10:46.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "Static and Final",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/06-static-and-final.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/06-static-and-final.html",
      "summary": "static 关键字 static 关键字用于定义类级别的成员（属于类本身，而非对象实例）。 静态变量（类变量） 静态变量被所有实例共享，只有一份。 静态方法 静态方法属于类，不需要创建对象就可以调用。 限制： ❌ 静态方法不能访问实例变量 ❌ 静态方法不能使用 this 关键字 ✅ 静态方法可以访问静态变量 ✅ 实例方法可以访问静态变量 静态代码块 ...",
      "content_html": "<h2>static 关键字</h2>\n<p><code>static</code> 关键字用于定义<strong>类级别</strong>的成员（属于类本身，而非对象实例）。</p>\n<h3>静态变量（类变量）</h3>\n<p>静态变量被所有实例共享，只有一份。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Counter</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 静态变量，所有实例共享</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>                <span class=\"token comment\">// 实例变量，每个实例独立</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> count<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> count<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">Counter</span> c1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// count = 1</span>\n<span class=\"token class-name\">Counter</span> c2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// count = 2</span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Counter</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 2（通过类名访问）</span>\n</code></pre></div><h3>静态方法</h3>\n<p>静态方法属于类，不需要创建对象就可以调用。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MathUtils</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">MathUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 通过类名调用</span>\n</code></pre></div><p><strong>限制：</strong></p>\n<ul>\n<li>❌ 静态方法不能访问实例变量</li>\n<li>❌ 静态方法不能使用 <code>this</code> 关键字</li>\n<li>✅ 静态方法可以访问静态变量</li>\n<li>✅ 实例方法可以访问静态变量</li>\n</ul>\n<h3>静态代码块</h3>\n<p>静态代码块在<strong>类加载时执行一次</strong>，用于初始化静态变量。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Config</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> apiUrl<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">static</span> <span class=\"token punctuation\">{</span>\n        apiUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.example.com\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Config initialized\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><strong>初始化顺序：</strong></p>\n<ol>\n<li>静态变量初始化</li>\n<li>静态代码块（类加载时执行一次）</li>\n<li>实例变量初始化（创建对象时）</li>\n<li>实例代码块（创建对象时）</li>\n<li>构造方法（创建对象时）</li>\n</ol>\n<h3>静态导入</h3>\n<p>可以直接导入静态成员，避免重复写类名。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">double</span> result <span class=\"token operator\">=</span> <span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token constant\">PI</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 不需要写 Math.sqrt() 和 Math.PI</span>\n</code></pre></div><h3>与 TypeScript 的区别</h3>\n<p>| 特性              | Java                     | TypeScript           |<br>\n|</p>\n",
      "date_published": "2026-02-02T00:00:00.000Z",
      "date_modified": "2026-02-02T04:54:37.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "Classes and Encapsulation",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/05-classes-and-encapsulation.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/05-classes-and-encapsulation.html",
      "summary": "在 Java 中，新建文件夹就是新建一个软件包（package），它对应你在项目里用来组织类的目录。 简单理解： 包（package） = 文件夹 类（class） = 文件 在类文件开头写 package 包名来声明它属于这个包。 提示 如果不声明一个包，那么类会隐式属于 default package，不推荐这么使用。 访问修饰符（Access M...",
      "content_html": "<p>在 Java 中，新建文件夹就是新建一个软件包（package），它对应你在项目里用来组织类的目录。</p>\n<p>简单理解：</p>\n<ul>\n<li>包（package） = 文件夹</li>\n<li>类（class） = 文件</li>\n</ul>\n<p>在类文件开头写 package 包名来声明它属于这个包。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>如果不声明一个包，那么类会隐式属于 default package，不推荐这么使用。</p>\n</div>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">package</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>utils</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Date</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 类定义</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>访问修饰符（Access Modifiers）</h2>\n<p>访问修饰符用于控制类、方法和变量的可见性和访问权限。Java 提供了四种访问级别。</p>\n<h3>类级别的访问修饰符</h3>\n<p><strong>顶级类</strong>（Top-level Class）是指直接定义在源文件中，而不是嵌套在其他类、类型或方法内部的类。</p>\n<p>顶级类只有<strong>两种</strong>有效的访问修饰符选项：</p>\n<p>| 访问修饰符 | 描述                                                               |<br>\n|</p>\n",
      "date_published": "2026-01-26T00:00:00.000Z",
      "date_modified": "2026-02-02T04:48:15.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "Control Flow",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/04-control-flow.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/04-control-flow.html",
      "summary": "控制流语句用于控制程序的执行顺序。Java 提供了条件语句、循环语句和跳转语句。 if-else 语句 if-else 用于根据条件执行不同的代码块。 单行语句可以省略大括号，但不推荐： 三元运算符 三元运算符是 if-else 的简化形式，用于简单的条件赋值。 switch 语句 传统 switch 语句 传统的 switch 语句使用 case 和...",
      "content_html": "<p>控制流语句用于控制程序的执行顺序。Java 提供了条件语句、循环语句和跳转语句。</p>\n<h2>if-else 语句</h2>\n<p><code>if-else</code> 用于根据条件执行不同的代码块。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span> score <span class=\"token operator\">=</span> <span class=\"token number\">85</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>score <span class=\"token operator\">&gt;=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"优秀\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>score <span class=\"token operator\">&gt;=</span> <span class=\"token number\">80</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"良好\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>score <span class=\"token operator\">&gt;=</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"及格\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不及格\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>单行语句可以省略大括号，但不推荐：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>score <span class=\"token operator\">&gt;=</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"及格\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 不推荐</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不及格\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>三元运算符</h2>\n<p>三元运算符是 <code>if-else</code> 的简化形式，用于简单的条件赋值。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span> score <span class=\"token operator\">=</span> <span class=\"token number\">85</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> score <span class=\"token operator\">&gt;=</span> <span class=\"token number\">60</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"及格\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"不及格\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>switch 语句</h2>\n<h3>传统 switch 语句</h3>\n<p>传统的 <code>switch</code> 语句使用 <code>case</code> 和 <code>break</code>：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span> day <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> dayName<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>day<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n        dayName <span class=\"token operator\">=</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n        dayName <span class=\"token operator\">=</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n        dayName <span class=\"token operator\">=</span> <span class=\"token string\">\"Wednesday\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        dayName <span class=\"token operator\">=</span> <span class=\"token string\">\"Unknown\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>传统 switch 语句容易忘记 <code>break</code>，导致 fall-through（继续执行下一个 case）。</p>\n</div>\n<h3>Switch 表达式（Java 14+）</h3>\n<p>Java 14 引入了 <strong>switch 表达式</strong>，使用 <code>-&gt;</code> 箭头语法，不需要 <code>break</code>，更加简洁和安全。</p>\n<h4>基本语法</h4>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span> day <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> dayName <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>day<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">3</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Wednesday\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">4</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Thursday\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">5</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Friday\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">6</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Saturday\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">7</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Sunday\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Unknown\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p><strong>特点：</strong></p>\n<ul>\n<li>使用 <code>-&gt;</code> 替代 <code>:</code> 和 <code>break</code></li>\n<li>自动返回值，可以直接赋值给变量</li>\n<li>不会发生 fall-through</li>\n<li>更加简洁和易读</li>\n</ul>\n<h4>多个 case 标签</h4>\n<p>可以将多个 case 合并：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">String</span> dayType <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>day<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"工作日\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"周末\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"无效\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h4>代码块形式</h4>\n<p>如果需要执行多条语句，使用代码块和 <code>yield</code> 返回值：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span> day <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>day<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这是工作日\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">yield</span> <span class=\"token string\">\"需要工作\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这是周末\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">yield</span> <span class=\"token string\">\"可以休息\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"无效的日期\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">yield</span> <span class=\"token string\">\"错误\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>使用代码块时，必须用 <code>yield</code> 关键字返回值，而不是 <code>return</code>。</p>\n</div>\n<h4>传统 case 与箭头语法混用</h4>\n<p>虽然可以混用，但<strong>不推荐</strong>：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>day<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">yield</span> <span class=\"token string\">\"Monday\"</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 传统形式需要 yield</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Tuesday\"</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 箭头形式</span>\n    <span class=\"token keyword\">default</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"Unknown\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h4>Switch 表达式的完整性</h4>\n<p>Switch 表达式必须是<strong>穷尽的</strong>（exhaustive），即覆盖所有可能的情况。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token comment\">// 编译错误：缺少 default 分支</span>\n<span class=\"token class-name\">String</span> dayType <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>day<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"工作日\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"周末\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 缺少 default，编译器会报错</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p>对于枚举类型，如果覆盖了所有枚举值，可以不需要 <code>default</code>：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">enum</span> <span class=\"token class-name\">Day</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">MONDAY</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">TUESDAY</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">WEDNESDAY</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">Day</span> day <span class=\"token operator\">=</span> <span class=\"token class-name\">Day</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MONDAY</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">String</span> type <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>day<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">MONDAY</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">TUESDAY</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">WEDNESDAY</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"工作日\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 所有枚举值都覆盖了，不需要 default</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h3>模式匹配（Java 17 预览，Java 21 正式）</h3>\n<p>Java 17 的预览特性引入了 switch 的<strong>模式匹配</strong>，Java 21 正式发布。</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">Object</span> obj <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">String</span> s <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"这是字符串: \"</span> <span class=\"token operator\">+</span> s<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">Integer</span> i <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"这是整数: \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"这是 null\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"未知类型\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p><strong>带条件的模式匹配（guarded patterns）：</strong></p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token class-name\">Object</span> obj <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">String</span> s when s<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">5</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"长字符串\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">String</span> s <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"短字符串\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">Integer</span> i when i <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"正整数\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">Integer</span> i <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"非正整数\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"null 值\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span> <span class=\"token operator\">-&gt;</span> <span class=\"token string\">\"其他类型\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>循环语句</h2>\n<h3>for 循环</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>增强 for 循环（for-each）</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> numbers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> num <span class=\"token operator\">:</span> numbers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>while 循环</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    i<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>do-while 循环</h3>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    i<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>跳转语句</h2>\n<h3>break</h3>\n<p>跳出循环或 switch 语句：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 跳出循环</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>continue</h3>\n<p>跳过当前循环的剩余部分，继续下一次循环：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 跳过 i=2</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 输出: 0, 1, 3, 4</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>return</h3>\n<p>从方法中返回：</p>\n<div class=\"language-java\" data-ext=\"java\" data-title=\"java\"><pre class=\"language-java\"><code><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>总结</h2>\n<p><strong>推荐使用：</strong></p>\n<ul>\n<li>优先使用 <strong>switch 表达式</strong>（箭头语法）而不是传统 switch 语句</li>\n<li>使用 <code>yield</code> 在代码块中返回值</li>\n<li>switch 表达式更安全、简洁，避免了 fall-through 问题</li>\n</ul>\n<p><strong>Java 17 的 switch 新特性：</strong></p>\n<ul>\n<li>✅ Switch 表达式（正式）</li>\n<li>✅ 箭头语法 <code>-&gt;</code>（正式）</li>\n<li>✅ 多 case 标签（正式）</li>\n<li>🔄 模式匹配（预览，Java 21 正式）</li>\n</ul>\n",
      "date_published": "2026-01-28T00:00:00.000Z",
      "date_modified": "2026-01-28T06:14:34.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "Primitive Types",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/02-primitive-types.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/02-primitive-types.html",
      "summary": "Java 有八个基本数据类型（primitive data types）： 整数类型：byte、short、int、long 浮点类型：float、double 字符类型：char 布尔类型：boolean 提示 L、f 和 d 后缀分别用于表示 long, float 和 double 类型的字面值。 int 和 double 是默认的数字字面量类型...",
      "content_html": "<p>Java 有八个基本数据类型（primitive data types）：</p>\n<ul>\n<li>整数类型：<code>byte</code>、<code>short</code>、<code>int</code>、<code>long</code></li>\n<li>浮点类型：<code>float</code>、<code>double</code></li>\n<li>字符类型：<code>char</code></li>\n<li>布尔类型：<code>boolean</code></li>\n</ul>\n<p>| Types     | Description              | Default Value |<br>\n|</p>\n",
      "date_published": "2026-01-24T00:00:00.000Z",
      "date_modified": "2026-02-13T08:07:26.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "程序基本结构",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/language/01-program-structure.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/language/01-program-structure.html",
      "summary": " 本文从「程序的基本结构」出发，解释为什么 Java 必须有明确入口，以及它与 TS / Node.js 的执行模型 在设计哲学上的根本差异。 什么是「程序结构」 从最抽象的层面看，一个程序至少要回答三个问题： 从哪里开始执行？（入口） 代码如何组织？（结构单元） 依赖如何生效？（加载 / 初始化 / 执行） 不同语言，对这三个问题的回答完全不同。 T...",
      "content_html": "<blockquote>\n<p>本文从「程序的基本结构」出发，解释为什么 <strong>Java 必须有明确入口</strong>，以及它与 <strong>TS / Node.js 的执行模型</strong> 在设计哲学上的根本差异。</p>\n</blockquote>\n",
      "date_published": "2026-01-23T00:00:00.000Z",
      "date_modified": "2026-01-24T08:25:49.000Z",
      "authors": [],
      "tags": [
        "java"
      ]
    },
    {
      "title": "What is MCP?",
      "url": "https://dribble-njr.github.io/blog/blog/ai/mcp/01-what-is-mcp.html",
      "id": "https://dribble-njr.github.io/blog/blog/ai/mcp/01-what-is-mcp.html",
      "summary": "MCP (Model Context Protocol) 是 AI 应用和外部系统如何连接的一个开源标准。 2026011914375988920260119143759889 What can MCP enable? nvim_clipboard_20260119150550nvim_clipboard_20260119150550 Agents 可...",
      "content_html": "<p>MCP (Model Context Protocol) 是 AI 应用和外部系统如何连接的一个开源标准。</p>\n<figure><img src=\"https://raw.githubusercontent.com/zeevenn/image-bed/main/img/20260119143759889.png\" alt=\"20260119143759889\" tabindex=\"0\" loading=\"lazy\"><figcaption>20260119143759889</figcaption></figure>\n<h2>What can MCP enable?</h2>\n<figure><img src=\"https://raw.githubusercontent.com/zeevenn/image-bed/main/img/nvim_clipboard_20260119150550.png\" alt=\"nvim_clipboard_20260119150550\" tabindex=\"0\" loading=\"lazy\"><figcaption>nvim_clipboard_20260119150550</figcaption></figure>\n<ul>\n<li>Agents 可以通过 MCP 连接到各种外部工具和数据源，如谷歌日历、notion 等。</li>\n<li>不同的 AI 模型和服务可以通过 MCP 互操作，形成复杂的多模型系统。</li>\n</ul>\n<h2>Why dose MCP matter?</h2>\n<ul>\n<li>开发者：减少开发时间和复杂度</li>\n<li>AI 应用或 agents：MCP 提供了一种标准化的方式访问数据源、工具和应用，提高互操作性。</li>\n<li>终端用户：通过 MCP 支持的应用，可以无缝访问和集成多种服务和数据源，提升用户体验。</li>\n</ul>\n",
      "image": "https://raw.githubusercontent.com/zeevenn/image-bed/main/img/20260119143759889.png",
      "date_published": "2026-01-19T00:00:00.000Z",
      "date_modified": "2026-01-23T04:41:10.000Z",
      "authors": [],
      "tags": [
        "mcp"
      ]
    },
    {
      "title": "MCP Architecture",
      "url": "https://dribble-njr.github.io/blog/blog/ai/mcp/02-architecture.html",
      "id": "https://dribble-njr.github.io/blog/blog/ai/mcp/02-architecture.html",
      "summary": "一、MCP 包含的项目 1. MCP Specification 协议规范本身。 定义了： 客户端和服务端如何通信 上下文（context）如何描述、传输、更新 必须遵守的接口、数据结构、行为约束 可以理解为「RFC / 标准文档」。 2. MCP SDKs 各语言的官方/半官方 SDK 实现。 作用是： 把规范落地成可直接使用的代码 降低实现 MCP...",
      "content_html": "<h2>一、MCP 包含的项目</h2>\n<h3>1. MCP Specification</h3>\n<p><strong>协议规范本身</strong>。<br>\n定义了：</p>\n<ul>\n<li>客户端和服务端如何通信</li>\n<li>上下文（context）如何描述、传输、更新</li>\n<li>必须遵守的接口、数据结构、行为约束</li>\n</ul>\n<p>可以理解为「RFC / 标准文档」。</p>\n",
      "date_published": "2026-01-19T00:00:00.000Z",
      "date_modified": "2026-01-23T04:41:10.000Z",
      "authors": [],
      "tags": [
        "mcp"
      ]
    },
    {
      "title": "A Mini Microservice Application",
      "url": "https://dribble-njr.github.io/blog/blog/backend/microservice/02-mini-microservice-app.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/microservice/02-mini-microservice-app.html",
      "summary": "Q&A Q1: Wait, so you're saying we nened to create a new service every time we need to join some data?! A1: Absolutely not! In reality, might not even have posts and comments in ...",
      "content_html": "<h2>Q&amp;A</h2>\n<p><strong>Q1: Wait, so you're saying we nened to create a new service every time we need to join some data?!</strong></p>\n<p>A1: Absolutely not! In reality, might not even have posts and comments in separate services in the first place.</p>\n<p><strong>Q2: Who cares that each service is independent</strong></p>\n<p>A2: Independent services + the reliability that brings is one of the core reasons of using microservices in the first place.</p>\n<p><strong>Q3: This is so over the top complicated for little benefit</strong></p>\n<p>A3: Seems that way now! Adding in some features starts to get really easy when we use this architecture.</p>\n<p><strong>Q4: This system won't correctly in the following scenarios...</strong></p>\n<p>A4: There are some very special things we need to consider with this design. I've got solutions for most (maybe?) of the concerns you may have.</p>\n<h2>Event Bus</h2>\n<p>非常多不同的实现，比如：RabbitMQ、Kafka、NATS、Redis Pub/Sub 等等。</p>\n<ul>\n<li>接收事件、分发事件</li>\n<li>许多微妙的特性使得 async communication 变得更容易或更难</li>\n</ul>\n",
      "date_published": "2026-01-21T00:00:00.000Z",
      "date_modified": "2026-01-21T15:07:32.000Z",
      "authors": [],
      "tags": [
        "microservice"
      ]
    },
    {
      "title": "Fundamental Ideas Around Microservices",
      "url": "https://dribble-njr.github.io/blog/blog/backend/microservice/01-fundamental-ideas.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/microservice/01-fundamental-ideas.html",
      "summary": "What is Microservices? 将不同服务拆分为独立的微服务，每个微服务专注于特定的业务功能。 单个服务拥有完整的中间件、路由和数据库支持。 每个服务拥有自己的数据库，确保松耦合和独立的数据管理。 Why database per service? 每个服务需要独立于其他服务，避免单点故障 数据库结构可能随时变化 不同服务可能有不同的数据...",
      "content_html": "<h2>What is Microservices?</h2>\n<ul>\n<li>将不同服务拆分为独立的微服务，每个微服务专注于特定的业务功能。</li>\n<li>单个服务拥有完整的中间件、路由和数据库支持。</li>\n<li>每个服务拥有自己的数据库，确保松耦合和独立的数据管理。</li>\n</ul>\n<h2>Why database per service?</h2>\n<ul>\n<li>每个服务需要独立于其他服务，避免单点故障</li>\n<li>数据库结构可能随时变化</li>\n<li>不同服务可能有不同的数据访问模式和需求（SQL、NoSQL等）</li>\n</ul>\n<h2>Data management between services</h2>\n<h3>Sync communication</h3>\n<p>服务之间的同步通信通常通过 HTTP/REST 或 gRPC 实现。调用方发出请求后，必须等待被调用服务返回结果，流程才继续。</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>Service A  →  Service B\n   |            |\n   |</code></pre></div>",
      "date_published": "2026-01-15T00:00:00.000Z",
      "date_modified": "2026-01-19T02:54:47.000Z",
      "authors": [],
      "tags": [
        "microservice"
      ]
    },
    {
      "title": "useMemo & useCallback & memo",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/14-useMemo-useCallback-memo.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/14-useMemo-useCallback-memo.html",
      "summary": "useMemo useMemo 可以缓存一个函数的结果，避免重复计算。 useMemo 接收两个参数： callback：一个函数，返回一个值。 dependencies：一个数组，包含所有依赖项。当依赖项发生变化时，callback 函数会重新执行。 useMemo 会返回一个 memoized 值，当依赖项发生变化时，callback 函数会重新执...",
      "content_html": "<h2>useMemo</h2>\n<p><code>useMemo</code> 可以缓存一个函数的结果，避免重复计算。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> memoizedValue <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">expensiveCalculation</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><code>useMemo</code> 接收两个参数：</p>\n<ul>\n<li><code>callback</code>：一个函数，返回一个值。</li>\n<li><code>dependencies</code>：一个数组，包含所有依赖项。当依赖项发生变化时，<code>callback</code> 函数会重新执行。</li>\n</ul>\n<p><code>useMemo</code> 会返回一个 memoized 值，当依赖项发生变化时，<code>callback</code> 函数会重新执行，并返回新的值。</p>\n<p>大部分情况下，React Compiler 会自动优化性能，只有在计算过程耗时较长导致交互明显卡顿的情况下，才有可能需要使用 <code>useMemo</code>。</p>\n<p>当你需要缓存一个函数时，可以这样使用：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> memoizedFunction <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'memoized function'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>缓存函数的情况非常常见，因此 react 提供了 <code>useCallback</code> 钩子来避免嵌套。</p>\n<h2>useCallback</h2>\n<p><code>useCallback</code> 可以缓存一个函数，避免重复创建。<code>useCallback</code> 接收两个参数：</p>\n<ul>\n<li><code>callback</code>：一个函数，返回一个值。</li>\n<li><code>dependencies</code>：一个数组，包含所有依赖项。当依赖项发生变化时，<code>callback</code> 函数会重新执行。</li>\n</ul>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> memoizedFunction <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'memoized function'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>memo</h2>\n<p><code>memo</code> 可以缓存一个组件，避免重复渲染。<code>memo</code> 接收两个参数：</p>\n<ul>\n<li><code>component</code>：一个组件，返回一个值。</li>\n<li><code>arePropsEqual</code>：可选值，一个函数，接收两个参数，<code>prevProps</code> 和 <code>nextProps</code>，当 <code>prevProps</code> 和 <code>nextProps</code> 相等时，组件不会重新渲染，通常情况下，你不需要手动进行比较，默认情况下，<code>memo</code> 会使用 <code>Object.is</code> 进行比较。</li>\n</ul>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> MemoizedComponent <span class=\"token operator\">=</span> <span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>SomeComponent<span class=\"token punctuation\">,</span> arePropsEqual<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>React 通常在不进行优化的情况下也足够快，但有时你需要手动 memorize 组件和值，以保持应用程序的响应速度。手动记忆化容易出错，还会增加额外的代码维护工作。<br>\n<a href=\"https://react.dev/learn/react-compiler\" target=\"_blank\" rel=\"noopener noreferrer\">React Compiler</a> 会在构建时自动优化 React 应用程序，但目前处于实验阶段，且在 React 19 才得到更好支持。</p>\n</div>\n",
      "date_published": "2025-09-05T09:11:09.000Z",
      "date_modified": "2025-09-05T09:11:09.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "useDeferredValue",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/13-useDeferredValue.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/13-useDeferredValue.html",
      "summary": "useTransition 可以让你给你一个 pending 的布尔值，让你可以展示 pending 状态。但这个问题的难点在于，如果你想展示触发 transition 的值。例如，如果你使用 state 控制一个搜索框，你希望 <input /> 的 value 与用户输入的值保持一致，而不是与之前的值保持一致，因为 React 正在等待 trans...",
      "content_html": "<p><code>useTransition</code> 可以让你给你一个 <code>pending</code> 的布尔值，让你可以展示 <code>pending</code> 状态。但这个问题的难点在于，如果你想展示触发 transition 的值。例如，如果你使用 state 控制一个搜索框，你希望 <code>&lt;input /&gt;</code> 的 <code>value</code> 与用户输入的值保持一致，而不是与之前的值保持一致，因为 React 正在等待 transition 完成。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Suspense<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">,</span> useTransition <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> SearchResults <span class=\"token keyword\">from</span> <span class=\"token string\">'./SearchResults.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isPending<span class=\"token punctuation\">,</span> startTransition<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        Search albums:\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>query<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>e <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">setQuery</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Loading...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SearchResults</span></span> <span class=\"token attr-name\">query</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>query<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>此时，input 的 value 不会实时更新，因为 React 正在等待 transition 完成。</p>\n<p><code>useDeferredValue</code> 可以让你把一个值「延迟处理」。</p>\n<ul>\n<li>组件里仍然会立刻拿到最新的输入值，所以 <code>&lt;input /&gt;</code> 不会卡顿。</li>\n<li>但你把这个值传给 <code>useDeferredValue</code>，得到一个「延迟版的值」，再用它去触发昂贵的渲染（比如搜索结果）。</li>\n</ul>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Suspense<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">,</span> useDeferredValue <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> SearchResults <span class=\"token keyword\">from</span> <span class=\"token string\">'./SearchResults.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> deferredQuery <span class=\"token operator\">=</span> <span class=\"token function\">useDeferredValue</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isStale <span class=\"token operator\">=</span> query <span class=\"token operator\">!==</span> deferredQuery<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        Search albums:\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>query<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>e <span class=\"token operator\">=&gt;</span> <span class=\"token function\">setQuery</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Loading...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n          opacity<span class=\"token operator\">:</span> isStale <span class=\"token operator\">?</span> <span class=\"token number\">0.5</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n          transition<span class=\"token operator\">:</span> isStale <span class=\"token operator\">?</span> <span class=\"token string\">'opacity 0.2s 0.2s linear'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'opacity 0s 0s linear'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SearchResults</span></span> <span class=\"token attr-name\">query</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>deferredQuery<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>useDeferredValue</code> 会让 React 渲染两次。第一次把 <code>deferredValue</code> 设置为之前的 <code>value</code>，第二次把 <code>deferredValue</code> 设置为当前的 <code>value</code>。这允许 React 处理挂起的组件，并且你可以根据 <code>deferredValue</code> 和 <code>value</code> 的差异来决定是否显示 stale UI。</p>\n<p>这可能感觉与 <code>useTransition</code> 非常相似。两者都允许你处理挂起的组件的 pending UI。<code>useDeferredValue</code> 通常用于典型的用户交互，而 <code>useTransition</code> 通常用于用户导航或刷新整个 UI。</p>\n<p>| 特性    | <code>useTransition</code>                                 | <code>useDeferredValue</code>                                    |<br>\n|</p>\n",
      "date_published": "2025-09-05T08:28:46.000Z",
      "date_modified": "2025-09-05T08:28:46.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "useOptimistic",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/12-useOptimistic.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/12-useOptimistic.html",
      "summary": "乐观更新是一种在用户操作后，立即更新 UI 的策略，即使操作可能失败。 useOptimistic Transitions () 可以防止 UI 在组件挂起时发生变化（本质是调度策略）。但有时候可能希望在组件挂起时显示不同的 UI（甚至在组件挂起时多次改变该 UI）。 useOptimistic 可以实现这一点，它就像一个 useState 钩子，它会...",
      "content_html": "<p>乐观更新是一种在用户操作后，立即更新 UI 的策略，即使操作可能失败。</p>\n<h2><code>useOptimistic</code></h2>\n<p>Transitions () 可以防止 UI 在组件挂起时发生变化（本质是调度策略）。但有时候可能希望在组件挂起时显示不同的 UI（甚至在组件挂起时多次改变该 UI）。</p>\n<p><code>useOptimistic</code> 可以实现这一点，它就像一个 <code>useState</code> 钩子，它会在组件挂起时改变 UI（而不是展示 fallback UI）。它经常用于实现乐观更新，这就是为什么它被称为 <code>useOptimistic</code>。可能叫它 <a href=\"https://twitter.com/ryanflorence/status/1788364906900959481\" target=\"_blank\" rel=\"noopener noreferrer\"><code>useTransitionState</code></a> 更合适。</p>\n<p>表单 <code>action</code> 会自动被 <code>startTransition</code> 包裹，所以如果你有一个表单 <code>action</code>，你希望实现乐观更新（需要更新状态），那么你需要使用 <code>useOptimistic</code> 来绕过 <code>transition</code> 的挂起状态。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">Todo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> todo <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> todo<span class=\"token operator\">:</span> TodoItem <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isComplete<span class=\"token punctuation\">,</span> setIsComplete<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useOptimistic</span><span class=\"token punctuation\">(</span>todo<span class=\"token punctuation\">.</span>isComplete<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span>\n\t\t\t<span class=\"token attr-name\">action</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">setIsComplete</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isComplete<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">await</span> <span class=\"token function\">updateTodo</span><span class=\"token punctuation\">(</span>todo<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token operator\">!</span>isComplete<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n\t\t<span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n\t\t\t\t\t<span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkbox<span class=\"token punctuation\">\"</span></span>\n\t\t\t\t\t<span class=\"token attr-name\">checked</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>isComplete<span class=\"token punctuation\">}</span></span>\n\t\t\t\t\t<span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>todos-checkbox<span class=\"token punctuation\">\"</span></span>\n\t\t\t\t<span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n\t\t\t\t</span><span class=\"token punctuation\">{</span>todo<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>isComplete</code> 是基于 <code>todo.isComplete</code> 的，但在 <code>transition</code> 期间，我们可以将其改变为 <code>!isComplete</code>。一旦 <code>transition</code> 完成（无论成功还是失败），它将回退到 <code>todo.isComplete</code> 的值。</p>\n<p>我们可以在 <code>transition</code> 期间多次更新乐观状态，这意味着如果你有一个多步骤操作，你可以更新消息以让用户知道你在运行过程中的哪一步。</p>\n<h3>参数</h3>\n<p><code>useOptimistic</code> 的参数如下：</p>\n<ul>\n<li><code>optimisticState</code>：乐观状态，即在 <code>transition</code> 期间的状态</li>\n<li><code>addOptimistic</code>：添加乐观状态，本地先「伪造」一个状态，立刻渲染到 UI 上</li>\n<li><code>actualState</code>：实际状态，来自真实数据</li>\n<li><code>updateFn</code>：更新函数，一个 reducer 函数，用于合并乐观状态和实际状态</li>\n</ul>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>optimisticState<span class=\"token punctuation\">,</span> addOptimistic<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useOptimistic</span><span class=\"token punctuation\">(</span>\n  actualState<span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// updateFn</span>\n  <span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">,</span> newInput<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// merge and return new state</span>\n    <span class=\"token comment\">// with optimistic value</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div><h3>对比 <code>useTransition</code></h3>\n<p>如果你发请求，依赖的 <code>use(fetchPromise)</code> 还没 resolve → <code>Suspense</code> 就会触发 <code>fallback</code>。但 <code>useOptimistic</code> 的设计目标是：让 UI 可以立即显示一个「乐观结果」，避免 <code>fallback</code> 抢走 UI。</p>\n<p><code>useOptimistic</code> 的效果和原理有点类似 <code>startTransition</code>，核心思路：</p>\n<ul>\n<li>给你一个「临时状态」（乐观 UI），立刻同步渲染出来</li>\n<li>真实数据到达后，再更新为最终状态</li>\n<li>这期间不会触发 <code>Suspense</code> <code>fallback</code>，因为 UI 已经有数据可渲染（虽然是乐观的）</li>\n</ul>\n<p>两者像是反向操作：</p>\n<ul>\n<li><code>useTransition</code> 解决的是 延迟更新，旧 UI 保留</li>\n<li><code>useOptimistic</code> 解决的是 提前更新，新 UI 假装完成</li>\n</ul>\n<h2><code>useFormStatus</code></h2>\n<p><code>useFormStatus</code> 是 <code>react-dom</code> 提供的一个 hook。它用于获取表单的提交状态。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>将 <code>form</code> 元素视为 <code>context provider</code>，而 <code>useFormStatus</code> 钩子视为 <code>context consumer</code>。</p>\n</div>\n<p>你可以创建一个提交按钮，它可以访问其父表单的当前状态，并在表单操作进行时显示一个 pending 状态：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">SubmitButton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> formStatus <span class=\"token operator\">=</span> <span class=\"token function\">useFormStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>formStatus<span class=\"token punctuation\">.</span>pending <span class=\"token operator\">?</span> <span class=\"token string\">'Creating...'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'Create'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>formStatus</code> 还有其他一些有用的属性，可以用于实现乐观 UI（比如正在提交的数据）。</p>\n<ul>\n<li><code>formStatus.pending</code>：一个布尔值，如果为 <code>true</code>，则表示父 <code>&lt;form&gt;</code> 正在提交。否则为 <code>false</code>。</li>\n<li><code>formStatus.data</code>：一个实现了 <code>FormData</code> 接口的对象，包含了父 <code>&lt;form&gt;</code> 正在提交的数据。如果没有活动提交或没有父 <code>&lt;form&gt;</code>，则为 <code>null</code>。</li>\n<li><code>formStatus.action</code>：正在提交的 action</li>\n<li><code>formStatus.method</code>：一个字符串值，表示父 <code>&lt;form&gt;</code> 正在提交时使用的是 GET 还是 POST HTTP 方法。默认情况下，一个 <code>&lt;form&gt;</code> 会使用 GET 方法，可以通过 <code>method</code> 属性指定。</li>\n</ul>\n",
      "date_published": "2025-09-01T06:53:01.000Z",
      "date_modified": "2025-09-01T06:53:01.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "useTransition",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/11-useTransition.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/11-useTransition.html",
      "summary": "缓存 promise 下述代码获取存在一个性能问题，每次点击按钮，都会重新调用 fetchUser 函数，触发一个新的 fetch 请求，这不仅效率低下，还会导致 NumberInfo 组件挂起，渲染 suspense 边界。 解决方法是添加缓存到我们的 fetchUser 函数中。这样，如果 fetchUser 函数再次被调用，我们可以返回之前返回的...",
      "content_html": "<h2>缓存 promise</h2>\n<p>下述代码获取存在一个性能问题，每次点击按钮，都会重新调用 <code>fetchUser</code> 函数，触发一个新的 fetch 请求，这不仅效率低下，还会导致 <code>NumberInfo</code> 组件挂起，渲染 <code>suspense</code> 边界。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/user'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> user\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">NumberInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> userInfo <span class=\"token operator\">=</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">fetchUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">increment</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\tHi </span><span class=\"token punctuation\">{</span>userInfo<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">! You have clicked </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> times.\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>increment<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Increment again!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>解决方法是添加缓存到我们的 <code>fetchUser</code> 函数中。这样，如果 <code>fetchUser</code> 函数再次被调用，我们可以返回之前返回的相同 promise：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">let</span> userPromise\n<span class=\"token keyword\">function</span> <span class=\"token function\">fetchUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tuserPromise <span class=\"token operator\">=</span> userPromise <span class=\"token operator\">??</span> <span class=\"token function\">fetchUserImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> userPromise\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// \"impl\" is short for \"implementation\"</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchUserImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/user'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> user\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>通过返回相同的 promise，React 会跟踪该特定 promise，并知道它是否已经 resolved 并需要挂起。</p>\n<p>当然，这是一个简单的例子。缓存通常需要更多的思考。例如，如果我们能按 ID 获取用户呢？我们不能只拥有 <code>userPromise</code>，现在我们必须拥有一个从用户 ID 到获取该用户的 promise 的映射：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> userPromiseCache <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>User<span class=\"token operator\">&gt;&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fetchUser</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> userPromise <span class=\"token operator\">=</span> userPromiseCache<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token function\">fetchUserImpl</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n\tuserPromiseCache<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> userPromise<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> userPromise\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">fetchUserImpl</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/api/user/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> user\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这会变得更加复杂，当你开始考虑用户数据可能会改变，现在你必须担心缓存失效。但重点是，你需要缓存你的 promise 以避免不必要的重新获取。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>可以使用 <code>useMemo</code> 来缓存 promise，这样会在 id 改变时，重新获取 promise，无需考虑缓存失效等复杂问题。</p>\n</div>\n<h2>Transitions</h2>\n<p>每当触发导致挂起组件的状态更新时，最近的 <code>suspense</code> 边界会被找到，并渲染其 <code>fallback</code> 属性，直到 promise 被 resolve。如果 <code>suspense</code> 边界离触发状态更新的组件很远，或者加载状态与 resolved 状态非常不同，这会给用户带来非常糟糕的体验。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Header</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Sidebar</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      \n      </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* Suspense 边界在这里 - 很远！ */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">整个页面加载中...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MainContent</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MainContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductList</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserStats</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">ProductList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">,</span> setFilter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'all'</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">const</span> productsPromise <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> \n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/api/products?filter=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>filter<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">const</span> products <span class=\"token operator\">=</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>productsPromise<span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'popular'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        热门商品  </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* 👈 用户点击这里 */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>products<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=&gt;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>p<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>p<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>用户点击「热门商品」按钮后：</p>\n<ul>\n<li>触发状态更新 setFilter('popular')</li>\n<li>组件挂起 ProductList 因为新的 use(productsPromise) 而挂起</li>\n<li>找到边界 React 向上查找，找到 App 中的 Suspense</li>\n<li>突兀体验 整个页面内容消失，显示\"整个页面加载中...\"</li>\n</ul>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>用户看到的变化：\n[Header] [Sidebar] [产品列表] [用户统计]\n                    ↓ 点击按钮\n[Header] [Sidebar] [整个页面加载中...]  ⚠️ 突兀！\n</code></pre></div><h3>局部 Suspense</h3>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">ProductList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">,</span> setFilter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'all'</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">const</span> productsPromise <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> \n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/api/products?filter=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>filter<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=&gt;</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'popular'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        热门商品\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      \n      </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* ✅ 局部 Suspense，只影响产品列表 */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductListSkeleton</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductGrid</span></span> <span class=\"token attr-name\">productsPromise</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>productsPromise<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">ProductGrid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> productsPromise <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> products <span class=\"token operator\">=</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>productsPromise<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>products<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=&gt;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>p<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>p<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>useTransition</h3>\n<p>为了使从加载到 resolved 状态的过渡更平滑，可以使用 <code>useTransition</code> hook。这个 hook 返回一个包含两个值的元组：一个布尔值和一个 <code>startTransition</code> 函数。</p>\n<ul>\n<li>当 promise 仍处于 pending 状态时，布尔值为 <code>true</code>，当 promise 已 resolved 时，布尔值为 <code>false</code>。这允许你显示一个加载状态，而不是使用 <code>suspense</code> 边界 fallback UI。这通常会带来更平滑的用户体验。</li>\n<li><code>startTransition</code> 函数是一个回调，可以使用它来保证旧 UI 的展示，避免用户看到突兀的 UI 变化。</li>\n</ul>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">ProductList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>filter<span class=\"token punctuation\">,</span> setFilter<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'all'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isPending<span class=\"token punctuation\">,</span> startTransition<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleFilterChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>newFilter<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">startTransition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setFilter</span><span class=\"token punctuation\">(</span>newFilter<span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 非紧急更新，避免挂起</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token comment\">// 显示当前数据 + 加载指示器，而不是完全挂起</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> \n        <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">handleFilterChange</span><span class=\"token punctuation\">(</span><span class=\"token string\">'popular'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">disabled</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>isPending<span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        热门商品 </span><span class=\"token punctuation\">{</span>isPending <span class=\"token operator\">&amp;&amp;</span> <span class=\"token string\">'(加载中...)'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* 其他内容 */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>startTransition</code> 的核心是 <strong>调度更新优先级</strong>，而「旧 UI 保留」只是它带来的副作用体验，不是它本质。</p>\n<p>React 内部把更新分成紧急和非紧急：</p>\n<ul>\n<li>紧急更新：输入框、点击 → 立即响应</li>\n<li>非紧急更新：列表渲染、大量 DOM 更新 → 可以延迟</li>\n</ul>\n<p><code>startTransition</code> 就是告诉 React：这次更新不重要，先保证用户交互流畅，再慢慢渲染。</p>\n<p>当你把 <code>Suspense</code> 放进 <code>Transition</code> 时，会带来一个副作用：旧 UI 保留。新数据还没准备好 → React 会先保留旧 UI，不会立刻切到 fallback。</p>\n<p>这个行为是 <strong>调度策略带来的体验效果</strong>，而不是 <code>Transition</code> 本身的目标。</p>\n<p>换句话说：</p>\n<ul>\n<li><code>Transition</code> 目标（调度策略） = 降低更新优先级，让交互不卡顿</li>\n<li><code>UI</code> 保留效果 = 因为更新被降级了，所以旧 UI 还能显示</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>React 单独提供了 <code>useTransition</code> 返回的 <code>startTransition</code> 函数，当你不需要 <code>isPending</code> 时，可以直接使用 <code>startTransition</code> 函数。</p>\n</div>\n",
      "date_published": "2025-08-25T00:00:00.000Z",
      "date_modified": "2025-08-27T10:38:24.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "addEventListener",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/018-addEventListener.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/018-addEventListener.html",
      "summary": "addEventListener 的第三个参数可以是一个布尔值 useCapture，也可以是一个包含多个配置项的 options 对象。两者的作用有所不同： useCapture 参数 (布尔值) 这个是较早的写法，主要用于指定事件监听器的触发阶段： true：表示监听器会在捕获阶段（capture phase）触发。 false：表示监听器会在冒泡...",
      "content_html": "<p><code>addEventListener</code> 的第三个参数可以是一个布尔值 <code>useCapture</code>，也可以是一个包含多个配置项的 <code>options</code> 对象。两者的作用有所不同：</p>\n<ol>\n<li><code>useCapture</code> 参数 (布尔值)</li>\n</ol>\n<p>这个是较早的写法，主要用于指定事件监听器的触发阶段：</p>\n<ul>\n<li><code>true</code>：表示监听器会在捕获阶段（capture phase）触发。</li>\n<li><code>false</code>：表示监听器会在冒泡阶段（bubble phase）触发（默认值）。</li>\n</ul>\n<p>事件的传播分为三个阶段：</p>\n<ul>\n<li>捕获阶段：事件从根节点向目标节点传播。</li>\n<li>目标阶段：事件到达目标节点。</li>\n<li>冒泡阶段：事件从目标节点向根节点反向传播。</li>\n</ul>\n<p>举例：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>element<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> eventHandler<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 在捕获阶段触发</span>\nelement<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> eventHandler<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 在冒泡阶段触发（默认）</span>\n</code></pre></div><ol start=\"2\">\n<li><code>options</code> 对象</li>\n</ol>\n<p>ES6 引入了 <code>options</code> 对象，取代了仅使用 <code>useCapture</code> 布尔值的单一功能，提供了更丰富的配置选项。<code>options</code> 可以包含以下属性：</p>\n<ul>\n<li><code>capture</code>：等价于以前的 <code>useCapture</code> 参数。<code>true</code> 表示在捕获阶段触发，<code>false</code> 表示在冒泡阶段触发。</li>\n<li><code>once</code>：如果设为 <code>true</code>，监听器只会触发一次，然后自动移除。</li>\n<li><code>passive</code>：如果设为 <code>true</code>，表示监听器不会调用 <code>preventDefault()</code>。这可以提高滚动性能，尤其是在移动设备上。</li>\n<li><code>signal</code>：允许通过 <code>AbortSignal</code> 来移除事件监听器，通常配合 <code>AbortController</code> 使用。</li>\n</ul>\n<p>举例说明：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>element<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> eventHandler<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">capture</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">// 捕获阶段触发</span>\n  <span class=\"token literal-property property\">once</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 监听器只会执行一次</span>\n  <span class=\"token literal-property property\">passive</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>    <span class=\"token comment\">// 不能调用 preventDefault()</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><ul>\n<li><code>capture: true</code>：在捕获阶段触发。</li>\n<li><code>once: true</code>：只会触发一次，触发后自动移除事件监听器。</li>\n<li><code>passive: true</code>：禁止调用 <code>event.preventDefault()</code>，这样可以提升性能，尤其是在处理滚动事件时。</li>\n</ul>\n<p>总结：</p>\n<ul>\n<li><code>useCapture</code> 是布尔值，简单控制事件在捕获还是冒泡阶段触发。</li>\n<li><code>options</code> 是扩展的配置对象，提供了更多的功能（例如 <code>once</code>、<code>passive</code> 等），可以更灵活地控制事件监听行为。</li>\n</ul>\n",
      "date_published": "2025-08-25T00:00:00.000Z",
      "date_modified": "2025-08-25T06:46:12.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "Suspense",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/10-Suspense.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/10-Suspense.html",
      "summary": "大多数应用程序都需要从服务器获取一些数据。例如一个 fetch 请求： 虽然代码很简单，但无论你的服务器有多快，你都需要考虑用户在等待时看到的内容。你无法控制用户的网络连接。同样，你还需要考虑如果请求失败会发生什么。你也无法控制用户的连接可靠性。 传统实现 下述代码是一个传统的实现方式，它通过 useState 和 useEffect 来管理异步状态，...",
      "content_html": "<p>大多数应用程序都需要从服务器获取一些数据。例如一个 <code>fetch</code> 请求：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://api.example.com/data'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>虽然代码很简单，但无论你的服务器有多快，你都需要考虑用户在等待时看到的内容。你无法控制用户的网络连接。同样，你还需要考虑如果请求失败会发生什么。你也无法控制用户的连接可靠性。</p>\n<h2>传统实现</h2>\n<p>下述代码是一个传统的实现方式，它通过 <code>useState</code> 和 <code>useEffect</code> 来管理异步状态，在数据加载完成之前，会展示 <code>Loading...</code> 状态，在数据加载失败时，会展示 <code>Error: {error.message}</code> 状态。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">DataLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isLoading<span class=\"token punctuation\">,</span> setIsLoading<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>error<span class=\"token punctuation\">,</span> setError<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">,</span> setData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchData</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://api.example.com/data'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setIsLoading</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isLoading<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Loading...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Error: </span><span class=\"token punctuation\">{</span>error<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>使用 Suspense</h2>\n<p>React 提供了一套优雅的解决方案来处理这些场景：<code>Suspense</code> 和 <code>ErrorBoundary</code> 组件。<code>Suspense</code> 组件可以让你在等待数据加载时展示一个 fallback UI，而 <code>ErrorBoundary</code> 组件可以让你在数据加载失败时展示一个错误 UI。</p>\n<p>关键问题在于：如何在渲染 UI 时恰当地处理异步状态？这时候 <code>use</code> 钩子就派上用场了：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">DataLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>fetchDataPromise<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>为了完成声明式循环，当 promise 被抛出时，React 会「暂停」组件，这意味着它会向上查找父组件的树，寻找 <code>Suspense</code> 组件并渲染其边界：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Suspense <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">loading phone details</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DataLoader</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这类似于错误边界，因为 <code>Suspense</code> 边界可以处理其子组件或孙组件中抛出的任何 promise。它们也可以嵌套，因此你可以在应用程序的加载状态上拥有很大的控制权。</p>\n<p>如果 promise 被拒绝，那么你的 <code>ErrorBoundary</code> 将被触发，你可以渲染一个错误消息给用户：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Suspense <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ErrorBoundary <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-error-boundary'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ErrorBoundary</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Oh no, something bad happened</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Suspense</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">loading phone details</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DataLoader</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Suspense</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ErrorBoundary</span></span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>一个简单的 <code>use</code> 钩子实现如下：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>type UsePromise<span class=\"token operator\">&lt;</span>Value<span class=\"token operator\">&gt;</span> <span class=\"token operator\">=</span> Promise<span class=\"token operator\">&lt;</span>Value<span class=\"token operator\">&gt;</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token string\">'pending'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'fulfilled'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'rejected'</span>\n\t<span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> Value\n\t<span class=\"token literal-property property\">reason</span><span class=\"token operator\">:</span> unknown\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> use<span class=\"token operator\">&lt;</span>Value<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">(</span>promise<span class=\"token operator\">:</span> Promise<span class=\"token operator\">&lt;</span>Value<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Value <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> usePromise <span class=\"token operator\">=</span> promise <span class=\"token keyword\">as</span> UsePromise<span class=\"token operator\">&lt;</span>Value<span class=\"token operator\">&gt;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>usePromise<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'fulfilled'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> usePromise<span class=\"token punctuation\">.</span>value\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>usePromise<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'rejected'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">throw</span> usePromise<span class=\"token punctuation\">.</span>reason\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>usePromise<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'pending'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">throw</span> usePromise\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\tusePromise<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token string\">'pending'</span>\n\t\tusePromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tusePromise<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token string\">'fulfilled'</span>\n\t\t\t\tusePromise<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> result\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token parameter\">reason</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tusePromise<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token string\">'rejected'</span>\n\t\t\t\tusePromise<span class=\"token punctuation\">.</span>reason <span class=\"token operator\">=</span> reason\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">throw</span> usePromise\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>总结</h2>\n<p>使用 <code>Suspense</code> 和 <code>use</code> 钩子，可以让我们更方便地管理异步状态，而不需要手动管理 <code>isLoading</code> 和 <code>error</code> 状态。</p>\n",
      "date_published": "2025-08-20T00:00:00.000Z",
      "date_modified": "2025-08-27T10:38:24.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "微信内置浏览器视频 preload 兼容性问题",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/023-weixin-video-preload.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/023-weixin-video-preload.html",
      "summary": "背景 在 Web 项目中使用 video.js 播放视频时，通常我们会通过 preload=\"metadata\" 或 preload=\"auto\" 来提前加载视频元数据（loadedmetadata 事件）和首帧，以便显示封面或做一些视频时长计算。 然而，在 微信内置浏览器（尤其是 iOS 版） 中，视频的加载行为存在限制： 即使设置了 autopla...",
      "content_html": "<h2>背景</h2>\n<p>在 Web 项目中使用 <code>video.js</code> 播放视频时，通常我们会通过 <code>preload=\"metadata\"</code> 或 <code>preload=\"auto\"</code> 来提前加载视频元数据（<code>loadedmetadata</code> 事件）和首帧，以便显示封面或做一些视频时长计算。</p>\n<p>然而，在 <strong>微信内置浏览器（尤其是 iOS 版）</strong> 中，视频的加载行为存在限制：</p>\n<ul>\n<li>即使设置了 <code>autoplay</code>、<code>muted</code>、<code>preload</code>，也<strong>不会自动触发 <code>loadedmetadata</code></strong>。</li>\n<li>视频首帧也不会在未播放时渲染出来。</li>\n<li>这些行为与 Chrome / Safari / Android 微信都有差异。</li>\n</ul>\n",
      "date_published": "2025-08-15T00:00:00.000Z",
      "date_modified": "2025-08-15T08:49:38.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "useSyncExternalStore",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/09-useSyncExternalStore.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/09-useSyncExternalStore.html",
      "summary": "不是所有的东西都是用 React 构建的。有很多库和平台 API 是外部于 React 的。将这些东西引入 React 的组件模型和状态管理生命周期是构建全功能应用程序的必要条件。 任务是同步外部世界与 React 组件的内部状态。为此，我们使用 useSyncExternalStore 钩子。 让我们以一个组件为例，该组件通过 geolocation...",
      "content_html": "<p>不是所有的东西都是用 React 构建的。有很多库和平台 API 是外部于 React 的。将这些东西引入 React 的组件模型和状态管理生命周期是构建全功能应用程序的必要条件。</p>\n<p>任务是同步外部世界与 React 组件的内部状态。为此，我们使用 <code>useSyncExternalStore</code> 钩子。</p>\n<p>让我们以一个组件为例，该组件通过 geolocation API 显示您的当前位置。geolocation API 不是 React 的一部分，因此我们需要同步 geolocation API 的外部状态与组件的内部状态。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useSyncExternalStore <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">LocationData</span> <span class=\"token operator\">=</span>\n\t<span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'unavailable'</span><span class=\"token punctuation\">;</span> geo<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">never</span> <span class=\"token punctuation\">}</span>\n\t<span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'available'</span><span class=\"token punctuation\">;</span> geo<span class=\"token operator\">:</span> GeolocationPosition <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// this variable is our external store!</span>\n<span class=\"token keyword\">let</span> location<span class=\"token operator\">:</span> LocationData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'unavailable'</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">subscribeToGeolocation</span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> watchId <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span><span class=\"token function\">watchPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\tlocation <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'available'</span><span class=\"token punctuation\">,</span> geo<span class=\"token operator\">:</span> position <span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\tlocation <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'unavailable'</span> <span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span><span class=\"token function\">clearWatch</span><span class=\"token punctuation\">(</span>watchId<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getGeolocationSnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> location\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyLocation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> location <span class=\"token operator\">=</span> <span class=\"token function\">useSyncExternalStore</span><span class=\"token punctuation\">(</span>\n\t\tsubscribeToGeolocation<span class=\"token punctuation\">,</span>\n\t\tgetGeolocationSnapshot<span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'unavailable'</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string\">'Your location is unavailable'</span>\n\t\t\t<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t\t\tYour location is </span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">.</span>geo<span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>latitude<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t\t\t\t</span><span class=\"token punctuation\">{</span><span class=\"token string\">'°, '</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t\t\t\t</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">.</span>geo<span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>longitude<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t\t\t\t</span><span class=\"token punctuation\">{</span><span class=\"token string\">'°'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">&gt;</span></span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>基本 API 如下：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> snapshot <span class=\"token operator\">=</span> <span class=\"token function\">useSyncExternalStore</span><span class=\"token punctuation\">(</span>\n\tsubscribe<span class=\"token punctuation\">,</span>\n\tgetSnapshot<span class=\"token punctuation\">,</span>\n\tgetServerSnapshot<span class=\"token punctuation\">,</span> <span class=\"token comment\">// optional</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div><ul>\n<li><code>subscribe</code> 是一个函数，它接受一个回调函数并返回一个清理函数。每当外部存储发生变化时，回调函数都会被调用，让 React 知道应该调用 <code>getSnapshot</code> 来获取新值。</li>\n<li><code>getSnapshot</code> 是一个函数，它返回外部存储的当前值。</li>\n<li><code>getServerSnapshot</code> 是一个可选函数，它从服务器返回外部存储的当前值。这对于服务器端渲染和重新水合很有用。如果您不提供此函数，则 React 将在服务器上渲染最近的 <code>Suspense</code> 边界 <code>fallback</code>，然后当客户端水合时，它将调用 <code>getSnapshot</code> 来获取当前值。</li>\n</ul>\n<p>参考文档：</p>\n<ul>\n<li><a href=\"https://react.dev/reference/react/useSyncExternalStore\" target=\"_blank\" rel=\"noopener noreferrer\">📜 <code>useSyncExternalStore</code> docs</a></li>\n<li><a href=\"https://react.dev/reference/react-dom/server\" target=\"_blank\" rel=\"noopener noreferrer\">📜 SSR docs</a></li>\n</ul>\n",
      "date_published": "2025-08-05T00:00:00.000Z",
      "date_modified": "2025-08-15T08:49:38.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "flushSync",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/08-flushSync.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/08-flushSync.html",
      "summary": "flushSync 是 React 中的一个函数，用于强制同步更新。 帮助用户将焦点保持在正确的位置是用户体验的关键部分。这对于依赖屏幕阅读器或键盘导航的用户尤其重要。但即使是能够使用键盘的用户也可以从精心设计的焦点管理体验中受益。 有时，您想要聚焦的元素在状态更新后才会变得可用。例如： 假设用户点击「显示」后，他们想要在输入框中输入一些内容。良好的焦...",
      "content_html": "<p><code>flushSync</code> 是 React 中的一个函数，用于强制同步更新。</p>\n<p>帮助用户将焦点保持在正确的位置是用户体验的关键部分。这对于依赖屏幕阅读器或键盘导航的用户尤其重要。但即使是能够使用键盘的用户也可以从精心设计的焦点管理体验中受益。</p>\n<p>有时，您想要聚焦的元素在状态更新后才会变得可用。例如：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>show<span class=\"token punctuation\">,</span> setShow<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">setShow</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Show</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>show <span class=\"token operator\">?</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>假设用户点击「显示」后，他们想要在输入框中输入一些内容。良好的焦点管理会在元素变得可见后聚焦该元素。</p>\n<p>React 中的状态更新是批量进行的。因此，状态更新不一定会在调用状态更新函数时立即发生。</p>\n<p>因此，如果尝试在状态更新后立即聚焦元素，它可能无法按预期工作。这是因为您想要聚焦的元素可能还不可用。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> inputRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">&gt;</span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>show<span class=\"token punctuation\">,</span> setShow<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n\t\t\t\t<span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t<span class=\"token function\">setShow</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\tinputRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// This probably won't work</span>\n\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n\t\t\t<span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t\tShow\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>show <span class=\"token operator\">?</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>inputRef<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>解决此问题的方法是强制 React 同步运行状态和 DOM 更新，以便在您尝试聚焦时，您想要聚焦的元素是可用的。</p>\n<p>您可以通过使用 <code>react-dom</code> 包中的 <code>flushSync</code> 函数来实现这一点。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> flushSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> inputRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">&gt;</span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>show<span class=\"token punctuation\">,</span> setShow<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n\t\t\t\t<span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t<span class=\"token function\">flushSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t<span class=\"token function\">setShow</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\tinputRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n\t\t\t<span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t\tShow\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>show <span class=\"token operator\">?</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>inputRef<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>flushSync</code> 的作用是强制 React 同步运行状态和 DOM 更新。这样，在 <code>flushSync</code> 调用后，输入元素将变得可用，您可以尝试聚焦它。</p>\n<p>通常，您应该避免这种优化，但在某些情况下（如焦点管理），它是完美的解决方案。</p>\n<ul>\n<li><a href=\"https://react.dev/reference/react-dom/flushSync\" target=\"_blank\" rel=\"noopener noreferrer\">📜 the <code>flushSync</code> docs</a>.</li>\n</ul>\n",
      "date_published": "2025-08-04T10:58:10.000Z",
      "date_modified": "2025-08-04T10:58:10.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "useImperativeHandle",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/07-useImperativeHandle.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/07-useImperativeHandle.html",
      "summary": "有时你需要暴露一个方法给父组件，让父组件可以主动与子组件交互。这可以通过 ref 来实现，useRef 钩子可以让你拥有一个与组件实例关联的对象，并且不会改变时触发组件重新渲染。 父组件可以传递一个 ref 给子组件，然后子组件可以在这个 ref 上挂载方法，父组件可以调用这些方法。 这实际上是可行的，但是当在 React 的 concurrent/s...",
      "content_html": "<p>有时你需要暴露一个方法给父组件，让父组件可以主动与子组件交互。这可以通过 <code>ref</code> 来实现，<code>useRef</code> 钩子可以让你拥有一个与组件实例关联的对象，并且不会改变时触发组件重新渲染。</p>\n<p>父组件可以传递一个 <code>ref</code> 给子组件，然后子组件可以在这个 <code>ref</code> 上挂载方法，父组件可以调用这些方法。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">type</span> <span class=\"token class-name\">InputAPI</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token function-variable function\">focusInput</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\tref<span class=\"token punctuation\">,</span>\n\t<span class=\"token operator\">...</span>props\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>InputHTMLAttributes<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">&gt;</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n\tref<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>RefObject<span class=\"token operator\">&lt;</span>InputAPI<span class=\"token operator\">&gt;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> inputRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tref<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function-variable function\">focusInput</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> inputRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>inputRef<span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> myInputRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>InputAPI<span class=\"token operator\">&gt;</span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyInput</span></span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>myInputRef<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Enter your name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> myInputRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focusInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t\tFocus the input\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这实际上是可行的，但是当在 React 的 concurrent/suspense 特性中使用时，会出现一些边缘情况的问题（它也不支持回调 ref）。所以，我们使用 <code>useImperativeHandle</code> 钩子来实现这个功能：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">type</span> <span class=\"token class-name\">InputAPI</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token function-variable function\">focusInput</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\tref<span class=\"token punctuation\">,</span>\n\t<span class=\"token operator\">...</span>props\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>InputHTMLAttributes<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">&gt;</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n\tref<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>RefObject<span class=\"token operator\">&lt;</span>InputAPI<span class=\"token operator\">&gt;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> inputRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">useImperativeHandle</span><span class=\"token punctuation\">(</span>\n\t\tref<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token function-variable function\">focusInput</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> inputRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>inputRef<span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>useImperativeHandle</code> 接收三个参数：</p>\n<ul>\n<li><code>ref</code>：与组件实例关联的 <code>ref</code> 对象。</li>\n<li><code>createHandle</code>：一个函数，返回一个对象，这个对象就是暴露给父组件的 API。</li>\n<li><code>dependencies</code>：依赖数组，当依赖数组中的值发生变化时，<code>createHandle</code> 函数会重新执行。</li>\n</ul>\n<p><a href=\"https://epicreact.dev/why-you-shouldnt-put-refs-in-a-dependency-array\" target=\"_blank\" rel=\"noopener noreferrer\">Why you shouldn't put refs in a dependency array</a>.</p>\n<p><code>useImperativeHandle</code> 允许我们暴露一些方法给父组件，这些方法可以被父组件调用。这在某些场景下非常有用，比如你有一个需要手动操作的组件，但是你又不想让父组件直接操作这个组件的内部状态。</p>\n<p>::: TIP</p>\n<p>大多数情况下，你不需要 <code>useImperativeHandle</code>。在决定使用它之前，问问自己是否还有其他方式可以实现你的目标。</p>\n<p><a href=\"https://tylermcginnis.com/imperative-vs-declarative-programming/\" target=\"_blank\" rel=\"noopener noreferrer\">Imperative vs Declarative Programming</a></p>\n<p>:::</p>\n",
      "date_published": "2025-07-16T00:00:00.000Z",
      "date_modified": "2025-07-22T06:35:28.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "Portals",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/06-createPortal.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/06-createPortal.html",
      "summary": "有一些场景下，需要将组件渲染在正常的文档流外部，比如一个模态框，需要渲染在 body 元素的顶部。 你可以通过 useEffect 来创建一个 DOM 节点，并将其添加到文档中，然后在组件卸载时将其删除。但是，这个模式非常常见，React 提供了一个内置的方法来实现这个功能，那就是 ReactDOM.createPortal。 createPortal...",
      "content_html": "<p>有一些场景下，需要将组件渲染在正常的文档流外部，比如一个模态框，需要渲染在 <code>body</code> 元素的顶部。</p>\n<p>你可以通过 <code>useEffect</code> 来创建一个 DOM 节点，并将其添加到文档中，然后在组件卸载时将其删除。但是，这个模式非常常见，React 提供了一个内置的方法来实现这个功能，那就是 <code>ReactDOM.createPortal</code>。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createPortal <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Modal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\ttitle<span class=\"token punctuation\">,</span>\n\tcontent<span class=\"token punctuation\">,</span>\n\thandleClose<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\ttitle<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n\tcontent<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n\t<span class=\"token function-variable function\">handleClose</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">createPortal</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>modal<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>content<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">,</span>\n\t\tdocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showModal<span class=\"token punctuation\">,</span> setShowModal<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">setShowModal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Show Modal</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token punctuation\">{</span>showModal <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Modal</span></span>\n\t\t\t\t\t<span class=\"token attr-name\">title</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>My Modal<span class=\"token punctuation\">\"</span></span>\n\t\t\t\t\t<span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>This is the content of the modal<span class=\"token punctuation\">\"</span></span>\n\t\t\t\t\t<span class=\"token attr-name\">handleClose</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">setShowModal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n\t\t\t\t<span class=\"token punctuation\">/&gt;</span></span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>createPortal</code> 接收两个参数：</p>\n<ul>\n<li>第一个参数是你要渲染的 UI，它有访问 props、state 等的能力。</li>\n<li>第二个参数是你要渲染到的 DOM 节点。</li>\n</ul>\n<p>在这个例子中，我们把模态框渲染到了 <code>body</code> 元素。</p>\n<ul>\n<li><a href=\"https://react.dev/reference/react-dom/createPortal\" target=\"_blank\" rel=\"noopener noreferrer\">the <code>createPortal</code> docs</a></li>\n</ul>\n",
      "date_published": "2025-07-16T00:00:00.000Z",
      "date_modified": "2025-07-16T09:19:21.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "useReducer",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/05-useReducer.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/05-useReducer.html",
      "summary": "A hook for managing state with a reducer function",
      "content_html": "<p><code>useState</code> 可以满足大部分状态管理的需求，有时你希望将状态逻辑与进行状态更改的组件分开。此外，如果你有多个状态元素通常会一起改变，那么有一个包含所有状态元素的对象可能很有帮助。这时使用 <code>useReducer</code> 是一个更好的选择。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useReducer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> age<span class=\"token operator\">:</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>useReducer</code> 接收一个 <code>reducer</code> 函数和一个初始状态，返回一个包含当前状态和 <code>dispatch</code> 函数的数组。</p>\n<ul>\n<li><code>reducer</code>：指定数据如何更新，<code>reducer</code> 函数必须为纯函数，接收当前状态和 action 作为参数，并返回下一个状态。状态和 action 可以是任何类型。\n<ul>\n<li><code>state</code>：当前状态</li>\n<li><code>action</code>：触发状态改变的 action</li>\n</ul>\n</li>\n<li><code>initialArg</code>：初始状态的值，可以是任何类型。初始状态的计算取决于下一个 <code>init</code> 参数。</li>\n<li><code>optional init</code>：初始化函数，返回初始状态。如果未指定，则初始状态设置为 <code>initialArg</code>。否则，初始状态设置为 <code>init(initialArg)</code> 的结果。</li>\n</ul>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useReducer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'incremented_age'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      age<span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>age <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Unknown action.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> age<span class=\"token operator\">:</span> <span class=\"token number\">42</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'incremented_age'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        Increment age\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello! You are </span><span class=\"token punctuation\">{</span>state<span class=\"token punctuation\">.</span>age<span class=\"token punctuation\">}</span><span class=\"token plain-text\">.</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>useReducer</code> 类似 <code>useState</code>，但他可以将逻辑与组件分离，并且可以处理多个状态元素。</p>\n",
      "date_published": "2025-07-03T00:00:00.000Z",
      "date_modified": "2025-07-04T11:02:47.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "useId",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/04-useId.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/04-useId.html",
      "summary": "useId 钩子用于生成唯一且稳定的标识符（ID），可以用于 DOM 元素，传入给 attribute。 在可重用组件中，特别是在同一页面上多次使用时，这会变得具有挑战性。你不能硬编码一个 id 值，因为那样会有多个具有相同 id 的元素，这是无效的 HTML。你可以使用随机数或字符串，但那样你需要自己管理，并且它不会在渲染之间保持一致。如果你想要服务...",
      "content_html": "<p><code>useId</code> 钩子用于生成唯一且稳定的标识符（ID），可以用于 DOM 元素，传入给 <code>attribute</code>。</p>\n<p>在可重用组件中，特别是在同一页面上多次使用时，这会变得具有挑战性。你不能硬编码一个 <code>id</code> 值，因为那样会有多个具有相同 <code>id</code> 的元素，这是无效的 HTML。你可以使用随机数或字符串，但那样你需要自己管理，并且它不会在渲染之间保持一致。如果你想要服务器渲染你的应用，你需要确保客户端生成的 ID 与服务器生成的 ID 匹配，以避免 bug，这很痛苦。</p>\n<p>这就是 <code>useId</code> 钩子发挥作用的地方。</p>\n<p><code>useId</code> 钩子生成一个唯一且稳定的标识符（ID），你可以用于 DOM 元素。</p>\n<p>这是一个如何在表单组件中使用 <code>useId</code> 钩子的示例：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">FormField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> <span class=\"token function\">useId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">htmlFor</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Name:</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>id<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>在这个示例中，<code>useId</code> 生成一个唯一 ID，将标签与输入关联起来，确保屏幕阅读器和其他辅助技术可以正确识别表单字段关系。</p>\n<p>与 <code>useState</code> 或 <code>useEffect</code> 不同，<code>useId</code> 不接受任何参数并返回一个单个字符串值。没有 setter 或 updater 函数，因为提供的 ID 应该在整个组件的生命周期中保持不变且唯一。</p>\n<p>它在服务器端渲染（SSR）上下文中特别有用，因为它确保服务器生成的 ID 与客户端生成的 ID 之间的一致性，避免 hydration 不匹配。</p>\n<p>记住，<code>useId</code> 的主要用途是用于可访问性和管理不同 DOM 元素之间的关系，如标签和输入。它帮助保持你的 UI 可预测且可访问，而无需自己管理唯一 ID。</p>\n<p>一个重要的事情是，你不应该使用 <code>useId</code> 为非 DOM 元素生成 ID，如列表中的键或 React 元素的唯一键。这些 ID 应该来自你的数据，而不是 <code>useId</code>。</p>\n",
      "date_published": "2025-06-26T00:00:00.000Z",
      "date_modified": "2025-06-26T03:54:00.000Z",
      "authors": [],
      "tags": [
        "react"
      ]
    },
    {
      "title": "useRef",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/03-useRef.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/03-useRef.html",
      "summary": "使用 React 时，通常需要直接与 DOM 交互。你可能需要使用一个需要直接与 DOM 交互的非框架特定的库。通常为了使 UI 可访问，你需要考虑焦点管理，这需要你调用输入框的 .focus() 方法。 记住，当你这样做时：<div>hi</div>，实际上是 React.createElement 的语法糖，所以你实际上无法在渲染方法中访问 DOM...",
      "content_html": "<p>使用 React 时，通常需要直接与 DOM 交互。你可能需要使用一个需要直接与 DOM 交互的非框架特定的库。通常为了使 UI 可访问，你需要考虑焦点管理，这需要你调用输入框的 <code>.focus()</code> 方法。</p>\n<p>记住，当你这样做时：<code>&lt;div&gt;hi&lt;/div&gt;</code>，实际上是 <code>React.createElement</code> 的语法糖，所以你实际上无法在渲染方法中访问 DOM 节点。事实上，DOM 节点在 <code>ReactDOM.createRoot().render()</code> 方法被调用之前根本不存在。你的组件的渲染方法实际上只是负责创建和返回 React 元素，与 DOM 本身无关。</p>\n<p>因此，为了访问 DOM，你需要让 React 在渲染组件时给你提供对特定 DOM 节点的访问。这通过一个特殊的属性 <code>ref</code> 来实现。</p>\n<p>有两种使用 <code>ref</code> 属性的方法：回调和 <code>useRef</code> 钩子。</p>\n<p><strong>ref callback:</strong></p>\n<p>最简单的方法是使用 <code>ref</code> 属性并传递一个回调：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">MyDiv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n\t\t\t<span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>myDiv <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">here's my div!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> myDiv<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">cleanup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">my div is getting removed from the page!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> myDiv<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n\t\t<span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n\t\t\tHey, this is my div!\n\t\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>出于向后兼容的原因，TypeScript 会告诉你 <code>myDiv</code> 可以是 <code>HTMLDivElement</code> 或 <code>null</code>。因此，你可能需要处理 <code>null</code> 的情况（通常，只需提前返回）。在未来，它将永远不会是 <code>null</code>。</p>\n</div>\n<p><strong>ref object:</strong></p>\n<p>对于更复杂的使用场景（例如，需要在初始渲染后与 DOM 交互），可以使用 <code>useRef</code> 钩子。</p>\n<p>这是一个使用 <code>ref</code> 属性和 <code>useRef</code> 的简单示例：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">MyDiv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> myDivRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLDivElement<span class=\"token operator\">&gt;</span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> myDiv <span class=\"token operator\">=</span> myDivRef<span class=\"token punctuation\">.</span>current\n\t\t<span class=\"token comment\">// myDiv is the div DOM node!</span>\n\t\t<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myDiv<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>myDivRef<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">hi</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>使用 <code>ref</code> 对象的优点是你可以将 ref 对象存储在变量中，并在 <code>useEffect</code> 回调或事件处理程序中安全地访问它。</p>\n<p>组件渲染后，它被认为是“已挂载”。这就是 <code>useEffect</code> 回调被调用的时候，所以到那时，ref 应该有它的 <code>current</code> 属性设置为 DOM 节点。因此，你通常会在 <code>useEffect</code> 回调中进行直接 DOM 交互/操作。</p>\n<p>每个元素都有一个特殊的 <code>ref</code> 属性（如上所示）。你将 ref 传递给该属性，React 将为你提供对该元素创建的元素的引用。</p>\n<p>你还可以将 <code>ref</code> 传递给函数组件，该组件可以将 <code>ref</code> 转发到另一个元素，或者它可以使用 <code>useImperativeHandle</code> 在上面添加一些方便的方法。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>直接将 <code>ref</code> 传递作为 <code>props</code> 给函数组件，在 React 18 中需要使用 <code>forwardRef</code> 来转发 <code>ref</code>。</p>\n<p>React19 中，<code>forwardRef</code> 已经废弃，直接将 <code>ref</code> 传递作为 <code>props</code> 给函数组件即可。</p>\n</div>\n",
      "date_published": "2025-06-26T00:00:00.000Z",
      "date_modified": "2025-06-26T03:44:06.000Z",
      "authors": [],
      "tags": [
        "react"
      ]
    },
    {
      "title": "Video.js Component 开发指南",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/022-videojs-component.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/022-videojs-component.html",
      "summary": "Video.js Component 基础概念 什么是 Video.js Component？ Video.js Component 是基于 Video.js Player 框架的可扩展 UI 元素，用于增强视频播放器的功能和用户体验。每个 Component 都是独立的、可重用的模块。 Component 继承关系 核心 API Component ...",
      "content_html": "<h2><strong>Video.js Component 基础概念</strong></h2>\n<h3>什么是 Video.js Component？</h3>\n<p>Video.js Component 是基于 Video.js Player 框架的可扩展 UI 元素，用于增强视频播放器的功能和用户体验。每个 Component 都是独立的、可重用的模块。</p>\n<h3>Component 继承关系</h3>\n<h3>核心 API</h3>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token comment\">// 基础 Component 类</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">videojs</span><span class=\"token punctuation\">.</span><span class=\"token function\">getComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Component'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>player<span class=\"token operator\">:</span> Player<span class=\"token punctuation\">,</span> options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>player<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 初始化逻辑</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 获取 DOM 元素</span>\n  <span class=\"token function\">el</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> HTMLElement\n\n  <span class=\"token comment\">// 添加/移除 CSS 类</span>\n  <span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span>className<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n  <span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span>className<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n\n  <span class=\"token comment\">// 事件绑定</span>\n  <span class=\"token function\">on</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> handler<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n  <span class=\"token function\">off</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> handler<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n\n  <span class=\"token comment\">// 清理资源</span>\n  <span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre></div>",
      "date_published": "2025-06-20T00:00:00.000Z",
      "date_modified": "2025-06-20T03:26:47.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "react fundamentals",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/00-fundaments.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/react/00-fundaments.html",
      "summary": "Hello Word In JS 在使用 react 之前，我们通常会使用原生 js 来写一些简单的页面。 In React React 按照原生 DOM 的操作逻辑，使用 createElement 方法来创建元素，并使用 render 方法来渲染元素。 提示 React 是一个跨平台的框架，用于描述 UI 结构和状态逻辑。而 React DOM 是...",
      "content_html": "<h2>Hello Word</h2>\n<h3>In JS</h3>\n<p>在使用 react 之前，我们通常会使用原生 js 来写一些简单的页面。</p>\n<div class=\"language-html\" data-ext=\"html\" data-title=\"html\"><pre class=\"language-html\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> rootElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span>\n\nelement<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'container'</span>\nelement<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Hello Word'</span>\n\nrootElement<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span>\n</code></pre></div><h3>In React</h3>\n<p>React 按照原生 DOM 的操作逻辑，使用 <code>createElement</code> 方法来创建元素，并使用 <code>render</code> 方法来渲染元素。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createElement <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRoot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom/client'</span>\n\n<span class=\"token keyword\">const</span> rootElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">className</span><span class=\"token operator\">:</span> <span class=\"token string\">'container'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Hello Word'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>rootElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>React 是一个跨平台的框架，用于描述 UI 结构和状态逻辑。而 React DOM 是 React 的 DOM 渲染器，用于在浏览器中渲染 React 组件。类似的还有 React Native，用于在移动端渲染 React 组件。</p>\n</div>\n<p><code>createElement</code> 方法的第一个参数是标签名，第二个参数是属性 <code>props</code>，第三个参数（以及后续参数）会被收集起来，作为子元素 <code>children</code>。</p>\n<h3>嵌套</h3>\n<p>若要实现一个深度嵌套的组件，需要一层一层的嵌套，这样代码会变得非常臃肿，类似下面这样：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// &lt;div class=\"container\"&gt;</span>\n<span class=\"token comment\">// \t&lt;p&gt;Nested list&lt;/p&gt;</span>\n<span class=\"token comment\">// \t&lt;ul class=\"content\"&gt;</span>\n<span class=\"token comment\">// \t\t&lt;li&gt;This is a nested list item&lt;/li&gt;</span>\n<span class=\"token comment\">// \t\t&lt;li&gt;This is a nested list item&lt;/li&gt;</span>\n<span class=\"token comment\">// \t&lt;/ul&gt;</span>\n<span class=\"token comment\">// &lt;/div&gt;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createElement <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createRoot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom/client'</span>\n\n<span class=\"token keyword\">const</span> rootElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">className</span><span class=\"token operator\">:</span> <span class=\"token string\">'container'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Nested list'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'ul'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">className</span><span class=\"token operator\">:</span> <span class=\"token string\">'content'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'This is a nested list item'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'This is a nested list item'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>rootElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span>\n</code></pre></div><p>因此 React 提供了 JSX 语法，让我们可以更方便地编写组件。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>在 JSX 中，<code>className</code> 表示类名，而不是 HTML 中的 <code>class</code>，因为在 JavaScript 中，<code>class</code> 是保留字，且 DOM 的类名属性是 <code>className</code>。</p>\n</div>\n<h2>JSX</h2>\n<p>JSX 是 React 的语法扩展，允许我们在 JavaScript 中使用类似于 HTML 的语法来描述 UI 结构。在生产环境中，打包工具（如 <a href=\"https://webpack.js.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Webpack</a>、<a href=\"https://vite.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">Vite</a>）会使用 <a href=\"https://babeljs.io/\" target=\"_blank\" rel=\"noopener noreferrer\">babel</a> 自动将 JSX 转换为 <code>createElement</code> 方法调用。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20250610120118.png\" alt=\"babel\" tabindex=\"0\" loading=\"lazy\"><figcaption>babel</figcaption></figure>\n<p>上面复杂嵌套结构在 JSX 中可以简化为：</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Nested list</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>content<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">This is a nested list item</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">This is a nested list item</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">createRoot</span><span class=\"token punctuation\">(</span>rootElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span>\n</code></pre></div><h3>插值</h3>\n<p>类似模板字符串，JSX 中也可以使用插值。你可以在里面写 JavaScript 表达式。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> world <span class=\"token operator\">=</span> <span class=\"token string\">'World'</span>\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello, </span><span class=\"token punctuation\">{</span>world<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><h3>Spread</h3>\n<p>Spread 允许你将一个对象的所有属性复制到另一个对象。因此，如果有一个对象 <code>props</code>，你可以将它展开，然后传递给 <code>createElement</code> 方法。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> children <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World'</span>\n<span class=\"token keyword\">const</span> className <span class=\"token operator\">=</span> <span class=\"token string\">'container'</span>\n<span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> className <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>props <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>在 JSX 中，也可以使用该特性，将 <code>props</code> 展开。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> children <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World'</span>\n<span class=\"token keyword\">const</span> className <span class=\"token operator\">=</span> <span class=\"token string\">'container'</span>\n<span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> className <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n</code></pre></div><h3>Fragment</h3>\n<p>React Fragments 允许你将多个元素组合在一起，而不会添加额外的 DOM 节点。这让你可以在组件中返回多个元素，而无需使用额外的 <code>div</code> 包装。这在避免不必要的标记影响样式或布局时非常有用。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Fragment</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello, World</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">This is a paragraph.</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Fragment</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div><p>也可以使用空标签 <code>&lt;&gt;&lt;/&gt;</code> 来代替 <code>Fragment</code>。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello, World</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">This is a paragraph.</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div><h2>组件</h2>\n<p>如果我们需要生成以下的 DOM 结构：</p>\n<div class=\"language-html\" data-ext=\"html\" data-title=\"html\"><pre class=\"language-html\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>message<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>message<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Goodbye World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><p>我们可以使用组件来生成这个结构。到目前为止，<code>createElement</code> 的第一个参数都只传入了一个字符串，表示标签名。但是，它还可以接受一个函数，这个函数会返回需要渲染的结构。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n\tsomeFunction<span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">prop1</span><span class=\"token operator\">:</span> <span class=\"token string\">'value1'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">prop2</span><span class=\"token operator\">:</span> <span class=\"token string\">'value2'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">'child1'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string\">'child2'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div><p><code>someFunction</code> 会以 <code>props</code> 对象作为第一个参数，而 <code>children</code> 会作为 <code>props</code> 对象的 <code>children</code> 属性。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">someFunction</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tprops<span class=\"token punctuation\">.</span>children <span class=\"token comment\">// ['child1', 'child2']</span>\n\tprops<span class=\"token punctuation\">.</span>prop1 <span class=\"token comment\">// 'value1'</span>\n\tprops<span class=\"token punctuation\">.</span>prop2 <span class=\"token comment\">// 'value2'</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token comment\">// some jsx</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这样即可实现组件的复用。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">message</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"message\"</span><span class=\"token operator\">&gt;</span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">&gt;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"container\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token punctuation\">{</span>React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token string\">'Hello World'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">{</span>React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token string\">'Goodbye World'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">&gt;</span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div><p>我们想在 JSX 中像 <code>div</code> 一样使用这个组件：</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>message</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello World</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>message</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><p><code>Babel</code> 负责将 JSX 组件编译成 <code>createElement</code> 调用。如果我们尝试 <code>&lt;message&gt;Hello World&lt;/message&gt;</code>，<code>Babel</code> 会这样做：</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>message</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello World</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>message</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token comment\">// the desired output</span>\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token string\">'Hello World'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// the actual output</span>\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token string\">'Hello World'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>因此，我们只需要告诉 <code>Babel</code> 如何编译我们的 JSX，让它通过函数名而不是字符串来传递函数。下面是一些 <code>Babel</code> 输出的 JSX 示例：</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code>element <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Capitalized</span></span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement(Capitalized)</span>\nelement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property.access</span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement(property.access)</span>\nelement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Property.Access</span></span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement(Property.Access)</span>\nelement <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>Property<span class=\"token punctuation\">[</span><span class=\"token string\">'Access'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span><span class=\"token operator\">&gt;</span> <span class=\"token comment\">// SyntaxError</span>\nelement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lowercase</span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement('lowercase')</span>\nelement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>kebab-case</span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement('kebab-case')</span>\nelement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Upper-Kebab-Case</span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement('Upper-Kebab-Case')</span>\nelement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Upper_Snake_Case</span></span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement(Upper_Snake_Case)</span>\nelement <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>lower_snake_case</span> <span class=\"token punctuation\">/&gt;</span></span> <span class=\"token comment\">// createElement('lower_snake_case')</span>\n</code></pre></div><p>因此，最终需要将组件名首字母大写，这样 <code>Babel</code> 才会将它编译成 <code>createElement</code> 调用。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">Message</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>message<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello World</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Message</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Goodbye World</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Message</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">)</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>Components are functions which accept an object called <code>props</code> and return something that is renderable.</p>\n</div>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20250610120118.png",
      "date_published": "2025-06-10T00:00:00.000Z",
      "date_modified": "2025-06-10T09:10:35.000Z",
      "authors": [],
      "tags": [
        "react"
      ]
    },
    {
      "title": "网络模型",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/01-network-model.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/01-network-model.html",
      "summary": "TCP/IP 网络体系 TCP/IP 体系结构分为四层，是事实上的国际标准，各层如下所示： 应用层 为用户提供应用功能，拥有不同的应用层协议，用来定义应用进程间的交互规则，以完成特定的网络应用，例如 HTTP（万维网）、SMTP（电子邮件）、DNS（域名查询）、FTP（文件传输） 等等； 运输层 负责为 两台主机中的进程 提供通信服务，其中的两个重要协...",
      "content_html": "<h2>TCP/IP 网络体系</h2>\n<p>TCP/IP 体系结构分为四层，是事实上的国际标准，各层如下所示：</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code></code></pre></div>",
      "date_published": "2022-05-06T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "HTTP 概述",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/02-http-overview.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/02-http-overview.html",
      "summary": "超文本传输协议（HyperText Transfer Protocol, HTTP）一般是用于浏览器和服务器之间传输文字、图片、音频视频等超文本数据的应用层协议。 HTTP 协议特性 简单：HTTP 基本的报文格式就是 header + body，头部信息也是 key-value 的简单文本形式，易于理解，降低了学习和使用的门槛。 灵活易扩展：HTTP...",
      "content_html": "<p>超文本传输协议（HyperText Transfer Protocol, HTTP）一般是用于浏览器和服务器之间传输文字、图片、音频视频等超文本数据的应用层协议。</p>\n<h2>HTTP 协议特性</h2>\n<ul>\n<li>简单：HTTP 基本的报文格式就是 header + body，头部信息也是 key-value 的简单文本形式，易于理解，降低了学习和使用的门槛。</li>\n<li>灵活易扩展：HTTP/1.0 出现的 HTTP headers 让协议扩展变得非常容易，只要服务端和客户端对新 headers 达成语义一致，新功能就可以被添加进来。</li>\n<li>无连接：每次连接只处理一个请求。服务器处理完客户端的请求，并收到客户端的应答后，就会断开连接，HTTP 1.1 可以开启长连接。</li>\n<li>无状态：对于事物处理没有记忆能力。因此浏览器无法保存用户的登录信息，每次进行需要登录才能执行的操作时，都需要输入用户名和密码。而 cookie 可以创建有状态的会话。好处在于服务器不会记忆 HTTP 的状态，能减轻服务器的压力。</li>\n<li>明文传输：给调试带来便利性，但是用户毫无隐私可言，不安全。</li>\n</ul>\n<h2>HTTP 报文格式</h2>\n<h3>请求报文格式</h3>\n<p>客户端发送 HTTP 请求到服务器的请求消息：<strong>请求行、请求头、空行和请求体四个部分组成。</strong></p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>POST / HTTP1.1\nHost:www.wrox.com\nUser-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)\nContent-Type:application/x-www-form-urlencoded\nContent-Length:40\nConnection: Keep-Alive\n\nname=Professional%20Ajax&amp;publisher=Wiley\n</code></pre></div><p>第一部分：请求行，请求方法 + URI + HTTP 版本。</p>\n<p>第二部分：请求头部。</p>\n<p>第三部分：空行。</p>\n<p>第四部分：请求数据。</p>\n<h3>响应报文格式</h3>\n<p>服务器响应也由四个部分组成，分别是：<strong>响应行、响应头、空行和响应体</strong>。</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>HTTP/1.1 200 OK\nDate: Fri, 22 May 2009 06:07:21 GMT\nContent-Type: text/html; charset=UTF-8\n\n&lt;html&gt;\n  &lt;head&gt;&lt;/head&gt;\n  &lt;body&gt;\n    &lt;!--body goes here--&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre></div><h2>HTTP 常见状态码</h2>\n<ul>\n<li>1xx：提示信息，表示目前是协议处理的中间状态，还需进一步操作；</li>\n<li>2xx：成功，表示请求已被成功收到并正确处理；</li>\n<li>3xx：重定向，资源位置发生变动，需要客户端重新发送请求；</li>\n<li>4xx：客户端错误，请求报文有误，服务器无法处理；</li>\n<li>5xx：服务器错误，服务器在处理请求时内部发生了错误。</li>\n</ul>\n<p>| 常见状态码                | 状态描述                                                         |<br>\n|</p>\n",
      "date_published": "2022-04-20T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "GET 和 POST 的区别",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/03-get-post-difference.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/03-get-post-difference.html",
      "summary": "概述 GET 和 POST 是 HTTP 协议中发送请求的方法。 GET：请求资源，从服务器获取数据； POST：将数据提交到指定地址。 二者本质上都是 TCP 链接，因此本质上没有区别，但由于 HTTP 规定和浏览器/服务器的限制，导致它们在实际操作中会有一定区别。 区别 GET 在浏览器回退时是无害的，而 POST 会再次提交请求。 GET 产生的...",
      "content_html": "<h2>概述</h2>\n<p>GET 和 POST 是 HTTP 协议中发送请求的方法。</p>\n<ul>\n<li>GET：请求资源，从服务器获取数据；</li>\n<li>POST：将数据提交到指定地址。</li>\n</ul>\n<p>二者本质上都是 TCP 链接，因此本质上<strong>没有区别</strong>，但由于 HTTP 规定和浏览器/服务器的限制，导致它们在实际操作中会有一定区别。</p>\n<h2>区别</h2>\n<ul>\n<li>GET 在浏览器回退时是无害的，而 POST 会再次提交请求。</li>\n<li>GET 产生的 URL 地址可以被 Bookmarked，而 POST 不可以。</li>\n<li>GET 请求会被浏览器主动 cache，而 POST 不会，除非手动设置。</li>\n<li>GET 请求只能进行 url 编码，而 POST 支持多种编码方式。</li>\n<li>GET 请求参数会被完整保留在浏览器历史记录里，而 POST 中的参数不会被保留。</li>\n<li>GET 请求在 URL 中传送的参数是有长度限制的，而 POST 没有。</li>\n<li>对参数的数据类型，GET 只接受 ASCII 字符，而 POST 没有限制。</li>\n<li>GET 比 POST 更不安全，因为参数直接暴露在 URL 上，所以不能用来传递敏感信息。</li>\n<li>GET 参数通过 URL 传递，POST 放在 Request body 中。</li>\n<li>GET 方法是安全且幂等的，POST 方法是<strong>不安全且不幂等</strong>的。</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<ul>\n<li>安全：请求方法不会破坏服务器上的资源；</li>\n<li>幂等：执行多次相同的操作，结果都是相同的。</li>\n</ul>\n</div>\n<h2>误区</h2>\n<h3>参数长度</h3>\n<p>GET 参数有长度限制，但这是因为浏览器对 URL 的长度限制，而不是 HTTP 协议本身对参数长度的限制。HTTP 同样对 POST 参数长度没有限制，而是靠服务器的设置来限制大小的。</p>\n<h3>安全性</h3>\n<p>POST <strong>相对</strong>比 GET 安全性要高。</p>\n<p>通过 GET 提交的请求都将显示到 URL 上，页面会被浏览器缓存，其他人查看历史记录会看到提交的数据。</p>\n<p>这里的相对在于：<strong>HTTP 本身是明文传输的协议</strong>，无论使用 GET 还是 POST 都有可能受到中间人攻击而造成数据泄露。</p>\n<p>如果 HTTP 链接使用 SSL/TLS，那么 GET 参数也会被加密，但是仍然会在某些地方出现，比如服务器日志、浏览器插件和其他应用。而 POST 数据会被加密并且不会被任何方式泄露。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>因此如果想要保证总是安全地传输数据，需要使用 HTTPS 上的 POST。</p>\n</div>\n<h3>Request Body</h3>\n<p>GET 可以带 Request Body，但不能保证一定能被接收到。如果你用 GET 请求，在 Request Body 携带数据，不同服务器的处理方式也是不同的，有些服务器会帮你读出数据，有些服务器直接忽略。</p>\n<h3>数据包</h3>\n<p>对于 GET 请求，浏览器会把 http header 和 data 一并发送出去，服务器响应 200（返回数据）。</p>\n<p>对于 POST，浏览器先发送 header，服务器响应 100 continue，浏览器再发送 data，服务器响应 200 ok。</p>\n<p>并不是所有浏览器都会在 POST 中发送两次包，Firefox 就只发送一次。</p>\n<h2>参考链接</h2>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/3063530/what-is-the-difference-between-get-and-post-encryption\" target=\"_blank\" rel=\"noopener noreferrer\">https - What is the difference between GET and POST encryption? - Stack Overflow</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==&amp;mid=100000054&amp;idx=1&amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4#rd\" target=\"_blank\" rel=\"noopener noreferrer\">99%的人都理解错了 HTTP 中 GET 与 POST 的区别 (qq.com)</a></li>\n<li><a href=\"https://github.com/febobo/web-interview/issues/145\" target=\"_blank\" rel=\"noopener noreferrer\">面试官：说一下 GET 和 POST 的区别？ · Issue #145 · febobo/web-interview (github.com)</a></li>\n</ul>\n",
      "date_published": "2022-04-24T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "HTTP 性能演变",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/04-http-development.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/04-http-development.html",
      "summary": "整个 HTTP 的演变史就是一个在不断优化性能的过程。 HTTP/0.9 - 单行协议 最初版本的 HTTP 协议并没有版本号，后来它的版本号被定位在 0.9 以区分后来的版本。 HTTP/0.9 极其简单：请求由单行指令构成，以唯一可用方法 GET 开头，其后跟目标资源的路径（一旦连接到服务器，协议、服务器、端口号这些都不是必须的）。 HTTP/0....",
      "content_html": "<p>整个 HTTP 的演变史就是一个在不断优化性能的过程。</p>\n<h2>HTTP/0.9 - 单行协议</h2>\n<p>最初版本的 HTTP 协议并没有版本号，后来它的版本号被定位在 0.9 以区分后来的版本。</p>\n<p>HTTP/0.9 极其简单：请求由单行指令构成，以唯一可用方法 GET 开头，其后跟目标资源的路径（一旦连接到服务器，协议、服务器、端口号这些都不是必须的）。</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>GET /mypage.html\n</code></pre></div><p>HTTP/0.9 的响应内容不包含 HTTP 头，这意味着只有 HTML 文件可以传送，无法传送其他类型的文件；也没有状态码或错误代码；一旦出现问题，一个特殊的包含问题描述信息的 HTML 文件将会被返回。</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>&lt;HTML&gt;\n这是一个非常简单的HTML页面\n&lt;/HTML&gt;\n</code></pre></div><p><strong>总结：</strong></p>\n<ul>\n<li>请求只有一个请求行；</li>\n<li>响应只有一个响应体，且只能返回 HTML 文件；</li>\n</ul>\n<h2>HTTP/1.0 - 构建可扩展性</h2>\n<p>由于 HTTP/0.9 协议的应用十分有限，HTTP/1.0 在其基础上增加了很多新特性：</p>\n<ul>\n<li>协议版本信息现在会随着每个请求行发送。</li>\n<li>状态码在响应开始时发送，使浏览器能了解请求执行成功或失败，并调整相应行为（如更新或使用本地缓存）。</li>\n<li>引入了 HTTP 头的概念，使协议变得灵活易扩展。</li>\n<li>Content-Type 头使传输除 HTML 文件以为其他类型文件的可能。</li>\n</ul>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>// 请求\nGET /mypage.html HTTP/1.0\nUser-Agent: NCSA_Mosaic/2.0 (Windows 3.1)\n\n// 响应\n200 OK\nDate: Tue, 15 Nov 1994 08:12:31 GMT\nServer: CERN/3.0 libwww/2.17\nContent-Type: text/html\n&lt;HTML&gt;\n一个包含图片的页面\n  &lt;IMG SRC=\"/myimage.gif\"&gt;\n&lt;/HTML&gt;\n</code></pre></div><h2>HTTP/1.1</h2>\n<p>HTTP/1.0 采用短连接方式，即每次请求一个文件都需要和浏览器建立 TCP 连接，当收到响应后就会立即关闭连接，这样会造成不必要的时间开销。</p>\n<p>为了减少时延，浏览器通常会建立多个并行的 TCP 连接同时请求多个对象。但是这会占用大量服务器的资源。</p>\n<p>HTTP/1.1 相比于 HTTP/1.0 性能上的改进：</p>\n<ul>\n<li>使用 TCP 长连接的方式改善了 HTTP/1.0 短连接造成的性能开销；</li>\n<li>支持管道网络传输，只要第一个请求发出，不必等待响应，就可以直接发送第二个请求，减少整体的响应时间（流水线方式工作）。</li>\n</ul>\n<p>但是 HTTP/1.1 还是有性能瓶颈：</p>\n<ul>\n<li>只能压缩 body 部分，请求/响应头部未经压缩就发送，头部信息越多延迟越大；</li>\n<li>发送冗长的首部，每次互相发送相同的首部造成的浪费比较多；</li>\n<li>服务器是按请求顺序响应的，如果服务器响应过慢，会导致客户端一直请求不到后面的数据，也就是<strong>队头阻塞</strong>；</li>\n<li>没有请求优先级控制；</li>\n<li>请求只能从客户端开始，服务器只能被动响应。</li>\n</ul>\n<h2>HTTP/2.0</h2>\n<p>HTTP/2.0 是基于 HTTPS 的，所以安全性有所保证。HTTP/2.0 相比 HTTP/1.1 性能上的改进：</p>\n<ul>\n<li>头部压缩：如果同时发出多个请求，他们的头是一样或相似的，那么协议会消除重复的部分；</li>\n<li>采用二进制格式：头信息和数据体都是二进制，并统称为帧，头信息帧和数据帧，增加了数据传输的效率；</li>\n<li>多路复用：可以在一个连接中并发多个请求或响应，而不用按照顺序一一对应，解决了队头阻塞的问题；</li>\n<li>可以指定数据流的优先级；</li>\n<li>服务器可以主动向客户端发送消息。</li>\n</ul>\n<p>缺陷在于：多个 HTTP 请求复用一个 TCP 连接，一旦发生丢包现象，就会触发 TCP 的重传机制，这样在一个 TCP 连接中的所有 HTTP 请求都必须等待这个丢了的包被重传回来。</p>\n<h2>HTTP/3.0</h2>\n<p>HTTP/2.0 基于 TCP 传输层，导致丢包下阻塞所有 HTTP 请求的问题，因此 HTTP/3.0 把 HTTP 下层的 TCP 协议改成了 UDP。</p>\n<p>UDP 是不可靠传输，但是基于 UDP 的 QUIC 协议可以实现类似 TCP 的可靠传输。</p>\n<h2>参考链接</h2>\n<p><a href=\"https://xiaolincoding.com/network/2_http/http_interview.html#http-1-1%E3%80%81http-2%E3%80%81http-3-%E6%BC%94%E5%8F%98\" target=\"_blank\" rel=\"noopener noreferrer\">3.1 HTTP 常见面试题 | 小林 coding (xiaolincoding.com)</a></p>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP#%E5%90%8Ehttp2%E8%BF%9B%E5%8C%96\" target=\"_blank\" rel=\"noopener noreferrer\">HTTP 的发展 - HTTP | MDN (mozilla.org)</a></p>\n<p><a href=\"https://www.bilibili.com/video/BV1c4411d7jb?p=73\" target=\"_blank\" rel=\"noopener noreferrer\">计算机网络微课堂（有字幕无背景音乐版）_哔哩哔哩_bilibili</a></p>\n",
      "date_published": "2022-04-26T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "HTTP 缓存",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/05-http-cache.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/05-http-cache.html",
      "summary": "对于一些相同的请求，通过复用以前获取的资源，显著提高网页的性能。Web 缓存减少了等待时间和流量，因此减少了显示资源的渲染时间。 HTTP 缓存的实现有两种方式，分别是强制缓存和协商缓存。 强缓存 强缓存是指：只要浏览器判断缓存没有过期，则直接使用本地缓存，不会向服务器发送请求。 强缓存是利用下面这两个字段实现的，它们都用来表示资源在客户端缓存的有效期...",
      "content_html": "<p>对于一些相同的请求，通过复用以前获取的资源，显著提高网页的性能。Web 缓存减少了等待时间和流量，因此减少了显示资源的渲染时间。</p>\n<p>HTTP 缓存的实现有两种方式，分别是<strong>强制缓存</strong>和<strong>协商缓存</strong>。</p>\n<h2>强缓存</h2>\n<p>强缓存是指：只要浏览器判断缓存没有过期，则直接使用本地缓存，不会向服务器发送请求。</p>\n<p>强缓存是利用下面这两个字段实现的，它们都用来表示资源在客户端缓存的有效期。</p>\n<ul>\n<li><code>Expires</code>：绝对时间；</li>\n<li><code>Cache-Control</code>：缓存指令。</li>\n</ul>\n<h3>Expires</h3>\n<p>响应头包含的日期时间，在这个时间前，浏览器都不会再发起请求，而是直接使用缓存资源。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token literal-property property\">Expires</span><span class=\"token operator\">:</span> Wed<span class=\"token punctuation\">,</span> <span class=\"token number\">21</span> Oct <span class=\"token number\">2015</span> <span class=\"token number\">07</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">00</span> <span class=\"token constant\">GMT</span>\n</code></pre></div><h3>Cache-Control</h3>\n<p>通用消息头字段，通过指定指令来实现缓存机制。缓存指令是单向的，这意味着在请求中设置的指令，不一定被包含在响应中。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>Cache<span class=\"token operator\">-</span>Control<span class=\"token operator\">:</span> max<span class=\"token operator\">-</span>age<span class=\"token operator\">=</span><span class=\"token number\">20000</span>\n</code></pre></div><p><code>max-age=&lt;seconds&gt;</code> 可以设置过期时间（单位秒），相对于请求的时间计算。</p>\n<p>具体流程：</p>\n<ol>\n<li>当浏览器第一次向服务器发起请求时，服务器响应头会带上 <code>Cache-Control</code>，其中设置了过期时间 <code>max-age</code>；</li>\n<li>浏览器再次向服务器发起请求后，会计算<strong>当前请求时间和过期时间</strong>差值，来判断是否过期，如果过期则重新请求服务器，否则使用本地缓存；</li>\n<li>如果已经过期，服务器再次收到请求后，会更新响应头的 <code>Cache-Control</code>。</li>\n</ol>\n<p>除了 <code>max-age</code> 外，还有其他指令，详见 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control\" target=\"_blank\" rel=\"noopener noreferrer\">Cache-Control</a>。</p>\n<h3>优先级</h3>\n<p>当同时有 <code>Expires</code> 和 <code>Cache-Control</code> 字段时，如果 <code>Cache-Control</code> 响应头设置了 <code>max-age</code> 或 <code>s-maxage</code> 指令，那么 <code>Expires</code> 会被忽略。</p>\n<h2>协商缓存</h2>\n<p>为了知道服务器有没有更新内容，必须和服务器沟通，然后根据服务器返回的信息判断是否使用本地缓存，这种方式称为<strong>协商缓存</strong>。</p>\n<p>协商缓存通过两种头部实现：</p>\n<ul>\n<li>请求头部的 <code>If-Modified-Since</code> 和响应头部的 <code>Last-Modified</code>；</li>\n<li>请求头部的 <code>If-None-Match</code> 和响应头部的 <code>ETag</code>。</li>\n</ul>\n<h3><code>If-Modified-Since</code> 和 <code>Last-Modified</code></h3>\n<p>这种方式是基于时间实现的。</p>\n<p>响应头 <code>Last-Modified</code> 存放的是资源最后修改时间：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>Last<span class=\"token operator\">-</span>Modified<span class=\"token operator\">:</span> Wed<span class=\"token punctuation\">,</span> <span class=\"token number\">21</span> Oct <span class=\"token number\">2015</span> <span class=\"token number\">07</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">00</span> <span class=\"token constant\">GMT</span>\n</code></pre></div><p>请求头中的 <code>If-Modified-Since</code> 含义为资源从 xxx 时间后是否有更新：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>If<span class=\"token operator\">-</span>Modified<span class=\"token operator\">-</span>Since<span class=\"token operator\">:</span> Wed<span class=\"token punctuation\">,</span> <span class=\"token number\">21</span> Oct <span class=\"token number\">2015</span> <span class=\"token number\">07</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">00</span> <span class=\"token constant\">GMT</span>\n</code></pre></div><p>当服务器收到浏览器这个请求头后，会跟当前版本的时间进行比较：</p>\n<ol>\n<li>当前版本的修改时间比这个晚，也就是内容发生变化了，那么会返回 200 和新的内容；</li>\n<li>若当前版本的修改时间较早，也就是没有更新，那么会返回 304，浏览器会从缓存中读取内容。</li>\n</ol>\n<h3><code>ETag</code> 和 <code>If-None-Match</code></h3>\n<p>这种方式是通过唯一标识实现。</p>\n<p><code>ETag</code> 是资源的特定版本的标识符，响应头会根据返回内容返回一个标识符，具体返回值看服务器的计算策略，可能如下所示：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token literal-property property\">ETag</span><span class=\"token operator\">:</span> <span class=\"token string\">'33a64df551425fcc55e4d42a148795d9f25f89d4'</span>\n</code></pre></div><p>当客户端收到这个响应后，会将这个 <code>ETag</code> 保存起来，等下个请求时，会将它放到请求体的 <code>If-None-Match</code> 字段中：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>If<span class=\"token operator\">-</span>None<span class=\"token operator\">-</span>Match<span class=\"token operator\">:</span> <span class=\"token string\">\"33a64df551425fcc55e4d42a148795d9f25f89d4\"</span>\n</code></pre></div><p>当服务器收到浏览器这个请求头后，会跟当前版本的 <code>ETag</code> 进行比较：</p>\n<ol>\n<li>如果标识符不一致，也就是内容发生变化了，那么会返回 200 和新的内容；</li>\n<li>如果标识符一致，也就是没有更新，那么会返回 304，浏览器会从缓存中读取内容。</li>\n</ol>\n<h3>优先级</h3>\n<p>协商缓存先检查上一次响应头中是否有 <code>ETag</code>，如果有，则发起请求中请求头带上 <code>If-None-Match</code> 字段；如果没有，则检查上一次响应头中是否有 <code>Last-Modified</code> 字段，发起请求中请求头带上 <code>If-Modified-Since</code> 字段。</p>\n<h2>总结</h2>\n<p>HTTP 缓存机制分为两种：强缓存和协商缓存。</p>\n<p>浏览器会首先判断强缓存，如果强缓存生效，那么直接从缓存中获取资源；若没有生效，则会使用协商缓存，发送请求与服务器协商。</p>\n",
      "date_published": "2022-05-04T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "HTTPS 略解",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/06-https-overview.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/06-https-overview.html",
      "summary": "HTTP 和 HTTPS 区别 HTTP 是明文传输，不安全，而 HTTPS 加入了 SSL/TLS 安全协议，使得报文能加密传输； HTTP 建立连接只需 TCP 三次握手，而 HTTPS 在三次握手后，还需要进行 SSL/TLS 握手； HTTP 端口号为 80，HTTPS 端口号为 443； HTTPS 需要向 CA 申请数字证书。 httpht...",
      "content_html": "<h2>HTTP 和 HTTPS</h2>\n<h3>区别</h3>\n<ul>\n<li>HTTP 是明文传输，不安全，而 HTTPS 加入了 SSL/TLS 安全协议，使得报文能加密传输；</li>\n<li>HTTP 建立连接只需 TCP 三次握手，而 HTTPS 在三次握手后，还需要进行 SSL/TLS 握手；</li>\n<li>HTTP 端口号为 80，HTTPS 端口号为 443；</li>\n<li>HTTPS 需要向 CA 申请数字证书。</li>\n</ul>\n<figure><img src=\"/assets/image/computer-science/networking/006/HTTP.png\" alt=\"http\" tabindex=\"0\" loading=\"lazy\"><figcaption>http</figcaption></figure>\n<figure><img src=\"/assets/image/computer-science/networking/006/HTTPS.png\" alt=\"https\" tabindex=\"0\" loading=\"lazy\"><figcaption>https</figcaption></figure>\n<h3>HTTPS 缺点</h3>\n<ul>\n<li>在相同网络环境中，HTTPS 相比 HTTP 无论是响应时间还是耗电量都有大幅度上升；</li>\n<li>HTTPS 的安全是有范围的，在黑客攻击、服务器劫持等情况下几乎起不到作用；</li>\n<li>在现有的证书机制下，中间人攻击依然有可能发生；</li>\n<li>HTTPS 需要更多的服务器资源，也会导致成本的升高。</li>\n</ul>\n<h2>加密算法</h2>\n<p>HTTPS 使用混合加密算法解决数据安全传输问题，即<strong>对称加密</strong>和<strong>非对称加密</strong>混合使用。</p>\n<h3>对称加密</h3>\n<p>加密和解密都是同一个密钥，优缺点如下：</p>\n<p><strong>优点：</strong></p>\n<ol>\n<li>由于密钥相同，因此加密解密速度快，适合加密比较大的数据。</li>\n</ol>\n<p><strong>缺点：</strong></p>\n<ol>\n<li>交易双方在传输过程中需要使用相同的密钥，因此需要在<strong>首次</strong>传输过程中必然需要由一方将密钥传给另一方，这样就无法保证保证密钥的安全性，有可能会被截获；</li>\n<li>不同用户访问的密钥需要不同，这会造成服务器管理密钥困难，成本高。</li>\n</ol>\n<h3>非对称加密</h3>\n<p>加密和解密使用不同的密钥：公钥（public key）加密和私钥（private key）解密。流程如下：</p>\n<ol>\n<li>发送方向接收方请求一个公钥；</li>\n<li>发送方使用公钥加密，公钥和加密的数据泄露并没有关系，因为只有私钥才能解密；</li>\n<li>接收方用私钥解密消息。</li>\n</ol>\n<p><strong>优点：</strong></p>\n<ol>\n<li>加密和解密使用不同的密钥，私钥不需要通过网络传输，安全性高。</li>\n</ol>\n<p><strong>缺点：</strong></p>\n<ol>\n<li>计算量比较大，加密解密速度比对称加密慢；</li>\n<li>中间人攻击：中间人进行拦截，无法保证公钥是接收方提供的。</li>\n</ol>\n<figure><img src=\"/assets/image/computer-science/networking/006/mid-attack.png\" alt=\"中间人攻击\" tabindex=\"0\" loading=\"lazy\"><figcaption>中间人攻击</figcaption></figure>\n<h2>数字证书和数字签名</h2>\n<p>中间人攻击使我们无法验证公钥的真假。因此引入<strong>数字证书</strong>，用它来证明身份是真实的，并且防止被中间人攻击。</p>\n<p>由数字证书认证机构（Certificate Authority，简称 CA）负责给用户签发数字证书，证书中包括：签发者、使用者公钥、使用的 HASH 算法、证书到期时间等。</p>\n<p>但是问题来了，如果中间人篡改了证书，如何保证身份证明是有效的？这时需要引进<strong>数字签名</strong>。</p>\n<p>首先使用 CA 自带的 HASH 算法对证书的内容进行 HASH 得到一个信息摘要，再用 CA 的私钥进行加密，最终组成数字签名。当服务器将原始信息和数字签名发送过来时，客户端先使用 CA 的公钥对数字签名进行解密，得到 CA 创建的信息摘要，再使用同样的 HASH 算法生成原始信息的信息摘要，两者进行对比，就知道证书是否被篡改了。</p>\n<p>通过数字签名的证书验证，能最大程度的保证数据传输安全。</p>\n<h2>HTTPS 工作流程</h2>\n<p>前面提到，HTTPS 使用了混合加密解决安全传输问题，整个工作过程分为三大步：证书验证、非对称加密和对称加密。</p>\n<figure><img src=\"/assets/image/computer-science/networking/006/https-flow.png\" alt=\"https工作流程\" tabindex=\"0\" loading=\"lazy\"><figcaption>https工作流程</figcaption></figure>\n<p><strong>证书验证：</strong></p>\n<ol>\n<li>Client 发起一个 HTTPS 的请求；</li>\n<li>Server 把事先配置好的公钥证书返回给客户端；</li>\n<li>Client 验证公钥证书：如果验证通过则继续，不通过则显示警告信息；</li>\n</ol>\n<p><strong>非对称加密：</strong></p>\n<ol start=\"4\">\n<li>Client 生成加密所使用的会话密钥，然后用证书的公钥加密这个会话密钥，发给 Server。</li>\n<li>Server 使用自己的私钥解密这个消息，得到会话密钥。至此，Client 和 Server 双方都持有了相同的会话密钥。</li>\n</ol>\n<p><strong>对称加密：</strong></p>\n<ol start=\"6\">\n<li>Server 使用会话密钥加密“明文内容 A”，发送给 Client。</li>\n<li>Client 使用会话密钥解密响应的密文，得到“明文内容 A”。</li>\n<li>Client 再次发起 HTTPS 的请求，使用会话密钥加密请求的“明文内容 B”，然后 Server 使用会话密钥解密密文，得到“明文内容 B”。</li>\n</ol>\n<h2>参考链接</h2>\n<p><a href=\"https://www.cnblogs.com/linianhui/p/security-based-toolbox.html\" target=\"_blank\" rel=\"noopener noreferrer\">[信息安全] 1.密码工具箱 </a></p>\n<p><a href=\"https://www.cnblogs.com/linianhui/p/security-complex-toolbox.html\" target=\"_blank\" rel=\"noopener noreferrer\">[信息安全] 2.密码工具箱（续）</a></p>\n<p><a href=\"https://www.cnblogs.com/linianhui/p/security-https-workflow.html\" target=\"_blank\" rel=\"noopener noreferrer\">[信息安全] 3.HTTPS 工作流程</a></p>\n<p><a href=\"https://segmentfault.com/a/1190000021494676\" target=\"_blank\" rel=\"noopener noreferrer\">HTTPS 详解一：附带最精美详尽的 HTTPS 原理图</a></p>\n",
      "image": "https://dribble-njr.github.io/blog/blog/assets/image/computer-science/networking/006/HTTP.png",
      "date_published": "2022-05-05T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "TCP 三次握手与四次挥手",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/07-tcp-three-handshakes-and-four-waves.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/07-tcp-three-handshakes-and-four-waves.html",
      "summary": "传输层控制协议（Transmission Control Protocol, TCP）是一种面向连接的、可靠的、基于字节流的传输层通信协议。 三次握手 三报文握手具体过程（客户端和服务端交换三个报文段）： 三次握手三次握手 第一次握手： 起初两端都处于 CLOSED 关闭状态。一开始，服务器就进入监听状态，被动等待客户端的连接请求。 在打算建立 TCP...",
      "content_html": "<p>传输层控制协议（Transmission Control Protocol, TCP）是一种面向连接的、可靠的、基于字节流的传输层通信协议。</p>\n<h2>三次握手</h2>\n<p>三报文握手具体过程（客户端和服务端交换三个报文段）：</p>\n<figure><img src=\"/assets/image/computer-science/networking/007/three.png\" alt=\"三次握手\" tabindex=\"0\" loading=\"lazy\"><figcaption>三次握手</figcaption></figure>\n<p><strong>第一次握手：</strong></p>\n<p>起初两端都处于 <code>CLOSED</code> 关闭状态。一开始，服务器就进入监听状态，被动等待客户端的连接请求。</p>\n<p>在打算建立 TCP 连接时，客户端将同步请求标志 <code>SYN=1</code> 和随机初始序号 <code>seq=x</code> 发送给服务器，客户端进入 <code>SYN-SENT</code> （同步已发送）状态，等待服务器确认。</p>\n<p><strong>第二次握手：</strong></p>\n<p>服务器收到数据包后由同步位 <code>SYN=1</code> 得知客户端请求建立连接。</p>\n<p>服务器发送同步请求标志 <code>SYN=1</code>、确认标志 <code>ACK=1</code>、随机初始序号 <code>seq=y</code> 以及确认号字段 <code>ack=x+1</code>，发送给客户端，并进入 <code>SYN-RCVD</code> （同步已接收）状态。</p>\n<p><strong>第三次握手：</strong></p>\n<p>客户端收到确认后，检查 <code>ack</code> 是否为 <code>x+1</code>，<code>ACK</code> 是否为 <code>1</code>，如果正确则发送确认标志 <code>ACK=1</code>、序号 <code>seq=x+1</code> 以及确认号 <code>ack=y+1</code>，并进入连接已建立状态 <code>ESTABLISHED</code>。</p>\n<p>服务器收到消息后，检查 <code>ack</code> 是否为 <code>y+1</code>，<code>ACK</code> 是否为 <code>1</code>，如果成功则建立连接。 进入连接已建立状态 <code>ESTABLISHED</code>。</p>\n<p><strong>能否采用两报文握手？</strong></p>\n<p>如果客户端发出连接请求，但因网络延迟而未收到确认，于是客户端再次发送一个连接请求，服务端收到确认，由于是两次握手，此时就会建立连接，等数据传输完毕后，释放连接。</p>\n<p>此时第一个请求报文经过一段时间到达服务端，于是服务端收到确认，由于采用两次握手，此时就已同意建立连接，客户端不需要对服务端的确认报文发出响应，也不继续发送数据，导致连接一直建立，浪费资源。</p>\n<h2>四次挥手</h2>\n<p>四报文挥手来释放连接（现二者均处于连接已建立状态，假设客户端主动关闭 TCP 连接）：</p>\n<figure><img src=\"/assets/image/computer-science/networking/007/four.png\" alt=\"四次挥手\" tabindex=\"0\" loading=\"lazy\"><figcaption>四次挥手</figcaption></figure>\n<p><strong>第一次挥手：</strong></p>\n<p>客户端发送 TCP 连接释放报文段，并进入<strong>终止等待 1 状态</strong>。</p>\n<p>该报文段首部种的终止位 FIN 和确认位 ACK 都设置为 1 ，表明这是一个 TCP 连接释放报文段，同时也对之前收到的报文段进行确认。</p>\n<p>序号 seq = u，它等于之前客户端已经传送过的数据的最后一个字节的序号加 1 。确认号 ack 的值设置为 v ，它等于 TCP 客户进程之前已收到的数据的最后一个字节的序号加 1 。</p>\n<p><strong>第二次挥手：</strong></p>\n<p>服务端收到连接释放报文段后，会发送一个普通的 TCP 确认报文段并进入<strong>关闭等待状态</strong>。</p>\n<p>该报文段首部中的确认位 ACK 被设置为 1；seq 设置为 v，它等于服务端之前已传送过的数据的最后一个字节的序号加 1 。确认号 ack 字段的值被设置为 u + 1，这是对连接释放报文的确认。</p>\n<p>这个时候，客户端不能给服务端发送信息报文，只能接收。但是服务端要是还有信息要传给客户端，仍能传送。</p>\n<p><strong>第三次挥手：</strong></p>\n<p>客户端收到确认报文段后就进入<strong>终止等待 2 状态</strong>，当服务器数据发送完毕后，给客户端发送 TCP 连接释放报文段并进入<strong>最后确认状态</strong>。</p>\n<p>该报文段首部中的终止位 FIN 和确认位 ACK 的值都设置为 1 ，seq = w ，ack = u + 1 。</p>\n<p><strong>第四次挥手：</strong></p>\n<p>客户端收到连接释放报文段后，需要向服务端发送 TCP 确认报文段，并进入<strong>时间等待状态</strong>。</p>\n<p>首部中的确认位 ACK = 1 ，seq = u + 1 ，ack = w + 1 ，这是对 TCP 连接释放报文段的确认。</p>\n<p>服务端 收到该报文后就进入<strong>关闭状态</strong>，而 客户端 还要经过 2MSL 后才能进入<strong>关闭状态</strong>。</p>\n<blockquote>\n<p>MSL，最长报文段寿命，一般为 2 分钟。</p>\n</blockquote>\n<p><strong>为什么最后还要等待两个时间周期呢？</strong></p>\n<ul>\n<li>客户端的最后一个 ACK 报文在传输的时候丢失，服务器并没有接收到这个报文。这个候时候服务器就会超时重传这个 FIN 消息，然后客户端就会重新返回最后一个 ACK 报文，等待两个时间周期，完成关闭。</li>\n<li>如果不等待这两个时间周期，服务器重传的那条消息就不会收到。服务器就因为接收不到客户端的信息而无法正常关闭。</li>\n</ul>\n<h2>参考链接</h2>\n<p><a href=\"https://www.bilibili.com/video/BV1c4411d7jb\" target=\"_blank\" rel=\"noopener noreferrer\">计算机网络微课堂</a></p>\n",
      "image": "https://dribble-njr.github.io/blog/blog/assets/image/computer-science/networking/007/three.png",
      "date_published": "2022-05-06T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "TCP 与 UDP 的区别",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/08-tcp-udp.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/08-tcp-udp.html",
      "summary": "TCP 和 UDP 都是传输层协议，属于 TCP/IP 协议族。 UDP 用户数据报协议（User Datagram Protocol，UDP）用来处理数据包，是一种无连接的协议，它的特点如下： 无连接 不需要像 TCP 一样进行三次握手进行连接，并且也只是数据报文的搬运工，不会对报文进行任何的加工处理。 单播、多播、广播 UDP 支持一对一、一对多、...",
      "content_html": "<p>TCP 和 UDP 都是传输层协议，属于 TCP/IP 协议族。</p>\n<h2>UDP</h2>\n<p>用户数据报协议（User Datagram Protocol，UDP）用来处理数据包，是一种无连接的协议，它的特点如下：</p>\n<p><strong>无连接</strong></p>\n<p>不需要像 TCP 一样进行三次握手进行连接，并且也只是数据报文的搬运工，不会对报文进行任何的加工处理。</p>\n<p><strong>单播、多播、广播</strong></p>\n<p>UDP 支持一对一、一对多、多对多、多对一的传输方式。</p>\n<p><strong>面向报文</strong></p>\n<p>在发送端，应用层将数据传递给传输层，UDP 只会给数据增加一个 UDP 头标识这是一个 UDP 协议报文，然后就传给网络层，对应用层交付的报文既不合并也不拆分，保留报文的边界，一次发送一个报文。</p>\n<p>在接收端，网络层将 UDP 数据报传输给 UDP，UDP 去除首部后就会将数据原封不动地传递给应用层，一次交付一个完整的报文。</p>\n<p><strong>不可靠</strong></p>\n<p>首先体现在无连接上，通信双方想发就发，必然不可靠。没有像 TCP 做重传机制、流量控制和拥塞控制。</p>\n<p><strong>头部开销小</strong></p>\n<p>UDP 头部只有 8 字节，相比 TCP 20 个字节少得多，传输数据时比较高效。</p>\n<p><strong>应用场景</strong></p>\n<p>UDP 应用于效率要求高，但可靠性要求相对较低的场景，例如：即时通讯，速度要求高，但是偶尔出现断续不是太大问题，完全可以不使用重传机制，场景有在线视频、网络语音通话、广播通信等。</p>\n<h2>TCP</h2>\n<p>传输控制协议（Transmission Control Protocol，TCP）是一种面向连接的、可靠的、基于字节流的传输层通讯协议，它的特点如下：</p>\n<p><strong>面向连接</strong></p>\n<p>在发送前必须进行 TCP 三次握手在两端建立连接。</p>\n<p><strong>仅支持单播传输</strong></p>\n<p>每个 TCP 只能进行一对一传输，不支持多播和广播的形式。</p>\n<p><strong>面向字节流</strong></p>\n<p>TCP 不像 UDP 那样一个一个报文独立传输，而是在不保留报文边界的情况下以字节流方式进行传输。</p>\n<p><strong>可靠传输</strong></p>\n<p>TCP 为了实现可靠传输，使用了重传机制、流量控制和拥塞控制。</p>\n<p><strong>头部开销大</strong></p>\n<p>TCP 头部最小 20 个字节，最大 60 个字节，传输效率慢。</p>\n<p><strong>应用场景</strong></p>\n<p>TCP 应用于效率要求相对低，但可靠性要求高的场景，例如：文件传输、邮件传输等。</p>\n<h2>区别</h2>\n<p>|              | UDP                   | TCP                                          |<br>\n|</p>\n",
      "date_published": "2022-05-06T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "登陆失败 HTTP 状态码",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/09-http-code-when-authorized-refused.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/09-http-code-when-authorized-refused.html",
      "summary": "如果用户尝试登陆，但用户名或密码不正确，应该返回什么状态码？ 这个问题在社区中有一定争议，有些人认为应该返回 403 Forbidden，有些人认为应该返回 404 Not Found，有些人认为应该返回 400 Bad Request，有些人认为应该返回 401 Unauthorized。 403 Forbidden 表示拒绝访问，但是请求接口是可以...",
      "content_html": "<p>如果用户尝试登陆，但用户名或密码不正确，应该返回什么状态码？</p>\n<p>这个问题在社区中有一定争议，有些人认为应该返回 <code>403 Forbidden</code>，有些人认为应该返回 <code>404 Not Found</code>，有些人认为应该返回 <code>400 Bad Request</code>，有些人认为应该返回 <code>401 Unauthorized</code>。</p>\n<p><code>403 Forbidden</code> 表示拒绝访问，但是请求接口是可以访问的，因此该状态码肯定不正确。</p>\n<p><code>404 Not Found</code> 表示请求的资源不存在，但是请求接口是存在的，因此该状态码也不正确。</p>\n<p><code>400 Bad Request</code> 表示请求参数错误，但是用户输入的数据格式也是完全正确的，因此也不应该用该状态码。</p>\n<p>而根据 <a href=\"https://stackoverflow.com/questions/32752578/whats-the-appropriate-http-status-code-to-return-if-a-user-tries-logging-in-wit\" target=\"_blank\" rel=\"noopener noreferrer\">What's the appropriate HTTP status code to return if a user tries logging in with an incorrect username / password, but correct format?</a> 讨论，应该返回 <code>401 Unauthorized</code>。</p>\n<p>根据 <a href=\"https://www.rfc-editor.org/rfc/rfc7235#section-3.1\" target=\"_blank\" rel=\"noopener noreferrer\">RFC7235</a>：如果请求中包含身份验证凭据，则 <code>401</code> 响应表示拒绝对这些凭据进行授权。</p>\n",
      "date_published": "2024-07-10T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "401 和 403 状态码",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/networking/10-401-403.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/networking/10-401-403.html",
      "summary": "401 Unauthorized（未授权） 含义：表示客户端请求的资源需要身份验证，但身份验证失败或未提供正确的认证信息。 触发情况：当服务器要求用户提供凭据（例如用户名和密码），但用户未提供凭据，或提供的凭据无效时，服务器返回 401。 处理方式： 客户端应该提供有效的凭据，如登录信息、API 密钥或 token。 一般情况下，服务器会在响应中包含一...",
      "content_html": "<h2>401 Unauthorized（未授权）</h2>\n<ul>\n<li><strong>含义</strong>：表示客户端请求的资源需要身份验证，但身份验证失败或未提供正确的认证信息。</li>\n<li><strong>触发情况</strong>：当服务器要求用户提供凭据（例如用户名和密码），但用户未提供凭据，或提供的凭据无效时，服务器返回 401。</li>\n<li><strong>处理方式</strong>：\n<ul>\n<li>客户端应该提供有效的凭据，如登录信息、API 密钥或 token。</li>\n<li>一般情况下，服务器会在响应中包含一个 <code>WWW-Authenticate</code> 头，提示客户端应该如何提供凭证。</li>\n</ul>\n</li>\n</ul>\n<p><strong>示例场景</strong>：</p>\n<ul>\n<li>用户访问一个需要登录才能查看的页面，但没有登录或登录信息无效。</li>\n<li>API 请求缺少认证信息（如缺少 Authorization Header 或 token 错误）。</li>\n</ul>\n",
      "date_published": "2025-02-11T00:00:00.000Z",
      "date_modified": "2025-02-11T08:02:34.000Z",
      "authors": [],
      "tags": [
        "计算机网络"
      ]
    },
    {
      "title": "从 React Native 到 Expo：快速实现跨平台开发",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/expo/",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/expo/",
      "summary": "随着移动开发的需求日益增长，跨平台开发框架成为开发者的首选。其中，React Native 和 Expo 是两种备受关注的技术路线。这篇文章将从 React Native 的基础出发，探讨 Expo 的优势，并介绍如何搭建 Expo 项目、CI/CD 流程及开发体验。 为什么选择 Expo 而不是纯 React Native？ React Native...",
      "content_html": "<p>随着移动开发的需求日益增长，跨平台开发框架成为开发者的首选。其中，<a href=\"https://reactnative.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">React Native</a> 和 <a href=\"https://expo.dev/\" target=\"_blank\" rel=\"noopener noreferrer\">Expo</a> 是两种备受关注的技术路线。这篇文章将从 React Native 的基础出发，探讨 Expo 的优势，并介绍如何搭建 Expo 项目、CI/CD 流程及开发体验。</p>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20250124160026.png",
      "date_published": "2025-01-24T00:00:00.000Z",
      "date_modified": "2025-01-24T09:10:50.000Z",
      "authors": [],
      "tags": [
        "expo"
      ]
    },
    {
      "title": "2024 前端生态报告",
      "url": "https://dribble-njr.github.io/blog/blog/news/2024/W52/state-of-fe-2024.html",
      "id": "https://dribble-njr.github.io/blog/blog/news/2024/W52/state-of-fe-2024.html",
      "summary": "最近，tsh.io 发布了一份关于 2024 年 前端生态的报告，其中包含了一些有趣的数据和趋势。 框架 前端框架 过去一年使用的框架过去一年使用的框架 React 和 Vue.js 在使用率和喜爱度上表现出色，仍是市场的主流选择。 Svelte 和 HTMX 展现出很高的学习兴趣，可能在未来成为更加流行的选择。 Angular 系列 虽然仍有稳定的用...",
      "content_html": "<p>最近，<a href=\"http://tsh.io\" target=\"_blank\" rel=\"noopener noreferrer\">tsh.io</a> 发布了一份关于 2024 年 <a href=\"https://tsh.io/state-of-frontend/\" target=\"_blank\" rel=\"noopener noreferrer\">前端生态的报告</a>，其中包含了一些有趣的数据和趋势。</p>\n<h2>框架</h2>\n<h3>前端框架</h3>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241230124159.png\" alt=\"过去一年使用的框架\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的框架</figcaption></figure>\n<ol>\n<li>React 和 Vue.js 在使用率和喜爱度上表现出色，仍是市场的主流选择。</li>\n<li>Svelte 和 HTMX 展现出很高的学习兴趣，可能在未来成为更加流行的选择。</li>\n<li>Angular 系列 虽然仍有稳定的用户基础，但学习兴趣较低。</li>\n<li>新兴框架（如 Qwik、Lit）显示了潜在的增长空间，但需要更多的推广和生态完善。</li>\n<li>边缘化框架（如 Ember、Phoenix）用户基础薄弱，未来可能逐渐退出主流市场。</li>\n</ol>\n<h3>渲染框架</h3>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241230124811.png\" alt=\"过去一年使用的渲染框架\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的渲染框架</figcaption></figure>\n<ol>\n<li>Next.js 依然是前端开发的首选工具，拥有极高的用户满意度和市场接受度。</li>\n<li>Astro 和 SvelteKit 的学习意向很高，特别是 SvelteKit，未来可能成为新兴热点。</li>\n<li>Nuxt 在 Vue.js 生态中表现稳定，但在整体市场上学习意向稍逊于 SvelteKit 和 Astro。</li>\n<li>Remix 虽然用户群较小，但学习意向表明其潜在发展前景广阔。</li>\n<li>Gatsby 的热度和满意度明显下降，可能难以保持市场竞争力。</li>\n<li>Docusaurus 的关注度较低，但在特定领域（文档生成）仍有一席之地。</li>\n</ol>\n<h2>库</h2>\n<h3>验证库</h3>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241230125532.png\" alt=\"过去一年使用的验证库\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的验证库</figcaption></figure>\n<ol>\n<li>Zod 是当前最受欢迎的工具，使用率高，评价好，并且对未来用户有较大吸引力。</li>\n<li>传统工具如 Joi 和 Yup 依然有一定的用户基础，但 Yup 在学习意向上表现更强。</li>\n<li>新兴工具如 Valibot 开始受到关注，但目前影响力有限。</li>\n<li>特定生态的工具如 Ajv 和 class-validator 主要用于特殊场景，使用范围较小。</li>\n</ol>\n<h3>日期管理库</h3>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231172109.png\" alt=\"过去一年使用的日期管理库\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的日期管理库</figcaption></figure>\n<p>总结</p>\n<ol>\n<li>最受欢迎：date-fns 是当前的主流选择，其功能全面且模块化设计深受开发者喜爱。</li>\n<li>Moment 的余热：尽管官方不再推荐，但 Moment 依然有广泛的用户基础，但其负面评价也较多。</li>\n<li>轻量替代品：Day.js 提供了类似 Moment 的 API，同时更加轻量，逐渐受到开发者青睐。</li>\n<li>新兴工具：Luxon 功能强大，学习意愿高，但目前尚未被广泛采用。</li>\n<li>关注度较低的工具：Date.js 和 Luxon 在无意见比例上排名靠前，说明它们的市场影响力较低。</li>\n</ol>\n<p>建议：</p>\n<ol>\n<li>如果项目需要模块化和高性能，可以选择 date-fns。</li>\n<li>如果倾向于轻量级解决方案，Day.js 是不错的选择。</li>\n<li>对于需要处理复杂国际化或时区功能的场景，可以考虑学习 Luxon。</li>\n</ol>\n<h3>状态管理库</h3>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231172832.png\" alt=\"过去一年使用的状态管理库\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的状态管理库</figcaption></figure>\n<ol>\n<li>流行趋势：React Context API 是目前最受欢迎的简单状态管理工具，Redux Toolkit 和 Zustand 是复杂场景中更现代化的选择。</li>\n<li>工具定位：\n<ul>\n<li>Redux 和 Redux Toolkit 适合复杂场景，但 Toolkit 更适合现代开发。</li>\n<li>React Context API 和 Zustand 是轻量场景的热门选择。</li>\n<li>Vue 社区用户倾向于 Pinia。</li>\n</ul>\n</li>\n<li>新兴工具：Zustand 和 Jotai 等轻量级库越来越受到关注，但 Jotai 目前的社区影响力较弱。</li>\n</ol>\n<h3>工具库</h3>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231173312.png\" alt=\"过去一年使用的其他工具库\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的其他工具库</figcaption></figure>\n<ol>\n<li>流行工具：Lodash 是最受欢迎的工具库，功能丰富且应用场景广泛。</li>\n<li>过时工具：jQuery 和 Underscore 的使用率下降，更多用户转向现代工具。</li>\n<li>新兴工具：Immer 和 Ramda 的用户群体较小，但对特定需求的开发者可能有吸引力。</li>\n<li>特定领域工具：RxJS 在响应式编程中有较高认可度，但学习曲线限制了它的普及。</li>\n</ol>\n<h2>数据请求库</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231174531.png\" alt=\"过去一年使用的数据请求库\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的数据请求库</figcaption></figure>\n<ol>\n<li>主流工具：Axios 和 Native Fetch 是最受欢迎的工具，分别占据了 73.6% 和 72.4% 的「Used and liked」。</li>\n<li>新兴趋势：tRPC 和 TanStack Query 逐渐受到关注，尤其是 tRPC 的未来学习兴趣高达 29.8%。</li>\n<li>小众工具：ky 和 ApolloClient 虽然功能强大，但在用户中的使用率较低。</li>\n<li>有潜力的工具：SWR 和 TanStack Query 在 React 生态中有较大潜力。</li>\n</ol>\n<h2>托管平台</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231174959.png\" alt=\"过去一年使用的托管平台\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的托管平台</figcaption></figure>\n<p>Vercel, AWS and… Netlify 是目前最受欢迎的云托管平台。也有很大一部分人使用自己的服务器。</p>\n<h2>CI（持续集成）</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231175544.png\" alt=\"是否使用 CI 工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>是否使用 CI 工具</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231175156.png\" alt=\"过去一年使用的 CI 工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的 CI 工具</figcaption></figure>\n<p>对于独立开发者来说，使用 GitHub Actions 是最佳选择。</p>\n<p>若想要独立的 CI/CD 平台，可以选择使用 Jenkins 或者 GitLab CI 提供的自托管替代方案。</p>\n<h2>微前端</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231175653.png\" alt=\"是否使用微前端\" tabindex=\"0\" loading=\"lazy\"><figcaption>是否使用微前端</figcaption></figure>\n<p>采用率从 2022 年报告使用微前端的受访者中 75.4% 显著下降至 2024 年的 23.6%。这一急剧下降表明行业在前端架构方面的转变。</p>\n<p>许多人意识到微前端不仅需要技术知识，还需要组织和文化的变革，而他们并未做好准备。另一个关键因素是对服务器端渲染（SSR）和静态网站生成（SSG）架构的投资不断增加，这些架构包含类似的概念。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231175714.png\" alt=\"过去一年使用的微前端解决方案\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的微前端解决方案</figcaption></figure>\n<ol>\n<li>主流工具：Webpack 5 Module Federation 和 Single SPA 是微前端领域的两大主流解决方案，分别占据了 51.8% 和 35.5% 的比例。</li>\n<li>次主流工具：Open Components、SystemJS 和 Bit 在特定场景下有一定用户基础，但市场占比明显低于前两者。</li>\n<li>小众工具：Qiankun、Luigi 和 Piral 等工具的使用比例较低，但在特定社区和应用场景中仍有价值。</li>\n<li>创新空间：\"Other\" 类别显示了开发者在微前端领域的多样化尝试，可能包括定制解决方案或尚未普及的新工具。</li>\n</ol>\n<h2>包管理器</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231180850.png\" alt=\"过去一年使用的包管理器\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的包管理器</figcaption></figure>\n<h2>JavaScript 运行时</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231181012.png\" alt=\"过去一年使用的 JavaScript 运行时\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的 JavaScript 运行时</figcaption></figure>\n<p>Node: 稳定、生态丰富、社区活跃。</p>\n<p>然而，其他 JavaScript 运行时，如 Bun（10%）和 Deno（2.6%），开始开辟自己的市场。</p>\n<p>Bun 作为领先替代品的地位值得注意。它专注于其惊人的速度和几乎完全的 Node.js 兼容性，尽管还未达到 100%。Bun 还引入了内置包管理器、原生 TypeScript 和 JSX 支持以及独特的 API。</p>\n<p>Deno 由 Ryan Dahl（Node.js 的原始开发者）创建，走上了与 Bun 类似的道路。尽管其最初通过 URL 导入依赖项的方法可能减缓了采用速度，但 Deno 推出其包注册表 JSR（npm 的替代品）标志着战略转变。随着 Deno2 的到来，观察它如何发展以及社区的反应将会很有趣。</p>\n<h2>TypeScript</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231182827.png\" alt=\"过去一年使用的类型工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的类型工具</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231182909.png\" alt=\"2024 与 2022 年相比更多人使用 TypeScript\" tabindex=\"0\" loading=\"lazy\"><figcaption>2024 与 2022 年相比更多人使用 TypeScript</figcaption></figure>\n<h2>浏览器技术</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231183301.png\" alt=\"过去一年使用的浏览器技术\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的浏览器技术</figcaption></figure>\n<h2>PWA（渐进式 Web 应用）</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231183531.png\" alt=\"是否使用 PWA\" tabindex=\"0\" loading=\"lazy\"><figcaption>是否使用 PWA</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231183453.png\" alt=\"PWA 的未来\" tabindex=\"0\" loading=\"lazy\"><figcaption>PWA 的未来</figcaption></figure>\n<h2>设计系统</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231183550.png\" alt=\"最喜欢的设计系统排名\" tabindex=\"0\" loading=\"lazy\"><figcaption>最喜欢的设计系统排名</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231183659.png\" alt=\"过去一年使用的设计交接工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的设计交接工具</figcaption></figure>\n<h2>Style 工具</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231183814.png\" alt=\"过去一年使用的 Style 工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的 Style 工具</figcaption></figure>\n<h2>测试</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231183955.png\" alt=\"团队中谁负责测试\" tabindex=\"0\" loading=\"lazy\"><figcaption>团队中谁负责测试</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184037.png\" alt=\"软件测试类型\" tabindex=\"0\" loading=\"lazy\"><figcaption>软件测试类型</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184104.png\" alt=\"过去一年使用的测试工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的测试工具</figcaption></figure>\n<h2>代码管理</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184146.png\" alt=\"最喜欢的代码编辑器\" tabindex=\"0\" loading=\"lazy\"><figcaption>最喜欢的代码编辑器</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184208.png\" alt=\"最喜欢的浏览器代码编辑器\" tabindex=\"0\" loading=\"lazy\"><figcaption>最喜欢的浏览器代码编辑器</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184301.png\" alt=\"版本控制\" tabindex=\"0\" loading=\"lazy\"><figcaption>版本控制</figcaption></figure>\n<h2>低代码/无代码</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184344.png\" alt=\"low-code 平台\" tabindex=\"0\" loading=\"lazy\"><figcaption>low-code 平台</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184409.png\" alt=\"no-code 平台\" tabindex=\"0\" loading=\"lazy\"><figcaption>no-code 平台</figcaption></figure>\n<h2>构建工具</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184501.png\" alt=\"过去一年使用的构建工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>过去一年使用的构建工具</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184537.png\" alt=\"lint 工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>lint 工具</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184607.png\" alt=\"网页构建工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>网页构建工具</figcaption></figure>\n<h2>操作系统</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184634.png\" alt=\"操作系统\" tabindex=\"0\" loading=\"lazy\"><figcaption>操作系统</figcaption></figure>\n<h2>AI 工具</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184727.png\" alt=\"AI 工具\" tabindex=\"0\" loading=\"lazy\"><figcaption>AI 工具</figcaption></figure>\n<h2>未来趋势</h2>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241231184836.png\" alt=\"未来趋势\" tabindex=\"0\" loading=\"lazy\"><figcaption>未来趋势</figcaption></figure>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241230124159.png",
      "date_published": "2024-12-29T00:00:00.000Z",
      "date_modified": "2024-12-31T10:49:31.000Z",
      "authors": [],
      "tags": [
        "news"
      ]
    },
    {
      "title": "Prisma",
      "url": "https://dribble-njr.github.io/blog/blog/backend/node/prisma/",
      "id": "https://dribble-njr.github.io/blog/blog/backend/node/prisma/",
      "summary": "Prisma ORM 是一套用于与数据库进行交互的下一代 ORM（对象关系映射，Object-Relational Mapping）工具，包括以下组件： Prisma Client: 自动生成且类型安全的查询构建器，用于 Node.js 和 TypeScript Prisma Migrate: 声明式数据建模和迁移系统 Prisma Studio: 用...",
      "content_html": "<p>Prisma ORM 是一套用于与数据库进行交互的下一代 ORM（对象关系映射，Object-Relational Mapping）工具，包括以下组件：</p>\n<ul>\n<li>Prisma Client: 自动生成且类型安全的查询构建器，用于 Node.js 和 TypeScript</li>\n<li>Prisma Migrate: 声明式数据建模和迁移系统</li>\n<li>Prisma Studio: 用于查看和编辑数据库中数据的 GUI</li>\n</ul>\n<div class=\"hint-container info\">\n<p class=\"hint-container-title\">相关信息</p>\n<p>Prisma Studio 是 Prisma ORM 中唯一不是开源的部分。你只能在本地运行 Prisma Studio。</p>\n</div>\n<h2>为什么使用 Prisma ORM</h2>\n<p>Prisma ORM 不仅提供了现代化的开发体验，还显著提高了与数据库交互的效率和安全性。以下是 Prisma ORM 的主要优势，并与原始 SQL 进行对比。</p>\n<h3>类型安全 vs SQL 静态查询</h3>\n<p>Prisma Client 提供了强大的类型安全功能，每个查询都与 Prisma schema 紧密结合，使得查询语法和返回值均受到 TypeScript 的静态类型检查支持：</p>\n<p>Prisma 查询：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">findMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  where<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> contains<span class=\"token operator\">:</span> <span class=\"token string\">'Alice'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>SQL 查询：</p>\n<div class=\"language-sql\" data-ext=\"sql\" data-title=\"sql\"><pre class=\"language-sql\"><code><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">WHERE</span> name <span class=\"token operator\">LIKE</span> <span class=\"token string\">'%Alice%'</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p>Prisma 查询中，错误可以在开发阶段被捕获，而 SQL 查询需要额外的测试或运行时调试，容易引入拼写或逻辑错误。</p>\n<h3>开发效率 vs 手动编写 SQL</h3>\n<p>使用 Prisma ORM，可以通过高层抽象简化常见的数据库操作，而不需要重复编写大量 SQL 查询。</p>\n<p>创建一个用户和关联帖子：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'Alice'</span><span class=\"token punctuation\">,</span>\n    email<span class=\"token operator\">:</span> <span class=\"token string\">'alice@example.com'</span><span class=\"token punctuation\">,</span>\n    posts<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      create<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> title<span class=\"token operator\">:</span> <span class=\"token string\">'Prisma is amazing!'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>SQL：</p>\n<div class=\"language-sql\" data-ext=\"sql\" data-title=\"sql\"><pre class=\"language-sql\"><code><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"User\"</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"email\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'Alice'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'alice@example.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"Post\"</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"authorId\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'Prisma is amazing!'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p>Prisma 的高层 API 不仅易读，还避免了处理 SQL 中外键关系和手动关联数据的复杂性。</p>\n<h3>声明式数据建模 vs 手动设计数据库</h3>\n<p>Prisma schema 提供了直观的声明式语法来定义数据模型，与数据库结构直接同步，而 SQL 通常需要手动设计表结构并维护复杂的迁移脚本。</p>\n<p>Prisma schema：</p>\n<div class=\"language-prisma\" data-ext=\"prisma\" data-title=\"prisma\"><pre class=\"language-prisma\"><code>model User {\n  id    Int     @id @default(autoincrement())\n  email String  @unique\n  posts Post[]\n}\n</code></pre></div><p>SQL：</p>\n<div class=\"language-sql\" data-ext=\"sql\" data-title=\"sql\"><pre class=\"language-sql\"><code><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token string\">\"User\"</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"id\"</span> <span class=\"token keyword\">INT</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"email\"</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token string\">\"Post\"</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"id\"</span> <span class=\"token keyword\">INT</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"title\"</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"authorId\"</span> <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"authorId\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token string\">\"User\"</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p>Prisma schema 自动生成相关的迁移脚本，而 SQL 的表定义需要开发者手动编写，容易出错。</p>\n<h3>总结</h3>\n<p>Prisma ORM 通过提供类型安全、自动迁移、高层抽象和声明式数据建模，显著提高了与数据库交互的效率和安全性。</p>\n<p>| 特性             | Prisma ORM                       | 原始 SQL             |<br>\n|</p>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241220174057.png",
      "date_published": "2024-12-20T00:00:00.000Z",
      "date_modified": "2024-12-23T03:21:07.000Z",
      "authors": [],
      "tags": [
        "backend",
        "node"
      ]
    },
    {
      "title": "Prisma 入门",
      "url": "https://dribble-njr.github.io/blog/blog/backend/node/prisma/01-quick-start.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/node/prisma/01-quick-start.html",
      "summary": "以关系型数据库 Mysql 为例，介绍 Prisma 在 Node.js 和 Typescript 项目中的安装和使用。 前置条件 安装 Node.js 运行 Mysql 注 更多系统要求请参考 Prisma 系统要求。 确保拥有 数据库连接 url。 安装项目 创建项目目录： 初始化 Typescript 项目并安装 Prisma CLI： 这会创建...",
      "content_html": "<p>以关系型数据库 Mysql 为例，介绍 Prisma 在 Node.js 和 Typescript 项目中的安装和使用。</p>\n<h2>前置条件</h2>\n<ul>\n<li>安装 <a href=\"https://nodejs.org/en\" target=\"_blank\" rel=\"noopener noreferrer\">Node.js</a></li>\n<li>运行 <a href=\"https://www.mysql.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Mysql</a></li>\n</ul>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>更多系统要求请参考 <a href=\"https://www.prisma.io/docs/orm/reference/system-requirements\" target=\"_blank\" rel=\"noopener noreferrer\">Prisma 系统要求</a>。</p>\n<p>确保拥有 <a href=\"https://www.prisma.io/docs/orm/reference/connection-urls\" target=\"_blank\" rel=\"noopener noreferrer\">数据库连接 url</a>。</p>\n</div>\n<h2>安装项目</h2>\n<p>创建项目目录：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">mkdir</span> hello-prisma\n<span class=\"token builtin class-name\">cd</span> hello-prisma\n</code></pre></div><p>初始化 Typescript 项目并安装 Prisma CLI：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> prisma typescript tsx @types/node --save-dev\n</code></pre></div><p>这会创建 <code>package.json</code> 文件，并创建一个 Typescript 项目。</p>\n<p>接下来，初始化 Typescript：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx tsc <span class=\"token parameter variable\">--init</span>\n</code></pre></div><p>你现在可以通过 <code>npx</code> 运行 Prisma CLI：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma\n</code></pre></div><p>接下来，你可以通过创建 <a href=\"https://www.prisma.io/docs/concepts/components/prisma-schema\" target=\"_blank\" rel=\"noopener noreferrer\">Prisma Schema</a> 文件来创建 Prisma ORM 项目：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma init\n</code></pre></div><p>这个命令做了两件事：</p>\n<ul>\n<li>创建一个名为 <code>prisma</code> 的目录，其中包含一个名为 <code>schema.prisma</code> 的文件，该文件包含数据库连接变量和 schema 模型。</li>\n<li>在项目根目录中创建 <a href=\"https://www.prisma.io/docs/orm/more/development-environment/environment-variables/env-files\" target=\"_blank\" rel=\"noopener noreferrer\"><code>.env</code></a> 文件，用于定义环境变量（例如数据库连接）。</li>\n</ul>\n<h2>连接数据库</h2>\n<p>为了连接数据库，你需要在 <code>schema.prisma</code> 文件中定义数据源：</p>\n<p><strong>prisma/schema.prisma</strong></p>\n<div class=\"language-prisma\" data-ext=\"prisma\" data-title=\"prisma\"><pre class=\"language-prisma\"><code>datasource db {\n  provider = \"mysql\"\n  url      = env(\"DATABASE_URL\")\n}\n</code></pre></div><p><strong>.env</strong></p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>DATABASE_URL=\"mysql://johndoe:randompassword@localhost:3306/mydb\"\n</code></pre></div><p>URL 格式取决于你使用的数据库。对于 MySQL，它看起来如下（大写的部分是你的特定连接细节的占位符）：</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>mysql://USER:PASSWORD@HOST:PORT/DATABASE\n</code></pre></div><p>这里是对每个组件的简要解释：</p>\n<ul>\n<li>USER: 数据库用户名</li>\n<li>PASSWORD: 数据库用户密码</li>\n<li>PORT: 数据库服务器运行的端口（通常为 3306 用于 MySQL）</li>\n<li>DATABASE: 数据库名称</li>\n</ul>\n<h2>Prisma Migrate</h2>\n<p><a href=\"https://www.prisma.io/docs/orm/prisma-migrate\" target=\"_blank\" rel=\"noopener noreferrer\">Prisma Migrate</a> 是 Prisma 的迁移工具，用于管理数据库 schema 的变更。</p>\n<p><strong>prisma/schema.prisma</strong></p>\n<div class=\"language-prisma\" data-ext=\"prisma\" data-title=\"prisma\"><pre class=\"language-prisma\"><code>model Post {\n  id        Int      @id @default(autoincrement())\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n  title     String   @db.VarChar(255)\n  content   String?\n  published Boolean  @default(false)\n  author    User     @relation(fields: [authorId], references: [id])\n  authorId  Int\n}\n\nmodel Profile {\n  id     Int     @id @default(autoincrement())\n  bio    String?\n  user   User    @relation(fields: [userId], references: [id])\n  userId Int     @unique\n}\n\nmodel User {\n  id      Int      @id @default(autoincrement())\n  email   String   @unique\n  name    String?\n  posts   Post[]\n  profile Profile?\n}\n</code></pre></div><p>为了将 schema 转换为数据库，你需要运行 Prisma Migrate：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma migrate <span class=\"token parameter variable\">--name</span> init\n</code></pre></div><p>这个命令会做两件事：</p>\n<ul>\n<li>创建一个 SQL 迁移文件。</li>\n<li>在数据库中执行对应的 SQL 迁移文件。</li>\n</ul>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>注意：默认情况下，运行 <code>prisma migrate dev</code> 后，会在引擎盖下调用 <code>generate</code>。 如果模式中定义了 <code>prisma-client-js</code> 生成器，它会检查 <code>@prisma/client</code> 是否已安装，如果缺少，则安装。</p>\n</div>\n<h2>安装 Prisma Client</h2>\n<p>要开始使用 Prisma 客户端，需要安装 <code>@prisma/client</code> 软件包：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> <span class=\"token function\">install</span> @prisma/client\n</code></pre></div><p>安装命令会调用 <code>prisma generate</code>，读取 Prisma schema 并生成适合你模型的 Prisma 客户端版本。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241217183854.png\" alt=\"workflow\" tabindex=\"0\" loading=\"lazy\"><figcaption>workflow</figcaption></figure>\n<p>无论何时更新 Prisma schema，都必须使用 <code>prisma migrate dev</code> 或 <code>prisma db push</code> 更新数据库模式。这将使数据库模式与 Prisma 模式保持同步。这些命令还将重新生成 Prisma 客户端。</p>\n<blockquote>\n<p>[!WARNING] &gt; <code>prisma db push</code> 不会生成迁移文件，只会在数据库中执行对应的 SQL 语句。</p>\n<p>因此如果你需要对数据库进行版本控制，需要更好的迁移记录和管理，请使用 <code>prisma migrate dev</code>。</p>\n</blockquote>\n<h2>操作数据库</h2>\n<h3>查询数据</h3>\n<p>现在已经生成了 <a href=\"https://www.prisma.io/docs/orm/prisma-client\" target=\"_blank\" rel=\"noopener noreferrer\">Prisma Client</a>，可以开始编写在数据库中读写数据的查询。</p>\n<p>创建一个名为 <code>index.ts</code> 的新文件，并在其中添加以下代码：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PrismaClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@prisma/client'</span>\n\n<span class=\"token keyword\">const</span> prisma <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrismaClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... you will write your Prisma Client queries here</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span><span class=\"token function\">$disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span><span class=\"token function\">$disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>以下是代码片段各部分的简要概述：</p>\n<ul>\n<li>从 <code>@prisma/client</code> 节点模块导入 <code>PrismaClient</code> 构造函数</li>\n<li>实例化 <code>PrismaClient</code></li>\n<li>定义名为 <code>main</code> 的异步函数，向数据库发送查询</li>\n<li>调用 <code>main</code> 函数</li>\n<li>脚本终止时关闭数据库连接</li>\n</ul>\n<p>在 <code>main</code> 函数中，添加以下查询，从数据库中读取所有用户记录并打印结果：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... you will write your Prisma Client queries here</span>\n  <span class=\"token keyword\">const</span> allUsers <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">findMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>allUsers<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>运行脚本：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx tsx index.ts\n</code></pre></div><p>这将打印一个空数组，因为数据库中还没有用户记录：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n</code></pre></div><h3>写入数据</h3>\n<p><code>findMany</code> 查询只能从数据库中读取数据（尽管它仍然是空的）。接下来可以向 <code>Post</code> 表和 <code>User</code> 表中写入新记录。</p>\n<p>调整 <code>main</code> 函数，向数据库发送创建查询：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      name<span class=\"token operator\">:</span> <span class=\"token string\">'Alice'</span><span class=\"token punctuation\">,</span>\n      email<span class=\"token operator\">:</span> <span class=\"token string\">'alice@prisma.io'</span><span class=\"token punctuation\">,</span>\n      posts<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        create<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> title<span class=\"token operator\">:</span> <span class=\"token string\">'Hello World'</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      profile<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        create<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> bio<span class=\"token operator\">:</span> <span class=\"token string\">'I like turtles'</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> allUsers <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">findMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    include<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      posts<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      profile<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">dir</span><span class=\"token punctuation\">(</span>allUsers<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> depth<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这段代码使用 <a href=\"https://www.prisma.io/docs/orm/prisma-client/queries/relation-queries#nested-writes\" target=\"_blank\" rel=\"noopener noreferrer\">嵌套写查询</a> 创建了一条新的用户记录以及新的帖子和简介记录。用户记录分别通过 <code>Post.author ↔ User.posts</code> 和 <code>Profile.user ↔ User.profile</code> 关系字段与其他两条记录创建 <a href=\"https://www.prisma.io/docs/orm/prisma-schema/data-model/relations#relation-fields\" target=\"_blank\" rel=\"noopener noreferrer\">关系</a>。</p>\n<p>请注意，您向 <code>findMany</code> 传递了 <a href=\"https://www.prisma.io/docs/orm/prisma-client/queries/select-fields#return-nested-objects-by-selecting-relation-fields\" target=\"_blank\" rel=\"noopener noreferrer\"><code>include</code></a> 选项，该选项告诉 Prisma 客户端在返回的用户对象中包含 <code>posts</code> 和 <code>profile</code> 关系。</p>\n<p>运行脚本：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx tsx index.ts\n</code></pre></div><p>这将打印一个包含新创建的用户的数组：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    email: <span class=\"token string\">'alice@prisma.io'</span>,\n    id: <span class=\"token number\">1</span>,\n    name: <span class=\"token string\">'Alice'</span>,\n    posts: <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        content: null,\n        createdAt: <span class=\"token number\">2020</span>-03-21T16:45:01.246Z,\n        updatedAt: <span class=\"token number\">2020</span>-03-21T16:45:01.246Z,\n        id: <span class=\"token number\">1</span>,\n        published: false,\n        title: <span class=\"token string\">'Hello World'</span>,\n        authorId: <span class=\"token number\">1</span>,\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>,\n    profile: <span class=\"token punctuation\">{</span>\n      bio: <span class=\"token string\">'I like turtles'</span>,\n      id: <span class=\"token number\">1</span>,\n      userId: <span class=\"token number\">1</span>,\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div><p>这个 query 向 <code>User</code> 和 <code>Post</code> 表中写入了新记录：</p>\n<p>User</p>\n<p>| id  | email           | name  |<br>\n|</p>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241217183854.png",
      "date_published": "2024-12-17T00:00:00.000Z",
      "date_modified": "2024-12-17T10:57:18.000Z",
      "authors": [],
      "tags": [
        "node"
      ]
    },
    {
      "title": "国际化",
      "url": "https://dribble-njr.github.io/blog/blog/project/imperial-kitchen/04-i18n.html",
      "id": "https://dribble-njr.github.io/blog/blog/project/imperial-kitchen/04-i18n.html",
      "summary": "配置 配置 app.json 集成 apps/mobile/locales/index.ts ",
      "content_html": "<h2>配置</h2>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">yarn</span> workspace mobile <span class=\"token function\">add</span> i18next react-i18next expo-localization\n</code></pre></div><p>配置 app.json</p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"expo\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"expo-localization\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>集成</h2>\n<p><code>apps/mobile/locales/index.ts</code></p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">import</span> i18n <span class=\"token keyword\">from</span> <span class=\"token string\">'i18next'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> initReactI18next <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-i18next'</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> Localization <span class=\"token keyword\">from</span> <span class=\"token string\">'expo-localization'</span>\n<span class=\"token keyword\">import</span> English <span class=\"token keyword\">from</span> <span class=\"token string\">'./en'</span>\n<span class=\"token keyword\">import</span> Chinese <span class=\"token keyword\">from</span> <span class=\"token string\">'./zh'</span>\n\n<span class=\"token keyword\">const</span> resources <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  en<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> translation<span class=\"token operator\">:</span> English <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  zh<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> translation<span class=\"token operator\">:</span> Chinese <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUserLanguage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> locales <span class=\"token operator\">=</span> Localization<span class=\"token punctuation\">.</span><span class=\"token function\">getLocales</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>locales<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> locales<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>languageCode <span class=\"token operator\">??</span> <span class=\"token string\">'zh'</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token string\">'zh'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// console.error('Error retrieving language preference:', error);</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'zh'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> language <span class=\"token operator\">=</span> <span class=\"token function\">getUserLanguage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ni18n<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>initReactI18next<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  resources<span class=\"token punctuation\">,</span>\n  compatibilityJSON<span class=\"token operator\">:</span> <span class=\"token string\">'v3'</span><span class=\"token punctuation\">,</span>\n  lng<span class=\"token operator\">:</span> language<span class=\"token punctuation\">,</span>\n  fallbackLng<span class=\"token operator\">:</span> <span class=\"token string\">'zh'</span><span class=\"token punctuation\">,</span>\n  interpolation<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    escapeValue<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token comment\">// react already safes from xss</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  react<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    useSuspense<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token comment\">// avoid suspense problem</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> i18n\n</code></pre></div>",
      "date_published": "2024-09-29T00:00:00.000Z",
      "date_modified": "2024-12-17T10:16:46.000Z",
      "authors": [],
      "tags": [
        "Project"
      ]
    },
    {
      "title": "云服务器设置代理",
      "url": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/06-server-proxy.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/06-server-proxy.html",
      "summary": "在许多开发和部署场景中，使用代理服务器能够帮助我们绕过网络限制，提升安全性，或者加速访问。在本篇文章中，我们将讨论如何在云服务器上设置代理，主要包括通过隧道技术与使用 Clash for Linux 两种方式。 使用 SSH 隧道设置代理 SSH 隧道是一种通过安全通道将本地端口转发到远程服务器的方法。使用 SSH 隧道可以通过云服务器作为中介，绕过局...",
      "content_html": "<p>在许多开发和部署场景中，使用代理服务器能够帮助我们绕过网络限制，提升安全性，或者加速访问。在本篇文章中，我们将讨论如何在云服务器上设置代理，主要包括通过隧道技术与使用 Clash for Linux 两种方式。</p>\n<h2>使用 SSH 隧道设置代理</h2>\n<p>SSH 隧道是一种通过安全通道将本地端口转发到远程服务器的方法。使用 SSH 隧道可以通过云服务器作为中介，绕过局域网或区域性网络的限制，访问外部服务。下面是如何设置 SSH 隧道代理。</p>\n<p>一般云服务器都支持 SSH 隧道，如果是基于 Ubuntu 的系统，可以通过以下命令来确认：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> systemctl status <span class=\"token function\">ssh</span>\n</code></pre></div><p>如果看到 <code>active (running)</code> 字样，说明 SSH 服务正在运行。</p>\n<p>如果没有安装，可以使用以下命令安装：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> openssh-server\n</code></pre></div><p>在本地电脑上，使用 SSH 连接到云服务器：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-R</span> <span class=\"token number\">7890</span>:127.0.0.1:7890 root@<span class=\"token operator\">&lt;</span>your-server-ip<span class=\"token operator\">&gt;</span>\n</code></pre></div><p>然后在云服务器上，设置环境变量，编辑 <code>~/.bashrc</code>（或 <code>~/.zshrc</code>，取决于你使用的 shell） 文件：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>$ <span class=\"token function\">vi</span> ~/.bashrc\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">http_proxy</span><span class=\"token operator\">=</span>http://127.0.0.1:7890\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">https_proxy</span><span class=\"token operator\">=</span>http://127.0.0.1:7890\n</code></pre></div><p>这样，云服务器上的所有请求，都会经过本地的 7890 端口。</p>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>该方式优点在于简单，在一些简单的场景下可以满足需求。</p>\n<p>缺点在于依赖 SSH 隧道，如果使用 GitHub Action 触发 CI，由于没有 SSH 隧道，所以会导致无法使用代理。</p>\n<p>除非你能保证本地电脑一直处于连接状态，否则不建议使用该方式。</p>\n</div>\n<h2>使用 Clash for Linux 设置代理</h2>\n<p><a href=\"https://github.com/Elegycloud/clash-for-linux-backup\" target=\"_blank\" rel=\"noopener noreferrer\">Clash for Linux</a> 是一款功能强大的代理工具，支持多种协议，包括 HTTP、SOCKS5 等。通过 Clash for Linux，我们可以方便地在本地电脑上设置代理，并将其同步到云服务器上。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">git</span> clone https://github.com/Elegycloud/clash-for-linux-backup.git\n</code></pre></div><p>进入到项目目录，编辑 <code>.env</code> 文件，修改变量 <code>CLASH_URL</code> 的值。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> clash-for-linux-backup\n<span class=\"token function\">vi</span> .env\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><code>CLASH_SECRET</code> 变量会用于登陆 dashboard。</p>\n</div>\n<p>启动代理：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>$ <span class=\"token function\">sudo</span> <span class=\"token function\">bash</span> start.sh\n正在检测订阅地址<span class=\"token punctuation\">..</span>.\nClash订阅地址可访问！                                      <span class=\"token punctuation\">[</span>  OK  <span class=\"token punctuation\">]</span>\n\n正在下载Clash配置文件<span class=\"token punctuation\">..</span>.\n配置文件config.yaml下载成功！                              <span class=\"token punctuation\">[</span>  OK  <span class=\"token punctuation\">]</span>\n\n正在启动Clash服务<span class=\"token punctuation\">..</span>.\n服务启动成功！                                             <span class=\"token punctuation\">[</span>  OK  <span class=\"token punctuation\">]</span>\n\nClash Dashboard 访问地址：http://<span class=\"token operator\">&lt;</span>ip<span class=\"token operator\">&gt;</span>:9090/ui\nSecret：xxxxxxxxxxxxx\n\n请执行以下命令加载环境变量: <span class=\"token builtin class-name\">source</span> /etc/profile.d/clash.sh\n\n请执行以下命令开启系统代理: proxy_on\n\n若要临时关闭系统代理，请执行: proxy_off\n</code></pre></div><p>加载环境变量并启动服务：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">source</span> /etc/profile.d/clash.sh\nproxy_on\n</code></pre></div><p>检查服务端口：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>$ <span class=\"token function\">sudo</span> <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-tuln</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">7890</span>\n$ <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-tln</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">'9090|789.'</span>\ntcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::7892                 :::*                    LISTEN\ntcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::7890                 :::*                    LISTEN\ntcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::7891                 :::*                    LISTEN\ntcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::9090                 :::*                    LISTEN\n</code></pre></div><p>检查环境变量：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>$ <span class=\"token function\">env</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">'http_proxy|https_proxy'</span>\n<span class=\"token assign-left variable\">http_proxy</span><span class=\"token operator\">=</span>http://127.0.0.1:7890\n<span class=\"token assign-left variable\">https_proxy</span><span class=\"token operator\">=</span>http://127.0.0.1:7890\n</code></pre></div><p>这样，云服务器上的代理即设置完成。若要查看 dashboard，可以使用 VS Code 插件 <a href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh\" target=\"_blank\" rel=\"noopener noreferrer\">Remote - SSH</a> 连接到云服务器，设置端口转发，然后在浏览器中访问 <code>http://127.0.0.1:9090/ui</code>。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241204164400.png\" alt=\"端口转发\" tabindex=\"0\" loading=\"lazy\"><figcaption>端口转发</figcaption></figure>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>配置完成后，dashboard 会在关闭连接后停止，所以可以进行持久化。</p>\n</div>\n<p>编辑 <code>~/.bashrc</code> 文件，添加以下内容：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>$ <span class=\"token function\">vi</span> ~/.bashrc\n<span class=\"token function\">bash</span> /path/to/clash-for-linux-backup/start.sh\n<span class=\"token builtin class-name\">source</span> /etc/profile.d/clash.sh\nproxy_on\n</code></pre></div><p>这样，每次连接到云服务器后，都会自动启动代理。</p>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20241204164400.png",
      "date_published": "2024-12-04T00:00:00.000Z",
      "date_modified": "2026-01-23T04:40:58.000Z",
      "authors": [],
      "tags": [
        "linux"
      ]
    },
    {
      "title": "Docker 安装 MySQL",
      "url": "https://dribble-njr.github.io/blog/blog/backend/database/mysql/01-install-mysql.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/database/mysql/01-install-mysql.html",
      "summary": "使用 Docker 安装 MySQL。 安装 从 docker-hub 镜像源中找到想要安装的版本号。 这里直接安装最新版本。 等待一段时间安装完成后，启动 MySQL 容器： 这个命令的参数解释如下： -d: 后台运行容器。 --name mysql-container: 给容器起一个名字。 -e MYSQL_ROOT_PASSWORD=my-sec...",
      "content_html": "<p>使用 Docker 安装 MySQL。</p>\n<h2>安装</h2>\n<p>从 <a href=\"https://hub.docker.com/_/mysql/\" target=\"_blank\" rel=\"noopener noreferrer\">docker-hub</a> 镜像源中找到想要安装的版本号。</p>\n<p>这里直接安装最新版本。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">docker</span> pull mysql\n</code></pre></div><p>等待一段时间安装完成后，启动 MySQL 容器：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> mysql-container <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span>my-secret-pw <span class=\"token parameter variable\">-v</span> /path/to/data:/var/lib/mysql <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">TZ</span><span class=\"token operator\">=</span>Asia/Shanghai <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3306</span>:3306 mysql\n</code></pre></div><p>这个命令的参数解释如下：</p>\n<ul>\n<li><code>-d</code>: 后台运行容器。</li>\n<li><code>--name mysql-container</code>: 给容器起一个名字。</li>\n<li><code>-e MYSQL_ROOT_PASSWORD=my-secret-pw</code>: 设置 MySQL root 用户的密码。</li>\n<li><code>-p 3306:3306</code>: 将容器的 MySQL 服务端口（默认为 3306）映射到主机的 3306 端口。</li>\n<li><code>-v /path/to/data:/var/lib/mysql</code>: 将容器中的 MySQL 数据目录挂载到主机上的 <code>/path/to/data</code> 目录。</li>\n<li><code>-e TZ=Asia/Shanghai</code>: 设置时区。</li>\n</ul>\n<p>启动容器后进入 MySQL 容器的命令行界面：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> mysql-container <span class=\"token function\">bash</span>\n</code></pre></div><p>输入密码即可进入 MySQL 命令行界面。</p>\n<h2>设置 MySQL</h2>\n<p>进入到命令行界面后，设置一些基本的配置。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>MySQL 命令以 <code>;</code> 表示一行结束。</p>\n</div>\n<ol>\n<li>登陆 MySQL</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>mysql <span class=\"token parameter variable\">-u</span> root <span class=\"token parameter variable\">-p</span>\n</code></pre></div><ol start=\"2\">\n<li>创建数据库</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>create database your_data_base_name<span class=\"token punctuation\">;</span>\n</code></pre></div><ol start=\"3\">\n<li>创建用户</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>CREATE <span class=\"token environment constant\">USER</span> <span class=\"token string\">'your_username'</span>@<span class=\"token string\">'localhost'</span> IDENTIFIED BY <span class=\"token string\">'your_password'</span><span class=\"token punctuation\">;</span>\n</code></pre></div><ol start=\"4\">\n<li>设置权限</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>GRANT ALL PRIVILEGES ON your_database_name.* TO <span class=\"token string\">'your_username'</span>@<span class=\"token string\">'localhost'</span><span class=\"token punctuation\">;</span>\n</code></pre></div><ol start=\"5\">\n<li>刷新权限</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>FLUSH PRIVILEGES<span class=\"token punctuation\">;</span>\n</code></pre></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>必要步骤，否则权限会不生效。</p>\n</div>\n<p>做完基本的配置之后，就可以使用下面命令退出命令行界面：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">exit</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>服务器开放端口</h2>\n<p>参考 。</p>\n<p>接下来就可以使用 Navicat 连接数据库了。</p>\n",
      "date_published": "2024-01-14T00:00:00.000Z",
      "date_modified": "2024-12-04T08:03:38.000Z",
      "authors": [],
      "tags": [
        "database"
      ]
    },
    {
      "title": "服务器设置 ssh 密钥登录",
      "url": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/01-set-the-ssh.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/01-set-the-ssh.html",
      "summary": " 提示 使用密码登录服务器并不安全，因此我们需要设置密钥登录。 创建密钥对 登录阿里云控制台 -> 云服务 ECS -> 网络与安全 -> 密钥对 -> 创建密钥对。 step1-create-sshstep1-create-ssh 创建成功之后，浏览器会自动下载一个 .pem 私钥文件，记住这个文件的位置，之后要用。 绑定密钥对 选中刚才创建的密钥对...",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>使用密码登录服务器并不安全，因此我们需要设置密钥登录。</p>\n</div>\n<h2>创建密钥对</h2>\n<p>登录阿里云控制台 -&gt; 云服务 ECS -&gt; 网络与安全 -&gt; 密钥对 -&gt; 创建密钥对。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step1-create-ssh.png\" alt=\"step1-create-ssh\" tabindex=\"0\" loading=\"lazy\"><figcaption>step1-create-ssh</figcaption></figure>\n<p>创建成功之后，浏览器会自动下载一个 <code>.pem</code> 私钥文件，记住这个文件的位置，之后要用。</p>\n<h2>绑定密钥对</h2>\n<p>选中刚才创建的密钥对，点击右侧<strong>绑定密钥对</strong>，将密钥对绑定到实例。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step2-bind-ssh.png\" alt=\"step2-bind-ssh\" tabindex=\"0\" loading=\"lazy\"><figcaption>step2-bind-ssh</figcaption></figure>\n<h2>添加安全组规则</h2>\n<p>云服务 ECS -&gt; 网络与安全 -&gt; 安全组 -&gt; 入方向 -&gt; 手动添加。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step3-add-port.png\" alt=\"step3-add-port\" tabindex=\"0\" loading=\"lazy\"><figcaption>step3-add-port</figcaption></figure>\n<p>执行完后重启实例。</p>\n<h2>密钥验证并禁用密码登录</h2>\n<ol>\n<li>\n<p>安装 MobaXterm</p>\n</li>\n<li>\n<p>在 MobaXterm 下输入命令（<a href=\"https://help.aliyun.com/document_detail/51798.html#title-7je-5ba-sm2\" target=\"_blank\" rel=\"noopener noreferrer\">参考阿里云官网文档</a>）</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">chmod</span> <span class=\"token number\">400</span> <span class=\"token punctuation\">[</span>.pem私钥文件在本地机上的存储路径<span class=\"token punctuation\">]</span>\n</code></pre></div><div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-i</span> <span class=\"token punctuation\">[</span>.pem私钥文件在本地机上的存储路径<span class=\"token punctuation\">]</span> root@<span class=\"token punctuation\">[</span>公网IP地址<span class=\"token punctuation\">]</span>\n</code></pre></div></li>\n<li>\n<p>输入以下命令修改 config 文件</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">vi</span> /etc/ssh/sshd_config\n</code></pre></div></li>\n<li>\n<p>按 <code>i</code> 进入编辑模式</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token comment\">#禁用密码验证</span>\nPasswordAuthentication no\n<span class=\"token comment\">#启用密钥验证</span>\nPubkeyAuthentication <span class=\"token function\">yes</span>\n</code></pre></div></li>\n<li>\n<p>重启 ssh 服务</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">service</span> sshd restart\n</code></pre></div></li>\n</ol>\n<p>接下来在阿里云控制台使用 Workbench 远程连接，可以发现密码登录已经被禁用了，只能使用密钥登录。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step4-pw-fail.png\" alt=\"step4-pw-fail\" tabindex=\"0\" loading=\"lazy\"><figcaption>step4-pw-fail</figcaption></figure>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step1-create-ssh.png",
      "date_published": "2021-05-12T00:00:00.000Z",
      "date_modified": "2024-12-03T06:25:23.000Z",
      "authors": [],
      "tags": [
        "linux"
      ]
    },
    {
      "title": "搭建 git 私服",
      "url": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/02-build-git-server.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/02-build-git-server.html",
      "summary": " 提示 git 私服作用： 自己电脑和公司（或者实验室）电脑随时同步资料 GitHub、Gitee 私有仓库都是限流的，文件一旦多了，或者有图片文件，git pull 的时候半天拉不下来 保存一些隐私文件 开始搭建 服务器：centos7.9 本地电脑: Windows10 如果服务器没装 git 可以使用以下命令安装： 创建 git 用户 创建一个 ...",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><strong>git 私服作用：</strong></p>\n<ul>\n<li>自己电脑和公司（或者实验室）电脑随时同步资料</li>\n<li>GitHub、Gitee 私有仓库都是限流的，文件一旦多了，或者有图片文件，<code>git pull</code> 的时候半天拉不下来</li>\n<li>保存一些隐私文件</li>\n</ul>\n</div>\n<h2>开始搭建</h2>\n<ul>\n<li>服务器：centos7.9</li>\n<li>本地电脑: Windows10</li>\n</ul>\n<p>如果服务器没装 git 可以使用以下命令安装：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>yum <span class=\"token function\">install</span> <span class=\"token function\">git</span>\n</code></pre></div><h2>创建 git 用户</h2>\n<p>创建一个 Git 的 Linux 账户，这个账户只做 Git 私服的操作，之后就要设置 Linux Git 账户的密码，但由于我之前已经 ，因此不用设置密码。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>adduser <span class=\"token function\">git</span>\n</code></pre></div><p><strong>后面所有的操作都在 git 用户下进行：</strong></p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span>root@instance-5fcyjde7 ~<span class=\"token punctuation\">]</span>su - <span class=\"token function\">git</span>\n</code></pre></div><p>看一下自己所在的目录，是不是在 git 目录下面：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span>git@instance-5fcyjde7 ~<span class=\"token punctuation\">]</span>$ <span class=\"token builtin class-name\">pwd</span>\n/home/git\n</code></pre></div><h2>服务器端密钥管理</h2>\n<p>创建 <code>.ssh</code> 目录，如果 <code>.ssh</code> 已经存在了，可以忽略这一项。方便每次操作 Git 仓库的时候不用再去输入密码。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> ~/\n<span class=\"token function\">mkdir</span> .ssh\n</code></pre></div><p>进入 <code>.ssh</code> 文件下，创建一个 <code>authorized_keys</code> 文件，并给 <code>authorized_keys</code> 文件设置权限。这个文件用来存放客户端的公钥。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> ~/.ssh\n<span class=\"token function\">touch</span> authorized_keys\n<span class=\"token function\">chmod</span> <span class=\"token number\">700</span> /home/git/.ssh\n<span class=\"token function\">chmod</span> <span class=\"token number\">600</span> /home/git/.ssh/authorized_keys\n</code></pre></div><p>接下来要把客户端的公钥放在 Git 服务器上，我们再回到客户端，创建一个公钥。</p>\n<p>在我们自己的电脑上，有公钥和私钥。两个文件分别是：<code>id_rsa</code> 和 <code>id_rsa.pub</code>。</p>\n<p>如果是 Windows 系统公钥私钥的目录在 <code>C:\\Users\\用户名.ssh</code> 下。</p>\n<p>如果是 Mac 或者 Linux， 公钥和私钥的目录这里 <code>cd ~/.ssh/</code>， 如果发现自己的电脑上没有公钥私钥，那就自己创建一个。</p>\n<p>创建密钥的命令：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>ssh-keygen <span class=\"token parameter variable\">-t</span> rsa\n</code></pre></div><p>创建密钥的过程中，一路点击回车就可以了，不需要填任何东西。把刚刚生成的 <code>id_rsa.pub</code>，拷贝到 Git 服务器的 <code>/home/git/.ssh/</code> 目录。</p>\n<p>在 Git 服务器上，将公钥添加到 <code>authorized_keys</code> 文件中：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> /home/git/.ssh/\n<span class=\"token function\">cat</span> id_rsa.pub <span class=\"token operator\">&gt;&gt;</span> authorized_keys\n</code></pre></div><p>在客户直接登录 Git 服务器，验证是否配置成功：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">ssh</span> git@git 服务器 <span class=\"token function\">ip</span>\n<span class=\"token comment\"># 例如：</span>\n<span class=\"token function\">ssh</span> git@127.0.0.1\n</code></pre></div><p>如果可以免密登录，那就说明服务器端密钥配置成功了。</p>\n<p>在这里我还出现了一个错误：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED<span class=\"token operator\">!</span>     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY<span class=\"token operator\">!</span>\nSomeone could be eavesdropping on you right now <span class=\"token punctuation\">(</span>man-in-the-middle attack<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\nIt is also possible that a <span class=\"token function\">host</span> key has just been changed.\nThe fingerprint <span class=\"token keyword\">for</span> the RSA key sent by the remote <span class=\"token function\">host</span> is\n<span class=\"token number\">51</span>:82:00:1c:7e:6f:ac:ac:de:f1:53:08:1c:7d:55:68.\nPlease contact your system administrator.\nAdd correct <span class=\"token function\">host</span> key <span class=\"token keyword\">in</span> /Users/isaacalves/.ssh/known_hosts to get rid of this message.\nOffending RSA key <span class=\"token keyword\">in</span> /Users/isaacalves/.ssh/known_hosts:12\nRSA <span class=\"token function\">host</span> key <span class=\"token keyword\">for</span> <span class=\"token number\">104.131</span>.16.158 has changed and you have requested strict checking.\nHost key verification failed.\n</code></pre></div><p>出现这个错误的原因是因为我更新了 <code>ssh key</code>，使用以下命令删除无效的 key 即可：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>ssh-keygen <span class=\"token parameter variable\">-R</span> <span class=\"token string\">\"服务器 ip\"</span>\n</code></pre></div><h2>服务器端部署 Git 仓库</h2>\n<p>接下来在服务器上部署 git 仓库。</p>\n<p>登录到 Git 服务器端，切换为 Git 账户。如果是 root 账户切换成 Git 账户：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">su</span> - <span class=\"token function\">git</span>\n</code></pre></div><p>如果是其他账户切换为 Git 账户：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> <span class=\"token function\">su</span> - <span class=\"token function\">git</span>\n</code></pre></div><p>进入 git 目录下：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> ~/git\n</code></pre></div><p>创建一个文件夹名为 <code>world.git</code>，<code>.git</code> 后缀表明这是一个 git 仓库而不是别的什么文件。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span>git@localhost git<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir world.git</span>\n<span class=\"token punctuation\">[</span>git@localhost git<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd word.git</span>\n</code></pre></div><p>初始化 word 仓库：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">git</span> init <span class=\"token parameter variable\">--bare</span>\n</code></pre></div><p>如果想创建多个仓库，就在 <strong>git</strong> 用户下的 <code>~/git</code> 目录创建多个文件夹并<strong>初始化</strong>就可以了。</p>\n<p>现在服务端的 Git 仓库就部署完了，接下来就能像平时使用 github 一样使用这个 Git 私服了。</p>\n<h2>客户端连接远程仓库</h2>\n<p>在自己的电脑上创建一个文件夹也叫做 <code>world</code>。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>其实这里命名是随意的，但是我们为了和 Git 服务端的仓库名称保持同步。这样更直观我们操作的是哪一个仓库。</p>\n</div>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">mkdir</span> world\n<span class=\"token builtin class-name\">cd</span> world\n</code></pre></div><p>进入 <code>world</code> 文件，并初始化操作：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> world\n<span class=\"token function\">git</span> init\n</code></pre></div><p>在 <code>world</code> 目录上创建一个测试文件，并且将其添加到 Git 私服中：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">touch</span> <span class=\"token builtin class-name\">test</span>\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">test</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"test git server\"</span>\n</code></pre></div><p>将本地仓库和远端仓库同步：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">git</span> remote <span class=\"token function\">add</span> origin git@服务器 ip:world.git\n<span class=\"token function\">git</span> push <span class=\"token parameter variable\">-u</span> origin master\n</code></pre></div><p>此时这个 <code>test</code> 测试文件就已经提交到我们的 Git 远端私服上了。</p>\n<h2>参考链接</h2>\n<ul>\n<li><a href=\"https://mp.weixin.qq.com/s/8m5zK29sX0D9NM_YB8KDNQ\" target=\"_blank\" rel=\"noopener noreferrer\">手把手来搭建 Git 私服！</a></li>\n<li><a href=\"https://www.digitalocean.com/community/questions/warning-remote-host-identification-has-changed\" target=\"_blank\" rel=\"noopener noreferrer\">WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED</a></li>\n</ul>\n",
      "date_published": "2021-05-12T00:00:00.000Z",
      "date_modified": "2026-01-23T04:40:58.000Z",
      "authors": [],
      "tags": [
        "linux"
      ]
    },
    {
      "title": "配置宝塔面板",
      "url": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/03-configure-bt.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/03-configure-bt.html",
      "summary": " 提示 服务器系统：centos 7.9。 其他系统可以参照 官网 进行搭建。 为了方便一键配置部署环境，因此选择宝塔面板。 安装宝塔面板 大概过两分钟即可安装成功，复制外网面板地址到浏览器打开，输入下面的 username 和 password。进去之后会弹出 推荐安装套件，因为只要部署 vuepress， 因此这里安装 nginx 就好。选择编译安...",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>服务器系统：centos 7.9。</p>\n<p>其他系统可以参照 <a href=\"https://www.bt.cn/bbs/thread-19376-1-1.html\" target=\"_blank\" rel=\"noopener noreferrer\">官网</a> 进行搭建。</p>\n<p>为了方便一键配置部署环境，因此选择宝塔面板。</p>\n</div>\n<h2>安装宝塔面板</h2>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">wget</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">wget</span> <span class=\"token parameter variable\">-O</span> install.sh http://download.bt.cn/install/install_6.0.sh <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sh</span> install.sh\n</code></pre></div><p>大概过两分钟即可安装成功，复制外网面板地址到浏览器打开，输入下面的 <code>username</code> 和 <code>password</code>。进去之后会弹出 <code>推荐安装套件</code>，因为只要部署 <code>vuepress</code>， 因此这里安装 <code>nginx</code> 就好。选择编译安装，更加稳定。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step1-install-bt.png\" alt=\"step1-install-bt\" tabindex=\"0\" loading=\"lazy\"><figcaption>step1-install-bt</figcaption></figure>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step2-install-nginx.png\" alt=\"step2-install-nginx\" tabindex=\"0\" loading=\"lazy\"><figcaption>step2-install-nginx</figcaption></figure>\n<p>如果之后忘记用户名和密码，可以通过以下命令查找：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span>root@xxxx ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># bt</span>\n<span class=\"token punctuation\">[</span>root@xxxx ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># 14</span>\n</code></pre></div><h2>参考链接</h2>\n<ul>\n<li><a href=\"https://www.bt.cn/bbs/thread-19376-1-1.html\" target=\"_blank\" rel=\"noopener noreferrer\">宝塔 Linux 面板安装教程</a></li>\n<li><a href=\"https://www.bilibili.com/video/BV12T4y1N7T9?from=search&amp;seid=2220018938681661072&amp;spm_id_from=333.337.0.0\" target=\"_blank\" rel=\"noopener noreferrer\">阿里云服务器 ECS 新手搭建网站视频教程（详细版）</a></li>\n</ul>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step1-install-bt.png",
      "date_published": "2021-05-12T00:00:00.000Z",
      "date_modified": "2024-12-03T06:25:23.000Z",
      "authors": [],
      "tags": [
        "linux"
      ]
    },
    {
      "title": "自动部署 Vuepress 到服务器",
      "url": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/04-automated-deployment.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/04-automated-deployment.html",
      "summary": " 提示 服务器：centos 7.9 本地电脑：Windows 10 服务器端 配置 nginx 登录宝塔面板，可以参考 。点击左侧网站 -> 添加站点。 step1-add-sitestep1-add-site 新增之后，点击设置 -> 配置文件。这三项按自己的情况配置，在后面 中会将 dist 文件推送到 root 配置项设置的文件夹下。 step...",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>服务器：centos 7.9</p>\n<p>本地电脑：Windows 10</p>\n</div>\n<h2>服务器端</h2>\n<h3>配置 nginx</h3>\n<p>登录宝塔面板，可以参考 。点击左侧网站 -&gt; 添加站点。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step1-add-site.png\" alt=\"step1-add-site\" tabindex=\"0\" loading=\"lazy\"><figcaption>step1-add-site</figcaption></figure>\n<p>新增之后，点击设置 -&gt; 配置文件。这三项按自己的情况配置，在后面  中会将 dist 文件推送到 <code>root</code> 配置项设置的文件夹下。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step2-nginx-conf.png\" alt=\"step2-nginx-conf\" tabindex=\"0\" loading=\"lazy\"><figcaption>step2-nginx-conf</figcaption></figure>\n<p>先测试下 nginx 有没有配置成功，本地打包文件：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">yarn</span> build\n</code></pre></div><p>然后将生成的 <code>dist</code> 文件里的内容复制到刚才设置的项目根目录下。</p>\n<p>接着输入 <code>http://xxx.xxx.xxx.xxx:端口号</code>，就能访问成功了。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>地址得用 http 协议，因为我们还没有配置 ssl 证书。</p>\n</div>\n<h3>配置 git 仓库</h3>\n<p>在  中已经搭建好了 git 私服，因此只需要初始化 <code>vuepress.git</code> 仓库即可。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> /home/git\n<span class=\"token function\">mkdir</span> vuepress.git\n<span class=\"token builtin class-name\">cd</span> vuepress.git\n<span class=\"token function\">git</span> init <span class=\"token parameter variable\">--bare</span> vuepress.git\n</code></pre></div><h3>配置 hooks</h3>\n<p>先切换到 root 用户（<code>ctrl + d</code>），在 home 文件夹下创建一个临时存放 dist 文件夹的地方。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>我这里选择存放到 home 文件夹下，但是 git 用户是没有权限的，因此切换到 root 用户，也可以存放到其他文件夹。</p>\n</div>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> /home\n<span class=\"token function\">mkdir</span> tmp\n<span class=\"token builtin class-name\">cd</span> tmp\n<span class=\"token function\">mkdir</span> vuepress\n</code></pre></div><p>接着将文件的所有权换成 git：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> git:git <span class=\"token parameter variable\">-R</span> vuepress\n</code></pre></div><p>然后，有一个关键的地方，要将 <code>/www/wwwroot</code> 的所有权换成 git：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> git:git /www/wwwroot\n</code></pre></div><p>做好这些准备之后，就可以开始配置 <code>hooks</code> 了。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">cd</span> /home/git/vuepress.git/hooks\n<span class=\"token comment\"># 通过 copy 新建 post-update 文件</span>\n<span class=\"token function\">cp</span> post-update.sample post-update\n<span class=\"token function\">vim</span> post-update\n</code></pre></div><p>接着将下面代码复制进去：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"auto deploy start ===================================\"</span>\n<span class=\"token builtin class-name\">unset</span> GIT_DIR\n\n<span class=\"token comment\"># 项目文件夹</span>\n<span class=\"token assign-left variable\">PUBLIC_WWW</span><span class=\"token operator\">=</span>/www/wwwroot/vuepress\n<span class=\"token comment\"># git 仓库文件夹</span>\n<span class=\"token assign-left variable\">GIT_REPO</span><span class=\"token operator\">=</span>/home/git/vuepress.git\n<span class=\"token comment\"># 临时文件夹</span>\n<span class=\"token assign-left variable\">TMP_GIT_CLONE</span><span class=\"token operator\">=</span>/home/tmp/vuepress\n\n<span class=\"token comment\"># 移除临时文件夹</span>\n<span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token variable\">${TMP_GIT_CLONE}</span>\n<span class=\"token comment\"># 克隆 git 仓库到临时文件夹</span>\n<span class=\"token function\">git</span> clone <span class=\"token variable\">$GIT_REPO</span> <span class=\"token variable\">$TMP_GIT_CLONE</span>\n<span class=\"token comment\"># 移除项目文件夹</span>\n<span class=\"token comment\"># 宝塔为了安全，为自动在项目文件夹下新增 .user.ini 文件</span>\n<span class=\"token comment\"># 需要先关闭这个文件的功能才能删除项目文件夹</span>\n<span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">${PUBLIC_WWW}</span>\nchattr <span class=\"token parameter variable\">-i</span> .user.ini\n<span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token variable\">${PUBLIC_WWW}</span>\n<span class=\"token comment\"># 将临时文件夹复制到项目文件夹</span>\n<span class=\"token function\">cp</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token variable\">${TMP_GIT_CLONE}</span> <span class=\"token variable\">${PUBLIC_WWW}</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"auto deploy end ====================================\"</span>\n</code></pre></div><p>现在服务器端的准备工作已经完成了，接下来看看本地电脑的配置。</p>\n<h2>本地电脑</h2>\n<p>在本地项目根目录下新建 <code>deploy.sh</code> 脚本文件，内容如下：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token shebang important\">#!/usr/bin/env sh</span>\n\n<span class=\"token comment\"># 确保脚本抛出遇到的错误</span>\n<span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">-e</span>\n\n<span class=\"token comment\"># 生成静态文件</span>\n<span class=\"token function\">yarn</span> build\n\n<span class=\"token comment\"># 进入生成的文件夹</span>\n<span class=\"token builtin class-name\">cd</span> docs/.vuepress/dist\n\n<span class=\"token comment\"># 初始化 git 仓库，并提交修改</span>\n<span class=\"token function\">git</span> init\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">-A</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">'deploy'</span>\n\n<span class=\"token comment\"># 发布到 git 私服， -f 强制覆盖</span>\n<span class=\"token function\">git</span> remote <span class=\"token function\">add</span> origin git@119.23.65.118:/home/git/vuepress.git\n<span class=\"token function\">git</span> push <span class=\"token parameter variable\">-f</span> git@119.23.65.118:/home/git/vuepress.git master\n\n<span class=\"token builtin class-name\">cd</span> -\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>了解更多 git 命令，可以查询<a href=\"https://git-scm.com/docs\" target=\"_blank\" rel=\"noopener noreferrer\">官方文档</a>。</p>\n</div>\n<h2>测试</h2>\n<p>vscode 终端中输入 <code>sh depoly.sh</code>，报错：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sh</span> <span class=\"token builtin class-name\">:</span> 无法将“sh”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。\n请检查名称的拼写，如果包括路径，请确保路径正确，然后再试一次。\n</code></pre></div><p>了解到 windows 上可以使用 git bash 执行 shell 脚本，但我可不想每次执行的时候都打开 git bash，当然得找如何在 vscode 中执行 shell 脚本的办法。</p>\n<ol>\n<li>首先得在 vscode 中安装 code runner，之前一直用它来调试力扣上的题，已经安装过了。</li>\n<li>安装 git bash，这个不用说，安装 git 的时候就已经有了</li>\n<li>配置 bash 环境，找到 bash.exe 的安装目录，将它的位置添加到系统的环境变量中。</li>\n<li>配置 code runner：文件 -&gt; 首选项 -&gt; 设置 -&gt; 搜索 code runner</li>\n<li>打开终端，输入 <code>bash</code> 切换到 bash 环境，点击右上角的三角形即可运行。</li>\n</ol>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step3-code-runner.png\" alt=\"step3-code-runner\" tabindex=\"0\" loading=\"lazy\"><figcaption>step3-code-runner</figcaption></figure>\n<p>现在随便更新点内容，并执行 <code>deploy.sh</code> 脚本：</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step4-complete.png\" alt=\"step4-complete\" tabindex=\"0\" loading=\"lazy\"><figcaption>step4-complete</figcaption></figure>\n<p>再次访问 <code>http://xxx.xxx.xxx.xxx:端口号</code> 发现已经更新了。</p>\n<h2>参考链接</h2>\n<ul>\n<li><a href=\"http://chanwingwah.info/article/604eb2273c8ec67668f6fd41\" target=\"_blank\" rel=\"noopener noreferrer\">只需三步， 部署 Vuepress 并实现本地一行命令更新部署到服务器</a></li>\n<li><a href=\"https://www.imqianduan.com/git-svn/335.html\" target=\"_blank\" rel=\"noopener noreferrer\">使用 git hooks(post-receive)实现简单的远程自动部署</a></li>\n<li><a href=\"https://hjxlog.com/posts/20191130a1.html#7-%E9%85%8D%E7%BD%AENginx\" target=\"_blank\" rel=\"noopener noreferrer\">将 Hexo 部署到阿里云轻量服务器（保姆级教程）</a></li>\n<li><a href=\"https://www.cnblogs.com/yongdaimi/p/15247771.html\" target=\"_blank\" rel=\"noopener noreferrer\">VSCode: Windows 下配置 VSCode 运行 shell</a></li>\n</ul>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/step1-add-site.png",
      "date_published": "2021-05-12T00:00:00.000Z",
      "date_modified": "2026-01-23T04:40:58.000Z",
      "authors": [],
      "tags": [
        "linux"
      ]
    },
    {
      "title": "centos 安装 docker",
      "url": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/05-install-docker.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/linux/practice/05-install-docker.html",
      "summary": " 提示 需要保证 centos 版本： centos 7 centos 8 centos 9 卸载旧版本 注意 必须先完成这一步，否则会出现不可预见的错误。 运行下列命令： 出现成功提示后即可。 使用 rpm repository 安装 设置镜像 安装 yum-utils 软件包（提供 yum-config-manager 实用工具）并设置软件源。 安...",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>需要保证 centos 版本：</p>\n<ul>\n<li>centos 7</li>\n<li>centos 8</li>\n<li>centos 9</li>\n</ul>\n</div>\n<h2>卸载旧版本</h2>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>必须先完成这一步，否则会出现不可预见的错误。</p>\n</div>\n<p>运行下列命令：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> yum remove <span class=\"token function\">docker</span> <span class=\"token punctuation\">\\</span>\n                  docker-client <span class=\"token punctuation\">\\</span>\n                  docker-client-latest <span class=\"token punctuation\">\\</span>\n                  docker-common <span class=\"token punctuation\">\\</span>\n                  docker-latest <span class=\"token punctuation\">\\</span>\n                  docker-latest-logrotate <span class=\"token punctuation\">\\</span>\n                  docker-logrotate <span class=\"token punctuation\">\\</span>\n                  docker-engine\n</code></pre></div><p>出现成功提示后即可。</p>\n<h2>使用 rpm repository 安装</h2>\n<h3>设置镜像</h3>\n<p>安装 <code>yum-utils</code> 软件包（提供 <code>yum-config-manager</code> 实用工具）并设置软件源。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> yum-utils\n<span class=\"token function\">sudo</span> yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n</code></pre></div><h3>安装 docker engin</h3>\n<ol>\n<li>安装最新版：</li>\n</ol>\n\n<ol start=\"2\">\n<li>启动 docker</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> systemctl start <span class=\"token function\">docker</span>\n</code></pre></div><ol start=\"3\">\n<li>运行 <code>hello-world</code> 映像，验证 Docker Engine 安装是否成功。</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> run hello-world\n</code></pre></div><p>这条命令会下载一个测试镜像，并在一个容器中运行。当容器运行时，它会打印一条确认信息并退出。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>可以不去执行，只要安装过程不报错就表明成功。</p>\n</div>\n",
      "date_published": "2024-01-12T00:00:00.000Z",
      "date_modified": "2024-12-03T06:25:23.000Z",
      "authors": [],
      "tags": [
        "linux"
      ]
    },
    {
      "title": "美化 Windows 终端",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/operating-system/02-windows-terminal-beauty.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/operating-system/02-windows-terminal-beauty.html",
      "summary": "在 Windows 上的开发体验，特别是在终端方面，相较于 macOS，常常让人觉得差了一点「味道」。macOS 上的 iTerm2 配合 oh-my-zsh，颜值高、功能强大，让开发者得以拥有流畅且美观的工作体验。而 Windows 默认的命令提示符（cmd）和 PowerShell，外观简单，功能也不够灵活。 幸运的是，随着 Windows Ter...",
      "content_html": "<p>在 Windows 上的开发体验，特别是在终端方面，相较于 macOS，常常让人觉得差了一点「味道」。macOS 上的 iTerm2 配合 oh-my-zsh，颜值高、功能强大，让开发者得以拥有流畅且美观的工作体验。而 Windows 默认的命令提示符（cmd）和 PowerShell，外观简单，功能也不够灵活。</p>\n<p>幸运的是，随着 <a href=\"https://github.com/microsoft/terminal\" target=\"_blank\" rel=\"noopener noreferrer\">Windows Terminal</a> 的推出，我们终于可以在 Windows 上获得更现代的终端体验。Windows Terminal 拥有标签页支持、强大的配色和字体自定义功能，通过集成 <a href=\"https://github.com/JanDeDobbeleer/oh-my-posh\" target=\"_blank\" rel=\"noopener noreferrer\">oh-my-posh</a> 进行美化、安装支持丰富符号的字体、以及配置一些常用的开发工具，我们可以让 Windows 终端焕然一新，达到高颜值和高效兼具的效果。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20250111181530.png\" alt=\"最终效果\" tabindex=\"0\" loading=\"lazy\"><figcaption>最终效果</figcaption></figure>\n<p>接下来，让我们一步步将 Windows 终端打造成一个高效、好看且符合开发者习惯的环境，为平时的开发工作增添一份愉悦和舒适。</p>\n<h2>安装 Windows Terminal</h2>\n<p>Windows Terminal 是微软官方推出的现代终端工具，支持多标签页、GPU 加速、Unicode 和 Emoji 显示等特性，推荐直接在 <a href=\"https://apps.microsoft.com/detail/9n0dx20hk701?rtc=1&amp;hl=zh-cn&amp;gl=CN\" target=\"_blank\" rel=\"noopener noreferrer\">微软商店</a> 直接安装 Windows Terminal。</p>\n<p>然后设置一下透明度，这里我选择的是 80%，并打开亚克力效果，这会让终端跟随底色增加透明模糊效果。</p>\n<h2>升级 PowerShell 7.x</h2>\n<p>Windows 10 或 Windows 11 默认的 PowerShell 版本较低，无法使用更多新特性，推荐升级到 PowerShell 7.x，PowerShell 7.x 是跨平台的，并且修复了很多 PowerShell 5.1 中的兼容性问题。</p>\n<p>安装方式：</p>\n<ul>\n<li>访问 <a href=\"https://github.com/PowerShell/PowerShell/releases\" target=\"_blank\" rel=\"noopener noreferrer\">PowerShell GitHub Release 页面</a> 下载适合你系统的版本。</li>\n<li>或者，可以直接通过 Windows 包管理器 安装（需要 Windows 10 1809 或更高版本）：<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>winget install <span class=\"token operator\">--</span>id Microsoft<span class=\"token punctuation\">.</span>Powershell <span class=\"token operator\">--</span>source winget\n</code></pre></div></li>\n<li>如果你使用 Chocolatey 包管理器，也可以通过以下命令安装：<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>choco install powershell-core\n</code></pre></div></li>\n</ul>\n<p>安装完后，重新启动 Windows Terminal 以使用 PowerShell 7。</p>\n<h2>安装 oh-my-posh</h2>\n<p><a href=\"https://ohmyposh.dev/docs/installation/windows\" target=\"_blank\" rel=\"noopener noreferrer\">安装 oh-my-posh</a> 可以使用如下命令：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>winget install JanDeDobbeleer<span class=\"token punctuation\">.</span>OhMyPosh <span class=\"token operator\">-</span>s winget\n</code></pre></div><p>这会安装 <code>oh-my-posh.exe</code> 和 oh-my-posh 的所有最新 <a href=\"https://ohmyposh.dev/docs/themes\" target=\"_blank\" rel=\"noopener noreferrer\">主题</a>。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>为了重新加载 PATH，建议重新启动终端。如果 oh-my-posh 未被识别为命令，可以重新运行安装程序，或手动将其添加到 PATH。 例如：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code><span class=\"token variable\">$env</span>:PATH <span class=\"token operator\">+=</span> <span class=\"token string\">\";C:\\Users\\&lt;username&gt;\\AppData\\Local\\Programs\\oh-my-posh\\bin\"</span>\n</code></pre></div></div>\n<p>为了在打开终端后自动加载 oh-my-posh，需要在 PowerShell 配置文件 <code>$PROFILE</code> 中添加以下内容：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>oh-my-posh init pwsh <span class=\"token operator\">--</span>config <span class=\"token string\">\"<span class=\"token variable\">$env</span>:POSH_THEMES_PATH\\jandedobbeleer.omp.json\"</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Invoke-Expression</span>\n</code></pre></div><p><code>--config</code> 参数指定主题配置文件路径，<code>$env:POSH_THEMES_PATH</code> 是 oh-my-posh 主题文件夹路径，可以通过 <code>Get-PoshThemes</code> 查看所有主题。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><code>$PROFILE</code> 文件类似 <code>~/.zshrc</code> 或 <code>~/.bashrc</code>，以下命令会使用系统默认的文本编辑器打开：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>notepad <span class=\"token variable\">$PROFILE</span>\n</code></pre></div><p>编辑完成后，可以使用 <code>. $PROFILE</code> 重新加载配置。</p>\n</div>\n<h3>设置字体</h3>\n<p>oh-my-posh 使用 <a href=\"https://www.nerdfonts.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Nerd Fonts</a> 做为设计字体，官方推荐安装 <a href=\"https://www.nerdfonts.com/font-downloads\" target=\"_blank\" rel=\"noopener noreferrer\">Meslo Nerd Font</a>。这里我选择了 <a href=\"https://www.nerdfonts.com/font-downloads\" target=\"_blank\" rel=\"noopener noreferrer\">BitstromWera Nerd Font</a>。</p>\n<p>可以在 <a href=\"https://www.nerdfonts.com/font-downloads\" target=\"_blank\" rel=\"noopener noreferrer\">Nerd Fonts</a> 页面下载和预览字体。也可以通过 oh-my-posh 提供的 CLI 安装：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>oh-my-posh font install\n</code></pre></div><p>安装完成后，需要在 Windows Terminal 中设置字体，按 <code>CTRL + SHIFT + ,</code> 打开配置文件，在 <code>defaults</code> 属性下添加：</p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"profiles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"defaults\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"font\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"face\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MesloLGM Nerd Font\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>如果使用了 VSCode，可以在 <code>settings.json</code> 中添加：</p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token property\">\"terminal.integrated.fontFamily\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bitstream Vera Sans Mono Nerd Font\"</span>\n</code></pre></div><h2>环境配置</h2>\n<h3>Chocolatey</h3>\n<p><a href=\"https://chocolatey.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Chocolatey</a> 是一个 Windows 下的包管理器，可以方便地安装和管理软件。</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code><span class=\"token function\">Set-ExecutionPolicy</span> Bypass <span class=\"token operator\">-</span>Scope <span class=\"token keyword\">Process</span> <span class=\"token operator\">-</span>Force<span class=\"token punctuation\">;</span> <span class=\"token namespace\">[System.Net.ServicePointManager]</span>::SecurityProtocol = <span class=\"token namespace\">[System.Net.SecurityProtocolType]</span>::Tls12<span class=\"token punctuation\">;</span> <span class=\"token function\">iex</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Net<span class=\"token punctuation\">.</span>WebClient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>DownloadString<span class=\"token punctuation\">(</span><span class=\"token string\">'https://community.chocolatey.org/install.ps1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h3>vim</h3>\n<p>PowerShell 默认不支持 vim，需要安装 <a href=\"https://github.com/vim/vim\" target=\"_blank\" rel=\"noopener noreferrer\">vim</a> 或 <a href=\"https://github.com/neovim/neovim\" target=\"_blank\" rel=\"noopener noreferrer\">neovim</a>。</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>choco install vim\n</code></pre></div><p>安装完成后即可使用 <code>vim</code> 命令，再也不用使用 <code>notepad</code> 打开文件了。</p>\n<h3>zoxide</h3>\n<p><a href=\"https://github.com/ajeetdsouza/zoxide\" target=\"_blank\" rel=\"noopener noreferrer\">zoxide</a> 是一个跨平台的命令行工具，可以快速跳转到指定目录。</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>choco install zoxide\n</code></pre></div><p>安装完成后，配置 zoxide 到 PowerShell 中：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>notepad <span class=\"token variable\">$PROFILE</span>\n</code></pre></div><p>在文件末尾添加：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code><span class=\"token function\">Invoke-Expression</span> <span class=\"token punctuation\">(</span>&amp; <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>zoxide init powershell <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>重新加载 PowerShell 配置文件：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code><span class=\"token punctuation\">.</span> <span class=\"token variable\">$PROFILE</span>\n</code></pre></div><h3>git</h3>\n<p>使用 Chocolatey 安装 git：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>choco install git\n</code></pre></div><p>安装完成后，配置 git 用户信息：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>git config <span class=\"token operator\">--</span>global user<span class=\"token punctuation\">.</span>name <span class=\"token string\">\"Your Name\"</span>\ngit config <span class=\"token operator\">--</span>global user<span class=\"token punctuation\">.</span>email <span class=\"token string\">\"your.email@example.com\"</span>\n</code></pre></div><h3>ssh</h3>\n<p>PowerShell 默认自带 ssh 客户端，可以直接使用。</p>\n<p>生成 ssh key：</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>ssh-keygen <span class=\"token operator\">-</span>t rsa <span class=\"token operator\">-</span>C <span class=\"token string\">\"your_email@example.com\"</span>\n</code></pre></div><p>将生成的 ssh key 添加到 GitHub，在 <code>Settings</code> -&gt; <code>SSH and GPG keys</code> 页面添加。</p>\n<p>然后使用 <code>ssh -T git@github.com</code> 测试连接。</p>\n<p>如果出现以下报错，可以更改 ssh 客户端配置。</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>ssh: connect to host github<span class=\"token punctuation\">.</span>com port 22: Connection refused\n</code></pre></div><p>在 <code>C:\\Users\\&lt;username&gt;\\.ssh\\config</code> 文件（没有则创建）中添加以下内容：</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>Host github.com\n  HostName ssh.github.com\n  Port 443\n</code></pre></div><p>这时再使用 <code>ssh -T git@github.com</code> 测试连接，应该就可以正常连接了。</p>\n<div class=\"language-powershell\" data-ext=\"powershell\" data-title=\"powershell\"><pre class=\"language-powershell\"><code>ssh <span class=\"token operator\">-</span>T git@github<span class=\"token punctuation\">.</span>com\n</code></pre></div><h3>node</h3>\n<p>推荐使用  安装 node。</p>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20250111181530.png",
      "date_published": "2024-11-07T00:00:00.000Z",
      "date_modified": "2025-01-11T10:21:01.000Z",
      "authors": [],
      "tags": [
        "操作系统"
      ]
    },
    {
      "title": "字符编码",
      "url": "https://dribble-njr.github.io/blog/blog/computer-science/operating-system/01-character-encoding.html",
      "id": "https://dribble-njr.github.io/blog/blog/computer-science/operating-system/01-character-encoding.html",
      "summary": "在计算机中，所有数据都是以二进制数的形式存储的，字符也不例外。为了表示字符，我们需要建立一套「字符集」，规定每个字符和二进制数之间的一一对应关系。有了字符集之后，计算机就可以通过查表完成二进制数到字符的转换。 Joel Spolsky The Absolute Minimum Every Software Developer Absolutely, P...",
      "content_html": "<p>在计算机中，所有数据都是以二进制数的形式存储的，字符也不例外。为了表示字符，我们需要建立一套「字符集」，规定每个字符和二进制数之间的一一对应关系。有了字符集之后，计算机就可以通过查表完成二进制数到字符的转换。</p>\n<p>Joel Spolsky</p>\n<p>The Absolute<br>\nMinimum Every Software Developer Absolutely, Positively Must Know About Unicode and<br>\nCharacter Sets (No Excuses!)</p>\n<p>Mathias Bynens</p>\n<p>JavaScript’s Internal Character Encoding:<br>\nUCS-2 or UTF-16?</p>\n",
      "date_published": "2024-01-24T00:00:00.000Z",
      "date_modified": "2024-11-07T02:47:43.000Z",
      "authors": [],
      "tags": [
        "operating-system"
      ]
    },
    {
      "title": "模块化",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/01-modularization.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/01-modularization.html",
      "summary": "早期 JavaScript 仅仅作为一个脚本语言，所需的代码通常不会很大。然而随着前端和 JavaScript 的发展，逐渐暴露出两个问题： 全局污染：不同文件中的函数会相互污染； 依赖混乱：各文件中的函数依赖非常混乱。 模块化就是为了解决上述问题，最终目的是为了将程序拆分为可按需导入的单独模块。在模块中编写属于自己的逻辑代码，拥有自己的作用域，能够导...",
      "content_html": "<p>早期 JavaScript 仅仅作为一个脚本语言，所需的代码通常不会很大。然而随着前端和 JavaScript 的发展，逐渐暴露出两个问题：</p>\n<ul>\n<li>全局污染：不同文件中的函数会相互污染；</li>\n<li>依赖混乱：各文件中的函数依赖非常混乱。</li>\n</ul>\n<p>模块化就是为了解决上述问题，最终目的是为了将程序拆分为可按需导入的单独模块。在模块中编写属于自己的逻辑代码，拥有自己的作用域，能够导出希望暴露的变量、函数、对象等，并能通过某种方式，导入其他模块中的变量、函数或对象等。</p>\n<p>JavaScript 本身直到 ES2015 才推出了自己的模块化方案 —— ES Module。在此之前，为了让 JavaScript 支持模块化，社区中涌现了不同的模块化规范：AMD、CMD、CommonJS 等。</p>\n<h2>早期模块化方案</h2>\n<h3>Window</h3>\n<p>在最开始的前端时期，JavaScript 文件之间的通信通常会依靠 window 对象。</p>\n<p><strong>utils.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> utils <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><strong>time.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> curTime <span class=\"token operator\">=</span> <span class=\"token string\">'2022-08-10 15:05'</span>\n<span class=\"token keyword\">var</span> time <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">curTime</span><span class=\"token operator\">:</span> curTime\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><strong>index.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>window<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span>curTime<span class=\"token punctuation\">)</span> <span class=\"token comment\">// '2022-08-10 15:05'</span>\n</code></pre></div><p><strong>index.html</strong></p>\n<div class=\"language-html\" data-ext=\"html\" data-title=\"html\"><pre class=\"language-html\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token comment\">&lt;!-- 必须保证顺序正确 --&gt;</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./time.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./utils.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./index.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><p>然而这会带来命名冲突的问题，并且声明的全局变量会占用内存无法回收，代码可读性差。因此出现了立即调用表达式（IIFE）。</p>\n<h2>IIFE</h2>\n<p>使用立即调用表达式（Immediately Invoked Function Expression, IIFE）改造上述代码：</p>\n<p><strong>utils.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> moduleUtils <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    format\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><strong>time.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> moduleTime <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> curTime <span class=\"token operator\">=</span> <span class=\"token string\">'2022-08-10 15:05'</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    curTime\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><strong>index.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>window<span class=\"token punctuation\">.</span>moduleUtils<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>moduleTime<span class=\"token punctuation\">.</span>curTime<span class=\"token punctuation\">)</span>\n</code></pre></div><p>现在因为函数具有作用域，就可以解决命名冲突的问题，然而这再次带来了新的问题：</p>\n<ul>\n<li>代码混乱不堪，每个文件的代码都需要包裹在一个立即调用函数表达式中编写；</li>\n<li>在没有合适的规范的情况下，每个公司或个人都会出现任意命名导致模块名称相同的情况。</li>\n</ul>\n<p>因此需要用规范编写模块化代码，这个规范需要包括两个核心功能：<strong>模块本身可以导出暴露的属性，又可以导入需要的属性。</strong></p>\n<h2>CommonJS</h2>\n<p>CommonJS 是一个 JavaScript 规范，最初提出来是在浏览器以外的地方使用，并且当时被命名为 ServerJS，后来为了体现它的广泛性，修改为 CommonJS，平时我们也会简称为 CJS。</p>\n<p>NodeJS 对 CommonJS 进行了支持和实现：</p>\n<ul>\n<li>在 Node 中每个 js 文件都是一个单独的模块；</li>\n<li>这个模块包括 CommonJS 规范的核心变量：<code>exports</code> <code>module.exports</code> <code>require</code>。</li>\n</ul>\n<p>下面在 node 环境中执行以下代码。</p>\n<p><strong>utils.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  format\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><strong>time.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> curTime <span class=\"token operator\">=</span> <span class=\"token string\">'2022-08-10 15:05'</span>\n\nexports<span class=\"token punctuation\">.</span>curTime <span class=\"token operator\">=</span> curTime\n</code></pre></div><p><strong>index.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> curTime <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./time.js'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> format <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">format</span><span class=\"token punctuation\">(</span>curTime<span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"2022-08-10 15:05\"</span>\n</code></pre></div><h3><code>exports</code> 和 <code>module.exports</code></h3>\n<p>可以看到，node 中实用 <code>exports</code> 和 <code>module.exports</code> 实现模块导出，使用 <code>require()</code> 实现模块导入。</p>\n<p>那么为什么要有两个导出方式？</p>\n<p>因为 CommonJS 规范中只定义了 <code>exports</code>，但是它存在一些问题，因此 node 使用 <code>module.exports = exports</code> 间接代替了 <code>exports</code>，他们两个指向同一个内存地址的对象。<code>require()</code> 会返回 <code>module.exports</code> 指向的对象。</p>\n<p>可以在 index.js 中打印 <code>module</code> 对象：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>Module <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">'.'</span><span class=\"token punctuation\">,</span>                    <span class=\"token comment\">// 模块 id</span>\n  <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/* ... */'</span><span class=\"token punctuation\">,</span>          <span class=\"token comment\">// 文件路径</span>\n  <span class=\"token literal-property property\">exports</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>                <span class=\"token comment\">// 模块导出对象</span>\n  <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'/* ... */'</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// 文件名</span>\n  <span class=\"token literal-property property\">loaded</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>              <span class=\"token comment\">// 模块是否加载完成</span>\n  <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    Module <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 模块 utils</span>\n    Module <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  <span class=\"token comment\">// 模块 time</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">paths</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">/* ... */</span> <span class=\"token punctuation\">]</span>        <span class=\"token comment\">// 搜索路径</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>require</h3>\n<p><code>require()</code> 引入模块需要经历三个步骤：</p>\n<ol>\n<li>路径分析</li>\n<li>文件定位</li>\n<li>编译执行</li>\n</ol>\n<h4>核心模块和文件模块</h4>\n<p>而在 Node 中，模块分为核心模块和文件模块：</p>\n<ul>\n<li>核心模块：在 Node 源代码的编译过程中，编译成了二进制执行文件。在 Node 进程启动时，核心模块就直接加载进了内存中，因此核心模块引入时，不需要进行文件定位和编译执行，并且在路径分析时会优先判断，因此它的加载速度是最快的。</li>\n<li>文件模块：在运行时动态加载，需要完整的路径分析、文件定位、编译执行过程，速度比核心模块慢。</li>\n</ul>\n<h4>优先从缓存中加载</h4>\n<p>Node 会对引入过的模块进行缓存，以减少二次引入时的开销，对任何模块都会采取缓存优先的策略，<strong>缓存是第一优先级</strong>。</p>\n<p>从缓存加载的优化策略使得二次引入时不需要路径分析、文件定位和编译执行的过程，提高了加载模块的效率。</p>\n<h4>路径分析</h4>\n<p>在判断缓存后，需要对模块进行路径分析和文件定位，<code>require(X)</code> 接收一个<strong>模块标识符</strong>，不同标识符有不同查找规则。</p>\n<p><strong>情况一：X 是一个核心模块，如 path、http</strong></p>\n<p><strong>核心模块</strong>会直接返回模块，并且停止查找。</p>\n<p>试图加载一个与核心模块标识符相同的自定义模块是不会成功的，如果自己编写了一个 <code>http</code> 用户模块，想要加载成功，则必须选择一个不同的标识符或者换用路径方式。</p>\n<p><strong>情况二：X 以 ./ 或 ../ 或 / （路径形式）开头</strong></p>\n<p>以路径开始的标识符，会被当成<strong>文件模块</strong>，在分析路径时，<code>require(X)</code> 方法会将路径转换为真实路径，并以真实路径作为索引，将编译执行的过程中放到缓存中。由于文件模块给 Node 指明了确切的文件位置，因此在查找过程中可以节约大量时间，<strong>文件模块的加载速度慢于核心模块</strong>。</p>\n<p><strong>情况三：直接是一个 X（没有路径），并且 X 不是一个核心模块</strong></p>\n<p>这种情况下，X 是一个<strong>自定义模块</strong>，那么 Node 会从<strong>模块路径</strong> <code>moudle.paths</code> 中查找。</p>\n<blockquote>\n<p>模块路径：Node 在定位文件模块的具体文件时指定的查找策略，为多个路径组成的数组。</p>\n</blockquote>\n<p>在 Linux 下，打印这个可能输出：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token punctuation\">;</span><span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'/home/jackson/research/node_modules'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/home/jackson/node_modules'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/home/node_modules'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'/node_modules'</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div><p>Windows 下，可能会输出：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token punctuation\">;</span><span class=\"token punctuation\">[</span><span class=\"token string\">'c:\\\\nodejs\\\\node_modules'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c:\\\\node_modules'</span><span class=\"token punctuation\">]</span>\n</code></pre></div><p>模块路径的生成规则如下：</p>\n<ul>\n<li>当前文件目录下的 <code>node_modules</code> 目录</li>\n<li>父目录下的 <code>node_modules</code> 目录</li>\n<li>父目录的父目录下的 <code>node_modules</code> 目录</li>\n<li>沿路径向上逐级递归，直到根目录下的 <code>node_modules</code> 目录</li>\n</ul>\n<p>在加载过程中，Node 会逐个尝试模块路径中的路径，直到找到目标模块，因此速度在三个情况中最慢。</p>\n<h4>文件定位</h4>\n<p>文件定位主要包括文件扩展名分析、目录和包的处理。</p>\n<p><strong>文件扩展名分析</strong></p>\n<p><code>require(X)</code> 在分析标识符的过程中，会出现标识符不包含文件扩展名的情况。</p>\n<ol>\n<li>如果有文件扩展名，按照后缀名的格式查找对应的文件</li>\n<li>如果没有文件扩展名，会按照如下顺序尝试：</li>\n</ol>\n<ul>\n<li>直接查找文件 X</li>\n<li>查找 <code>X.js</code> 文件</li>\n<li>查找 <code>X.json</code> 文件</li>\n<li>查找 <code>X.node</code> 文件</li>\n</ul>\n<p>在尝试的过程中，需要调用 <code>fs</code> 模块同步阻塞式地判断文件是否存在，所以会引起性能问题，因此，最好带上文件扩展名，会加快模块加载速度。</p>\n<p><strong>目录分析和包</strong></p>\n<p>在分析标识符的过程中，通过分析文件扩展名可能并没有得到对应文件，但却得到一个目录，此时 Node 会将目录当作一个包来处理。</p>\n<ol>\n<li>首先在当前目录下查找 <code>package.json</code> 文件，通过 <code>JSON.parse()</code> 解析出包描述对象，从中取出 <code>main</code> 属性指定的文件名进行定位，如果文件名缺少扩展名，则会进行文件扩展名分析</li>\n<li>如果 <code>main</code> 属性指定的文件名错误，或者没有 <code>package.json</code> 文件，那么会一次查找目录下面的 <code>index</code> 文件</li>\n</ol>\n<ul>\n<li>查找 <code>X/index.js</code> 文件</li>\n<li>查找 <code>X/index.json</code> 文件</li>\n<li>查找 <code>X/index.node</code> 文件</li>\n</ul>\n<ol start=\"3\">\n<li>如果目录分析的过程中没有成功定位，则自定义模块进入下一个模块路径中进行搜索；如果所有路径都遍历完毕，仍然没有找到目标文件，那么报错：<code>not found</code></li>\n</ol>\n<h3>模块编译</h3>\n<p>Node 中对于模块的定义如下：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">Module</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> parent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parent <span class=\"token operator\">=</span> parent\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    parent<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filename <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loaded <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>children <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>当定位到目标文件时，Node 会新建一个模块对象，然后根据路径载入并编译，对于不同的文件扩展名，它的载入方法也不同：</p>\n<ul>\n<li><code>.js</code> 文件：通过 <code>fs</code> 模块同步读取文件后编译执行；</li>\n<li><code>.node</code> 文件：这是用 <code>C/C++</code> 编写的扩展文件，通过 <code>dlopen()</code> 方法加载最后编译生成的文件；</li>\n<li><code>.json</code> 文件：通过 <code>fs</code> 模块同步读取文件后，用 <code>JSON.parse()</code> 解析返回结果；</li>\n<li>其余扩展名文件：都被当作 <code>.js</code> 文件载入。</li>\n</ul>\n<p>模块在第一次被引入时，模块中的代码会被执行一次；模块被多次引入，会缓存（<code>module.loaded</code> 设置为 <code>true</code>），最终只运行一次；如果有循环引入，会采用深度优先搜索加载模块。</p>\n<p>每一个编译成功的模块都会讲其文件路径作为索引缓存在 <code>Module._cache</code> 对象上，以提高二次引入的性能。</p>\n<h3>其他</h3>\n<p>每个模块都存在 <code>require</code>、<code>exports</code>、<code>module</code> 等其它变量，这些变量从何而来？这是因为 Node 对获取的 JavaScript 文件内容进行了头尾包装。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">exports<span class=\"token punctuation\">,</span> require<span class=\"token punctuation\">,</span> module<span class=\"token punctuation\">,</span> __filename<span class=\"token punctuation\">,</span> __dirname</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> Math <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'math'</span><span class=\"token punctuation\">)</span>\n  exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">area</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">raduis</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">*</span> radius <span class=\"token operator\">*</span> radius\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>这样每个模块文件都用函数进行了作用域隔离，包装之后的代码会通过 <code>vm</code> 原生模块的 <code>runInThisContext()</code> 方法执行（类似 <code>eval</code>，只是有明确作用域，不会污染全局），返回一个具体的 <code>function</code> 对象。最后,将当前模块的 <code>exports</code> 属性、<code>require()</code> 方法、<code>module</code> 以及在文件定位中得到的完整文件路径和文件目录作为参数传递给这个 <code>function</code> 执行。</p>\n<p>那么为什么存在 <code>exports</code> 的情况下，还存在 <code>module.exports</code>？</p>\n<p>先来看看包装之后的文件：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">exports<span class=\"token punctuation\">,</span> require<span class=\"token punctuation\">,</span> module<span class=\"token punctuation\">,</span> __filename<span class=\"token punctuation\">,</span> __dirname</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>exports</code> 是通过形参的方式传入，<strong>直接赋值形参会改变形参的引用</strong>，但并不能改变作用域外的值，因此在使用 <code>exports</code> 的时候不推荐直接赋值一个对象，而是通过赋值属性的方式导出变量。而如果想要达到 <code>require</code> 直接引入一个类的效果，应该赋值给 <code>module.exports</code> 对象，这种方案不会改变形参的引用。</p>\n<h3>缺点</h3>\n<p>CommonJS 加载模块是同步的：同步意味着只有等到对应的模块加载完毕，当前模块中的内容才能被运行。</p>\n<p>这也是通常用作服务器模块化规范的原因，因为服务器加载的 js 文件都是本地文件，加载速度非常快。</p>\n<p>如果将它应用于浏览器呢？浏览器加载 js 文件需要先从服务器将文件下载下来，之后在加载运行，会阻塞后续代码的执行。</p>\n<p>所以早期在浏览器中，我们通常不使用 CommonJS 规范，而通常会采用 AMD 或 CMD 规范。</p>\n<h2>AMD/CMD</h2>\n<p>AMD 和 CMD 是用于浏览器端的模块化规范。</p>\n<p>但是目前一方面现代的浏览器已经支持 ES Modules，另一方面借助于 webpack 等工具可以实现对 CommonJS 或者 ES Module 代码的转换。AMD 和 CMD 已经使用非常少了，所以这里我们进行简单的演练。</p>\n<h3>AMD</h3>\n<p>异步模块定义（Asynchronous Module Definition，AMD）采用异步加载模块，因此可以在浏览器中使用。比较常用的库是 <code>require.js</code>。</p>\n<blockquote>\n<p>先有 RequireJS，后有 AMD 规范，随着 RequireJS 的推广和普及，AMD 规范才被创建出来。</p>\n</blockquote>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>AMD\n├── index.html\n├── index.js\n├── lib\n│   └── require.js\n└── modules\n    ├── time.js\n    └── .js\n</code></pre></div><p><strong>index.html</strong></p>\n<div class=\"language-html\" data-ext=\"html\" data-title=\"html\"><pre class=\"language-html\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">&gt;</span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token comment\">&lt;!-- 注意 data-main --&gt;</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./lib/require.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-main</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./index.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><p><strong>index.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 配置</span>\n  require<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">baseUrl</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 模块映射关系</span>\n    <span class=\"token literal-property property\">paths</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">time</span><span class=\"token operator\">:</span> <span class=\"token string\">'./modules/time'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">utils</span><span class=\"token operator\">:</span> <span class=\"token string\">'./modules/utils'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'utils'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'time'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">utils<span class=\"token punctuation\">,</span> time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 逻辑代码</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>utils<span class=\"token punctuation\">.</span>format<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Function</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>curTime<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2022-08-10 15:05</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><strong>time.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// 定义模块</span>\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> curTime <span class=\"token operator\">=</span> <span class=\"token string\">'2022-08-10 15:05'</span>\n\n  <span class=\"token comment\">// 暴露属性</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    curTime\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><strong>utils.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// 定义模块，引入需要的模块</span>\n<span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'time'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">format</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>curTime<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2022-08-10 15:05</span>\n\n  <span class=\"token comment\">// 暴露属性</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    format\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h3>CMD</h3>\n<p>通用模块定义（Common Module Definition，CMD）采用异步加载模块，并且吸收 CommonJS 的优点，比较常用的库是 <code>SeaJS</code>。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>CMD\n├── index.html\n├── index.js\n├── lib\n│   └── sea.js\n└── modules\n    ├── time.js\n    └── .js\n</code></pre></div><p><strong>index.html</strong></p>\n<div class=\"language-html\" data-ext=\"html\" data-title=\"html\"><pre class=\"language-html\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">&gt;</span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./lib/sea.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      seajs<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./index.js'</span><span class=\"token punctuation\">)</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><p><strong>index.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">require<span class=\"token punctuation\">,</span> exports<span class=\"token punctuation\">,</span> module</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> curTime <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./modules/foo'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> format <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./modules/utils'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">format</span><span class=\"token punctuation\">(</span>curTime<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2022-08-10 15:05</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><strong>time.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">require<span class=\"token punctuation\">,</span> exports<span class=\"token punctuation\">,</span> module</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> curTime <span class=\"token operator\">=</span> <span class=\"token string\">'2022-08-10 15:05'</span>\n\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    curTime\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><strong>utils.js</strong></p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">require<span class=\"token punctuation\">,</span> exports<span class=\"token punctuation\">,</span> module</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    format\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>ESM</h2>\n<p>ES2015 后浏览器实现的模块化方案，长远来看，未来无论是基于 JS 的 WEB 端，还是基于 node 的服务器端或桌面应用，模块规范都会统一使用 ES6 module。</p>\n<h3>兼容性</h3>\n<p>并不是所有浏览器都对 ESM 实现完全支持，需要用到 webpack 等工具实现代码转换。</p>\n<p>可见 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81\" target=\"_blank\" rel=\"noopener noreferrer\">浏览器支持</a>。</p>\n<h3>导出</h3>\n<h4>方式一：分别导出</h4>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> curTime <span class=\"token operator\">=</span> <span class=\"token string\">'2022-08-10 15:05'</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h4>方式二：统一导出</h4>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> curTime <span class=\"token operator\">=</span> <span class=\"token string\">'2022-08-10 15:05'</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> curTime<span class=\"token punctuation\">,</span> format <span class=\"token punctuation\">}</span>\n</code></pre></div><h4>方式三：别名导出</h4>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> curTime <span class=\"token keyword\">as</span> time<span class=\"token punctuation\">,</span> format <span class=\"token punctuation\">}</span>\n</code></pre></div><p>注意这里 <code>{}</code> 并非对象。</p>\n<h4>方式四：默认导出</h4>\n<p>一个模块中只能有一个默认导出。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">time</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'format'</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>导入</h3>\n<h4>方式一：统一导入</h4>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> curTime<span class=\"token punctuation\">,</span> format <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./module.js'</span>\n</code></pre></div><h4>方式二：整体导入</h4>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> module <span class=\"token keyword\">from</span> <span class=\"token string\">'./module.js'</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">)</span>\n</code></pre></div><h4>方式三：别名导入</h4>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> curTime <span class=\"token keyword\">as</span> time<span class=\"token punctuation\">,</span> format <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./module.js'</span>\n</code></pre></div><h4>方式四：默认导出的导入</h4>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> format <span class=\"token keyword\">from</span> <span class=\"token string\">'./module.js'</span>\n</code></pre></div><h3><code>import()</code></h3>\n<p>上述的导入都是用 import 关键字实现模块实现，<code>import()</code> 函数可以实现动态导入模块。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">let</span> flag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./foo.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">foo</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 逻辑代码</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./bar.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bar</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 逻辑代码</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>ESM VS CommonJS</h3>\n<p>CommonJS 模块加载 js 文件的过程是 <strong>运行时</strong> 加载的，并且是同步的：</p>\n<ul>\n<li>运行时加载意味着是 js 引擎在执行 js 代码的过程中加载模块；</li>\n<li>同步的就意味着一个文件没有加载结束之前，后面的代码都不会执行。</li>\n</ul>\n<p>ES Module 加载 js 文件的过程是 <strong>编译（解析）时</strong> 加载的，并且是异步的：</p>\n<ul>\n<li>编译时（解析）时加载，意味着 <code>import</code> 关键字不能和运行时相关的内容放在一起使用；</li>\n<li>异步的意味着：JS 引擎在遇到 import 时会去获取这个 js 文件，但是这个获取的过程是异步的，并不会阻塞主线程继续执行。</li>\n</ul>\n<p>CommonJS 通过 <code>module.exports</code> 导出的是一个对象，导出和导入指向的是同一块内存空间，两边修改会同时影响导出对象。</p>\n<p>ES Module 通过 <code>export</code> 导出的是变量本身的引用：JS 引擎会创建<strong>模块环境记录</strong>，会和导出的变量进行绑定。所以在导出的模块中修改变化，导入的地方可以通过模块环境记录获取最新的值；但是在导入的地方不允许修改变量（直接报错），因为导入它时相当于给一个常量赋值。</p>\n<blockquote>\n<p>如果 ESM 导出的是一个对象，那么导入的模块也能修改对象中的属性，因为他指向内存空间。</p>\n</blockquote>\n<h2>总结</h2>\n<p>本文主要介绍了模块化发展的历程，介绍各种规范如 CommonJS、AMD、CMD、ESM 的使用和对比。</p>\n",
      "date_published": "2022-08-10T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "工程化"
      ]
    },
    {
      "title": "包管理工具",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/02-package-manager.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/02-package-manager.html",
      "summary": "npm https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally ",
      "content_html": "<h2>npm</h2>\n<p><a href=\"https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally</a></p>\n",
      "date_published": "2023-12-23T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "工程化"
      ]
    },
    {
      "title": "工具链",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/03-tool.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/03-tool.html",
      "summary": "JavaScript 问题： API 兼容，polyfill: core.js 语法增强（compiler），syntax transformer(regenerator)，jsx，tsc... babel 代码编译工具 @babel/core @babel/preset-env source code -- ast swc(rust) 对标 babe...",
      "content_html": "<h2>JavaScript</h2>\n<p>问题：</p>\n<ul>\n<li>API 兼容，polyfill: core.js</li>\n<li>语法增强（compiler），syntax transformer(regenerator)，jsx，tsc...</li>\n</ul>\n<p>babel 代码编译工具</p>\n<ul>\n<li>@babel/core</li>\n<li>@babel/preset-env</li>\n</ul>\n<p>source code -- ast</p>\n<p>swc(rust) 对标 babel</p>\n<p><a href=\"https://github.com/estree/estree\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/estree/estree</a></p>\n<p><a href=\"https://github.com/bramblex/jsjs\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/bramblex/jsjs</a></p>\n<h2>CSS</h2>\n<p>问题：</p>\n<ul>\n<li>语法缺失（循环、判断、拼接）</li>\n<li>功能缺失（颜色函数、数学函数、自定义函数）</li>\n</ul>\n<p>sass/less/stylus --&gt; 预处理器 --&gt; css --&gt; postcss（后处理器） --&gt; polyfill、代码压缩、剪枝</p>\n<p><a href=\"https://postcss.org/\" target=\"_blank\" rel=\"noopener noreferrer\">https://postcss.org/</a></p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20231223162446.png\" alt=\"20231223162446\" tabindex=\"0\" loading=\"lazy\"><figcaption>20231223162446</figcaption></figure>\n<h2>构建工具</h2>\n<p>以 webpack 为例。</p>\n<ol>\n<li>入口：通过入口分析依赖关系；</li>\n<li>开发服务器：webpack serve --&gt; webpack dev server --&gt; express --&gt; 源码变更 --&gt; 浏览器刷新（强制刷新、HMR）websocket</li>\n<li>文件指纹（hash），涉及到缓存，类似 </li>\n<li>sourcemap</li>\n<li>...</li>\n</ol>\n<h2>脚手架</h2>\n<p>提供界面与交互、提供工程模版</p>\n<ul>\n<li>cra：深度定制，配置需要 eject 或使用 react-rewired 和 customize-cra</li>\n<li>vue-cli：支持配置覆盖，折中方案</li>\n<li>...</li>\n</ul>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20231223162446.png",
      "date_published": "2023-12-23T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "工程化"
      ]
    },
    {
      "title": "项目规范",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/04-project-standards.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/04-project-standards.html",
      "summary": "代码规范 editorconfig EditorConfig 有助于跨不同编辑器和 IDE 为处理同一项目的多个开发人员维护一致的编码风格。 VSCode 需要安装 EditorConfig for VS Code 插件。 .editorconfig ESLint ESLint 是一个 Javascript Linter，帮助我们规范代码质量，提高团队...",
      "content_html": "<h2>代码规范</h2>\n<h3>editorconfig</h3>\n<p>EditorConfig 有助于跨不同编辑器和 IDE 为处理同一项目的多个开发人员维护一致的编码风格。</p>\n<p>VSCode 需要安装 <code>EditorConfig for VS Code</code> 插件。</p>\n<p><strong><code>.editorconfig</code></strong></p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token comment\"># http://editorconfig.org</span>\n\nroot <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> <span class=\"token comment\"># 表示所有文件适用</span>\ncharset <span class=\"token operator\">=</span> utf-8 <span class=\"token comment\"># 设置文件字符集为 utf-8</span>\nindent_style <span class=\"token operator\">=</span> space <span class=\"token comment\"># 缩进风格（tab | space）</span>\nindent_size <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token comment\"># 缩进大小</span>\nend_of_line <span class=\"token operator\">=</span> lf <span class=\"token comment\"># 控制换行类型(lf | cr | crlf)</span>\ntrim_trailing_whitespace <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token comment\"># 去除行首的任意空白字符</span>\ninsert_final_newline <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token comment\"># 始终在文件末尾插入一个新行</span>\n\n<span class=\"token punctuation\">[</span>*.md<span class=\"token punctuation\">]</span> <span class=\"token comment\"># 表示仅 md 文件适用以下规则</span>\nmax_line_length <span class=\"token operator\">=</span> off\ntrim_trailing_whitespace <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n</code></pre></div><h3>ESLint</h3>\n<p>ESLint 是一个 Javascript Linter，帮助我们规范代码质量，提高团队开发效率。</p>\n<p>安装 <code>eslint</code> 并新建配置文件 <code>.eslintrc.js</code>。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> eslint <span class=\"token parameter variable\">-D</span>\n</code></pre></div><div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">env</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">browser</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">es2021</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">extends</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'eslint:recommended'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'plugin:react/recommended'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'plugin:@typescript-eslint/recommended'</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">parserOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">ecmaVersion</span><span class=\"token operator\">:</span> <span class=\"token string\">'latest'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">sourceType</span><span class=\"token operator\">:</span> <span class=\"token string\">'module'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>如果想要在项目中安装 <code>jest</code>，则需要在配置文件中的 <code>env</code> 加上下面这一行：</p>\n<div class=\"language-diff\" data-ext=\"diff\" data-title=\"diff\"><pre class=\"language-diff\"><code><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> env: {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   browser: true,\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   es2021: true,\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   jest: true\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> },\n</span></span></code></pre></div><p>如果想和 <code>prettier</code> 一起使用则需要在 <code>extends</code> 中加入：</p>\n<div class=\"language-diff\" data-ext=\"diff\" data-title=\"diff\"><pre class=\"language-diff\"><code><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> extends: [\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   'eslint:recommended',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   'plugin:react/recommended',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   'plugin:@typescript-eslint/recommended',\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   \"prettier\"\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> ],\n</span></span></code></pre></div><p>还需要在项目中安装与 <code>TypeScript</code> 相关的插件：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">-D</span> eslint-plugin-import @typescript-eslint/parser eslint-import-resolver-typescript\n</code></pre></div><p>最后在 <code>.eslintrc.js</code> 中添加 <code>settings</code>：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token punctuation\">{</span>\n\t<span class=\"token literal-property property\">settings</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"import/resolver\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"typescript\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>prettier</h3>\n<p><code>prettier</code> 是代码格式化工具，和 <code>eslint</code> 不同的是，它只关注代码格式，而不关注语法问题。</p>\n<p>首先安装 <code>prettier</code> 及相关依赖插件：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> prettier eslint-config-prettier eslint-plugin-prettier eslint-plugin-react-hooks <span class=\"token parameter variable\">-D</span>\n</code></pre></div><p>为了使用刚才安装的插件，需要对 <code>.eslintrc.js</code> 中的 <code>plugins</code> 进行修改：</p>\n<div class=\"language-diff\" data-ext=\"diff\" data-title=\"diff\"><pre class=\"language-diff\"><code><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> plugins: [\"react\", \"@typescript-eslint\"]\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> plugins: [\"react\", \"react-hooks\", \"@typescript-eslint\", \"prettier\"]\n</span></span></code></pre></div><p><code>prettier</code> 基本的配置文件如下：</p>\n<p><strong><code>.prettierrc</code></strong></p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"useTabs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"tabWidth\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"printWidth\"</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"singleQuote\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"trailingComma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"semi\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><strong><code>.prettierignore</code></strong></p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>/dist/*\n.local\n.output.js\n/node_modules/**\n\n**/*.svg\n**/*.sh\n\n/public/*\n</code></pre></div><p>最后可以在 <code>package.json</code> 中配置 <code>scripts</code>：</p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint src/**/*.{js,jsx,ts,tsx,json}\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lint:fix\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint --fix 'src/**/*.{js,jsx,ts,tsx,json}'\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"format\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prettier --write 'src/**/*.{js,jsx,ts,tsx,css,md,json}' --config ./.prettierrc\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>StyleLint</h3>\n<p><code>Stylelint</code> 是一个强大、先进的 CSS 代码检查器（linter），可以帮助你规避 CSS 代码中的错误并保持一致的编码风格。</p>\n<blockquote>\n<p><a href=\"https://stylelint.io/\" target=\"_blank\" rel=\"noopener noreferrer\">https://stylelint.io/</a></p>\n</blockquote>\n<p>安装依赖</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token comment\"># 如果项目中使用 scss</span>\n<span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> stylelint stylelint-config-standard-scss <span class=\"token parameter variable\">-D</span>\n<span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> postcss-scss <span class=\"token parameter variable\">-D</span>\n</code></pre></div><p>配置文件 <code>.stylelintrc.js</code>：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">extends</span><span class=\"token operator\">:</span> <span class=\"token string\">'stylelint-config-standard-scss'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// rule覆盖（根据自己喜好来配置）</span>\n  <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'string-quotes'</span><span class=\"token operator\">:</span> <span class=\"token string\">'single'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'property-no-vendor-prefix'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'declaration-colon-newline-after'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'value-list-comma-newline-after'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'custom-property-pattern'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'color-hex-length'</span><span class=\"token operator\">:</span> <span class=\"token string\">'short'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'color-function-notation'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'alpha-value-notation'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'value-no-vendor-prefix'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'selector-class-pattern'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'function-url-quotes'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'no-missing-end-of-source-newline'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'no-descending-specificity'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'font-family-no-missing-generic-family-keyword'</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">overrides</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// 若项目中存在scss文件，添加以下配置</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token string\">'**/*.scss'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">customSyntax</span><span class=\"token operator\">:</span> <span class=\"token string\">'postcss-scss'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>.stylelintignore</code> 忽略校验目录文件：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>/dist/*\n/public/*\npublic/*\nnode_modules\n</code></pre></div><h2>Git 规范</h2>\n<p><code>Git</code> 规范包括：</p>\n<ul>\n<li><code>pre-commit</code>：判断提交的代码是否符合规范</li>\n<li><code>commit-message</code>：判断 <code>commit</code> 信息是否符合规范</li>\n</ul>\n<h3>husky</h3>\n<p><code>husky</code> 可以管理 <code>git</code> 中的 <code>hooks</code>，初始化应该执行如下命令：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">pnpm</span> dlx husky-init <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">pnpm</span> <span class=\"token function\">install</span> <span class=\"token comment\"># pnpm</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>它将设置 <code>husky</code>，修改 <code>package.json</code> 并创建一个你可以编辑的预提交钩子样本。默认情况下，它将在你提交时运行 <code>npm test</code>。</p>\n</div>\n<p>然后修改 <code>pre-commit</code>：</p>\n<div class=\"language-diff\" data-ext=\"diff\" data-title=\"diff\"><pre class=\"language-diff\"><code><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> npm test\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> npm run lint\n</span></span></code></pre></div><p>这样在每次 <code>git commit</code> 之前，都会首先进行 <code>lint</code> 检查，通过之后才能提交代码。</p>\n<h3>lint-staged</h3>\n<p>然而思考几个问题：</p>\n<ol>\n<li>我们只修改了个别的文件，没有必要检测所有的文件代码格式</li>\n<li>它只能给我们提示出对应的错误，我们还需要手动的进行代码修改</li>\n<li>修改后需要手动 <code>git add .</code></li>\n</ol>\n<p>这时可以使用 <code>lint-staged</code> 解决这个问题，它只会检查在暂存区的代码。</p>\n<p>安装：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> lint-staged <span class=\"token parameter variable\">-D</span>\n</code></pre></div><p>修改 <code>.husky</code> 中的 <code>pre-commit</code>：</p>\n<div class=\"language-diff\" data-ext=\"diff\" data-title=\"diff\"><pre class=\"language-diff\"><code><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> npm test\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> npx --no-install lint-staged\n</span></span></code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><code>--no-install</code> 强制使用本地模块，不下载远程模块，如果本地不存在该模块，就会报错。</p>\n</div>\n<p>在 <code>package.json</code> 中配置：</p>\n<blockquote>\n<p>参考资料</p>\n<p><a href=\"https://github.com/ant-design/ant-design/blob/master/package.json\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/ant-design/ant-design/blob/master/package.json</a> &gt; <a href=\"https://www.npmjs.com/package/lint-staged\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.npmjs.com/package/lint-staged</a> &gt; <a href=\"https://juejin.cn/post/7136009620979449893#heading-5\" target=\"_blank\" rel=\"noopener noreferrer\">https://juejin.cn/post/7136009620979449893#heading-5</a></p>\n</blockquote>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token property\">\"lint-staged\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"*.{json,md}\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prettier --ignore-unknown --write\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"*.{js,jsx,ts,tsx}\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"eslint --fix\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"prettier --write\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"{!(package)*.json,*.code-snippets,.!(browserslist)*rc}\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"prettier --write--parser json\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"package.json\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"prettier --write\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"*.{scss,less,styl,html}\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"stylelint --fix\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"prettier --write\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>commitizen</h3>\n<p>在安装完上面两个依赖后，就已经能在 <code>pre-commit</code> 钩子判断<strong>暂存区代码</strong>是否符合规范，并且使用 <code>prettier</code> 修复它。</p>\n<p>第二个问题是我们需要在 <code>commit-message</code> 中判断 <code>commit</code> 信息是否符合规范。可以使用 <code>commitizen</code>，它是一个撰写符合 <code>Commit Message</code> 标准的一款工具。通过它可以实现交互式撰写规范的 <code>Commit Message</code>。</p>\n<blockquote>\n<p><a href=\"http://commitizen.github.io/cz-cli/\" target=\"_blank\" rel=\"noopener noreferrer\">http://commitizen.github.io/cz-cli/</a></p>\n</blockquote>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> commitizen <span class=\"token parameter variable\">-D</span>\n</code></pre></div><p>安装完成后，一般我们都采用符合 Angular 的 <code>Commit message</code> 格式的提交规范，运行以下命令生成符合 Angular 提交规范格式的 <code>Commit message</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx --no-install commitizen init cz-conventional-changelog <span class=\"token parameter variable\">--pnpm</span> --save-dev --save-exact\n</code></pre></div><p><code>package.json</code> 中会自动生成以下配置：</p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token property\">\"config\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"commitizen\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/cz-conventional-changelog\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>然后在 <code>package.json</code> 中的 <code>scripts</code> 添加命令：</p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"commit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git-cz\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>commitlint</h3>\n<p>虽然使用了 <code>commitizen</code> 交互式撰写规范的 <code>Commit Message</code>，但由于它不是强制使用，我们仍然可以通过 <code>git commit</code> 提交信息，因此不管是使用 <code>git commit</code> 或 <code>git cz</code>，我们都需要对 <code>commit message</code> 进行校验，不允许规范的情况下不能进行 <code>commit</code> 操作。</p>\n<blockquote>\n<p><a href=\"https://commitlint.js.org/#/guides-local-setup\" target=\"_blank\" rel=\"noopener noreferrer\">https://commitlint.js.org/#/guides-local-setup</a></p>\n</blockquote>\n<p>首先安装相关依赖并且生成相关配置：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token comment\"># Install and configure if needed</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev @commitlint/<span class=\"token punctuation\">{</span>cli,config-conventional<span class=\"token punctuation\">}</span>\n<span class=\"token comment\"># For Windows:</span>\n<span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> @commitlint/config-conventional @commitlint/cli <span class=\"token parameter variable\">-D</span>\n\n<span class=\"token comment\"># Configure commitlint to use conventional config</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"module.exports = { ignores: [(commit) =&gt; commit.includes('init')], extends: ['@commitlint/config-conventional'] };\"</span> <span class=\"token operator\">&gt;</span> commitlint.config.js\n</code></pre></div><p>在 <code>hushy</code> 中自动生成 <code>hook</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx husky <span class=\"token function\">add</span> .husky/commit-msg <span class=\"token string\">\"npx --no-install commitlint --edit <span class=\"token variable\">$1</span>\"</span>\n</code></pre></div><p>除了 <code>cli</code> 和 <code>config-conventional</code> 外，<code>commitlint</code> 还提供了其他的工具包：</p>\n<ul>\n<li><code>@commitlint/cli</code>: 这是 <code>commitlint</code> 的命令行接口，用于在命令行中执行 <code>commitlint</code>。</li>\n<li><code>@commitlint/config-conventional</code>: 这是 <code>commitlint</code> 的一个常规配置，它提供了一组常规的 <code>commit</code> 规则，这些规则来源于 <code>Angular</code> 团队的提交规范。</li>\n<li><code>@commitlint/cz-commitlint</code>: 这个包是 <code>commitizen</code> 与 <code>commitlint</code> 的适配器，用于在命令行中启动交互式的 <code>commit</code> 提示器，来协助开发者完成符合规范的提交信息。</li>\n<li><code>@commitlint/format</code>: 这个包提供了一种格式化 <code>commitlint</code> 返回的结果的方式，可以自定义输出结果的样式。</li>\n<li><code>@commitlint/prompt-cli</code>: 这个包提供了一个命令行的交互式提示器，用于在命令行中启动交互式的 <code>commit</code> 提示器，来协助开发者完成符合规范的提交信息。</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">`commitizen` 和 `@commitlint/cz-commitlint` 的区别</p>\n<p><code>commitizen</code> 和 <code>@commitlint/cz-commitlint</code> 的功能并不完全一样，但它们可以协同工作来帮助实现更好地 <code>git commit</code> 信息。</p>\n<p><code>commitizen</code> 是一个帮助创建符合规范的 <code>git commit</code> 的工具。它在运行 <code>git cz</code> 时会提供一个命令行的交互式界面来引导你创建 <code>commit</code>，使 <code>commit message</code> 更为标准化。</p>\n<p><code>@commitlint/cz-commitlint</code> 是一个为 <code>commitizen</code> 提供的 <code>@commitlint</code> 适配器。它让 <code>commitizen</code> 可以使用 <code>@commitlint</code> 的 <code>config</code> 配置（如 <code>@commitlint/config-conventional</code>）作为 <code>commit</code> 提示的规则。</p>\n<p>所以，可以这么理解：<code>commitizen</code> 提供了一种方式来创建 <code>commit</code>，而 <code>@commitlint/cz-commitlint</code> 则是允许 <code>commitizen</code> 使用 <code>commitlint</code> 的规则进行 <code>commit</code> 信息的创建。</p>\n<p>这样，当使用 <code>commitizen</code> 进行 <code>commit</code> 时，就会遵守 <code>commitlint</code> 的规则，如果不遵守，<code>commit</code> 就会被阻止，除非修改为符合规则的信息。这可以保证项目中的 <code>git commit</code> 样式的一致性。</p>\n<p>总结：<code>commitizen</code> 负责引导创建 <code>commit</code>，而 <code>@commitlint/cz-commitlint</code> 则负责设定创建 <code>commit</code> 的规则。</p>\n</div>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">`commitizen` 和 `@commitlint/prompt-cli` 的区别</p>\n<p><code>@commitlint/prompt-cli</code> 和 <code>commitizen</code> 的功能类似，它们都提供命令行的交互式界面来引导创建符合规范的 <code>commit message</code>。</p>\n<p>区别主要在于：</p>\n<ul>\n<li><code>@commitlint/prompt-cli</code> 是 <code>commitlint</code> 的一部分，用于捕获 <code>commit message</code> 进行校验。</li>\n<li><code>commitizen</code> 是一个独立的第三方库，它没有自己的校验规范，但可以非常好的与 <code>commitlint</code> 以及其他规范配合使用。</li>\n</ul>\n<p>总的来说，这两者可以一起使用或分开使用，选择使用哪一个主要取决于希望从哪个工具中获取需要的特性或者个人的使用习惯。</p>\n</div>\n<h3>CHANGELOG</h3>\n<p>CHANGELOG 记录项目所有的 <code>commit</code> 信息并归类版本，可以快速跳转到该条 <code>commit</code> 记录，方便知道项目哪个版本做了哪些功能有哪些 bug 等信息。也方便排查 bug，对于提交记录一目了然，不用一个一个去翻去查。</p>\n<blockquote>\n<p><a href=\"https://juejin.cn/post/7136009620979449893\" target=\"_blank\" rel=\"noopener noreferrer\">https://juejin.cn/post/7136009620979449893</a></p>\n</blockquote>\n<p>首先安装 <code>standard-version</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">pnpm</span> <span class=\"token function\">add</span> standard-version <span class=\"token parameter variable\">-D</span>\n</code></pre></div><p>然后在 <code>package.json</code> 的 <code>scripts</code> 中添加命令：</p>\n<div class=\"language-json\" data-ext=\"json\" data-title=\"json\"><pre class=\"language-json\"><code><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"standard-version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"standard-version\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>当 <code>commit type</code> 是 <code>feat</code> 和 <code>fix</code> 的时候执行 <code>npm run standard-version</code>，它会自增版本号。</p>\n<p><code>standard-version</code> 提供自定义配置不同类型对应显示文案，在根目录新建 <code>.versionrc.js</code> 文件：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">types</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'feat'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'✨ Features | 新功能'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'fix'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'🐛 Bug Fixes | Bug 修复'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'init'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'🎉 Init | 初始化'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'docs'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'✏️ Documentation | 文档'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'style'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'💄 Styles | 风格'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'refactor'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'♻️ Code Refactoring | 代码重构'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'perf'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'⚡ Performance Improvements | 性能优化'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'✅ Tests | 测试'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'revert'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'⏪ Revert | 回退'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'build'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'📦‍ Build System | 打包构建'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'chore'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'🚀 Chore | 构建/工程依赖/工具'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'ci'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">section</span><span class=\"token operator\">:</span> <span class=\"token string\">'👷 Continuous Integration | CI 配置'</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>",
      "date_published": "2023-11-21T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "工程化"
      ]
    },
    {
      "title": "yeoman 基础使用",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/05-yeoman.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/05-yeoman.html",
      "summary": " 注意 yo@5.0.0 引入了一个破坏性的更新，会导致 instantiatedGenerator.run is not a function，需要降级到 @4.x。 降级后仍有报错，可能是 generator-node 的问题，不再推荐使用。 Yeoman 是一个通用的脚手架系统，允许创建任何类型的应用程序。它可以快速启动新项目，并简化现有项目的维...",
      "content_html": "<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p><code>yo@5.0.0</code> 引入了一个破坏性的更新，会导致 <a href=\"https://github.com/yeoman/generator-generator/issues/258\" target=\"_blank\" rel=\"noopener noreferrer\">instantiatedGenerator.run is not a function</a>，需要降级到 <code>@4.x</code>。</p>\n<p>降级后仍有报错，可能是 <code>generator-node</code> 的问题，不再推荐使用。</p>\n</div>\n<p>Yeoman 是一个通用的脚手架系统，允许创建任何类型的应用程序。它可以快速启动新项目，并简化现有项目的维护工作。</p>\n<p>Yeoman 与语言无关。它可以生成任何语言（Web、Java、Python、C# 等）的项目。</p>\n<p>Yeoman 本身不做任何决定。所有决定都由生成器做出，而生成器基本上就是 Yeoman 环境中的插件。有很多公开可用的生成器，创建一个新的生成器来匹配任何工作流程也很容易。Yeoman 始终是满足脚手架需求的正确选择。</p>\n<p>以下是一些常见的使用案例：</p>\n<ul>\n<li>快速创建新项目</li>\n<li>创建项目的新部分，如带有单元测试的新控制器</li>\n<li>创建模块或软件包</li>\n<li>引导新服务</li>\n<li>执行标准、最佳实践和风格指南</li>\n<li>通过让用户使用示例应用程序来推广新项目</li>\n<li>...</li>\n</ul>\n<h2>开始</h2>\n<p><code>yo</code> 是一款 Yeoman 命令行实用程序，允许使用脚手架模板（简称为生成器）创建项目。使用 npm 安装 <code>yo</code> 和生成器：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> yo\n</code></pre></div><p>然后可以安装一些生成器：</p>\n<div class=\"hint-container info\">\n<p class=\"hint-container-title\">相关信息</p>\n<p>可以在 <a href=\"https://yeoman.io/generators/\" target=\"_blank\" rel=\"noopener noreferrer\">生成器</a> 中搜索想要的生成器。</p>\n</div>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> generator-node\n</code></pre></div><h2>基本脚手架</h2>\n<p>搭建基本脚手架，只需要去除生成器前缀 <code>generator-</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>yo <span class=\"token function\">node</span>\n</code></pre></div><p>大多数生成器会提出一系列问题来定制新项目。要查看哪些选项可用，请使用 <code>help</code> 命令：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>yo <span class=\"token function\">node</span> <span class=\"token parameter variable\">--help</span>\n</code></pre></div><p>很多生成器都依赖于构建系统（如 Grunt 或 Gulp）和软件包管理器（如 npm 和 Bower）。请务必访问生成器的网站，了解运行和维护新应用程序的相关信息。运行以下命令即可轻松访问生成器的主页：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> home generator-node\n</code></pre></div><p>为复杂框架搭建脚手架的生成器可能会提供额外的生成器，为项目的较小部分搭建脚手架。这些生成器通常被称为子生成器，访问方式为 <code>generator:sub-generator</code>。</p>\n<p>以 <code>generator-node</code> 为例。一旦生成了完整的 node 应用程序，就可以添加其他功能。要在项目中添加新控制器，请运行控制器子生成器：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>yo node:cli\n</code></pre></div><h2>其他 yo 命令</h2>\n<p>除了上一节介绍的基础知识，<code>yo</code> 还是一个完全交互式的工具。只需在终端键入 <code>yo</code>，就能看到一系列选项，用于管理与生成器有关的一切：运行、更新、安装、帮助和其他实用程序。</p>\n<p><code>yo</code> 还提供以下命令。</p>\n<ul>\n<li><code>yo --help</code> 访问完整的帮助界面</li>\n<li><code>yo --generators</code> 列出所有已安装的生成器</li>\n<li><code>yo --version</code> 获取版本</li>\n</ul>\n<h2>故障排除</h2>\n<p>大多数问题都可以通过运行：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>yo doctor\n</code></pre></div><p><code>doctor</code> 命令将诊断并提供解决最常见问题的步骤。</p>\n",
      "date_published": "2024-01-09T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "工程化"
      ]
    },
    {
      "title": "fnm 和 nvm 对比",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/06-fnm-nvm.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/06-fnm-nvm.html",
      "summary": "在管理多个 Node.js 项目（每个项目都可能需要不同的 Node 版本）时，可靠的版本管理器可以简化您的工作流程。 两种流行的选择是 fnm（Fast Node Manager） 和 nvm（Node Version Manager）。本文从性能、功能、安装简便性、使用和兼容性等方面对 fnm 和 nvm 进行了比较，帮助你选择最适合自己开发需求的...",
      "content_html": "<p>在管理多个 Node.js 项目（每个项目都可能需要不同的 Node 版本）时，可靠的版本管理器可以简化您的工作流程。 两种流行的选择是 <a href=\"https://github.com/Schniz/fnm\" target=\"_blank\" rel=\"noopener noreferrer\">fnm（Fast Node Manager）</a> 和 <a href=\"https://github.com/nvm-sh/nvm\" target=\"_blank\" rel=\"noopener noreferrer\">nvm（Node Version Manager）</a>。本文从性能、功能、安装简便性、使用和兼容性等方面对 <code>fnm</code> 和 <code>nvm</code> 进行了比较，帮助你选择最适合自己开发需求的版本管理器。</p>\n<h2>fnm 和 nvm 简介</h2>\n<p><code>nvm</code>：作为最广泛使用的 Node.js 版本管理器，<code>nvm</code> 提供了可靠的 Node.js 版本管理。它用 Bash 编写，适用于类 UNIX 环境（如 macOS 和 Linux），也可以通过兼容的 shell（如 WSL）在 Windows 上使用。</p>\n<p><code>fnm</code>：<code>fnm</code> 是一种较新的、快速的替代方案，由 Rust 编写，以其速度闻名。<code>fnm</code> 支持多线程，因此在安装和切换 Node 版本时特别快。它还提供跨平台支持，包括 WSL、macOS 和 Windows。</p>\n<h2>安装</h2>\n<h3><code>nvm</code></h3>\n<p>要安装 <code>nvm</code>，在 UNIX 系统或 Windows 的 WSL 上运行以下命令：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">curl</span> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span>\n</code></pre></div><p>或者使用 <code>wget</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">wget</span> -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span>\n</code></pre></div><p>安装完成之后，在 <code>~/.bashrc</code> 或 <code>~/.zshrc</code> 中添加以下内容：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NVM_DIR</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token string\">\"<span class=\"token variable\">${XDG_CONFIG_HOME-}</span>\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">printf</span> %s <span class=\"token string\">\"<span class=\"token variable\">${<span class=\"token environment constant\">HOME</span>}</span>/.nvm\"</span> <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">printf</span> %s <span class=\"token string\">\"<span class=\"token variable\">${XDG_CONFIG_HOME}</span>/nvm\"</span><span class=\"token variable\">)</span></span>\"</span>\n<span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-s</span> <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/nvm.sh\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>. <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/nvm.sh\"</span> <span class=\"token comment\"># This loads nvm</span>\n</code></pre></div><p>重启终端或运行 <code>source ~/.bashrc</code> 或 <code>source ~/.zshrc</code> 使配置生效，然后检查 <code>nvm</code> 是否安装成功：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>nvm <span class=\"token parameter variable\">--version</span>\n</code></pre></div><h3><code>fnm</code></h3>\n<p>在 UNIX 系统上，可以运行脚本或使用 <code>homebrew</code> 安装 <code>fnm</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token comment\"># 运行脚本安装</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://fnm.vercel.app/install <span class=\"token operator\">|</span> <span class=\"token function\">bash</span>\n\n<span class=\"token comment\"># 或使用 homebrew 安装</span>\nbrew <span class=\"token function\">install</span> fnm\n</code></pre></div><p>在 Windows 上，可以使用 PowerShell 安装 <code>fnm</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>winget <span class=\"token function\">install</span> Schniz.fnm\n</code></pre></div><p>安装完成后，需要设置环境变量。</p>\n<h4><code>~/.bashrc</code>：</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">eval</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>fnm <span class=\"token function\">env</span> --use-on-cd <span class=\"token parameter variable\">--shell</span> <span class=\"token function\">bash</span><span class=\"token variable\">)</span></span>\"</span>\n</code></pre></div><h4><code>~/.zshrc</code>：</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">eval</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>fnm <span class=\"token function\">env</span> --use-on-cd <span class=\"token parameter variable\">--shell</span> <span class=\"token function\">zsh</span><span class=\"token variable\">)</span></span>\"</span>\n</code></pre></div><h4><code>PowerShell</code>：</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>fnm <span class=\"token function\">env</span> --use-on-cd <span class=\"token parameter variable\">--shell</span> powershell <span class=\"token operator\">|</span> Out-String <span class=\"token operator\">|</span> Invoke-Expression\n</code></pre></div><p>重启终端使配置生效，然后检查 <code>fnm</code> 是否安装成功：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>fnm <span class=\"token parameter variable\">--version</span>\n</code></pre></div><h2>使用</h2>\n<h3><code>nvm</code></h3>\n<h4>安装 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>nvm <span class=\"token function\">install</span> <span class=\"token operator\">&lt;</span>version<span class=\"token operator\">&gt;</span>\n</code></pre></div><h4>切换 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>nvm use <span class=\"token operator\">&lt;</span>version<span class=\"token operator\">&gt;</span>\n</code></pre></div><h4>设置默认 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>nvm <span class=\"token builtin class-name\">alias</span> default <span class=\"token operator\">&lt;</span>version<span class=\"token operator\">&gt;</span>\n</code></pre></div><h4>列出所有已安装的 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>nvm <span class=\"token function\">ls</span>\n</code></pre></div><h4>自动切换版本</h4>\n<p><code>nvm</code> 默认没有支持根据 <code>.nvmrc</code> 文件自动切换版本，需要在 <code>~/.bashrc</code> 或 <code>~/.zshrc</code> 中添加以下内容：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token comment\"># 自动使用 .nvmrc 文件中定义的 Node 版本</span>\n<span class=\"token function-name function\">auto_nvm_use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\"># 如果存在 .nvmrc 文件，则切换到该文件指定的版本</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\".nvmrc\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">local</span> nvmrc_version\n    <span class=\"token assign-left variable\">nvmrc_version</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token operator\">&lt;</span>.nvmrc<span class=\"token variable\">)</span></span>\n    <span class=\"token comment\"># 检查当前版本是否与 .nvmrc 中的版本不同</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>nvm version<span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">!=</span> <span class=\"token string\">\"v<span class=\"token variable\">$nvmrc_version</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n      nvm use <span class=\"token string\">\"<span class=\"token variable\">$nvmrc_version</span>\"</span> <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"NVM: Version <span class=\"token variable\">$nvmrc_version</span> specified in .nvmrc is not installed.\"</span>\n    <span class=\"token keyword\">fi</span>\n  <span class=\"token keyword\">fi</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 针对 Bash 的目录切换钩子</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"<span class=\"token environment constant\">$BASH_VERSION</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token assign-left variable\">PROMPT_COMMAND</span><span class=\"token operator\">=</span><span class=\"token string\">\"auto_nvm_use;<span class=\"token variable\">$PROMPT_COMMAND</span>\"</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># 针对 Zsh 的目录切换钩子</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"<span class=\"token variable\">$ZSH_VERSION</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  autoload <span class=\"token parameter variable\">-U</span> add-zsh-hook\n  add-zsh-hook chpwd auto_nvm_use\n  auto_nvm_use  <span class=\"token comment\"># 立即执行一次，适配启动后的初始目录</span>\n<span class=\"token keyword\">fi</span>\n</code></pre></div><p>同时，如果想要支持递归查找版本文件，也需要自己实现。</p>\n<h3><code>fnm</code></h3>\n<h4>安装 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>fnm <span class=\"token function\">install</span> <span class=\"token operator\">&lt;</span>version<span class=\"token operator\">&gt;</span>\n</code></pre></div><h4>切换 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>fnm use <span class=\"token operator\">&lt;</span>version<span class=\"token operator\">&gt;</span>\n</code></pre></div><h4>设置默认 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>fnm <span class=\"token builtin class-name\">alias</span> default <span class=\"token operator\">&lt;</span>version<span class=\"token operator\">&gt;</span>\n</code></pre></div><h4>列出所有已安装的 Node.js 版本</h4>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>fnm <span class=\"token function\">ls</span>\n</code></pre></div><h4>自动切换版本</h4>\n<p><code>fnm</code> 默认支持根据 <code>.nvmrc</code>、<code>.node-version</code> 或 <code>packages.json#engines#node</code>（如果 <code>--resolve-engines</code> 启用）文件自动切换版本，只需要在 <code>~/.bashrc</code> 或 <code>~/.zshrc</code> 中添加以下内容，<code>--use-on-cd</code> 表示根据当前目录下的 <code>.nvmrc</code> 文件自动切换版本，<code>--version-file-strategy=recursive</code> 表示递归查找版本文件。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">eval</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>fnm <span class=\"token function\">env</span> --use-on-cd --version-file-strategy<span class=\"token operator\">=</span>recursive<span class=\"token variable\">)</span></span>\"</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><code>fnm</code> 开箱即带许多功能。其中一些默认情况下不会激活，因为它们会改变 shell 的默认行为，还有一些只是功能标志，以避免破坏性更改，或者只是实验性的，直到我们认为值得引入它们为止。</p>\n<p>所有这些功能都可以通过在初始化 shell 时为 <code>fnm env</code> 调用添加标志来配置。例如，如果你的 shell 设置为 <code>eval \"$(fnm env)\"</code>，那么你可以添加一个标志，将其更改为 <code>eval \"$(fnm env --my-flag=value)\"</code>。</p>\n<p>详细可以查看配置文档：<a href=\"https://github.com/Schniz/fnm/blob/master/docs/configuration.md\" target=\"_blank\" rel=\"noopener noreferrer\">fnm 配置</a> 实现更好的使用体验。</p>\n</div>\n<h3>命令对比</h3>\n<p><code>fnm</code> 中的命令与 <code>nvm</code> 中的命令几乎完全相同，因此 <code>nvm</code> 用户可以根据需要更方便地切换到 <code>fnm</code>。</p>\n<h2>对比</h2>\n<h3>性能比较</h3>\n<p>安装速度：由于采用 Rust 基础和多线程架构，<code>fnm</code> 的速度明显更快。 与 <code>nvm</code> 相比，安装时间通常更快。</p>\n<p>内存使用：<code>fnm</code> 针对低内存使用率进行了优化，因此在高端和资源受限的系统上都很高效。</p>\n<p>版本切换：在 <code>fnm</code> 中，版本切换是即时进行的。 相比之下，<code>nvm</code> 可能会出现轻微延迟，尤其是在切换大量使用的版本时。</p>\n<h3>跨平台兼容性</h3>\n<p><code>nvm</code>：主要为类 UNIX 系统设计。在 Windows 上，可以通过 WSL 或第三方工具（如 nvm-windows）使用。</p>\n<p><code>fnm</code>：天然支持跨平台，包括 Windows、macOS 和 Linux，适合在不同操作系统上工作。</p>\n<h3>社区和支持</h3>\n<p><code>nvm</code>：用户群体庞大，文档丰富，社区资源充足，解决问题更为容易。</p>\n<p><code>fnm</code>：虽然相对较新，但 <code>fnm</code> 的受欢迎度迅速上升，文档特别针对安装和使用做了详细的说明。</p>\n<h2>总结</h2>\n<p><code>nvm</code> 和 <code>fnm</code> 都是管理 Node.js 版本的有效工具。虽然 <code>nvm</code> 是一个被广泛采用的选择，具有强大的社区支持，但 <code>fnm</code> 作为一种新兴的快速、轻量级替代方案，正在迅速崛起。对于需要跨平台兼容性和频繁版本切换的开发者来说，<code>fnm</code> 可能更适合，而偏好成熟工具和丰富文档支持的用户可以选择 <code>nvm</code>。</p>\n",
      "date_published": "2024-11-05T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "工程化"
      ]
    },
    {
      "title": "fnm 全局共享模块",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/07-fnm-global-module-shared.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/engineering/basic/07-fnm-global-module-shared.html",
      "summary": "fnm 会根据当前 Node 版本创建独立的模块目录，若频繁切换版本，则需要重新安装模块。 为了提高开发体验，我们可能需要全局共享模块，虽然这会在一定程度上造成版本冲突的可能性，但可以减少切换版本时重新安装模块的麻烦。 fnm 设置全局共享模块步骤如下。 macOS 创建全局共享模块目录 设置 npm 全局模块目录 更新环境变量 Windows 创建一...",
      "content_html": "<p><code>fnm</code> 会根据当前 Node 版本创建独立的模块目录，若频繁切换版本，则需要重新安装模块。</p>\n<p>为了提高开发体验，我们可能需要全局共享模块，虽然这会在一定程度上造成版本冲突的可能性，但可以减少切换版本时重新安装模块的麻烦。</p>\n<p><code>fnm</code> 设置全局共享模块步骤如下。</p>\n<h2>macOS</h2>\n<ol>\n<li>创建全局共享模块目录<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> ~/.npm_global\n</code></pre></div></li>\n<li>设置 <code>npm</code> 全局模块目录<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> config <span class=\"token builtin class-name\">set</span> prefix ~/.npm_global\n</code></pre></div></li>\n<li>更新环境变量<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"export PATH=~/.npm_global/bin:\\<span class=\"token environment constant\">$PATH</span>\"</span> <span class=\"token operator\">&gt;&gt;</span> ~/.zshrc\n<span class=\"token builtin class-name\">source</span> ~/.zshrc\n</code></pre></div></li>\n</ol>\n<h2>Windows</h2>\n<ol>\n<li>创建一个共享的全局模块目录：你可以在任意位置创建一个共享目录，比如 <code>C:\\fnm-global-modules</code>。<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">mkdir</span> C:<span class=\"token punctuation\">\\</span>fnm-global-modules\n</code></pre></div></li>\n<li>设置 <code>npm</code> 全局模块目录<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> config <span class=\"token builtin class-name\">set</span> prefix C:<span class=\"token punctuation\">\\</span>fnm-global-modules\n</code></pre></div></li>\n<li>更新环境变量\n<ol>\n<li>打开 系统环境变量设置（按 Win + X，选择 系统 &gt; 高级系统设置 &gt; 环境变量）。</li>\n<li>在「系统变量和用户变量」部分找到 Path，点击 编辑。</li>\n<li>添加新的路径：<code>C:\\fnm-global-modules\\</code>。</li>\n</ol>\n</li>\n<li>重启终端使配置生效。</li>\n</ol>\n<p>配置完成后，通过 <code>npm install -g</code> 安装的全局模块会存储在 <code>~/.npm_global</code> 中，不再受 Node.js 版本切换的影响。</p>\n",
      "date_published": "2024-11-05T00:00:00.000Z",
      "date_modified": "2024-11-09T11:51:37.000Z",
      "authors": [],
      "tags": [
        "工程化"
      ]
    },
    {
      "title": "单例模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/11-singleton-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/11-singleton-pattern.html",
      "summary": "单例是指只需实例化一次就可以全局访问的类。单例可以在整个应用程序中共享，这使得单例非常适合管理应用程序中的全局状态。 比如一个邮件应用，可以使用单例模式来共享一个 EmailClient 对象。 这里构造函数为 private，因此无法在外部创建 EmailClient 对象，但可以通过 getInstance 方法获取单例对象。 如果使用 js 创建...",
      "content_html": "<p>单例是指只需实例化一次就可以全局访问的类。单例可以在整个应用程序中共享，这使得单例非常适合管理应用程序中的全局状态。</p>\n<p>比如一个邮件应用，可以使用单例模式来共享一个 <code>EmailClient</code> 对象。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">EmailClient</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> transporter<span class=\"token operator\">:</span> Transporter\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> instance<span class=\"token operator\">:</span> Mailer\n\n  <span class=\"token comment\">// 使用 nodemailer 配置，发送邮件</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> smtpConfig<span class=\"token operator\">:</span> SMTPTransport<span class=\"token punctuation\">.</span>Options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      host<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token constant\">NODEMAILER_HOST</span><span class=\"token punctuation\">,</span>\n      port<span class=\"token operator\">:</span> <span class=\"token number\">465</span><span class=\"token punctuation\">,</span>\n      secure<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      auth<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        user<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token constant\">NODEMAILER_AUTH_USER</span><span class=\"token punctuation\">,</span>\n        pass<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token constant\">NODEMAILER_AUTH_PASS</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      socketTimeout<span class=\"token operator\">:</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">,</span>\n      connectionTimeout<span class=\"token operator\">:</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">,</span>\n      logger<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      debug<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>transporter <span class=\"token operator\">=</span> <span class=\"token function\">createTransport</span><span class=\"token punctuation\">(</span>smtpConfig<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mailer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>instance\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这里构造函数为 <code>private</code>，因此无法在外部创建 <code>EmailClient</code> 对象，但可以通过 <code>getInstance</code> 方法获取单例对象。</p>\n<p>如果使用 js 创建对象，由于 js 无 <code>private</code> 修饰符，可以在 <code>constructor</code> 中使用  判断是否为 <code>EmailClient</code> 类，如果是则抛出错误。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">EmailClient</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span>target <span class=\"token operator\">===</span> EmailClient<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Cannot instantiate EmailClient directly'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这样，一个 <code>EmailClient</code> 对象只能通过 <code>getInstance</code> 方法获取，而且只会在初始化时创建一次，不会大量地创建多个 <code>EmailClient</code> 对象，防止大量连接邮件服务造成性能问题。</p>\n",
      "date_published": "2024-10-28T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "Provider 模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/react/01-provider-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/react/01-provider-pattern.html",
      "summary": "Provider 解决了多层嵌套组件中 props 传递的问题。 基础使用 react 提供了 createContext 方法来创建上下文，可以方便的在多层嵌套组件中共享数据。 Provider 需要传递一个 value 参数，代表需要共享的数据。 在嵌套组件中，可以使用 useContext 获取 value 参数。 hooks 一般来说，并不直接...",
      "content_html": "<p>Provider 解决了多层嵌套组件中 <code>props</code> 传递的问题。</p>\n<h2>基础使用</h2>\n<p>react 提供了 <code>createContext</code> 方法来创建上下文，可以方便的在多层嵌套组件中共享数据。</p>\n<p><code>Provider</code> 需要传递一个 <code>value</code> 参数，代表需要共享的数据。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> DataContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DataContext.Provider</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SideBar</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Content</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">DataContext.Provider</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>在嵌套组件中，可以使用 <code>useContext</code> 获取 <code>value</code> 参数。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">const</span> DataContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SideBar</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Content</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SideBar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">List</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ListItem</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Content</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Header</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Block</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">ListItem</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>DataContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>listItem<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>DataContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Header</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>DataContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>hooks</h2>\n<p>一般来说，并不直接在嵌套组件使用 <code>useContext</code>，而是将其封装成一个 hooks。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">useDataContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>DataContext<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 安全起见，可以在这里做一些检查</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'useDataContext must be used within a DataContextProvider'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> data\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>接下来在组件中，可以使用 <code>useDataContext</code> 获取 <code>value</code> 参数。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">useDataContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>",
      "date_published": "2024-10-15T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "原型模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/09-prototype-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/09-prototype-pattern.html",
      "summary": "详见 。 ",
      "content_html": "<p>详见 。</p>\n",
      "date_published": "2024-10-15T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "Turso 集成 Prisma",
      "url": "https://dribble-njr.github.io/blog/blog/backend/practice/001-integrate-turso-prisma.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/practice/001-integrate-turso-prisma.html",
      "summary": "在现代应用开发中，数据库和 ORM（对象关系映射）工具的选择对项目的开发效率和数据管理至关重要。Prisma 是一款优秀的 ORM，它不仅能为你生成类型安全的数据库查询，还可以通过自动迁移管理数据库模式。而 Turso 是一种基于 libSQL 的托管云数据库，提供了生产环境级别的 SQLite 数据库。本文将介绍如何将 Turso 和 Prisma ...",
      "content_html": "<p>在现代应用开发中，数据库和 ORM（对象关系映射）工具的选择对项目的开发效率和数据管理至关重要。<a href=\"https://www.prisma.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Prisma</a> 是一款优秀的 ORM，它不仅能为你生成类型安全的数据库查询，还可以通过自动迁移管理数据库模式。而 <a href=\"https://docs.turso.tech/introduction\" target=\"_blank\" rel=\"noopener noreferrer\">Turso</a> 是一种基于 libSQL 的托管云数据库，提供了生产环境级别的 SQLite 数据库。本文将介绍如何将 Turso 和 Prisma 结合使用，帮助你快速集成并管理数据库。</p>\n<h2>什么是 Turso？</h2>\n<p>Turso 是由 libSQL 提供的云端托管数据库服务，其核心基于 SQLite，专为生产环境设计。它保持了 SQLite 简单、轻量和快速的特点，同时通过云端托管的方式，让开发者能够在分布式的环境中使用 SQLite，且具有云数据库的优势，例如多点访问、强大性能和易于集成。</p>\n<p>Turso 的特点：</p>\n<ul>\n<li>基于 libSQL：提供了生产级的 SQLite 数据库。</li>\n<li>分布式存储：适用于多区域、多地的应用程序。</li>\n<li>轻量易用：你可以像使用本地 SQLite 数据库一样去使用它。</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>重点是能够免费使用。</p>\n</div>\n<h2>什么是 Prisma？</h2>\n<p>Prisma 是一个现代的 ORM 工具，旨在简化数据库交互。它通过提供类型安全的数据库查询接口，使得开发者能够在使用数据库时避免常见的错误。Prisma 的一些核心功能包括数据库迁移管理、自动生成的查询 API 和直观的数据库模式定义文件（<code>schema.prisma</code>）。</p>\n<p>Prisma 的特点：</p>\n<ul>\n<li>类型安全：Prisma 生成的客户端代码是类型安全的，能在开发阶段捕获错误。</li>\n<li>直观的 Schema 定义：使用 <code>.prisma</code> 文件定义数据库模型。</li>\n<li>数据库迁移：提供了数据库迁移工具，能够自动化管理数据库版本。</li>\n</ul>\n<h2>集成 Turso 和 Prisma</h2>\n<p>接下来将逐步介绍如何将 Turso 和 Prisma 集成在一起。主要的步骤包括安装工具、设置数据库连接、生成模型、进行数据库迁移并应用更改。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>从 Prisma ORM 5.4.2 及更高版本开始，Turso 可获得早期访问支持。</p>\n</div>\n<h3>安装 Turso CLI 和 Prisma CLI</h3>\n<p>首先，我们需要安装 Turso CLI 以便管理和访问 Turso 数据库，并且需要安装 Prisma CLI 以便生成客户端和管理数据库迁移。</p>\n<p>安装 Prisma CLI：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> <span class=\"token function\">install</span> prisma --save-dev\n</code></pre></div><p><a href=\"https://docs.turso.tech/cli/introduction\" target=\"_blank\" rel=\"noopener noreferrer\">安装 Turso CLI</a>，以 macOS 为例：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>brew <span class=\"token function\">install</span> tursodatabase/tap/turso\n</code></pre></div><p>安装完成后，通过 <code>turso auth login</code> 登录你的 Turso 帐户。</p>\n<h3>创建 Turso 数据库</h3>\n<p>使用以下命令创建一个新的 Turso 数据库：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>turso db create my-database\n</code></pre></div><p>获取数据库 URL：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>turso db show <span class=\"token parameter variable\">--url</span> my-database\n</code></pre></div><p>获取数据库访问 token：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>turso db tokens create my-database\n</code></pre></div><h3>配置 Prisma 数据源</h3>\n<p>初始化 Prisma 数据源：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma init\n</code></pre></div><p>这会生成 <code>prisma/schema.prisma</code> 文件及 <code>.env</code> 文件，其中包含 Prisma 数据源定义。</p>\n<p><code>.env</code> 文件：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token assign-left variable\">TURSO_URL</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-turso-database-url<span class=\"token operator\">&gt;</span>\n<span class=\"token assign-left variable\">TURSO_AUTH_TOKEN</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-turso-auth-token<span class=\"token operator\">&gt;</span>\n</code></pre></div><p>需要启用 <code>driverAdapters</code> 特性：</p>\n<div class=\"language-prisma\" data-ext=\"prisma\" data-title=\"prisma\"><pre class=\"language-prisma\"><code>generator client {\n  provider        = \"prisma-client-js\"\n  previewFeatures = [\"driverAdapters\"]\n}\n\ndatasource db {\n  provider = \"sqlite\"\n  url      = \"file:./dev.db\"\n}\n</code></pre></div><p>生成 Prisma 客户端，它可以让你通过代码与数据库交互。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma generate\n</code></pre></div><h3>同步数据库</h3>\n<p>在本地开发环境下，我们首先需要同步数据库。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>若无需同步数据库，可以跳过这一步。</p>\n</div>\n<p>首先登陆到 Turso 数据库：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>turso db shell my-database\n</code></pre></div><p>导出当前数据库 SQL 数据：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>.schema\n</code></pre></div><p>然后将 SQL 应用到本地数据库：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>sqlite3 dev.db <span class=\"token operator\">&lt;</span> schema.sql\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><code>sqlite3</code> 是 SQLite 数据库的命令行工具，用于创建、管理和查询 SQLite 数据库。它非常轻量，适合嵌入式系统或小型应用的本地数据库操作。你可以通过 <code>sqlite3</code> 工具来执行 SQL 命令、创建数据库、插入数据、查询数据、导入和导出数据库结构等。</p>\n<p>macOS 通常自带 SQLite。</p>\n</div>\n<p>然后将数据库结构拉入 prisma，这将从本地的 <code>dev.db</code> 文件中提取数据库模型，并自动生成 Prisma schema。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma db pull\n</code></pre></div><p>生成 Prisma 客户端：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma generate\n</code></pre></div><h3>迁移数据库</h3>\n<p>由于 Turso 目前不支持直接使用 Prisma 进行模式迁移，所以在本地开发环境下，我们首先使用 SQLite 进行数据库迁移。</p>\n<p>生成迁移文件：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>npx prisma migrate dev <span class=\"token parameter variable\">--name</span> init\n</code></pre></div><p>这条命令做了三件事：</p>\n<ol>\n<li>在 <code>prisma/migrations</code> 目录中为这次迁移创建了一个新的 SQL 迁移文件。</li>\n<li>针对数据库执行 SQL 迁移文件。</li>\n<li>运行 <code>prisma generate</code>（安装 <code>@prisma/client</code> 软件包，并根据你的模型生成定制的 Prisma 客户端 API）。</li>\n</ol>\n<p>推送迁移到远端 turso 数据库：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>turso db shell my-database <span class=\"token operator\">&lt;</span> ./prisma/migrations/20240923125341_init/migration.sql\n</code></pre></div><h3>数据库操作</h3>\n<p>为 libSQL 安装 libSQL 数据库客户端和 Prisma ORM 驱动程序适配器：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> <span class=\"token function\">install</span> @libsql/client @prisma/adapter-libsql\n</code></pre></div><p>更新数据库访问实例：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PrismaClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@prisma/client'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PrismaLibSQL <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@prisma/adapter-libsql'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@libsql/client'</span>\n\n<span class=\"token keyword\">const</span> libsql <span class=\"token operator\">=</span> <span class=\"token function\">createClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  url<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TURSO_URL</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  authToken<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TURSO_AUTH_TOKEN</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> adapter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrismaLibSQL</span><span class=\"token punctuation\">(</span>libsql<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> prisma <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrismaClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> adapter <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> prisma\n</code></pre></div><h2>结论</h2>\n<p>集成 Turso 和 Prisma 可以让你在分布式云环境中享受 SQLite 的性能优势，同时利用 Prisma 的 ORM 功能管理数据库模型和查询。</p>\n<p>但由于 Turso 目前对 Prisma 的支持有限，你需要手动将迁移文件应用到远程数据库。通过这种方式，你可以将本地开发环境与生产环境有效分离，保持高效的开发流程。</p>\n",
      "date_published": "2024-09-24T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "观察者模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/08-observer-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/08-observer-pattern.html",
      "summary": "观察者模式（Observer Pattern）是一种行为设计模式，用于创建一种对象之间的「一对多」关系，使得当一个对象的状态发生变化时，所有依赖于它的对象都能得到通知并自动更新。这个模式非常适合用来实现事件系统或数据绑定功能。 观察者模式观察者模式 函数版本 函数式观察者模式的主要组成部分： observers：在发生特定事件时会收到通知的观察者数组 ...",
      "content_html": "<p>观察者模式（Observer Pattern）是一种行为设计模式，用于创建一种对象之间的「一对多」关系，使得当一个对象的状态发生变化时，所有依赖于它的对象都能得到通知并自动更新。这个模式非常适合用来实现事件系统或数据绑定功能。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240920125941.png\" alt=\"观察者模式\" tabindex=\"0\" loading=\"lazy\"><figcaption>观察者模式</figcaption></figure>\n<h2>函数版本</h2>\n<p>函数式观察者模式的主要组成部分：</p>\n<ul>\n<li><code>observers</code>：在发生特定事件时会收到通知的观察者数组</li>\n<li><code>subscribe()</code>：向观察者列表添加观察者的方法</li>\n<li><code>unsubscribe()</code>：从观察者列表移除观察者的方法</li>\n<li><code>notify()</code>：在发生特定事件时通知所有观察者的方法</li>\n</ul>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">Observable</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">observer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> observer <span class=\"token operator\">!==</span> func<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">observer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token function\">observer</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>让我们用这个可观察对象构建一些东西。 我们有一个非常基本的应用程序，它只由两个组件组成：一个按钮和一个开关。</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ToastContainer<span class=\"token punctuation\">,</span> toast <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-toastify'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">logger</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">toastify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">toast</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>App<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Button</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Click me!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Button</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">FormControlLabel</span></span> <span class=\"token attr-name\">control</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Switch</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ToastContainer</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>我们希望跟踪用户与应用程序的交互。每当用户点击按钮或拨动开关时，我们都要记录这一事件并加上时间戳。除了记录，我们还想创建一个 toast 通知，在事件发生时显示！</p>\n<div class=\"language-jsx\" data-ext=\"jsx\" data-title=\"jsx\"><pre class=\"language-jsx\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ToastContainer<span class=\"token punctuation\">,</span> toast <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-toastify'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">logger</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">toastify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">toast</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nobservable<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span>\nobservable<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>toastify<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    observable<span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">'User clicked button!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">handleToggle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    observable<span class=\"token punctuation\">.</span><span class=\"token function\">notify</span><span class=\"token punctuation\">(</span><span class=\"token string\">'User toggled switch!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>App<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Button</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Click me!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Button</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">FormControlLabel</span></span> <span class=\"token attr-name\">control</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Switch</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ToastContainer</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>整个流程：<code>handleClick</code> 和 <code>handleToggle</code> 用数据调用了观察者的 <code>notify</code> 方法，然后观察者通知了订阅者：本例中是 <code>logger</code> 和 <code>toastify</code> 函数。</p>\n<p>虽然我们可以在很多方面使用观察者模式，但它在处理异步、基于事件的数据时非常有用。也许你想让某些组件在某些数据下载完成时收到通知，或者当用户向留言板发送新消息时，所有其他成员都应收到通知。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>使用观察者模式是执行关注点分离和单一响应原则的好方法。观察者对象与可观察对象并不紧密耦合，而且可以随时（解除）耦合。可观察对象负责监控事件，而观察者只需处理接收到的数据。</p>\n</div>\n<h2>传统版本</h2>\n<p>上述版本中，使用了一个函数式的观察者设计。在这个实现中，观察者被设计为函数 <code>func</code>，通过调用 <code>subscribe</code> 方法，观察者可以订阅主题；<code>notify</code> 方法会遍历所有订阅的函数并调用它们来通知观察者。</p>\n<p>在传统的观察者模式中，观察者通常是一个对象，且必须实现一个统一的接口或方法（如 <code>update()</code>）。而在上述例子中，观察者就是普通的函数，这样简化了设计，不需要创建专门的观察者类。</p>\n<ul>\n<li>主题（Subject）：也称为被观察者。主题对象持有对观察者对象的引用，并在自身状态变化时通知所有注册的观察者。</li>\n<li>观察者（Observer）：观察者对象在被通知时更新自己或执行相关动作。</li>\n<li>具体主题（Concrete Subject）：实现主题接口，维护观察者列表，并在状态变化时通知所有观察者。</li>\n<li>具体观察者（Concrete Observer）：实现观察者接口，定义响应主题状态变化的具体操作。</li>\n</ul>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token comment\">// 主题（可观察者）类</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Subject</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> observers<span class=\"token operator\">:</span> Observer<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\">// 添加观察者</span>\n  <span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span>observer<span class=\"token operator\">:</span> Observer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 移除观察者</span>\n  <span class=\"token function\">removeObserver</span><span class=\"token punctuation\">(</span>observer<span class=\"token operator\">:</span> Observer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>obs<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> obs <span class=\"token operator\">!==</span> observer<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 通知所有观察者</span>\n  <span class=\"token function\">notifyObservers</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> observer<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 观察者抽象类</span>\n<span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Observer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 定义一个抽象方法，子类必须实现</span>\n  <span class=\"token keyword\">abstract</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ConcreteObserver</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Observer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Observer received data:'</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 使用观察者模式</span>\n<span class=\"token keyword\">const</span> subject <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Subject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> observer1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcreteObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> observer2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcreteObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nsubject<span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span>observer1<span class=\"token punctuation\">)</span>\nsubject<span class=\"token punctuation\">.</span><span class=\"token function\">addObserver</span><span class=\"token punctuation\">(</span>observer2<span class=\"token punctuation\">)</span>\n\nsubject<span class=\"token punctuation\">.</span><span class=\"token function\">notifyObservers</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello Observers!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 输出:</span>\n<span class=\"token comment\">// Received data: Hello Observers!</span>\n<span class=\"token comment\">// Received data: Hello Observers!</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>在 React 等组件化框架中，使用函数式的简易观察者模式通常更方便、更直观。特别是结合 React 的钩子（如 <code>useState</code> 和 <code>useEffect</code>），可以非常轻松地实现类似观察者模式的效果，而不必依赖复杂的类继承结构。</p>\n</div>\n<h2>扩展</h2>\n<p>在观察者模式的经典定义中：</p>\n<ul>\n<li>参与者：观察者（Observer）和被观察者（Subject）。</li>\n<li>结构：在观察者模式中，观察者直接订阅主题（被观察者），主题有状态变化时，主动通知所有的观察者。观察者通过注册到主题中，接收事件通知。</li>\n<li>特点：\n<ul>\n<li>观察者和主题是紧耦合的：主题知道谁订阅了自己，通知时直接调用观察者的方法。</li>\n<li>观察者知道主题的存在，彼此之间有依赖。</li>\n<li>通常用于单一事件源，比如 UI 事件监听。</li>\n</ul>\n</li>\n</ul>\n<p>但在之前的例子中，都是主动调用了 <code>notifyObservers</code>，这看起来更像是直接的事件触发，而不是主题状态的变化引起的自动通知。</p>\n<p>观察者模式结构如下：</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240920124553.png\" alt=\"模式结构\" tabindex=\"0\" loading=\"lazy\"><figcaption>模式结构</figcaption></figure>\n<p>下面来看一个具体的例子：</p>\n<ul>\n<li>观察者（<code>LoggingListener</code> 和 <code>EmailAlertsListener</code>）直接订阅主题（<code>Editor</code>）。</li>\n<li>当 <code>Editor</code> 状态发生变化时，它主动通知所有订阅了该事件的观察者。</li>\n<li>观察者通过 <code>EventManager</code> 进行管理，但它们仍然直接与 <code>Editor</code> 交互。</li>\n<li><code>EventManager</code> 仅仅是辅助类，用于简化管理订阅和通知的逻辑。</li>\n<li>观察者可以只关心主题的某个事件类型（<code>open</code> 和 <code>save</code>）的状态变化。</li>\n</ul>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240920124501.png\" alt=\"将对象中发生的事件通知给其他对象\" tabindex=\"0\" loading=\"lazy\"><figcaption>将对象中发生的事件通知给其他对象</figcaption></figure>\n\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240920125941.png",
      "date_published": "2024-09-20T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "模块模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/07-module-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/07-module-pattern.html",
      "summary": "随着应用程序和代码库的增长，保持代码的可维护性和分离性变得越来越重要。模块模式可以将代码分割成更小的、可重复使用的片段。 除了可以将代码分割成更小的、可重复使用的片段外，模块还可以将文件中的某些值保持私有。默认情况下，模块中的声明会被作用域（封装）到该模块。如果我们没有明确导出某个值，那么该值在该模块之外就不可用。这就降低了代码库其他部分声明的值发生名...",
      "content_html": "<p>随着应用程序和代码库的增长，保持代码的可维护性和分离性变得越来越重要。模块模式可以将代码分割成更小的、可重复使用的片段。</p>\n<p>除了可以将代码分割成更小的、可重复使用的片段外，模块还可以将文件中的某些值保持私有。默认情况下，模块中的声明会被作用域（封装）到该模块。如果我们没有明确导出某个值，那么该值在该模块之外就不可用。这就降低了代码库其他部分声明的值发生名称冲突的风险，因为这些值在全局范围内不可用。</p>\n<p>更详细的内容可以见 。</p>\n",
      "date_published": "2024-09-19T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "混入模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/06-mixin-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/06-mixin-pattern.html",
      "summary": "混入模式 mixin 是一种对象，我们可以使用它为另一个对象或类添加可重复使用的功能，而无需使用继承。我们不能单独使用 mixins：mixins 的唯一目的是在不使用继承的情况下为对象或类添加功能。 假设我们的应用程序需要创建多条狗。然而，我们创建的基本狗没有任何属性，只有一个名称属性。 狗不应该只有名字。它应该会 bark、wagTail 和 pl...",
      "content_html": "<h2>混入模式</h2>\n<p><code>mixin</code> 是一种对象，我们可以使用它为另一个对象或类添加可重复使用的功能，而无需使用继承。我们不能单独使用 mixins：mixins 的唯一目的是在不使用继承的情况下为对象或类添加功能。</p>\n<p>假设我们的应用程序需要创建多条狗。然而，我们创建的基本狗没有任何属性，只有一个名称属性。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">Dog</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>狗不应该只有名字。它应该会 <code>bark</code>、<code>wagTail</code> 和 <code>play</code>！ 我们可以创建一个 mixin，而不是直接将其添加到 <code>Dog</code> 中。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> dogFunctionality <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">bark</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Woof!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">wagTail</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Wagging my tail!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">play</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Playing!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>我们可以使用 <code>Object.assign</code> 方法将 <code>dogFunctionality</code> 混合元素添加到 <code>Dog</code> 原型中。通过该方法，我们可以向目标对象添加属性：本例中为 <code>Dog.prototype</code>。<code>Dog</code> 的每个新实例都可以访问 <code>dogFunctionality</code> 的属性，因为它们都被添加到了 <code>Dog</code> 的原型中！</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">Dog</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> dogFunctionality <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">bark</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Woof!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">wagTail</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Wagging my tail!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">play</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Playing!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dog</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> dogFunctionality<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> pet1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dog</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Daisy'</span><span class=\"token punctuation\">)</span>\n\npet1<span class=\"token punctuation\">.</span>name <span class=\"token comment\">// Daisy</span>\npet1<span class=\"token punctuation\">.</span><span class=\"token function\">bark</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Woof!</span>\npet1<span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Playing!</span>\n</code></pre></div><p>虽然我们可以在不使用继承的情况下使用 mixin 添加功能，但 mixin 本身也可以使用继承！大多数哺乳动物（除了海豚，也许还有其他动物）都会走路和睡觉。狗是哺乳动物，应该会走路和睡觉！</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> animalFunctionality <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">walk</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Walking!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">sleep</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sleeping!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>我们可以使用 <code>Object.assign</code> 将这些属性添加到 <code>dogFunctionality</code> 原型中。在本例中，目标对象是 <code>dogFunctionality</code>。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> animalFunctionality <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">walk</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Walking!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">sleep</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sleeping!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> dogFunctionality <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">bark</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Woof!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">wagTail</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Wagging my tail!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">play</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Playing!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">walk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">walk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>dogFunctionality<span class=\"token punctuation\">,</span> animalFunctionality<span class=\"token punctuation\">)</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dog</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> dogFunctionality<span class=\"token punctuation\">)</span>\n</code></pre></div><p>在现实世界中，浏览器环境中的 <code>Window</code> 就是一个 mixin 的例子。 <code>Window</code> 对象从 <code>WindowOrWorkerGlobalScope</code> 和 <code>WindowEventHandlers</code> mixins 中实现了许多属性，这使我们可以访问 <code>setTimeout</code> 和 <code>setInterval</code>、<code>indexedDB</code> 和 <code>isSecureContext</code> 等属性。</p>\n<p>由于它是一个 mixin，因此只能用于为对象添加功能，您将无法创建 <code>WindowOrWorkerGlobalScope</code> 类型的对象。</p>\n\n<h2>总结</h2>\n<p>在引入 ES6 类之前，mixins 通常用于为 React 组件添加功能。 React 团队不鼓励使用 mixins，因为它很容易给组件增加不必要的复杂性，使其难以维护和重用。React 团队鼓励使用高阶组件，现在这些组件通常可以被 Hooks 代替。</p>\n<p>混入模式看起来和继承非常类似，但是有一点区别：</p>\n<ul>\n<li>继承：继承通常是在类定义时确定的，子类会继承父类的所有方法和属性，并且可以覆盖或扩展它们。</li>\n<li>混入：混入是动态的、灵活的，你可以在对象或类实例创建后将某些行为混入，而不必在定义时就确定继承关系。混入只是通过组合而不是创建严格的继承链。</li>\n</ul>\n<p>因此上面的实现仍然是混入模式。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>虽然你修改了原型，但混入模式的本质是将多个功能组合到一个类或对象中，而不强制遵循严格的继承层次结构。因此，它依然可以被认为是混入模式。</p>\n</div>\n<p>如果不想直接修改原型，可以选择实例级别的混入：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">Dog</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> dogFunctionality <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">bark</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Woof!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">wagTail</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Wagging my tail!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">play</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Playing!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> pet1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dog</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Daisy'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 仅将功能混入特定实例，而不是修改原型</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>pet1<span class=\"token punctuation\">,</span> dogFunctionality<span class=\"token punctuation\">)</span>\n\npet1<span class=\"token punctuation\">.</span><span class=\"token function\">bark</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Woof!</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>通过向对象的原型注入功能，mixins 可以让我们在没有继承的情况下为对象轻松添加功能。修改对象的原型被认为是一种不好的做法，因为这会导致原型污染和函数来源的不确定性。</p>\n</div>\n",
      "date_published": "2024-09-19T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "中间件模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/05-middleware-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/05-middleware-pattern.html",
      "summary": "中间件模式 中间件模式是一种行为设计模式， 允许你将请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。 相关信息 Express 就使用了中间件模式处理请求。中间件模式是 Express 核心架构的一部分，它允许你在处理请求的过程中，通过一系列中间件函数来对请求和响应对象进行操作。中间件在请求-响应生命周...",
      "content_html": "<h2>中间件模式</h2>\n<p>中间件模式是一种行为设计模式， 允许你将请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。</p>\n<div class=\"hint-container info\">\n<p class=\"hint-container-title\">相关信息</p>\n<p>Express 就使用了中间件模式处理请求。中间件模式是 Express 核心架构的一部分，它允许你在处理请求的过程中，通过一系列中间件函数来对请求和响应对象进行操作。中间件在请求-响应生命周期中充当「处理链」中的一个节点，既可以终止请求（发送响应），也可以将请求传递给下一个中间件。</p>\n</div>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">middleware</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 执行某些逻辑</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 调用 next() 将请求传递给下一个中间件</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240918173949.png\" alt=\"20240918173949\" tabindex=\"0\" loading=\"lazy\"><figcaption>20240918173949</figcaption></figure>\n<h2>Express 中间件</h2>\n<p>Express 通过 <code>app.use()</code> 来定义中间件，并作用于整个应用程序的请求处理过程。例如：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Request received at:'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 继续到下一个中间件</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>简单的中间件实现</h2>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MiddlewareManager</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> readonly middlewares<span class=\"token operator\">:</span> Middleware<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>middlewares <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">func</span><span class=\"token operator\">:</span> Middleware</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">req</span><span class=\"token operator\">:</span> CustomIncomingMessage<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">res</span><span class=\"token operator\">:</span> ServerResponse</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runner</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> middleware <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>middleware<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> <span class=\"token function\">middleware</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token function\">runner</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">runner</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240918173949.png",
      "date_published": "2024-09-18T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "中介者模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/04-mediator-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/04-mediator-pattern.html",
      "summary": "中介者模式使组件之间通过一个中心点（调解器）进行交互成为可能。它允许组件接收请求并将其发送出去，而不是彼此直接对话！在 JavaScript 中，中介者通常只是一个对象字面或函数。 你可以把这种模式比作空中交通管制员和飞行员之间的关系。飞行员与空中交通管制员之间的对话可能会导致混乱，而不是让飞行员直接对话。空中交通管制员确保所有飞机都能收到所需的信息，...",
      "content_html": "<p>中介者模式使组件之间通过一个中心点（调解器）进行交互成为可能。它允许组件接收请求并将其发送出去，而不是彼此直接对话！在 JavaScript 中，中介者通常只是一个对象字面或函数。</p>\n<p>你可以把这种模式比作空中交通管制员和飞行员之间的关系。飞行员与空中交通管制员之间的对话可能会导致混乱，而不是让飞行员直接对话。空中交通管制员确保所有飞机都能收到所需的信息，以便安全飞行，不撞击其他飞机。</p>\n<p>虽然我们不希望在 JavaScript 中控制飞机，但我们经常需要处理对象之间的多向数据。如果组件数量较多，组件之间的通信可能会变得相当混乱。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240918170836.png\" alt=\"20240918170836\" tabindex=\"0\" loading=\"lazy\"><figcaption>20240918170836</figcaption></figure>\n<p>与让每个对象直接与其他对象对话从而形成多对多的关系不同，对象的请求由调解器处理。调解器处理请求，并将其发送到需要的地方。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240918170920.png\" alt=\"20240918170920\" tabindex=\"0\" loading=\"lazy\"><figcaption>20240918170920</figcaption></figure>\n<p>聊天室就是中间件模式的一个很好的用例！聊天室中的用户不会直接对话。聊天室只是用户之间的中介。</p>\n\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>组件的封装也使用了中介者模式，子组件抛出事件在父组件中集中处理。</p>\n</div>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240918170836.png",
      "date_published": "2024-09-18T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "享元模式",
      "url": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/03-flyweight-pattern.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/patterns/vanilla/03-flyweight-pattern.html",
      "summary": "享元模式 当我们创建大量对象时，我们可以使用享元模式来减少内存使用。 在我们的应用程序中，我们希望用户能够添加书籍。所有书籍都有 title、author 和 isbn！然而，一个图书馆通常不会只有一本书：它通常有同一本书的多本副本。 如果有多本完全相同的书，每次创建一个新的图书实例并不是很有用。相反，我们希望创建多个 Book 构造函数实例，代表一本...",
      "content_html": "<h2>享元模式</h2>\n<p>当我们创建大量对象时，我们可以使用享元模式来减少内存使用。</p>\n<p>在我们的应用程序中，我们希望用户能够添加书籍。所有书籍都有 <code>title</code>、<code>author</code> 和 <code>isbn</code>！然而，一个图书馆通常不会只有一本书：它通常有同一本书的多本副本。</p>\n<p>如果有多本完全相同的书，每次创建一个新的图书实例并不是很有用。相反，我们希望创建多个 <code>Book</code> 构造函数实例，代表一本书。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> isbn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> title\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>author <span class=\"token operator\">=</span> author\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isbn <span class=\"token operator\">=</span> isbn\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>如果一本书有相同的 ISBN 编号，因此是完全相同的图书类型，我们就不想创建一个全新的图书实例。相反，我们应该首先检查这本书是否已经存在。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> books <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createBook</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> isbn</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> existingBook <span class=\"token operator\">=</span> books<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>isbn<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>existingBook<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> books<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>isbn<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>如果它尚未包含图书的 ISBN 编号，我们将创建一本新书，并将其 ISBN 编号添加到 <code>isbnNumbers</code> 集合中。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createBook</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> isbn</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> existingBook <span class=\"token operator\">=</span> books<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>isbn<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>existingBook<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> books<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>isbn<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> book <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> isbn<span class=\"token punctuation\">)</span>\n  books<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>isbn<span class=\"token punctuation\">,</span> book<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> book\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p><code>createBook</code> 函数可以帮助我们创建一种图书的新实例。然而，图书馆通常包含同一本书的多个副本！让我们创建一个 <code>addBook</code> 函数，它允许我们添加同一本书的多个副本。它应该调用 <code>createBook</code> 函数，该函数要么返回一个新创建的图书实例，要么返回已经存在的实例。</p>\n<p>为了记录副本总数，我们创建一个 <code>bookList</code> 数组，其中包含图书馆中的图书总数。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> bookList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addBook</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> isbn<span class=\"token punctuation\">,</span> availability<span class=\"token punctuation\">,</span> sales</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> book <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token function\">createBook</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> isbn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    sales<span class=\"token punctuation\">,</span>\n    availability<span class=\"token punctuation\">,</span>\n    isbn\n  <span class=\"token punctuation\">}</span>\n\n  bookList<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>book<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> book\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>完美！我们不必每次添加副本时都创建一个新的图书实例，而是可以有效地为特定副本使用已有的图书实例。让我们创建 3 本书的 5 个副本：《哈利-波特》、《杀死一只知更鸟》和《了不起的盖茨比》。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token function\">addBook</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Harry Potter'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JK Rowling'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AB123'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">addBook</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Harry Potter'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JK Rowling'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AB123'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">addBook</span><span class=\"token punctuation\">(</span><span class=\"token string\">'To Kill a Mockingbird'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Harper Lee'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CD345'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">addBook</span><span class=\"token punctuation\">(</span><span class=\"token string\">'To Kill a Mockingbird'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Harper Lee'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CD345'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">addBook</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The Great Gatsby'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'F. Scott Fitzgerald'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'EF567'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>特点</h2>\n<p>享元模式是一种结构型设计模式，其核心思想是通过共享已经存在的对象来减少内存占用，从而提高性能。有两个特点：</p>\n<ul>\n<li>对象共享：避免重复创建相同状态的对象，节省内存。</li>\n<li>不可变部分与可变部分分离：将对象分为共享的、不可变的部分（如 <code>title</code>、<code>author</code> 和 <code>isbn</code>）和非共享的、可变的部分（如 <code>availability</code> 和 <code>sales</code>）。</li>\n</ul>\n<p>上述代码体现了这两个特点：</p>\n<p><code>Book</code> 类实例化了书籍的基本信息（<code>title</code>、<code>author</code>、<code>isbn</code>），并通过 <code>Map</code> 存储，确保同样的 <code>isbn</code> 只会创建一次。这部分相当于享元对象的内部状态（不可变且可以被多个实例共享）。</p>\n<p><code>addBook</code> 函数添加了一些书籍的可变信息（<code>sales</code> 和 <code>availability</code>），这些信息属于享元对象的外部状态（每次使用时可以独立指定）。</p>\n<h2>优点</h2>\n<ul>\n<li>减少内存占用：避免了为每个新书籍对象重复创建相同的 <code>Book</code> 实例。如果书籍的 <code>isbn</code> 相同，那么不再创建新的实例，而是共享现有的对象。</li>\n<li>提高性能：通过共享已有对象，减少对象的创建和销毁，特别是在大量数据处理的场景中能显著提高性能。</li>\n<li>更好的管理：将不可变的数据与可变数据分开，代码逻辑更加清晰，易于维护。</li>\n</ul>\n<h2>适用场景</h2>\n<p>在本例中，由于 <code>title</code>、<code>author</code> 和 <code>isbn</code> 都是基本数据类型（字符串），享元模式带来的优化可能会非常有限，甚至没有明显的优势，原因如下：</p>\n<ul>\n<li>内存优化有限：由于字符串本身是不可变且通常由引擎优化处理，JavaScript 已经会对相同的字符串进行共享存储（类似于享元模式），这意味着手动实现的享元模式在这方面并没有太大的额外好处。</li>\n<li>重复实例减少不明显：与对象不同，基本类型的重复实例在内存中通常不会像对象那样占用大量空间。因此，避免创建多个基本类型的实例不会有明显的内存节省。</li>\n</ul>\n<p>因此，享元模式适用于有大量公共内在属性的场景，如：粒子系统，在这种情况下，每个粒子都有一些共同的属性，如颜色、精灵图等。通过享元模式，我们可以共享这些属性，从而节省内存。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>实际上享元模式是共享一些内在的公共状态，而不是共享所有的状态。</p>\n<p>在 JavaScript 中，我们可以通过原型继承轻松解决这个问题。</p>\n<p>在享元模式中，虽然最后创建的对象数量和之前一样多，但会大量节省内存。在本例中可能没有体现出这个好处，但是如果共享的内在状态是对象，那么享元模式就可以发挥作用。</p>\n</div>\n",
      "date_published": "2024-09-18T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [
        {
          "name": "patterns"
        }
      ],
      "tags": [
        "reading"
      ]
    },
    {
      "title": "覆盖输入框 autofill 样式",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/basic/css/018-autofill.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/basic/css/018-autofill.html",
      "summary": "浏览器自动填充密码会有一些默认样式： autofill 默认样式autofill 默认样式 方法一 使用 -webkit-box-shadow 实现覆盖： 但是，该方式无法设置背景透明。 方法二 使用动画： 但是如果停留时间过久，也会有问题，但是目前好像没有更好的解决方法。 ",
      "content_html": "<p>浏览器自动填充密码会有一些默认样式：</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240914171559.png\" alt=\"autofill 默认样式\" tabindex=\"0\" loading=\"lazy\"><figcaption>autofill 默认样式</figcaption></figure>\n<h2>方法一</h2>\n<p>使用 <code>-webkit-box-shadow</code> 实现覆盖：</p>\n<div class=\"language-css\" data-ext=\"css\" data-title=\"css\"><pre class=\"language-css\"><code><span class=\"token selector\">input:-webkit-autofill, textarea:-webkit-autofill, select:-webkit-autofill</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">-webkit-box-shadow</span><span class=\"token punctuation\">:</span> 0 0 0 999px #fff inset<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>但是，该方式无法设置背景透明。</p>\n<h2>方法二</h2>\n<p>使用动画：</p>\n<div class=\"language-css\" data-ext=\"css\" data-title=\"css\"><pre class=\"language-css\"><code><span class=\"token selector\">input:-webkit-autofill, textarea:-webkit-autofill, select:-webkit-autofill</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">-webkit-text-fill-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--white-color-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> background-color 5000s ease-in-out 0s<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>但是如果停留时间过久，也会有问题，但是目前好像没有更好的解决方法。</p>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240914171559.png",
      "date_published": "2024-09-14T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "CSS"
      ]
    },
    {
      "title": "实现 loading spinner",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/basic/css/017-loading-spinner.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/basic/css/017-loading-spinner.html",
      "summary": "实现一个 loading spinner 可以使用 CSS 动画和边框。 ",
      "content_html": "<p>实现一个 loading spinner 可以使用 CSS 动画和边框。</p>\n\n",
      "date_published": "2024-09-14T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "CSS"
      ]
    },
    {
      "title": "iOS 图片兼容",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/020-ios-img.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/020-ios-img.html",
      "summary": "长按图片，弹出菜单 在 iOS 中，用户可以通过长按图片来弹出菜单，可以通过以下方式阻止。 长按图片，拖动 长按禁止拖动。 点击出现黑色阴影 ",
      "content_html": "<h2>长按图片，弹出菜单</h2>\n<p>在 iOS 中，用户可以通过长按图片来弹出菜单，可以通过以下方式阻止。</p>\n<div class=\"language-css\" data-ext=\"css\" data-title=\"css\"><pre class=\"language-css\"><code><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">-webkit-touch-callout</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>长按图片，拖动</h2>\n<p>长按禁止拖动。</p>\n<div class=\"language-css\" data-ext=\"css\" data-title=\"css\"><pre class=\"language-css\"><code><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">-webkit-user-drag</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">user-select</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>点击出现黑色阴影</h2>\n<div class=\"language-css\" data-ext=\"css\" data-title=\"css\"><pre class=\"language-css\"><code><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">-webkit-tap-highlight-color</span><span class=\"token punctuation\">:</span> transparent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>",
      "date_published": "2024-09-11T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "iOS 阻止 touch 事件默认行为",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/019-ios-prevent-touch.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/019-ios-prevent-touch.html",
      "summary": "webview 开发时，iOS 中 safari 浏览器通过 preventDefault 方法来阻止默认行为。 注意 在 iOS 上，需要增加 { passive: false } 参数，否则会导致 touch 事件的 preventDefault() 行为失效。 详细见：addEventListener#passive。 ",
      "content_html": "<p>webview 开发时，iOS 中 safari 浏览器通过 <code>preventDefault</code> 方法来阻止默认行为。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">const</span> usePreventTouchEvent <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HTMLElement</span> <span class=\"token operator\">=</span> HTMLDivElement<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">(</span>containerRef<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span>RefObject<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">&gt;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> preventDefaultBehavior <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> Event<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> touchEvents<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'touchmove'</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">const</span> dragContainer <span class=\"token operator\">=</span> containerRef<span class=\"token punctuation\">.</span>current\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dragContainer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      touchEvents<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>eventType<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        dragContainer<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> preventDefaultBehavior<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          passive<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        touchEvents<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>eventType<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          dragContainer<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> preventDefaultBehavior<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>containerRef<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> usePreventTouchEvent\n</code></pre></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>在 iOS 上，需要增加 <code>{ passive: false }</code> 参数，否则会导致 <code>touch</code> 事件的 <code>preventDefault()</code> 行为失效。</p>\n<p>详细见：<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#passive\" target=\"_blank\" rel=\"noopener noreferrer\">addEventListener#passive</a>。</p>\n</div>\n",
      "date_published": "2024-09-11T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "Maven",
      "url": "https://dribble-njr.github.io/blog/blog/backend/java/tool/01-maven.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/java/tool/01-maven.html",
      "summary": "什么是 Maven Maven 是一个项目管理和构建工具，主要用于 Java 项目。它通过 POM（Project Object Model）文件来管理项目的依赖、编译、测试和打包等任务。Maven 的核心功能包括： 依赖管理：通过定义 POM 文件中的依赖项，Maven 能够自动下载和配置项目所需的库。 构建自动化：Maven 可以自动化执行从编译、...",
      "content_html": "<h2>什么是 Maven</h2>\n<p>Maven 是一个项目管理和构建工具，主要用于 Java 项目。它通过 POM（Project Object Model）文件来管理项目的依赖、编译、测试和打包等任务。Maven 的核心功能包括：</p>\n<ul>\n<li>依赖管理：通过定义 POM 文件中的依赖项，Maven 能够自动下载和配置项目所需的库。</li>\n<li>构建自动化：Maven 可以自动化执行从编译、测试到打包的整个构建过程。</li>\n<li>项目结构标准化：Maven 提供了约定优于配置的项目结构，减少了开发者的配置工作。</li>\n</ul>\n<p>类似 npm，不同的是，npm 使用 <code>package.json</code>，而 Maven 使用 <code>pom.xml</code>。</p>\n<p><code>package.json</code> 通常包含以下内容：</p>\n<ul>\n<li>依赖管理：<code>dependencies</code> 和 <code>devDependencies</code> 字段用于列出项目在运行时和开发时所需的包。</li>\n<li>脚本管理：<code>scripts</code> 字段允许开发者定义各种命令，如 <code>npm start</code>、<code>npm test</code> 等，来自动化常见任务。</li>\n<li>项目元数据：如项目名称、版本、描述、作者等。</li>\n</ul>\n<p><code>pom.xml</code> 中包含下述内容：</p>\n<ul>\n<li>依赖管理：<code>dependencies</code> 节点列出项目所依赖的库及其版本。</li>\n<li>构建管理：<code>build</code> 节点定义了构建过程中的各种配置，包括插件的使用。</li>\n<li>项目元数据：如项目的 <code>groupId</code>、<code>artifactId</code>、<code>version</code> 等。</li>\n<li>生命周期管理：Maven 提供了一整套的生命周期管理机制，涵盖了项目的编译、测试、打包和部署等阶段。</li>\n</ul>\n<p>示例：</p>\n<div class=\"language-xml\" data-ext=\"xml\" data-title=\"xml\"><pre class=\"language-xml\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span>\n         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">&gt;</span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">&gt;</span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>com.example<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>my-project<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>1.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>3.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">&gt;</span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.apache.maven.plugins<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>maven-compiler-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>3.8.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span><span class=\"token punctuation\">&gt;</span></span>17<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>source</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span><span class=\"token punctuation\">&gt;</span></span>17<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><h2>依赖原则</h2>\n<ol>\n<li>依赖路径最短优先原则：</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>A -<span class=\"token operator\">&gt;</span> B -<span class=\"token operator\">&gt;</span> C -<span class=\"token operator\">&gt;</span> X<span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span>\nA -<span class=\"token operator\">&gt;</span> D -<span class=\"token operator\">&gt;</span> X<span class=\"token punctuation\">(</span><span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>由于 X(2.0) 路径最短，所以使用 X(2.0)。</p>\n<ol>\n<li>声明顺序优先原则：</li>\n</ol>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>A -<span class=\"token operator\">&gt;</span> B -<span class=\"token operator\">&gt;</span> X<span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span>\nA -<span class=\"token operator\">&gt;</span> C -<span class=\"token operator\">&gt;</span> X<span class=\"token punctuation\">(</span><span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>在 POM 中最先声明的优先，上面的两个依赖如果先声明 B，那么最后使用 X(1.0)。</p>\n<ol>\n<li>覆写优先原则：子 POM 内声明的依赖优先于父 POM 中声明的依赖。</li>\n</ol>\n",
      "date_published": "2024-08-30T00:00:00.000Z",
      "date_modified": "2026-01-15T15:42:45.000Z",
      "authors": [],
      "tags": [
        "node"
      ]
    },
    {
      "title": "finalhandler",
      "url": "https://dribble-njr.github.io/blog/blog/backend/node/module/001-finalhandler.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/node/module/001-finalhandler.html",
      "summary": "finalhandler 模块在 Express.js 中用于处理未处理的请求或错误，是请求处理的最后一个步骤。它确保了当请求经过所有中间件和路由后，如果没有响应或者发生了错误，应用仍然能够正确地处理这些情况，并返回适当的 HTTP 响应。 具体来说，finalhandler 模块实现了以下功能： 处理未匹配的路由 当请求经过所有中间件和路由后，fin...",
      "content_html": "<p><a href=\"https://github.com/pillarjs/finalhandler\" target=\"_blank\" rel=\"noopener noreferrer\">finalhandler</a> 模块在 Express.js 中用于处理未处理的请求或错误，是请求处理的最后一个步骤。它确保了当请求经过所有中间件和路由后，如果没有响应或者发生了错误，应用仍然能够正确地处理这些情况，并返回适当的 HTTP 响应。</p>\n<p>具体来说，<code>finalhandler</code> 模块实现了以下功能：</p>\n<h2>处理未匹配的路由</h2>\n<p>当请求经过所有中间件和路由后，<code>finalhandler</code> 会检查是否已经发送了响应。如果没有，则认为请求未被处理（即未匹配到任何路由），并返回一个 404 状态码（\"Not Found\"）。</p>\n<h2>处理未捕获的错误</h2>\n<p>如果请求处理过程中抛出了错误（无论是在中间件还是在路由处理程序中），而这些错误没有被处理，那么 <code>finalhandler</code> 会捕获到这些错误，并根据错误类型返回适当的 HTTP 状态码。常见的错误处理包括返回 500 状态码（\"Internal Server Error\"），以及输出错误信息（在开发环境中）。</p>\n<h2>处理不同的响应类型</h2>\n<p><code>finalhandler</code> 会根据请求的 Accept 头信息，决定返回纯文本错误信息还是返回 HTML 格式的错误页面。</p>\n<h2>日志记录</h2>\n<p>在处理错误时，finalhandler 可以记录错误日志，帮助开发者排查问题。</p>\n<p>简而言之，finalhandler 是 Express 应用的最后一道防线，确保所有请求都能得到适当的处理，即使发生了未预料的错误或未匹配的路由。</p>\n",
      "date_published": "2024-08-27T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "node"
      ]
    },
    {
      "title": "express.js",
      "url": "https://dribble-njr.github.io/blog/blog/backend/node/express/02-express.js.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/node/express/02-express.js.html",
      "summary": "express.js 文件定义了 Express 应用的主入口。它的核心功能是创建一个新的 Express 应用实例，并暴露相关的原型和构造函数，使应用能够处理 HTTP 请求并管理中间件（middleware）。 Hello World 先看看官网的 Hello World： 思考一下，express() app.get() 和 app.listen...",
      "content_html": "<p><code>express.js</code> 文件定义了 Express 应用的主入口。它的核心功能是创建一个新的 Express 应用实例，并暴露相关的原型和构造函数，使应用能够处理 HTTP 请求并管理中间件（<code>middleware</code>）。</p>\n<h2>Hello World</h2>\n<p>先看看官网的 Hello World：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>思考一下，<code>express()</code> <code>app.get()</code> 和 <code>app.listen()</code> 分别做了什么？</p>\n<p>接下来一步步看源码，就能看出它们的作用。</p>\n<h2>模块依赖</h2>\n<p>引入了一些依赖模块：</p>\n<ul>\n<li><code>bodyParser</code>: 用于解析请求体（body）。</li>\n<li><code>EventEmitter</code>: Node.js 的事件模块，使 <code>app</code> 具有事件处理能力。</li>\n<li><a href=\"https://www.npmjs.com/package/merge-descriptors\" target=\"_blank\" rel=\"noopener noreferrer\"><code>merge-descriptors</code></a>: 一个合并对象属性的模块，用于将多个对象的属性混入到一个对象中。</li>\n<li><code>proto</code>: 从 <strong></strong> 引入的核心应用逻辑。</li>\n<li><code>Route</code> 和 <code>Router</code>: 处理路由的模块。</li>\n<li><code>req</code> 和 <code>res</code>: 扩展了 <code>request</code> 和 <code>response</code> 对象。</li>\n</ul>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> bodyParser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body-parser'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> EventEmitter <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'events'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>EventEmitter\n<span class=\"token keyword\">var</span> mixin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'merge-descriptors'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> proto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./application'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> Route <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./router/route'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> Router <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./router'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> req <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./request'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./response'</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2><code>createApplication()</code></h2>\n<p>暴露了一个 <code>createApplication()</code> 函数，用于创建一个新的 Express 应用。</p>\n<p>该函数主要创建了一个应用程序对象，该 <code>app</code> 对象首先混入了 <code>EventEmitter</code> 和 <code>proto</code>（<strong>application.js</strong> 导出的对象），并分别将 <code>request</code> 属性和 <code>response</code> 属性初始化成了 <code>req</code>（<strong>request.js</strong> 导出的对象）实例和 <code>res</code>（<strong>response.js</strong> 导出的对象）实例。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>exports <span class=\"token operator\">=</span> module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> createApplication\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">createApplication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">app</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">mixin</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventEmitter</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">mixin</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> proto<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// expose the prototype that will get set on requests</span>\n  app<span class=\"token punctuation\">.</span>request <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">app</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">configurable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">enumerable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">writable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> app <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// expose the prototype that will get set on responses</span>\n  app<span class=\"token punctuation\">.</span>response <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">app</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">configurable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">enumerable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">writable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> app <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> app\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>具体功能如下：</p>\n<ul>\n<li><code>app</code> 函数: 这是一个处理请求的函数，当请求到达时，<code>app.handle(req, res, next)</code> 会被调用来处理请求。</li>\n<li><code>mixin(app, EventEmitter.prototype, false)</code>: 将 <code>EventEmitter</code> 的原型方法混入 <code>app</code>，使得 <code>app</code> 具备事件处理能力，<code>false</code> 代表不覆盖原对象属性。</li>\n<li><code>mixin(app, proto, false)</code>: 将 <code>application.js</code> 中定义的核心功能混入 <code>app</code>。</li>\n<li><code>app.request</code> 和 <code>app.response</code>: 创建 <code>req</code> 和 <code>res</code> 的原型对象，并绑定 <code>app</code>。</li>\n<li><code>app.init()</code>: 初始化应用。</li>\n</ul>\n<p>调用下述代码时，实际上就相当于调用了 <code>createApplication()</code> 函数，返回一个新的 <code>app</code> 函数，它使用了  增强了一些功能（<code>proto</code> 为 <code>application.js</code> 暴露的对象），该原型提供了初始化 <code>init</code> 方法。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p><code>listen</code> 函数实际做了如下功能：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>app<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">listen</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>注意到他这里直接将 <code>app</code> 传入了 <code>http.createServer</code> 函数，该函数的签名为：<code>http.createServer([options][, requestListener])</code>，<code>requestListener</code> 函数的签名为 <code>(request, response) =&gt; void</code>。而在 <code>express.js</code> 中，<code>createApplication()</code> 中就已经声明 <code>app</code> 是 <code>requestListener</code> 类型的。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">app</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  app<span class=\"token punctuation\">.</span><span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>到这里为止，我们其实已经弄清楚了 Hello World 内部的实现。</p>\n<h2>暴露的接口</h2>\n<p>暴露的接口如下：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// 原型</span>\nexports<span class=\"token punctuation\">.</span>application <span class=\"token operator\">=</span> proto\nexports<span class=\"token punctuation\">.</span>request <span class=\"token operator\">=</span> req\nexports<span class=\"token punctuation\">.</span>response <span class=\"token operator\">=</span> res\n\n<span class=\"token comment\">// 路由构造函数</span>\nexports<span class=\"token punctuation\">.</span>Route <span class=\"token operator\">=</span> Route\nexports<span class=\"token punctuation\">.</span>Router <span class=\"token operator\">=</span> Router\n\n<span class=\"token comment\">// 中间件</span>\nexports<span class=\"token punctuation\">.</span>json <span class=\"token operator\">=</span> bodyParser<span class=\"token punctuation\">.</span>json\nexports<span class=\"token punctuation\">.</span>query <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./middleware/query'</span><span class=\"token punctuation\">)</span>\nexports<span class=\"token punctuation\">.</span>raw <span class=\"token operator\">=</span> bodyParser<span class=\"token punctuation\">.</span>raw\nexports<span class=\"token punctuation\">.</span>static <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serve-static'</span><span class=\"token punctuation\">)</span>\nexports<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> bodyParser<span class=\"token punctuation\">.</span>text\nexports<span class=\"token punctuation\">.</span>urlencoded <span class=\"token operator\">=</span> bodyParser<span class=\"token punctuation\">.</span>urlencoded\n</code></pre></div><ul>\n<li><code>application</code>, <code>request</code>, <code>response</code>: 分别暴露了应用的原型和请求、响应对象的原型，供外部使用或扩展。</li>\n<li><code>Route</code>, <code>Router</code>: 暴露了路由相关的构造函数。</li>\n<li><code>json</code>, <code>query</code>, <code>raw</code>, <code>static</code>, <code>text</code>, <code>urlencoded</code>: 这些是常用的 middleware，用于处理请求的各种内容。</li>\n</ul>\n<h2>移除的中间件</h2>\n<p>Express 在较新的版本中移除了许多默认包含的中间件，用户需要手动安装这些中间件。如果用户尝试访问这些被移除的中间件，会抛出错误提示，并引导用户去手动安装。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> removedMiddlewares <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'bodyParser'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'compress'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'cookieSession'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'session'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'logger'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'cookieParser'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'favicon'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'responseTime'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'errorHandler'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'timeout'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'methodOverride'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'vhost'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'csrf'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'directory'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'limit'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'multipart'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'staticCache'</span>\n<span class=\"token punctuation\">]</span>\n\nremovedMiddlewares<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>exports<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">get</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'Most middleware (like '</span> <span class=\"token operator\">+</span>\n          name <span class=\"token operator\">+</span>\n          <span class=\"token string\">') is no longer bundled with Express and must be installed separately. Please see https://github.com/senchalabs/connect#middleware.'</span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">configurable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>总结</h2>\n<p><strong>express.js</strong> 文件的核心功能是创建并返回一个 Express 应用实例，并提供了一些内置的中间件和路由工具。移除的中间件部分提醒开发者需要手动安装以前版本中内置的中间件。</p>\n",
      "date_published": "2024-08-23T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "node"
      ]
    },
    {
      "title": "总体架构",
      "url": "https://dribble-njr.github.io/blog/blog/backend/node/express/01-overview-architecture.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/node/express/01-overview-architecture.html",
      "summary": "Express 是适用于 Node.js 的极简网络应用程序框架。它为构建网络和移动应用程序提供了一套强大的功能。尽管简单，Express 却具有很强的可扩展性，允许开发人员添加中间件并自定义应用程序的行为。 注意 在代码解读中，贴上的源码有可能改为 TS 类型，在阅读源码时请注意。 核心组件 包括 Application、Request、Respon...",
      "content_html": "<p><a href=\"https://github.com/expressjs/express\" target=\"_blank\" rel=\"noopener noreferrer\">Express</a> 是适用于 Node.js 的极简网络应用程序框架。它为构建网络和移动应用程序提供了一套强大的功能。尽管简单，Express 却具有很强的可扩展性，允许开发人员添加中间件并自定义应用程序的行为。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>在代码解读中，贴上的源码有可能改为 TS 类型，在阅读源码时请注意。</p>\n</div>\n<h2>核心组件</h2>\n<p>包括 <code>Application</code>、<code>Request</code>、<code>Response</code> 和 <code>Router</code>：</p>\n<ul>\n<li><code>Application</code>：应用程序对象，由 <code>express()</code> 创建，它代表一个 Express 应用程序，用于通过设置中间件、路由和错误处理程序来配置应用程序。</li>\n<li><code>Request</code>： HTTP 请求实例，该对象封装了传入请求的所有信息，如 <code>header</code>、<code>query parameters</code>、<code>URL</code>、<code>body</code> 等。</li>\n<li><code>Response</code>：HTTP 响应实例，该对象用于向客户端发回数据、设置响应 <code>header</code>、<code>cookie</code>、状态代码等。</li>\n<li><code>Router</code>: 路由器对象，由 <code>express.Router()</code> 创建，一个小型 <code>Application</code>，可拥有自己的路由和中间件。它有助于将应用组织成更小的、模块化的部分。</li>\n</ul>\n<h2>Middleware</h2>\n<p>可以访问请求（<code>req</code>）、响应（<code>res</code>）以及应用程序请求-响应循环中下一个中间件函数的函数。中间件可以执行任何代码、修改请求和响应对象、结束请求-响应循环或调用下一个中间件函数。</p>\n<p>在 Express 中，有不同类型的中间件：</p>\n<ul>\n<li>应用程序级中间件：与 <code>Express</code> 应用程序实例绑定。</li>\n<li>路由器级中间件：与 <code>express.Router()</code> 实例绑定。</li>\n<li>错误处理中间件：能捕捉错误并进行处理的特殊中间件。</li>\n</ul>\n<p>中间件按照应用程序中定义的顺序执行。 如果中间件函数没有结束请求-响应循环（调用 <code>res.end()</code>），则必须调用 <code>next()</code> 将控制权传递给下一个中间件函数。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>Most middleware (like ' + name + ') is no longer bundled with Express and must be installed separately. Please see <a href=\"https://github.com/senchalabs/connect#middleware\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/senchalabs/connect#middleware</a>.</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> removedMiddlewares <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'bodyParser'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'compress'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'cookieSession'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'session'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'logger'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'cookieParser'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'favicon'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'responseTime'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'errorHandler'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'timeout'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'methodOverride'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'vhost'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'csrf'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'directory'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'limit'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'multipart'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'staticCache'</span>\n<span class=\"token punctuation\">]</span>\n</code></pre></div></div>\n<h2>Routing</h2>\n<p>路由定义了应用程序响应客户端请求的端点（URI）。每个路由可以有多个处理程序，并支持所有 HTTP 方法（GET、POST、PUT、DELETE 等）。</p>\n<p>支持自动解析 <code>query parameters</code> 和 <code>URL</code> 中的 <code>:param</code> 值。</p>\n<p>简单理解为分发请求并进行相应处理。</p>\n<h2>lib 源码结构</h2>\n<p>Express@4.21.0 中，<code>lib</code> 目录结构如下：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>lib/\n├── application.js\n├── express.js\n├── middleware/\n│   ├── init.js\n│   ├── query.js\n├── request.js\n├── response.js\n├── router/\n│   ├── index.js\n│   ├── layer.js\n│   ├── route.js\n├── utils.js\n└── view.js\n</code></pre></div><ul>\n<li><code>express.js</code>: 主入口文件，导出了核心的 <code>express()</code> 函数。</li>\n<li><code>application.js</code>: 定义了 Express 应用的核心功能，如 <code>app.use()</code>、<code>app.get()</code> 等方法。</li>\n<li><code>middleware/</code>: 包含 Express 内置的 <code>middleware</code>，例如 <code>init.js</code> 用于初始化中间件，<code>query.js</code> 用于解析查询字符串。</li>\n<li><code>request.js</code>: 定义了 <code>req</code> 对象的扩展和辅助方法。</li>\n<li><code>response.js</code>: 定义了 <code>res</code> 对象的扩展和辅助方法。</li>\n<li><code>router/</code>: 包含与路由相关的代码，其中 <code>index.js</code> 是路由器的主模块，<code>layer.js</code> 和 <code>route.js</code> 用于处理路由层次和路径匹配。</li>\n<li><code>utils.js</code>: 一些工具函数，用于简化内部实现。</li>\n<li><code>view.js</code>: 处理视图渲染相关的逻辑。</li>\n</ul>\n<p>接下来会对每个文件进行详细分析。</p>\n",
      "date_published": "2024-08-20T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "node"
      ]
    },
    {
      "title": "monaco-editor/react",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/018-monaco-editor-react.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/018-monaco-editor-react.html",
      "summary": "Monaco Editor 是由微软开发的开源代码编辑器，使用于 VS Code。然而他本身是用 JavaScript/TypeScript 编写的一个独立库，提供了丰富的 API 来实现代码编辑器的功能。因此无法直接在 React 中使用。 @monaco-editor/react 这个库是对 monaco-editor 的 React 封装，使得你...",
      "content_html": "<p><a href=\"https://github.com/microsoft/monaco-editor\" target=\"_blank\" rel=\"noopener noreferrer\">Monaco Editor</a> 是由微软开发的开源代码编辑器，使用于 VS Code。然而他本身是用 JavaScript/TypeScript 编写的一个独立库，提供了丰富的 API 来实现代码编辑器的功能。因此无法直接在 React 中使用。</p>\n<p><a href=\"https://github.com/suren-atoyan/monaco-react\" target=\"_blank\" rel=\"noopener noreferrer\">@monaco-editor/react</a> 这个库是对 monaco-editor 的 React 封装，使得你在 React 项目中更方便地使用 Monaco Editor。</p>\n<h2>工作原理</h2>\n<p>Monaco Editor (<code>monaco-editor</code>)：提供了编辑器的核心功能，包括代码高亮、自动补全、语法检查等。它是独立于框架的，可以在任何 JavaScript 环境中使用。它提供了一个全局的 monaco 对象，通过这个对象，你可以调用各种 API 来配置和操作编辑器。</p>\n<p>React 封装 (<code>@monaco-editor/react</code>)： 为了更好地在 React 环境中使用 Monaco Editor，<code>@monaco-editor/react</code> 通过封装组件的方式，将 <code>monaco-editor</code> 的 API 暴露给 React 用户。这个库管理了编辑器的生命周期和状态，使得 Monaco Editor 能够很好地与 React 的组件生命周期和状态管理系统配合使用。</p>\n<p>具体来说，<code>@monaco-editor/react</code> 主要做了以下几件事情：</p>\n<ul>\n<li>组件化封装：提供了一个 <code>Editor</code> 组件，供 React 开发者使用。你可以通过 JSX 的方式直接在 React 组件中嵌入 Monaco Editor。</li>\n<li>API 接口简化：提供了一些简单的 props 来配置编辑器，而不需要直接调用 <code>monaco</code> 对象。</li>\n<li>生命周期管理：处理了编辑器的创建、更新和销毁，使得它与 React 的生命周期方法（如 <code>componentDidMount</code>、<code>componentWillUnmount</code>）配合良好。</li>\n</ul>\n<h2>示例</h2>\n<p>在 React 中使用 <code>@monaco-editor/react</code> 时，你不需要手动管理 monaco 对象的创建和销毁，只需要通过 <code>Editor</code> 组件来设置语言、主题、默认代码等配置项。比如：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> Editor <span class=\"token keyword\">from</span> <span class=\"token string\">'@monaco-editor/react'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Editor</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>90vh<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">theme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vs-dark<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>// Start coding here<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyEditor\n</code></pre></div><p>如果你需要进行更复杂的定制化操作，比如加载自定义语言或主题，<code>@monaco-editor/react</code> 也提供了 <code>beforeMount</code> 和 <code>onMount</code> 回调函数，让你可以直接访问 <code>monaco</code> 对象来进行高级配置：</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Editor</span></span>\n  <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>90vh<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>javascript<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">theme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>vs-dark<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">beforeMount</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span>monaco<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 这里可以对 monaco 进行配置，例如定义自定义的语言或主题</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">onMount</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span>editor<span class=\"token punctuation\">,</span> monaco<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 这里可以操作 editor 和 monaco 对象，例如注册快捷键等</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">/&gt;</span></span>\n</code></pre></div><h2>loader-config</h2>\n<p><code>@monaco-editor/react</code> 的 loader 会默认从 cdn 中加载，这会影响中国用户的访问速度，因此需要修改 loader 的默认配置。</p>\n<h3>使用 monaco-editor 包</h3>\n<p>如果项目使用 <code>webpack</code> 进行打包，可以通过 <a href=\"https://www.npmjs.com/package/monaco-editor-webpack-plugin\" target=\"_blank\" rel=\"noopener noreferrer\">monaco-editor-webpack-plugin</a> 来进行配置。该插件自动处理编辑器了相关的文件。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> monaco <span class=\"token keyword\">from</span> <span class=\"token string\">'monaco-editor'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> loader <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@monaco-editor/react'</span>\n\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> monaco <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>对于其他打包工具，官方提供了 Vite 示例：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> loader <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@monaco-editor/react'</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> monaco <span class=\"token keyword\">from</span> <span class=\"token string\">'monaco-editor'</span>\n<span class=\"token keyword\">import</span> editorWorker <span class=\"token keyword\">from</span> <span class=\"token string\">'monaco-editor/esm/vs/editor/editor.worker?worker'</span>\n<span class=\"token keyword\">import</span> jsonWorker <span class=\"token keyword\">from</span> <span class=\"token string\">'monaco-editor/esm/vs/language/json/json.worker?worker'</span>\n<span class=\"token keyword\">import</span> cssWorker <span class=\"token keyword\">from</span> <span class=\"token string\">'monaco-editor/esm/vs/language/css/css.worker?worker'</span>\n<span class=\"token keyword\">import</span> htmlWorker <span class=\"token keyword\">from</span> <span class=\"token string\">'monaco-editor/esm/vs/language/html/html.worker?worker'</span>\n<span class=\"token keyword\">import</span> tsWorker <span class=\"token keyword\">from</span> <span class=\"token string\">'monaco-editor/esm/vs/language/typescript/ts.worker?worker'</span>\n\nself<span class=\"token punctuation\">.</span>MonacoEnvironment <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">getWorker</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> label</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>label <span class=\"token operator\">===</span> <span class=\"token string\">'json'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">jsonWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>label <span class=\"token operator\">===</span> <span class=\"token string\">'css'</span> <span class=\"token operator\">||</span> label <span class=\"token operator\">===</span> <span class=\"token string\">'scss'</span> <span class=\"token operator\">||</span> label <span class=\"token operator\">===</span> <span class=\"token string\">'less'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cssWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>label <span class=\"token operator\">===</span> <span class=\"token string\">'html'</span> <span class=\"token operator\">||</span> label <span class=\"token operator\">===</span> <span class=\"token string\">'handlebars'</span> <span class=\"token operator\">||</span> label <span class=\"token operator\">===</span> <span class=\"token string\">'razor'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">htmlWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>label <span class=\"token operator\">===</span> <span class=\"token string\">'typescript'</span> <span class=\"token operator\">||</span> label <span class=\"token operator\">===</span> <span class=\"token string\">'javascript'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">tsWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">editorWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> monaco <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* ... */</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>我使用了 Rspack 来打包，官方说明对 <code>monaco-editor-webpack-plugin</code> 插件进行了兼容，但是不知道是由于我 Rspack 版本问题，导致报错，因此实验了一种更加稳定的方式如下。</p>\n<p>Rspack 配置与 Vite 一致，详细见 <a href=\"https://github.com/rspack-contrib/rspack-examples/blob/main/rspack/monaco-editor-ts-react/src/components/Editor.tsx\" target=\"_blank\" rel=\"noopener noreferrer\">Rspack demo monaco-editor-react</a>。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>需要注意的是 <code>publicPath</code> 需要设置为 <code>'auto'</code>，否则 web worker 内引用的文件会添加重复路径。</p>\n<p>See <a href=\"https://rspack.dev/config/output#outputpublicpath\" target=\"_blank\" rel=\"noopener noreferrer\">Rspack output.publicPath</a>。</p>\n</div>\n<h3><s>本地路径</s></h3>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>该方式会在 public 中引入大量文件，不太优雅。</p>\n</div>\n<p><code>monaco-editor</code> 中提供了一些打包后的文件，路径是 <code>monaco-editor/min/vs</code>，因此可以通过下载 npm 包并将文件移动至 <code>public</code> 文件夹，并自定义路径。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">mv</span> node_modules/monaco-editor/min/vs public\n</code></pre></div><div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> loader <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@monaco-editor/react'</span>\n\n<span class=\"token comment\">// you can change the source of the monaco files</span>\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">paths</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">vs</span><span class=\"token operator\">:</span> <span class=\"token string\">'./vs'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// you can configure the locales</span>\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'vs/nls'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">availableLanguages</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'*'</span><span class=\"token operator\">:</span> <span class=\"token string\">'de'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// or</span>\nloader<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">paths</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">vs</span><span class=\"token operator\">:</span> <span class=\"token string\">'./vs'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">'vs/nls'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">availableLanguages</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'*'</span><span class=\"token operator\">:</span> <span class=\"token string\">'de'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>",
      "date_published": "2024-08-09T00:00:00.000Z",
      "date_modified": "2024-12-03T06:25:23.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "场景图像",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/04-scene-graph.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/04-scene-graph.html",
      "summary": "每一帧，PixiJS 都会更新并渲染场景图。让我们来谈谈场景图中有哪些内容，以及它如何影响项目开发。 场景图是一棵树 场景图的根节点是由应用程序维护的容器，用 app.stage 引用。将 sprite 或其他可渲染对象作为子对象添加到 stage 时，它就会被添加到场景图中，并进行渲染和交互。 PixiJS 容器也可以有子对象，因此当你构建更复杂的场...",
      "content_html": "<p>每一帧，PixiJS 都会更新并渲染场景图。让我们来谈谈场景图中有哪些内容，以及它如何影响项目开发。</p>\n<h2>场景图是一棵树</h2>\n<p>场景图的根节点是由应用程序维护的容器，用 <code>app.stage</code> 引用。将 sprite 或其他可渲染对象作为子对象添加到 stage 时，它就会被添加到场景图中，并进行渲染和交互。</p>\n<p>PixiJS 容器也可以有子对象，因此当你构建更复杂的场景时，最终会形成一棵父子关系树，stage 是整个场景树的根节点。Chrome 浏览器的 <a href=\"https://chromewebstore.google.com/detail/pixijs-devtools/aamddddknhcagpehecnhphigffljadon\" target=\"_blank\" rel=\"noopener noreferrer\">Pixi.js devtools</a> 插件是一个探索项目的有用工具，它允许你在项目运行时实时查看和操作场景图！）。</p>\n<h2>Parents and Children</h2>\n<p>父节点移动时，其子节点也会移动。旋转父节点时，其子节点也会旋转。隐藏父对象，子对象也会被隐藏。如果一个游戏对象由多个精灵组成，可以将它们收集到一个容器中，将它们视为世界中的一个对象，作为一个整体移动和旋转。</p>\n<p>在每一帧中，PixiJS 都会运行场景图，从根开始向下穿过所有子对象，直到叶子，以计算每个对象的最终位置、旋转、可见性、透明度等。</p>\n<p>如果父对象的 alpha 设置为 0.5（使其透明 50% ），那么它的所有子对象也将从 50% 开始透明。如果将一个子对象的 alpha 设置为 0.5，它就不会是 50% 透明，而是 0.5 x 0.5 = 0.25 alpha，即 75% 透明。同样，对象的位置是相对于父对象而言的，因此如果父对象的 x 位置设置为 50 像素，而子对象的 x 位置设置为 100 像素，那么它将在屏幕偏移 150 像素处绘制，即 50 + 100。</p>\n<p>下面是一个示例。我们将创建三个精灵，每个都是上一个精灵的子精灵，并对它们的位置、旋转、缩放和 alpha 进行动画处理。尽管每个精灵的属性都设置为相同的值，但父子链会放大每个变化：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// Create the application helper and add its render target to the page</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">360</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Add a container to center our sprite stack on the page</span>\n<span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Container</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span>app<span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span>width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span>app<span class=\"token punctuation\">.</span>screen<span class=\"token punctuation\">.</span>height <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// load the texture</span>\n<span class=\"token keyword\">await</span> Assets<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token string\">'assets/images/sample.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create the 3 sprites, each a child of the last</span>\n<span class=\"token keyword\">const</span> sprites <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> parent <span class=\"token operator\">=</span> container<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> wrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Container</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> sprite <span class=\"token operator\">=</span> Sprite<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'assets/images/sample.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sprite<span class=\"token punctuation\">.</span>anchor<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>sprite<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  parent<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sprites<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  parent <span class=\"token operator\">=</span> wrapper<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Set all sprite's properties to the same value, animated over time</span>\n<span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span>ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">delta</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  elapsed <span class=\"token operator\">+=</span> delta<span class=\"token punctuation\">.</span>deltaTime <span class=\"token operator\">/</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> amount <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>elapsed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> scale <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.25</span> <span class=\"token operator\">*</span> amount<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> alpha <span class=\"token operator\">=</span> <span class=\"token number\">0.75</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.25</span> <span class=\"token operator\">*</span> amount<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> angle <span class=\"token operator\">=</span> <span class=\"token number\">40</span> <span class=\"token operator\">*</span> amount<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token number\">75</span> <span class=\"token operator\">*</span> amount<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> sprites<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> sprite <span class=\"token operator\">=</span> sprites<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    sprite<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>scale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    sprite<span class=\"token punctuation\">.</span>alpha <span class=\"token operator\">=</span> alpha<span class=\"token punctuation\">;</span>\n    sprite<span class=\"token punctuation\">.</span>angle <span class=\"token operator\">=</span> angle<span class=\"token punctuation\">;</span>\n    sprite<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><p>场景图中任何给定节点的累计平移、旋转、缩放和倾斜值都存储在对象的 <code>worldTransform</code> 属性中。 同样，累积的 alpha 值也存储在 <code>worldAlpha</code> 属性中。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/Aug-08-2024 11-58-35.gif\" alt=\"sample\" tabindex=\"0\" loading=\"lazy\"><figcaption>sample</figcaption></figure>\n<h2>渲染顺序</h2>\n<p>因此，我们有一个树需要渲染，那么渲染顺序是什么？</p>\n<p>PixiJS 会从树根开始向下渲染。在每一级，先渲染当前对象，然后按插入顺序渲染每个子对象。请看下面的示例：两个父对象 A 和 D，以及 A 下的两个子对象 B 和 C：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// Create the application helper and add its render target to the page</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">360</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Label showing scene graph hierarchy</span>\n<span class=\"token keyword\">const</span> label <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">'Scene Graph:\\n\\napp.stage\\n  ┗ A\\n     ┗ B\\n     ┗ C\\n  ┗ D'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">fill</span><span class=\"token operator\">:</span> <span class=\"token string\">'#ffffff'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>label<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Helper function to create a block of color with a letter</span>\n<span class=\"token keyword\">const</span> letters <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">addLetter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">letter<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">,</span> color<span class=\"token punctuation\">,</span> pos</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> bg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sprite</span><span class=\"token punctuation\">(</span>Texture<span class=\"token punctuation\">.</span><span class=\"token constant\">WHITE</span><span class=\"token punctuation\">)</span>\n  bg<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n  bg<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n  bg<span class=\"token punctuation\">.</span>tint <span class=\"token operator\">=</span> color\n\n  <span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> letter<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">fill</span><span class=\"token operator\">:</span> <span class=\"token string\">'#ffffff'</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  text<span class=\"token punctuation\">.</span>anchor<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n  text<span class=\"token punctuation\">.</span>position <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">50</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Container</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  container<span class=\"token punctuation\">.</span>position <span class=\"token operator\">=</span> pos\n  container<span class=\"token punctuation\">.</span>visible <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n  container<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>bg<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span>\n  parent<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n\n  letters<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> container\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Define 4 letters</span>\n<span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token function\">addLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'A'</span><span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">,</span> <span class=\"token number\">0xff0000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> <span class=\"token function\">addLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'B'</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> <span class=\"token number\">0x00ff00</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> <span class=\"token function\">addLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'C'</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> <span class=\"token number\">0x0000ff</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">40</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> d <span class=\"token operator\">=</span> <span class=\"token function\">addLetter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'D'</span><span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">,</span> <span class=\"token number\">0xff8800</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> <span class=\"token number\">140</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Display them over time, in order</span>\n<span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\napp<span class=\"token punctuation\">.</span>ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ticker</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  elapsed <span class=\"token operator\">+=</span> ticker<span class=\"token punctuation\">.</span>deltaTime <span class=\"token operator\">/</span> <span class=\"token number\">60.0</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>elapsed <span class=\"token operator\">&gt;=</span> letters<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> letters<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    letters<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>visible <span class=\"token operator\">=</span> elapsed <span class=\"token operator\">&gt;=</span> i\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/Aug-08-2024 16-23-14.gif\" alt=\"render order\" tabindex=\"0\" loading=\"lazy\"><figcaption>render order</figcaption></figure>\n<p>如果想对子对象重新排序，可以使用 <code>setChildIndex()</code>。 要在父对象列表的给定位置添加子对象，可以使用 <code>addChildAt()</code>。 最后，您可以使用 <code>sortableChildren</code> 选项，结合设置每个子对象的 <code>zIndex</code> 属性，对对象的子对象进行自动排序。</p>\n<h2>渲染组</h2>\n<p>当你深入研究 PixiJS 时，你会遇到一个强大的功能，即渲染组。 将渲染组视为场景图中的专门容器，其本身就像迷你场景图。 以下是在项目中有效使用渲染组的必要知识。 更多信息，请查看 <a href=\"https://pixijs.com/8.x/guides/advanced/render-groups\" target=\"_blank\" rel=\"noopener noreferrer\">渲染组概述</a>。</p>\n<h2>剔除</h2>\n<p>如果您正在构建的项目中，大部分场景对象都不在屏幕上（例如，一个横版游戏），那么您就需要对这些对象进行剔除。</p>\n<p>剔除是一个评估对象（或其子代！）是否在屏幕上的过程，如果不在屏幕上，则关闭对其的渲染。</p>\n<p>如果不对屏幕外的对象进行剔除，即使它们的像素最终都不在屏幕上，渲染器仍会绘制它们。</p>\n<p>PixiJS 并不提供视口剔除的内置支持，但你可以找到第三方插件来满足你的需求。另外，如果你想建立自己的剔除系统，只需在每个 tick 期间运行对象，并将任何不需要绘制的对象的 <code>renderable</code> 设置为 false 即可。</p>\n<h2>局部坐标 vs 全局坐标</h2>\n<p>如果在舞台上添加一个精灵，默认情况下它会显示在屏幕的左上角。这是 PixiJS 使用的全局坐标空间的原点。</p>\n<p>如果你的所有对象都是舞台的子对象，那么你只需要担心这个坐标。但是一旦引入容器和子对象，事情就变得复杂了。</p>\n<p>位于 [50, 100] 处的子对象距离父对象向右 50 像素，向下 100 像素。我们称这两个坐标系为「全局坐标」和「局部坐标」。当你在一个对象上使用 <code>position.set(x, y)</code> 时，你总是在局部坐标系下工作，相对于对象的父对象。</p>\n<p>问题是，很多时候你都想知道某个对象的全局位置。例如，如果您想剔除屏幕外的对象以节省渲染时间，您需要知道给定的子对象是否在视图矩形之外。</p>\n<p>要将本地坐标转换为全局坐标，您需要使用 <code>toGlobal()</code> 函数。下面是一个使用示例：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// Get the global position of an object, relative to the top-left of the screen</span>\n<span class=\"token keyword\">let</span> globalPos <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span><span class=\"token function\">toGlobal</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>这段代码会将 <code>globalPos</code> 设置为子对象的全局坐标，相对于全局坐标系中的 [0, 0]。</p>\n<h2>全局坐标 vs 屏幕坐标</h2>\n<p>当您的项目与主机操作系统或浏览器协同工作时，还有第三个坐标系——「屏幕坐标」（又称「视口坐标」）会发挥作用。屏幕坐标表示相对于 PixiJS 正在呈现的画布元素左上角的位置。DOM 和本地鼠标点击事件等都在屏幕空间中工作。</p>\n<p>现在，在很多情况下，屏幕空间等同于世界空间。如果画布的大小与创建应用程序时指定的呈现视图大小相同，就属于这种情况。 默认情况下就是这样——例如，您将创建一个 800x600 的应用程序窗口并将其添加到 HTML 页面，它就会保持这个大小。世界坐标中的 100 像素等于屏幕空间中的 100 像素。</p>\n<p>但是！常见的情况是拉伸呈现视图，使其充满整个屏幕，或者以较低分辨率呈现，然后放大以提高速度。在这种情况下，画布元素的屏幕尺寸会发生变化（例如通过 CSS），但底层呈现视图不会，从而导致世界坐标和屏幕坐标不匹配。</p>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/Aug-08-2024%2011-58-35.gif",
      "date_published": "2024-08-08T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "Pixi"
      ]
    },
    {
      "title": "渲染循环",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/03-render-loop.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/03-render-loop.html",
      "summary": "现在您已经了解了系统的主要部分，让我们来看看这些部分是如何协同工作，将您的项目呈现在屏幕上的。 与网页不同的是，PixiJS 会不断更新和重新绘制，一遍又一遍。 你更新对象，然后 PixiJS 将它们渲染到屏幕上，然后重复这个过程。 我们称这个循环为渲染循环。 任何 PixiJS 项目最主要的部分包含更新 + 渲染循环，编写更新，PixiJS 会处理整...",
      "content_html": "<p>现在您已经了解了系统的主要部分，让我们来看看这些部分是如何协同工作，将您的项目呈现在屏幕上的。 与网页不同的是，PixiJS 会不断更新和重新绘制，一遍又一遍。 你更新对象，然后 PixiJS 将它们渲染到屏幕上，然后重复这个过程。 我们称这个循环为渲染循环。</p>\n<p>任何 PixiJS 项目最主要的部分包含更新 + 渲染循环，编写更新，PixiJS 会处理整个渲染。</p>\n<p>发生在渲染循环中的每一帧主要包含三个部分。</p>\n<h2>运行 Ticker 回调</h2>\n<p>第一步是计算从上一帧开始已经过去了多长时间，然后根据时间差调用应用程序对象的 ticker 回调。 这样，项目代码就可以制作动画并更新舞台上的精灵等，为渲染做好准备。</p>\n<h2>更新场景图像</h2>\n<p>场景图包含您正在绘制的事物（精灵、文本等），并且这些对象处于树状层次结构中。这些对象处于树状层次结构中。 通过移动、旋转等方式更新游戏对象后，PixiJS 需要计算场景中每个对象的新位置和状态，然后才能开始绘制。</p>\n<h2>渲染场景图像</h2>\n<p>现在我们的游戏状态已经更新，是时候将其绘制到屏幕上了。渲染系统会从场景图的根节点（app.stage）开始，渲染每个对象及其子节点，直到绘制完所有对象。 在此过程中不会进行剔除或其他巧妙的处理。如果在舞台的可见部分之外有大量对象，则需要将其禁用作为一种优化方法（视椎体剔除）。</p>\n<h2>帧频</h2>\n<p>渲染循环不可能无限快地运行--在屏幕上绘制图像需要时间。此外，每次屏幕更新（通常为 60fps，但较新的显示器可支持 144fps 或更高）时，帧的更新次数一般不会超过一次。最后，PixiJS 是在 Chrome 或 Firefox 等网络浏览器的环境中运行的。浏览器本身必须平衡各种内部操作的需要和为任何打开的标签页提供服务的需要。综上所述，确定何时绘制帧是一个复杂的问题。</p>\n<p>如果您想调整该行为，可以在 Ticker 上设置 <code>minFPS</code> 和 <code>maxFPS</code> 属性。请注意，由于环境复杂，项目无法保证给定的 FPS。 在 ticker 回调中使用传递的 <code>ticker.deltaTime</code> 值来缩放任何动画，以确保流畅播放。</p>\n<h2>自定义渲染循环</h2>\n<p>以上介绍的是应用程序辅助类开箱即用的默认呈现循环。对于希望解决特定问题的高级用户来说，创建呈现循环还有许多其他方法。在制作原型和学习 PixiJS 的过程中，建议使用应用程序提供的系统。</p>\n",
      "date_published": "2024-08-08T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "Pixi"
      ]
    },
    {
      "title": "务实的项目",
      "url": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/09-pragmatic-project.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/09-pragmatic-project.html",
      "summary": "一旦项目不只你一个人，就需要建立一些基本规则，并依次将项目的各部分分配出去。 务实的团队 维持小而稳定的团队 禁止破窗 团队的工作不应仅致力于开发新功能，还可能包括： 旧系统的维护 流程的反思与精炼 实验新技术 学习和提升技能 做能起作用的事，别赶时髦 务实的入门套件 版本控制 回归测试 完全自动化 傲慢与偏见 在作品上签名。 保持匿名会滋生粗心、错误...",
      "content_html": "<p>一旦项目不只你一个人，就需要建立一些基本规则，并依次将项目的各部分分配出去。</p>\n<h2>务实的团队</h2>\n<ul>\n<li>维持小而稳定的团队</li>\n<li>禁止破窗</li>\n<li>团队的工作不应仅致力于开发新功能，还可能包括：\n<ul>\n<li>旧系统的维护</li>\n<li>流程的反思与精炼</li>\n<li>实验新技术</li>\n<li>学习和提升技能</li>\n</ul>\n</li>\n<li>做能起作用的事，别赶时髦</li>\n</ul>\n<h2>务实的入门套件</h2>\n<ul>\n<li>版本控制</li>\n<li>回归测试</li>\n<li>完全自动化</li>\n</ul>\n<h2>傲慢与偏见</h2>\n<p>在作品上签名。</p>\n<p>保持匿名会滋生粗心、错误、懒惰和糟糕的代码，特别是在大型项目中——很容易把自己看成只是大齿轮上的一个小齿，在无休止的工作汇报中制造蹩脚的借口，而不是写出好的代码。</p>\n",
      "date_published": "2024-08-07T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "READING"
      ]
    },
    {
      "title": "项目启动前",
      "url": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/08-before-start-project.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/08-before-start-project.html",
      "summary": "在项目的最早期，你和团队需要了解需求。仅仅是被人告知要做什么或是倾听用户是不够的：读一下需求之坑，学习如何避免常见的陷阱。 需求之坑 需求很少停留在表面。通常情况下，它们被埋在层层的假设、误解和政治之下。更糟糕的是，需求通常根本不存在。 无人确切知道自己想要什么 程序员帮助人们理解他们想要什么 需求是从反馈循环中学到的 和用户一起工作以便从用户角度思考...",
      "content_html": "<p>在项目的最早期，你和团队需要了解需求。仅仅是被人告知要做什么或是倾听用户是不够的：读一下需求之坑，学习如何避免常见的陷阱。</p>\n<h2>需求之坑</h2>\n<p>需求很少停留在表面。通常情况下，它们被埋在层层的假设、误解和政治之下。更糟糕的是，需求通常根本不存在。</p>\n<ul>\n<li>无人确切知道自己想要什么</li>\n<li>程序员帮助人们理解他们想要什么</li>\n<li>需求是从反馈循环中学到的</li>\n<li>和用户一起工作以便从用户角度思考</li>\n<li>使用项目术语表</li>\n</ul>\n<h2>处理无法解决的难题</h2>\n<p>偶尔也会出现一个真的非常困难的问题，你会发现自己顿时被卷入项目之中：一些工程问题你把握不了，或者某些代码比你想象的更难写，也许看起来根本做不到。但这些真的像看起来那么难吗？</p>\n<p>解决谜题的关键是，认识到你所受到的约束和你所拥有的自由度，因为认识到这些就会找到答案。</p>\n<ul>\n<li>不要跳出框框思考——找到框框</li>\n<li>跳出自身的局限</li>\n<li>幸运眷顾有准备的人</li>\n</ul>\n<h2>携手共建</h2>\n<p>「一起工作」的真正含义：不仅仅是提问、讨论、做笔记，还要在真正编码的同一时刻提问和讨论。</p>\n<ul>\n<li>结对编程</li>\n<li>集体编程</li>\n<li>不要一个人埋头钻进代码中</li>\n</ul>\n",
      "date_published": "2024-08-07T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "READING"
      ]
    },
    {
      "title": "当你编码时",
      "url": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/07-when-coding.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/07-when-coding.html",
      "summary": "对所有代码进行批判性思考，包括自己的代码。不断看到程序和设计的改进空间。 听从蜥蜴脑 一种有效的脑力突破的方法： 在便签上写下「我正在做 xx」，然后贴在屏幕的一侧。 提醒自己，「xx」注定要出问题。提醒自己，「xx」即使没有出问题也会被扔掉。这样做没有坏处。 在空编辑器窗口中，写一条注释，用一句话描述你想学点什么或做点什么。 开始编码。 如果在实验结...",
      "content_html": "<p>对所有代码进行批判性思考，包括自己的代码。不断看到程序和设计的改进空间。</p>\n<h2>听从蜥蜴脑</h2>\n<p>一种有效的脑力突破的方法：</p>\n<ol>\n<li>在便签上写下「我正在做 xx」，然后贴在屏幕的一侧。</li>\n<li>提醒自己，「xx」注定要出问题。提醒自己，「xx」即使没有出问题也会被扔掉。这样做没有坏处。</li>\n<li>在空编辑器窗口中，写一条注释，用一句话描述你想学点什么或做点什么。</li>\n<li>开始编码。</li>\n</ol>\n<p>如果在实验结束后仍旧不舒服，那就重新从散步、谈话和休息开始。</p>\n<p>阅读别人的代码。</p>\n<h2>重构</h2>\n<p>重组现有代码实体、改变其内部结构而不改变其外部行为的规范式技术。</p>\n<p>重构是一项日复一日的工作，需要采取低风险的小步骤进行，它更像是耙松和除草这类活动。这是一种有针对性的、精确的方法，有助于保持代码易于更改，而不是对代码库进行自由的、大规模的重写。</p>\n<p>为了保证外部行为没有改变，你需要良好的自动化单元测试来验证代码的行为。</p>\n<ul>\n<li>尽早重构，尽快重构</li>\n</ul>\n<h2>注意安全</h2>\n<ul>\n<li>保持代码简洁，让攻击面更小</li>\n<li>尽早打上安全补丁</li>\n</ul>\n",
      "date_published": "2024-08-07T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "READING"
      ]
    },
    {
      "title": "并发",
      "url": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/06-concurrent.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/pragmatic-programmer/06-concurrent.html",
      "summary": "打破时域耦合 时域耦合——在时间范畴上产生耦合：A 方法必须在 B 方法之前调用；一次只能运行一个报告；在按钮按下前必须等屏幕先重绘；“嘀嘀”一定在“嗒嗒”之前发生。 我们需要考虑并发性，并且考虑对时间依赖或顺序依赖解耦。 通过分析工作流来提高并发性 做事也需要思考如何解耦 ",
      "content_html": "<h2>打破时域耦合</h2>\n<p>时域耦合——在时间范畴上产生耦合：A 方法必须在 B 方法之前调用；一次只能运行一个报告；在按钮按下前必须等屏幕先重绘；“嘀嘀”一定在“嗒嗒”之前发生。</p>\n<p>我们需要考虑并发性，并且考虑对时间依赖或顺序依赖解耦。</p>\n<ul>\n<li>通过分析工作流来提高并发性</li>\n<li>做事也需要思考如何解耦</li>\n</ul>\n",
      "date_published": "2024-08-07T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "READING"
      ]
    },
    {
      "title": "手写 call、apply、bind",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/017-implement-call-apply-bind.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/017-implement-call-apply-bind.html",
      "summary": "call()、apply() 和 bind() 三者都可以改变 JavaScript 中的 this 指向，关于三者的区别在 中有详细记录。 这三个函数实际上是由 C++ 实现的，这里只考虑功能上的实现，不会考虑太多边界情况。 call() call() 接受一个 this 指向，其后跟参数列表。 apply() apply() 与 call() 的区...",
      "content_html": "<p><code>call()</code>、<code>apply()</code> 和 <code>bind()</code> 三者都可以改变 JavaScript 中的 this 指向，关于三者的区别在 中有详细记录。</p>\n<p>这三个函数实际上是由 C++ 实现的，这里只考虑功能上的实现，不会考虑太多边界情况。</p>\n<h2><code>call()</code></h2>\n<p><code>call()</code> 接受一个 <code>this</code> 指向，其后跟参数列表。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">myCall</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">thisArg<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 将 thisArg 转成对象类型（防止传入非对象类型）</span>\n  <span class=\"token comment\">// 传入 null 或 undefined 则为全局对象</span>\n  thisArg <span class=\"token operator\">=</span> thisArg <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> thisArg <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">?</span> <span class=\"token function\">Object</span><span class=\"token punctuation\">(</span>thisArg<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> window\n\n  <span class=\"token comment\">// foo.myCall();</span>\n  <span class=\"token comment\">// foo 是函数，本质上也是一个对象，即隐式绑定：对象（foo）调用函数（myCall）</span>\n  <span class=\"token comment\">// 那么函数 myCall 中的 this 指向 foo 对象（函数）</span>\n  <span class=\"token keyword\">const</span> fn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span> <span class=\"token comment\">// foo</span>\n\n  <span class=\"token comment\">// 需要将 fn 的指向改为 thisArg</span>\n  <span class=\"token comment\">// 那么可以继续利用 this 的隐式绑定规则</span>\n  thisArg<span class=\"token punctuation\">.</span>fn <span class=\"token operator\">=</span> fn\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> thisArg<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">delete</span> thisArg<span class=\"token punctuation\">.</span>fn\n\n  <span class=\"token keyword\">return</span> res\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2><code>apply()</code></h2>\n<p><code>apply()</code> 与 <code>call()</code> 的区别在于传入的是参数数组，参照上面流程，可以很容易的写出：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">myApply</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">thisArg<span class=\"token punctuation\">,</span> args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理 thisArg</span>\n  thisArg <span class=\"token operator\">=</span> thisArg <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> thisArg <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">?</span> <span class=\"token function\">Object</span><span class=\"token punctuation\">(</span>thisArg<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> window\n\n  <span class=\"token comment\">// 获取待执行函数</span>\n  <span class=\"token keyword\">const</span> fn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n\n  <span class=\"token comment\">// 执行</span>\n  thisArg<span class=\"token punctuation\">.</span>fn <span class=\"token operator\">=</span> fn\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> thisArg<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">delete</span> thisArg<span class=\"token punctuation\">.</span>fn\n\n  <span class=\"token keyword\">return</span> res\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2><code>bind()</code></h2>\n<p><code>bind()</code> 函数稍有不同，它返回一个改变了 <code>this</code> 的函数：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">myBind</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">thisArg<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理 thisArg</span>\n  thisArg <span class=\"token operator\">=</span> thisArg <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> thisArg <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">?</span> <span class=\"token function\">Object</span><span class=\"token punctuation\">(</span>thisArg<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> window\n\n  <span class=\"token comment\">// 获取待执行函数</span>\n  <span class=\"token keyword\">const</span> fn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">_bind</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>newArgs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 收集参数</span>\n    <span class=\"token keyword\">const</span> finalArgs <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>newArgs<span class=\"token punctuation\">]</span>\n\n    <span class=\"token comment\">// 执行</span>\n    thisArg<span class=\"token punctuation\">.</span>fn <span class=\"token operator\">=</span> fn\n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> thisArg<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>finalArgs<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">delete</span> thisArg<span class=\"token punctuation\">.</span>fn\n\n    <span class=\"token keyword\">return</span> res\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>总结</h2>\n<p>手写 <code>call</code>、<code>apply</code>、<code>bind</code> 的步骤大致相同，只是 <code>bind</code> 多了一个收集参数的过程：</p>\n<ol>\n<li>处理 thisArg;</li>\n<li>获取待执行函数；</li>\n<li>执行函数（<code>bind()</code> 还有一个收集参数的过程）。</li>\n</ol>\n<p>无论是在获取函数还是执行函数（改变 <code>this</code>）的过程中，都是利用了隐式绑定改变 <code>this</code> 指向的规则。</p>\n",
      "date_published": "2022-04-27T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "JavaScript"
      ]
    },
    {
      "title": "函数",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/015-function.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/015-function.html",
      "summary": "箭头函数 ES6 中新增了 =>，它可以将函数定义成箭头函数。 注意 箭头函数不能使用 arguments、super 和 new.target，也不能用作构造函数。此外，箭头函数也没有 prototype 属性。 函数名 在 JavaScript 中，函数名可以是任何标识符。 ECMAScript 6 的所有函数对象都会暴露一个只读的 name 属性...",
      "content_html": "<h2>箭头函数</h2>\n<p>ES6 中新增了 <code>=&gt;</code>，它可以将函数定义成箭头函数。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">add</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> a <span class=\"token operator\">+</span> b\n</code></pre></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>箭头函数不能使用 <code>arguments</code>、<code>super</code> 和 <code>new.target</code>，也不能用作构造函数。此外，箭头函数也没有 <code>prototype</code> 属性。</p>\n</div>\n<h2>函数名</h2>\n<p>在 JavaScript 中，函数名可以是任何标识符。</p>\n<p>ECMAScript 6 的所有函数对象都会暴露一个只读的 <code>name</code> 属性，其中包含关于函数的信息。</p>\n<p>多数情况下，这个属性中保存的就是一个函数标识符，或者说是一个字符串化的变量名。即使函数没有名称，也会如实显示成空字符串。如果它是使用 <code>Function</code> 构造函数创建的，则会标识成 <code>anonymous</code>：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">bar</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">baz</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// foo</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>bar<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// bar</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>baz<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// baz</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">//（空字符串）</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// anonymous</span>\n</code></pre></div><p>如果函数是一个获取函数、设置函数，或者使用 <code>bind()</code> 实例化，那么标识符前面会加上一个前缀：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">foo</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// bound foo</span>\n\n<span class=\"token keyword\">let</span> dog <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">years</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">get</span> <span class=\"token function\">age</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>years\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">set</span> <span class=\"token function\">age</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">newAge</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>years <span class=\"token operator\">=</span> newAge\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> propertyDescriptor <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">getOwnPropertyDescriptor</span><span class=\"token punctuation\">(</span>dog<span class=\"token punctuation\">,</span> <span class=\"token string\">'age'</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>propertyDescriptor<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// get age</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>propertyDescriptor<span class=\"token punctuation\">.</span>set<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token comment\">// set age</span>\n</code></pre></div><h2>参数</h2>\n<p>函数既不关心传入的参数个数，也不关心这些参数的数据类型。定义函数时要接收两个参数，并不意味着调用时就传两个参数。你可以传一个、三个，甚至一个也不传，解释器都不会报错。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>之所以会这样，主要是因为 ECMAScript 函数的参数在内部表现为一个数组。但函数并不关心这个数组中包含什么。如果数组中什么也没有，那没问题；如果数组的元素超出了要求，那也没问题。</p>\n<p>事实上，在使用 <code>function</code> 关键字定义（非箭头）函数时，可以在函数内部访问 <code>arguments</code> 对象（参见 ），从中取得传进来的每个参数值。</p>\n</div>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>ECMAScript 中的所有参数都按值传递的。不可能按引用传递参数。如果把对象作为参数传递，那么传递的值就是这个对象的引用，详见 。</p>\n</div>\n<h2>无重载</h2>\n<p>ECMAScript 中，函数的重载是不允许的，只能有一个函数签名。</p>\n<p>而在 TypeScript 中，可以有函数重载。一个函数可以有多个不同的签名，但只有一个具体的实现。这种机制允许一个函数根据不同的参数类型或数量来执行不同的逻辑。</p>\n<p>重载函数在定义时，先列出多个函数签名，然后提供一个具体的实现函数，该实现函数根据传入的参数执行相应的操作。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> User <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> User<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> User <span class=\"token operator\">|</span> User<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> value <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> userList<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> item<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> value<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> userList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> item<span class=\"token punctuation\">.</span>grades <span class=\"token operator\">===</span> value<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>默认参数</h2>\n<p>在函数定义中的参数后面用 <code>=</code> 就可以为参数赋一个默认值：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">makeKing</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Henry'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">King </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> VIII</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeKing</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Louis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'King Louis VIII'</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeKing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'King Henry VIII'</span>\n</code></pre></div><h2>参数扩展和收集</h2>\n<h3>扩展参数</h3>\n<p>对可迭代对象应用扩展操作符，并将其作为一个参数传入，可以将可迭代对象拆分，并将迭代返回的每个值单独传入。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">let</span> values <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getSum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> arguments<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sum <span class=\"token operator\">+=</span> arguments<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> sum\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">getSum</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>values<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h3>收集参数</h3>\n<p>在构思函数定义时，可以使用扩展操作符把不同长度的独立参数组合为一个数组。这有点类似 <code>arguments</code> 对象的构造机制，只不过收集参数的结果会得到一个 Array 实例。</p>\n<p>且收集参数只能放在最后一个参数位置：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">ignoreFirst</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">firstValue<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>values</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">ignoreFirst</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// []</span>\n<span class=\"token function\">ignoreFirst</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// []</span>\n<span class=\"token function\">ignoreFirst</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// [2]</span>\n<span class=\"token function\">ignoreFirst</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// [2, 3]</span>\n</code></pre></div><h2>函数声明和函数表达式</h2>\n<p>函数声明会在任何代码执行之前先被读取并添加到执行上下文，函数表达式不会。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sum1</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum1</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sum2</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 报错</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">sum2</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">num1<span class=\"token punctuation\">,</span> num2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> num1 <span class=\"token operator\">+</span> num2\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>函数作为值</h2>\n<p>因为函数名在 ECMAScript 中就是变量，所以函数可以用在任何可以使用变量的地方。这意味着不仅可以把函数作为参数传给另一个函数，而且还可以在一个函数中返回另一个函数。</p>\n<h2>函数内部</h2>\n<p>在 ECMAScript 5 中，函数内部存在两个特殊的对象：<code>arguments</code> 和 <code>this</code>。ECMAScript 6 又新增了 <code>new.target</code> 属性。</p>\n<h3>arguments</h3>\n<p><code>arguments</code> 对象还有一个 <code>callee</code> 属性，是一个指向 <code>arguments</code> 对象所在函数的指针。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">factorial</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> num <span class=\"token operator\">*</span> <span class=\"token function\">factorial</span><span class=\"token punctuation\">(</span>num <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这个函数要正确执行就必须保证函数名是 <code>factorial</code>，从而导致了紧密耦合。使用 <code>arguments.callee</code> 就可以让函数逻辑与函数名解耦：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">factorial</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> num <span class=\"token operator\">*</span> arguments<span class=\"token punctuation\">.</span><span class=\"token function\">callee</span><span class=\"token punctuation\">(</span>num <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>this</h3>\n<p>详见 。</p>\n<h3>new.target</h3>\n<p>ECMAScript 中的函数始终可以作为构造函数实例化一个新对象，也可以作为普通函数被调用。ECMAScript 6 新增了检测函数是否使用 <code>new</code> 关键字调用的 <code>new.target</code> 属性。</p>\n<p>如果函数是正常调用的，<code>new.target</code> 将返回 <code>undefined</code>，如果函数被 <code>new</code> 关键字调用，则 <code>new.target</code> 将返回这个函数。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">King</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token string\">'King must be instantiated using \"new\"'</span>\n  <span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'King instantiated using \"new\"'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">King</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// King instantiated using \"new\"</span>\n<span class=\"token function\">King</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Error: King must be instantiated using \"new\"</span>\n</code></pre></div><h2>函数属性和方法</h2>\n<p>ECMAScript 中的函数是对象，因此有属性和方法。每个函数都有两个属性：<code>length</code> 和 <code>prototype</code>。其中，<code>length</code> 属性保存函数定义的命名参数的个数，<code>prototype</code> 属性保存函数的原型对象。</p>\n<p>函数还有两个方法：<code>apply()</code> 和 <code>call()</code>。这两个方法都会以指定的 <code>this</code> 值来调用函数，即会设置调用函数时函数体内 <code>this</code> 对象的值。</p>\n<h2>尾调用优化</h2>\n<p>ECMAScript 6 规范新增了一项内存管理优化机制，让 JavaScript 引擎在满足条件时可以重用栈帧。</p>\n<p>具体来说，这项优化非常适合「尾调用」，即外部函数的返回值是一个内部函数的返回值。比如：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 尾调用</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>在 ES6 优化之前，执行这个例子会在内存中发生如下操作。</p>\n<ol>\n<li>执行到 <code>outerFunction</code> 函数体，第一个栈帧被推到栈上。</li>\n<li>执行 <code>outerFunction</code> 函数体，到 <code>return</code> 语句。计算返回值必须先计算 <code>innerFunction</code>。</li>\n<li>执行到 <code>innerFunction</code> 函数体，第二个栈帧被推到栈上。</li>\n<li>执行 <code>innerFunction</code> 函数体，计算其返回值。</li>\n<li>将返回值传回 <code>outerFunction</code>，然后 <code>outerFunction</code> 再返回值。</li>\n<li>将栈帧弹出栈外。</li>\n</ol>\n<p>在 ES6 优化之后，执行这个例子会在内存中发生如下操作。</p>\n<ol>\n<li>执行到 outerFunction 函数体，第一个栈帧被推到栈上。</li>\n<li>执行 outerFunction 函数体，到达 return 语句。为求值返回语句，必须先求值 innerFunction。</li>\n<li>引擎发现把第一个栈帧弹出栈外也没问题，因为 innerFunction 的返回值也是 outerFunction<br>\n的返回值。</li>\n<li>弹出 outerFunction 的栈帧。</li>\n<li>执行到 innerFunction 函数体，栈帧被推到栈上。</li>\n<li>执行 innerFunction 函数体，计算其返回值。</li>\n<li>将 innerFunction 的栈帧弹出栈外。</li>\n</ol>\n<p>很明显，第一种情况下每多调用一次嵌套函数，就会多增加一个栈帧。而第二种情况下无论调用多少次嵌套函数，都只有一个栈帧。这就是 ES6 尾调用优化的关键：如果函数的逻辑允许基于尾调用将其<br>\n销毁，则引擎就会那么做。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>现在还没有办法测试尾调用优化是否起作用。不过，因为这是 ES6 规范所规定的，兼容的浏览器实现都能保证在代码满足条件的情况下应用这个优化。</p>\n</div>\n<h3>条件</h3>\n<p>尾调用优化的条件就是确定外部栈帧真的没有必要存在了。涉及的条件如下：</p>\n<ul>\n<li>严格模式；</li>\n<li>外部函数的返回值是对尾调用函数的调用；</li>\n<li>尾调用函数返回后不需要执行额外的逻辑；</li>\n<li>尾调用函数不是引用外部函数作用域中自由变量的闭包。</li>\n</ul>\n<p>下面展示了几个违反上述条件的函数，因此都不符号尾调用优化的要求：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token string\">'use strict'</span>\n<span class=\"token comment\">// 无优化：尾调用没有返回</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 无优化：尾调用没有直接返回</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> innerFunctionResult <span class=\"token operator\">=</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> innerFunctionResult\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 无优化：尾调用返回后必须转型为字符串</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 无优化：尾调用是一个闭包</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> foo <span class=\"token operator\">=</span> <span class=\"token string\">'bar'</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> foo\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>下面是几个符合尾调用优化条件的例子：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token string\">'use strict'</span>\n<span class=\"token comment\">// 有优化：栈帧销毁前执行参数计算</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 有优化：初始返回值不涉及栈帧</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">&lt;</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> a\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 有优化：两个内部函数都在尾部</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">condition</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> condition <span class=\"token operator\">?</span> <span class=\"token function\">innerFunctionA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">innerFunctionB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>尾调用优化</h3>\n<p>下面是一个通过递归计算斐波纳契数列的函数：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> n\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">fib</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token function\">fib</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 0</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 1</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 2</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 3</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 5</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 8</span>\n</code></pre></div><p>显然这个函数不符合尾调用优化的条件，因为返回语句中有一个相加的操作。结果，<code>fib(n)</code> 的栈帧数的内存复杂度是 <code>O(2n)</code>。</p>\n<p>利用尾调用优化：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token string\">'use strict'</span>\n<span class=\"token comment\">// 基础框架</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fib</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">fibImpl</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 执行递归</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">fibImpl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> a\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">fibImpl</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">,</span> n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>闭包</h2>\n<p>简而言之是指内部函数引用外部函数的变量，这个内部函数就是闭包。</p>\n<p>虽然外部函数已经运行完毕，但由于闭包的存在，内部函数依然可以访问外部函数的变量，该变量不会被销毁。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> foo <span class=\"token operator\">=</span> <span class=\"token string\">'bar'</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">innerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> foo\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> fn <span class=\"token operator\">=</span> <span class=\"token function\">outerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'bar'</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>一些闭包场景：</p>\n<ul>\n<li>节流防抖</li>\n<li>函数柯里化</li>\n<li>链式调用</li>\n<li>迭代器</li>\n<li>发布订阅</li>\n</ul>\n<p>因为闭包会保留它们包含函数的作用域，所以比其他函数更占用内存。过度使用闭包可能导致内存过度占用，因此建议仅在十分必要时使用。</p>\n</div>\n<h2>立即执行函数（IIFE）</h2>\n<p>立即调用的匿名函数又被称作立即调用的函数表达式（IIFE，Immediately Invoked Function Expression）。它类似于函数声明，但由于被包含在括号中，所以会被解释为函数表达式。紧跟在第一组括号后面的第二组括号会立即调用前面的函数表达式。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 块级作用域</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>具体应用见 。</p>\n<h2>私有变量</h2>\n<p>严格来讲，JavaScript 没有私有成员的概念，所有对象属性都公有的。不过，倒是有「私有变量」的概念。任何定义在函数或块中的变量，都可以认为是私有的，因为在这个函数或块的外部无法访问其中的变量。私有变量包括函数参数、局部变量，以及函数内部定义的其他函数。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num1<span class=\"token punctuation\">,</span> num2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> sum <span class=\"token operator\">=</span> num1 <span class=\"token operator\">+</span> num2\n  <span class=\"token keyword\">return</span> sum\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>在这个函数中，函数 <code>add()</code> 有 3 个私有变量：<code>num1</code>、<code>num2</code> 和 <code>sum</code>。这几个变量只能在函数内部使用，不能在函数外部访问。如果这个函数中创建了一个闭包，则这个闭包能通过其作用域链访问其外部的这 3 个变量。基于这一点，就可以创建出能够访问私有变量的公有方法。</p>\n<p><strong>特权方法（privileged method）</strong> 是能够访问函数私有变量（及私有函数）的公有方法。在对象上有两种方式创建特权方法。第一种是在构造函数中实现，比如：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">MyObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 私有变量和私有函数</span>\n  <span class=\"token keyword\">let</span> privateVariable <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 特权方法</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">publicMethod</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    privateVariable<span class=\"token operator\">++</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>这里实际上创建了一个闭包，在创建实例后，只能通过 <code>MyObject.prototype.publicMethod()</code> 调用 <code>privateVariable</code> 和 <code>privateFunction</code>。</p>\n<h3>静态私有变量</h3>\n<p>该模式不常用，简单看看例子：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 私有变量和私有函数</span>\n  <span class=\"token keyword\">let</span> privateVariable <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 构造函数</span>\n  <span class=\"token function-variable function\">MyObject</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 公有和特权方法</span>\n  <span class=\"token class-name\">MyObject</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">publicMethod</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    privateVariable<span class=\"token operator\">++</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>使用闭包和私有变量会导致作用域链变长，作用域链越长，则查找变量所需的时间也越多。</p>\n</div>\n<h3>模块模式</h3>\n<p>模块模式，则在一个单例对象上实现了相同的隔离和封装。单例对象（singleton）就是只有一个实例的对象。按照惯例，JavaScript 是通过对象字面量来创建单例对象的：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">let</span> singleton <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 私有变量和私有函数</span>\n  <span class=\"token keyword\">let</span> privateVariable <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 特权/公有方法和属性</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">publicProperty</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">publicMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      privateVariable<span class=\"token operator\">++</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>类似一些 hooks 的封装。</p>\n</div>\n<h3>模块增强模式</h3>\n<p>另一个利用模块模式的做法是在返回对象之前先对其进行增强。这适合单例对象需要是某个特定类型的实例，但又必须给它添加额外属性或方法的场景。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">let</span> singleton <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 私有变量和私有函数</span>\n  <span class=\"token keyword\">let</span> privateVariable <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 创建对象</span>\n  <span class=\"token keyword\">let</span> object <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 添加特权/公有属性和方法</span>\n  object<span class=\"token punctuation\">.</span>publicProperty <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n  object<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">publicMethod</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    privateVariable<span class=\"token operator\">++</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">privateFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 返回对象</span>\n  <span class=\"token keyword\">return</span> object\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre></div>",
      "date_published": "2024-07-08T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "JavaScript"
      ]
    },
    {
      "title": "this 指向",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/016-this.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/016-this.html",
      "summary": "在常见的编程语言中，几乎都有 this 关键字，但是 JavaScript 中的 this 和常见的面向对象语言中的 this 不太一样： 常见的面向对象的编程语言中，如 Java、C++、Swift 等，this 通常只会出现在类的方法中，this 代表的是当前调用对象； 但是 JavaScript 中的 this 更加灵活，无论是它出现的位置还是代...",
      "content_html": "<p>在常见的编程语言中，几乎都有 <code>this</code> 关键字，但是 JavaScript 中的 <code>this</code> 和常见的面向对象语言中的 <code>this</code> 不太一样：</p>\n<ul>\n<li>常见的面向对象的编程语言中，如 Java、C++、Swift 等，<code>this</code> 通常只会出现在类的方法中，<code>this</code> 代表的是当前调用对象；</li>\n<li>但是 JavaScript 中的 <code>this</code> 更加灵活，无论是它出现的位置还是代表的含义。</li>\n</ul>\n<p>在  中提到过：上下文中会包含 <code>this</code> 指向，那么不同的上下文的 <code>this</code> 指向肯定会不同。下面就来具体看看。</p>\n<h2>全局上下文</h2>\n<p>无论是否处于严格模式，全局上下文中的 <code>this</code> 都指向全局对象。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token operator\">===</span> window<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n</code></pre></div><h2>函数上下文</h2>\n<p>在函数上下文中，<code>this</code> 指向取决于函数的调用方式，一共分为四种。</p>\n<ul>\n<li>默认绑定</li>\n<li>隐式绑定</li>\n<li>显式绑定</li>\n<li>new 绑定</li>\n</ul>\n<h3>默认绑定</h3>\n<p>默认绑定即为独立函数调用，可以理解为没有绑定到某个对象上进行调用。</p>\n<p>严格模式和非严格模式下 <code>this</code> 的指向会有所不同。</p>\n<p>非严格模式下，独立调用函数的 <code>this</code> 指向为全局对象，在浏览器中为 <code>window</code>，node 中为 <code>global</code>。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">f1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">f1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> window <span class=\"token comment\">// true</span>\n</code></pre></div><p>而严格模式下，独立调用函数的 <code>this</code> 指向为 <code>undefined</code>。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">f2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'use strict'</span> <span class=\"token comment\">// 这里是严格模式</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">f2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span> <span class=\"token comment\">// true</span>\n</code></pre></div><h3>隐式绑定（对象函数调用）</h3>\n<p>通过对象发起的函数调用，<code>this</code> 会指向调用者本身。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 案例一</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'why'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> foo\n<span class=\"token punctuation\">}</span>\n\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// obj 对象发起的函数调用，因此 this 指向 obj 对象</span>\n\n<span class=\"token comment\">// 案例二</span>\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'wang'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">eating</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">'在吃东西'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">eating</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// wang在吃东西</span>\n\n<span class=\"token keyword\">var</span> fn <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span>eating\n<span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// undefined在吃东西 -&gt; 没有对象调用，还是默认绑定</span>\n\n<span class=\"token comment\">// 案例三</span>\n<span class=\"token keyword\">var</span> obj1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'obj1'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">foo</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'obj2'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> obj1<span class=\"token punctuation\">.</span>foo\n<span class=\"token punctuation\">}</span>\n\nobj2<span class=\"token punctuation\">.</span><span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// obj2</span>\n</code></pre></div><h3>显示绑定</h3>\n<p>前面的隐式绑定存在一个缺点：对象内部必须有一个函数的引用，否则会报错。</p>\n<p>如果我们不希望在 <strong>对象内部</strong> 包含这个函数的引用，同时又希望在这个对象上强制调用，那么应该怎么办？</p>\n<p>JavaScript 提供了三个改变 this 指向的函数：<code>call()</code>、<code>apply()</code> 和 <code>bind()</code>。它们都能改变 this 指向，但是都有一些细微的区别。</p>\n<h4><code>Function.prototype.call()</code></h4>\n<p>语法：第一个参数为 this 值（可选，若省略或指定为 <code>null</code> 或 <code>undefined</code> 则为全局对象），后面为参数列表。<code>call()</code> 会立即调用该函数，因此返回值为该函数的返回值。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>thisArg<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> arg1<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> arg2<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>例子：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'函数被调用了'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'obj'</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 函数被调用了 { name: 'obj' }</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num1<span class=\"token punctuation\">,</span> num2<span class=\"token punctuation\">,</span> num3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>num1 <span class=\"token operator\">+</span> num2 <span class=\"token operator\">+</span> num3<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">sum</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">'call'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 90 [String: 'call']</span>\n</code></pre></div><h4><code>Function.prototype.apply()</code></h4>\n<p>语法：第一个参数为 this 值（可选，若省略或指定为 <code>null</code> 或 <code>undefined</code> 则为全局对象），后面为参数列表。和 <code>call()</code> 一样，<code>apply()</code>会立即调用该函数，因此返回值为该函数的返回值。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span><span class=\"token punctuation\">.</span><span class=\"token function\">aplly</span><span class=\"token punctuation\">(</span>thisArg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>argsArray<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>例子：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'函数被调用了'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'obj'</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 函数被调用了 { name: 'obj' }</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num1<span class=\"token punctuation\">,</span> num2<span class=\"token punctuation\">,</span> num3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>num1 <span class=\"token operator\">+</span> num2 <span class=\"token operator\">+</span> num3<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">sum</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'call'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 90 [String: 'call']</span>\n</code></pre></div><h4><code>Function.prototype.bind()</code></h4>\n<p>有时候我们不希望函数立即被执行，那么可以使用 <code>bind()</code>，它和 <code>call()</code>、<code>apply()</code> 不同，<code>bind()</code> <strong>不会</strong>立即调用该函数，返回值为改变 this 指向之后的函数。</p>\n<p><code>bind()</code> 方法创建一个新的函数，在 <code>bind()</code> 被调用时，这个新函数的 this 被指定为 <code>bind()</code> 的第一个参数，而其余参数将作为新函数的参数，供调用时使用。</p>\n<p>语法：第一个参数为 this 值（可选，若省略或指定为 <code>null</code> 或 <code>undefined</code> 则为全局对象），后面为参数列表。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>thisArg<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> arg1<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> arg2<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>例子：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">num1<span class=\"token punctuation\">,</span> num2<span class=\"token punctuation\">,</span> num3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>num1 <span class=\"token operator\">+</span> num2 <span class=\"token operator\">+</span> num3<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> _bind <span class=\"token operator\">=</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bind'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">_bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 90 [String: 'bind']</span>\n</code></pre></div><h3>new 绑定</h3>\n<p>使用 new 操作符调用构造函数生成对象时，会自动执行以下操作：</p>\n<ol>\n<li>创建一个全新的对象；</li>\n<li>这个对象的 <code>[[proto]]</code> 属性会被赋值为构造函数的 <code>prototype</code> 属性；</li>\n<li>构造函数内部的 this 被赋值为这个对象（<strong>new 绑定</strong>）;</li>\n<li>执行构造函数内部的代码；</li>\n<li>如果构造函数返回非空对象，则返回该对象；否则返回刚才创建的新对象。</li>\n</ol>\n<p>在这个过程中就会执行 new 绑定。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">sayName</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Person { name: 'wang', sayName: [Function (anonymous)] }</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> person <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">'wang'</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>优先级</h2>\n<p>如果一个函数应用了多个规则，那么它们的优先级谁更高？</p>\n<ol>\n<li>\n<p>默认绑定</p>\n<p>毫无疑问，优先级最低</p>\n</li>\n<li>\n<p>显式绑定高于隐式绑定</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'obj'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">foo</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 1.call/apply的显示绑定高于隐式绑定</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">foo</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// [String: 'abc']</span>\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">foo</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// [String: 'abc']</span>\n\n<span class=\"token comment\">// 2.bind的优先级高于隐式绑定</span>\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span><span class=\"token function\">foo</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// [String: 'abc']</span>\n</code></pre></div></li>\n<li>\n<p>new 绑定高于显示绑定</p>\n<p>new 不能和 <code>call()</code>、<code>apply()</code> 一起使用。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> bar <span class=\"token operator\">=</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aaa'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// foo {}</span>\n</code></pre></div></li>\n</ol>\n<p>因此优先级是 new 绑定 &gt; 显示绑定(apply/call/bind) &gt; 隐式绑定(obj.foo()) &gt; 默认绑定(独立函数调用)。</p>\n<h2>箭头函数</h2>\n<p>上面所说的是普通函数的 this 指向，而在箭头函数中，this 根据外层作用域来决定。</p>\n<p>那么它有什么应用场景呢？来看一个模拟网络请求的例子：</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><code>setTimeout()</code> 中的 this 关键字在非严格模式会指向 window (或全局)对象，严格模式下为 undefined。详见 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout#%E5%85%B3%E4%BA%8Ethis%E7%9A%84%E9%97%AE%E9%A2%98\" target=\"_blank\" rel=\"noopener noreferrer\">window.setTimeout - Web API 接口参考 | MDN (mozilla.org)</a></p>\n</div>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">var</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">getData</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 发送网络请求, 将结果放到上面 data 属性中</span>\n    <span class=\"token comment\">// 在箭头函数之前的解决方案</span>\n    <span class=\"token keyword\">var</span> _this <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// window</span>\n      <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'cba'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nba'</span><span class=\"token punctuation\">]</span>\n      _this<span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> result\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nobj<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token comment\">// [\"abc\", \"cba\", \"nba\"]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span>\n</code></pre></div><p>有了箭头函数之后，就不必使用 <code>_this = this</code> 获取真正想要的 <code>this</code> 了：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// { data: [], getData: [Function: getData] }</span>\n  <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'abc'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'cba'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nba'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> result\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>参考链接</h2>\n<ul>\n<li><a href=\"https://developer.mozilla.org/\" target=\"_blank\" rel=\"noopener noreferrer\">MDN (mozilla.org)</a></li>\n<li><a href=\"https://juejin.cn/post/6844903746984476686\" target=\"_blank\" rel=\"noopener noreferrer\">面试官问：JS 的 this 指向 - 掘金 (juejin.cn)</a></li>\n</ul>\n",
      "date_published": "2022-04-22T00:00:00.000Z",
      "date_modified": "2026-01-23T04:40:58.000Z",
      "authors": [],
      "tags": [
        "JavaScript"
      ]
    },
    {
      "title": "架构概述",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/02-architecture-overview.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/02-architecture-overview.html",
      "summary": "PixiJS 源代码中主要模块的关系如下： ",
      "content_html": "<p><a href=\"https://github.com/pixijs/pixijs\" target=\"_blank\" rel=\"noopener noreferrer\">PixiJS</a> 源代码中主要模块的关系如下：</p>\n<p>| 模块          | 说明                                                           |<br>\n|</p>\n",
      "date_published": "2024-07-29T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "Pixi"
      ]
    },
    {
      "title": "whistle 调试真机",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/017-whistle-debug-real-phone.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/017-whistle-debug-real-phone.html",
      "summary": "在前端开发中移动端开发技能必不可少。当我们遇到类似于这样的问题： 移动端 Canvas 渲染失败 微信获取 openId 回调页不匹配 微信浏览器文件上传失败 支付宝，微信 H5 支付域名校验不匹配 生产环境 BUG，测试环境无法复现 当后端接口启用 cors 跨域时，本地环境无法访问 Chrome 模拟器和微信开发者工具等都无法完美复现我们遇到的问题...",
      "content_html": "<p>在前端开发中移动端开发技能必不可少。当我们遇到类似于这样的问题：</p>\n<ul>\n<li>移动端 <code>Canvas</code> 渲染失败</li>\n<li>微信获取 <code>openId</code> 回调页不匹配</li>\n<li>微信浏览器文件上传失败</li>\n<li>支付宝，微信 <code>H5</code> 支付域名校验不匹配</li>\n<li>生产环境 BUG，测试环境无法复现</li>\n<li>当后端接口启用 <code>cors</code> 跨域时，本地环境无法访问</li>\n</ul>\n<p><code>Chrome</code> 模拟器和微信开发者工具等都无法完美复现我们遇到的问题，这时候我们需要用到 <code>whistle</code> 来实现真机调试</p>\n<h2>Whistle</h2>\n<p><a href=\"https://wproxy.org/whistle/\" target=\"_blank\" rel=\"noopener noreferrer\">whistle</a>（读音[ˈwɪsəl]，拼音[wēisǒu]）基于 Node 实现的跨平台 web 调试代理工具。</p>\n<p>它的作用可以理解为用 Node 开一个代理服务器，将我们需要调试的设备代理到 <code>whistle</code> 后，由 <code>whistle</code> 进行代理请求。同时 <code>whistle</code> 支持类似于 hosts 的转发规则，我们可以通过正则或者内置的一些指令对我们需要进行代理的域名进行转发，添加插件等。</p>\n<h3>安装启动</h3>\n<p>安装 <code>whistle</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">npm</span> <span class=\"token function\">install</span> whistle <span class=\"token parameter variable\">-g</span>\n</code></pre></div><p>启动 <code>whistle</code>：</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>w2 start\n</code></pre></div><p>启动完成后，默认会在 <code>localhost:8899</code> 端口监听。</p>\n<h3>设置代理</h3>\n<h4>移动端</h4>\n<p>电脑与手机连接同一 wifi，在手机端 wifi 中设置代理为手动，输入代理 ip（启动 <code>whistle</code> 后在控制台中打印的局域网 ip），端口号为 <code>8899</code>。</p>\n<p>保存后移动端则已经设置好代理，在手机浏览器中访问互联网，即可以在 <code>whistle</code> 控制台中抓取到相应的网络请求。</p>\n<h4>PC 端</h4>\n<p>PC 端有时也需要通过 <code>whistle</code> 控制台设置代理修改请求信息或者配置 <code>source map</code> 文件，下面介绍如何使用 <code>Proxy switchyOmega</code> 插件设置代理。</p>\n<p>在扩展商店中搜索安装 <code>Proxy switchyOmega</code> 插件，下载完成后，默认会有一个 <code>proxy</code> 的情景模式，设置代理服务器为 <code>127.0.0.1</code>，端口号为 <code>8899</code> 保存并应用选项。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240729163103.png\" alt=\"设置情景模式\" tabindex=\"0\" loading=\"lazy\"><figcaption>设置情景模式</figcaption></figure>\n<p>这里还推荐修改一个配置，将默认配置改为系统代理，避免日常使用时被代理到 <code>whistle</code>，无法科学上网。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240729163028.png\" alt=\"修改默认配置\" tabindex=\"0\" loading=\"lazy\"><figcaption>修改默认配置</figcaption></figure>\n<h3>安装证书</h3>\n<p>参考 <a href=\"https://wproxy.org/whistle/webui/https.html\" target=\"_blank\" rel=\"noopener noreferrer\">官方文档</a> 即可。</p>\n<h2>真机调试</h2>\n<p>打开 <code>whistle</code> 控制台，左侧有个 <code>Rules</code>，在这里面可以进行一些跳转规则的分组，配置。</p>\n<h3>resMerge</h3>\n<p>由于大部分 webapp 是嵌入到 webview 中，因此需要更改响应结果中的 <code>webAppUrl</code> 路径。</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>https://xxxx resMerge://(webAppUrl=https://localhost:3000/index.html?isWebApp=true)\n</code></pre></div><h3>tpl</h3>\n<p>tpl 基本功能跟 file 一样可以做本地替换，但 tpl 内置了一个简单的模板引擎，可以把文件内容里面 <code>{name}</code> 替换请求参数对应的字段(如果不存在对应的自动则不会进行替换)，一般可用于 mock jsonp 的请求。</p>\n<p>在 <code>values</code> 面板中创建一个文件，名字为 <code>mockConfig.json</code>，内容如下：</p>\n<p>可以直接修改返回结果：</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>https://xxxx tpl://{mockConfig.json}\n</code></pre></div><h3>注入 eruda</h3>\n<p>安装 <code>whistle.inspect</code> 插件，该插件即成了 <a href=\"https://github.com/liriliri/eruda\" target=\"_blank\" rel=\"noopener noreferrer\">eruda</a> 等调试工具，用来在移动端页面上模拟 Chrome 开发者工具功能的模块。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code>w2 i whistle.inspect\n</code></pre></div><p>配置如下：</p>\n<div class=\"language-text\" data-ext=\"text\" data-title=\"text\"><pre class=\"language-text\"><code>https://localhost:3000/index.html whistle.inspect://eruda disable://cache\n</code></pre></div><p>这个配置的作用是当访问到 <code>localhost:3000</code> 时，页面会自动注入 <code>eruda</code> 调试工具。</p>\n<h2>Chrome inspect</h2>\n<p>有些时候，使用 <code>whistle</code> 注入调试工具的效果并不是很好，因此我们可以使用 Chrome inspect 来替代。</p>\n<h3>准备工作</h3>\n<p>需要的工具：</p>\n<ul>\n<li>PC 安装 Chrome 浏览器</li>\n<li>安卓手机</li>\n<li>数据线</li>\n</ul>\n<h3>操作步骤</h3>\n<p>打开手机开发者选项，允许 USB 调试。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>不同安卓设备打开方式不同，根据品牌谷歌搜索打开方式。</p>\n</div>\n<p>谷歌浏览器输入 <code>chrome://inspect/</code> 打开调试工具，点击 <code>inspect</code> 按钮即可调试网页。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240821141307.png\" alt=\"inspect\" tabindex=\"0\" loading=\"lazy\"><figcaption>inspect</figcaption></figure>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>应该只能调试 chrome 内核的浏览器。</p>\n</div>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240729163103.png",
      "date_published": "2024-07-29T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "快速开始",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/01-quick-start.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/framework/pixi/01-quick-start.html",
      "summary": "PixiJS 的核心是一个使用 WebGL（或 Canvas）显示图像或其他 2D 可视化内容的呈现系统。 它提供了一个完整的场景图（要呈现的对象的层次结构），并提供交互支持以处理点击和触摸事件。 在现代 HTML5 世界中，它是 Flash 的天然替代品，但却能提供更好的性能和像素级的效果，超越了 Flash 所能达到的水平。 它非常适合网络游戏、教...",
      "content_html": "<p><a href=\"https://pixijs.com/\" target=\"_blank\" rel=\"noopener noreferrer\">PixiJS</a> 的核心是一个使用 WebGL（或 Canvas）显示图像或其他 <strong>2D</strong> 可视化内容的呈现系统。</p>\n<p>它提供了一个完整的场景图（要呈现的对象的层次结构），并提供交互支持以处理点击和触摸事件。</p>\n<p>在现代 HTML5 世界中，它是 Flash 的天然替代品，但却能提供更好的性能和像素级的效果，超越了 Flash 所能达到的水平。</p>\n<p>它非常适合网络游戏、教育内容、交互式广告、数据可视化......任何基于网络的、需要复杂图形的应用程序。</p>\n<p>与 Cordova 和 Electron 等技术相结合，PixiJS 应用程序可以作为移动和桌面应用程序在浏览器之外发布。</p>\n<h2>创建 pixi 应用</h2>\n<p><code>Application</code> 是一个简化 PixiJS 工作的辅助类。 它能创建呈现器、创建舞台并启动一个用于更新的 ticker。</p>\n<p><code>Application</code> 类还有一个 <code>init</code> 方法，它将使用给定的选项初始化应用程序。因为 PixiJS 使用了 WebGPU，因此该方法是异步的。</p>\n<div class=\"language-html\" data-ext=\"html\" data-title=\"html\"><pre class=\"language-html\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">&gt;</span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://pixijs.download/release/pixi.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span>Hello PixiJS<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">360</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">)</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240719160224.png\" alt=\"create pixi app\" tabindex=\"0\" loading=\"lazy\"><figcaption>create pixi app</figcaption></figure>\n<h2>创建 Sprite</h2>\n<p>到目前为止，我们所做的只是准备工作。 我们还没有告诉 PixiJS 绘制任何东西。 让我们添加一张要显示的图片来解决这个问题。</p>\n<p>在 PixiJS 中绘制图像有多种方法，但最简单的方法是使用 <a href=\"https://pixijs.download/release/docs/scene.Sprite.html\" target=\"_blank\" rel=\"noopener noreferrer\">Sprite</a>。 Sprite 是一种容器类型，它封装了加载的图像资源，允许对其进行绘制、缩放、旋转等操作。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// load the PNG asynchronously</span>\n<span class=\"token keyword\">await</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Assets<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sample.png'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> sprite <span class=\"token operator\">=</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Sprite<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sample.png'</span><span class=\"token punctuation\">)</span>\n</code></pre></div><figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/sample.png\" alt=\"sample\" tabindex=\"0\" loading=\"lazy\"><figcaption>sample</figcaption></figure>\n<h2>将 Sprite 添加至 Stage</h2>\n<p>最后，我们需要将 Sprite 添加到 Stage 上。Stage 只是一个容器，是场景图的根。Stage 容器的每个子容器都将在每一帧中进行渲染。将 Sprite 添加到 Stage 后，我们就告诉了 PixiJS 的渲染器我们要绘制它。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>app<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>sprite<span class=\"token punctuation\">)</span>\n</code></pre></div><h2>更新 loop</h2>\n<p>虽然可以将 PixiJS 用于静态内容，但对于大多数项目而言，都希望添加动画。</p>\n<p>示例应用程序希望每秒在同一位置多次渲染同一个 Sprite。</p>\n<p>要使图像移动，我们只需每帧更新一次属性即可。为此，我们要挂钩应用程序的 <code>ticker</code>。<code>ticker</code> 是一个 PixiJS 对象，每帧运行一个或多个回调。</p>\n<p>只需调用 <code>app.ticker.add(...)</code>，给它传递一个回调函数，然后在该函数中更新场景。它将在每一帧中被调用，你可以移动、旋转等任何你想要的方式来驱动项目的动画。</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token comment\">// Add a variable to count up the seconds our demo has been running</span>\n<span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\n<span class=\"token comment\">// Tell our application's ticker to run a new callback every frame, passing</span>\n<span class=\"token comment\">// in the amount of time that has passed since the last tick</span>\napp<span class=\"token punctuation\">.</span>ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ticker</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Add the time to our total elapsed time</span>\n  elapsed <span class=\"token operator\">+=</span> ticker<span class=\"token punctuation\">.</span>deltaTime\n  <span class=\"token comment\">// Update the sprite's X position based on the cosine of our elapsed time.  We divide</span>\n  <span class=\"token comment\">// by 50 to slow the animation down a bit...</span>\n  sprite<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">100.0</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>elapsed <span class=\"token operator\">/</span> <span class=\"token number\">50.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100.0</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>all done</h2>\n<p>现在，我们已经创建了一个简单的应用程序，可以在浏览器中运行。</p>\n<div class=\"language-html\" data-ext=\"html\" data-title=\"html\"><pre class=\"language-html\"><code><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://pixijs.download/release/pixi.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token comment\">// Create the application helper and add its render target to the page</span>\n      <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PIXI<span class=\"token punctuation\">.</span>Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">640</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">360</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// Create the sprite and add it to the stage</span>\n      <span class=\"token keyword\">await</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Assets<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sample.png'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">let</span> sprite <span class=\"token operator\">=</span> <span class=\"token constant\">PIXI</span><span class=\"token punctuation\">.</span>Sprite<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sample.png'</span><span class=\"token punctuation\">)</span>\n      app<span class=\"token punctuation\">.</span>stage<span class=\"token punctuation\">.</span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span>sprite<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// Add a ticker callback to move the sprite back and forth</span>\n      <span class=\"token keyword\">let</span> elapsed <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\n      app<span class=\"token punctuation\">.</span>ticker<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ticker</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        elapsed <span class=\"token operator\">+=</span> ticker<span class=\"token punctuation\">.</span>deltaTime\n        sprite<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">100.0</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>elapsed <span class=\"token operator\">/</span> <span class=\"token number\">50.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100.0</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div>",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240719160224.png",
      "date_published": "2024-07-19T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "Pixi"
      ]
    },
    {
      "title": "数据库结构设计",
      "url": "https://dribble-njr.github.io/blog/blog/project/imperial-kitchen/03-database.html",
      "id": "https://dribble-njr.github.io/blog/blog/project/imperial-kitchen/03-database.html",
      "summary": " 注意 Deprecated. 已改用 prisma + Mysql 数据库。 数据库选择 选择使用云数据库 turso。 Turso 是一个兼容 SQLite 的数据库，基于 libSQL（SQLite 的开放贡献分叉）构建。 它可以将每个组织的数据库扩展到数十万个，并支持复制到任何位置，包括您自己的服务器，以实现微秒级延迟访问。 user cate...",
      "content_html": "<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>Deprecated. 已改用 prisma + Mysql 数据库。</p>\n</div>\n<h2>数据库选择</h2>\n<p>选择使用云数据库 <a href=\"https://docs.turso.tech/introduction\" target=\"_blank\" rel=\"noopener noreferrer\">turso</a>。</p>\n<p>Turso 是一个兼容 SQLite 的数据库，基于 libSQL（SQLite 的开放贡献分叉）构建。 它可以将每个组织的数据库扩展到数十万个，并支持复制到任何位置，包括您自己的服务器，以实现微秒级延迟访问。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> InStatement<span class=\"token punctuation\">,</span> LibsqlError<span class=\"token punctuation\">,</span> createClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@libsql/client'</span>\n\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token function\">createClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  url<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TURSO_URL</span> <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  authToken<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TURSO_AUTH_TOKEN</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h2>user</h2>\n<div class=\"language-sql\" data-ext=\"sql\" data-title=\"sql\"><pre class=\"language-sql\"><code><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token string\">\"user\"</span> <span class=\"token punctuation\">(</span>\n  ID <span class=\"token keyword\">INTEGER</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> AUTOINCREMENT<span class=\"token punctuation\">,</span>\n  name <span class=\"token keyword\">TEXT</span>\n<span class=\"token punctuation\">,</span> password <span class=\"token keyword\">TEXT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>category</h2>\n<div class=\"language-sql\" data-ext=\"sql\" data-title=\"sql\"><pre class=\"language-sql\"><code><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> category <span class=\"token punctuation\">(</span>\nid <span class=\"token keyword\">INTEGER</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\nname <span class=\"token keyword\">TEXT</span><span class=\"token punctuation\">,</span>\ndescription <span class=\"token keyword\">TEXT</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h2>commodity</h2>\n<div class=\"language-sql\" data-ext=\"sql\" data-title=\"sql\"><pre class=\"language-sql\"><code><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> commodity <span class=\"token punctuation\">(</span>\nid <span class=\"token keyword\">INTEGER</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span>\nname <span class=\"token keyword\">TEXT</span><span class=\"token punctuation\">,</span>\nprice <span class=\"token keyword\">REAL</span><span class=\"token punctuation\">,</span>\ndescription <span class=\"token keyword\">TEXT</span><span class=\"token punctuation\">,</span>\ncategory_id <span class=\"token keyword\">INTEGER</span><span class=\"token punctuation\">,</span>\n<span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>category_id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> category<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>",
      "date_published": "2024-07-11T00:00:00.000Z",
      "date_modified": "2024-12-17T10:16:46.000Z",
      "authors": [],
      "tags": [
        "Project"
      ]
    },
    {
      "title": "服务器架构设计",
      "url": "https://dribble-njr.github.io/blog/blog/project/imperial-kitchen/02-server.html",
      "id": "https://dribble-njr.github.io/blog/blog/project/imperial-kitchen/02-server.html",
      "summary": " 注意 Deprecated. 已改用 nest.js 框架。 分层架构 route 分发路由，如：/category。匹配后的路由包含 controller 和 路由特定的 middleware。 middleware 中间件，处理请求中间逻辑，比如：cors、auth 等。 以 corsMiddleware 为例： controller 控制层，处...",
      "content_html": "<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>Deprecated. 已改用 nest.js 框架。</p>\n</div>\n<h2>分层架构</h2>\n<h3>route</h3>\n<p>分发路由，如：<code>/category</code>。匹配后的路由包含 <code>controller</code> 和 路由特定的 <code>middleware</code>。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Router</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> Route <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Route</span> <span class=\"token punctuation\">{</span>\n  controller<span class=\"token operator\">:</span> Controller<span class=\"token punctuation\">;</span>\n  middlewares<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Middleware<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// route-specific middleware</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>middleware</h3>\n<p>中间件，处理请求中间逻辑，比如：<code>cors</code>、<code>auth</code> 等。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Middleware</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> CustomIncomingMessage<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> ServerResponse<span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">next</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span>\n\n<span class=\"token doc-comment comment\">/**\n * Manage the execution order of middleware functions.\n * It allows you to add multiple middleware functions to a queue\n * and execute them sequentially during a request.\n *\n * <span class=\"token keyword\">@export</span>\n * <span class=\"token keyword\">@class</span> MiddlewareManager\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MiddlewareManager</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> middlewares<span class=\"token operator\">:</span> Middleware<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>middlewares <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>func<span class=\"token operator\">:</span> Middleware<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">run</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> CustomIncomingMessage<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> ServerResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runner</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> middleware <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>middleware<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> <span class=\"token function\">middleware</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token function\">runner</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">runner</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>以 <code>corsMiddleware</code> 为例：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">const</span> corsMiddleware <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> origin<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> methods<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> credentials<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Middleware <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>origin<span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Methods'</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>methods<span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Headers'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Content-Type, Authorization'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>credentials<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Credentials'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// Handle preflight requests</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>method <span class=\"token operator\">===</span> <span class=\"token string\">'OPTIONS'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      res<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">=</span> <span class=\"token number\">204</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> corsMiddleware\n</code></pre></div><h3>controller</h3>\n<p>控制层，处理请求参数和请求体数据，分发业务逻辑。一个抽象基类，提供 <code>sendResponse</code> 和 <code>sendError</code> 方法。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Controller</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> CustomIncomingMessage<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> ServerResponse<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token keyword\">void</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token function\">sendResponse</span><span class=\"token punctuation\">(</span>statusCode<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> ServerResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content-type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span>statusCode<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// handle bigint</span>\n    <span class=\"token keyword\">let</span> responseData<span class=\"token operator\">:</span> <span class=\"token builtin\">unknown</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> data <span class=\"token operator\">===</span> <span class=\"token string\">'bigint'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data <span class=\"token operator\">&lt;=</span> Number<span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_SAFE_INTEGER</span> <span class=\"token operator\">&amp;&amp;</span> data <span class=\"token operator\">&gt;=</span> Number<span class=\"token punctuation\">.</span><span class=\"token constant\">MIN_SAFE_INTEGER</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        responseData <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        responseData <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      responseData <span class=\"token operator\">=</span> data\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> response<span class=\"token operator\">:</span> Response <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      code<span class=\"token operator\">:</span> statusCode<span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token string\">'OK'</span><span class=\"token punctuation\">,</span>\n      data<span class=\"token operator\">:</span> responseData\n    <span class=\"token punctuation\">}</span>\n\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">protected</span> <span class=\"token function\">sendError</span><span class=\"token punctuation\">(</span>statusCode<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> ServerResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content-type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span>statusCode<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> response<span class=\"token operator\">:</span> Response <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      code<span class=\"token operator\">:</span> statusCode<span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> error<span class=\"token operator\">:</span> message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>以 <code>UserController</code> 为例：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> userService<span class=\"token operator\">:</span> UserService\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>userService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">signIn</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> CustomIncomingMessage<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> ServerResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token generic-function\"><span class=\"token function\">getRequestBody</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SignInParams<span class=\"token operator\">&gt;</span></span></span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// TODO: verify parameters.</span>\n\n      <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>userService<span class=\"token punctuation\">.</span><span class=\"token function\">signIn</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'All time: '</span><span class=\"token punctuation\">,</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span>\n      UserController<span class=\"token punctuation\">.</span><span class=\"token function\">sendResponse</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> message<span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      UserController<span class=\"token punctuation\">.</span><span class=\"token function\">sendResponse</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'Internal Server Error'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> error\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>service</h3>\n<p>服务层，处理业务逻辑。<code>BaseService</code> 为抽象基类，提供 <code>db</code> 属性。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">protected</span> db<span class=\"token operator\">:</span> <span class=\"token constant\">DB</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>db <span class=\"token operator\">=</span> <span class=\"token constant\">DB</span><span class=\"token punctuation\">.</span><span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><p>以 <code>UserService</code> 为例：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// sign-in</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">signIn</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> SignInParams<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Response<span class=\"token operator\">&lt;</span><span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">&gt;&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">'SELECT * FROM users WHERE name = ?'</span>\n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>db<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> sql<span class=\"token punctuation\">,</span> args<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> usersInfo<span class=\"token operator\">:</span> User<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>rows<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token constant\">ID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      name<span class=\"token operator\">:</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      password<span class=\"token operator\">:</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Check if the user exists.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>usersInfo<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        code<span class=\"token operator\">:</span> <span class=\"token number\">401</span><span class=\"token punctuation\">,</span>\n        message<span class=\"token operator\">:</span> <span class=\"token string\">'Access to the requested resource is unauthorized. Please authenticate.'</span><span class=\"token punctuation\">,</span>\n        data<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// Check if the password matches.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>usersInfo<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">!==</span> data<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        code<span class=\"token operator\">:</span> <span class=\"token number\">401</span><span class=\"token punctuation\">,</span>\n        message<span class=\"token operator\">:</span> <span class=\"token string\">'Access to the requested resource is unauthorized. Please authenticate.'</span><span class=\"token punctuation\">,</span>\n        data<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// All checks passed, return success message or token</span>\n    <span class=\"token comment\">// TODO: generate token.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> code<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'Login successful'</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>dao</h3>\n<p>数据访问层，处理数据查询。提供 <code>execute</code> 方法执行 <code>sql</code>。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\"><span class=\"token constant\">DB</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> instance<span class=\"token operator\">:</span> <span class=\"token constant\">DB</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token constant\">DB</span><span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">DB</span><span class=\"token punctuation\">.</span>instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">DB</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">DB</span><span class=\"token punctuation\">.</span>instance\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>stmt<span class=\"token operator\">:</span> InStatement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>stmt<span class=\"token punctuation\">)</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Query time: '</span><span class=\"token punctuation\">,</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> res\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">LibsqlError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Execution failed: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">An error occurred: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token constant\">DB</span>\n</code></pre></div><h2>其他细节</h2>\n<h3>请求体处理</h3>\n<p>目前允许 <code>POST</code> 和 <code>PUT</code> 请求携带请求体。</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getRequestBody <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">&gt;</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> CustomIncomingMessage<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">&gt;</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>method <span class=\"token operator\">!==</span> <span class=\"token string\">'POST'</span> <span class=\"token operator\">&amp;&amp;</span> req<span class=\"token punctuation\">.</span>method <span class=\"token operator\">!==</span> <span class=\"token string\">'PUT'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'content-type'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">let</span> postData <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n      req<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>chunk<span class=\"token operator\">:</span> Buffer<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        postData <span class=\"token operator\">+=</span> chunk<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      req<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>postData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>postData<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h3>路径参数处理</h3>\n<p>路由规则：<code>method</code> + <code>path</code> + <code>query</code>，如 <code>GET/category/:id</code>。</p>\n<p>其中 <code>path</code> 需要进行参数处理，如：<code>/category/:id</code>。处理完后参数类型应为 <code>params: Record&lt;string, string&gt;</code>，因为可能存在多个参数。</p>\n<p>解析完成后，<code>controller</code> 中需要接收 <code>params</code>，需要将 <code>params</code> 转换为 <code>request.params</code>。</p>\n<p>具体逻辑如下：</p>\n<div class=\"language-typescript\" data-ext=\"ts\" data-title=\"ts\"><pre class=\"language-typescript\"><code><span class=\"token doc-comment comment\">/**\n * Execute route's middleware and controller.\n *\n * <span class=\"token keyword\">@param</span> <span class=\"token punctuation\">{</span>CustomIncomingMessage<span class=\"token punctuation\">}</span> req\n * <span class=\"token keyword\">@param</span> <span class=\"token punctuation\">{</span>ServerResponse<span class=\"token punctuation\">}</span> res\n * <span class=\"token keyword\">@param</span> <span class=\"token punctuation\">{</span>Route<span class=\"token punctuation\">}</span> route\n */</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>\n  req<span class=\"token operator\">:</span> CustomIncomingMessage<span class=\"token punctuation\">,</span>\n  res<span class=\"token operator\">:</span> ServerResponse<span class=\"token punctuation\">,</span>\n  route<span class=\"token operator\">:</span> Route<span class=\"token punctuation\">,</span>\n  params<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token operator\">&gt;</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> mwManager <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MiddlewareManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  req<span class=\"token punctuation\">.</span>params <span class=\"token operator\">=</span> params\n\n  <span class=\"token keyword\">const</span> cors <span class=\"token operator\">=</span> <span class=\"token function\">corsMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    origin<span class=\"token operator\">:</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span>\n    methods<span class=\"token operator\">:</span> <span class=\"token string\">'GET,HEAD,PUT,PATCH,POST,DELETE'</span><span class=\"token punctuation\">,</span>\n    credentials<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  mwManager<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>cors<span class=\"token punctuation\">)</span>\n\n  route<span class=\"token punctuation\">.</span>middlewares<span class=\"token operator\">?.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> mwManager<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  mwManager<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>controller<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">await</span> mwManager<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token doc-comment comment\">/**\n * Matches the provided method and pathname to a route in the Router.\n *\n * <span class=\"token keyword\">@param</span> <span class=\"token punctuation\">{</span>string<span class=\"token punctuation\">}</span> method - The HTTP method to match.\n * <span class=\"token keyword\">@param</span> <span class=\"token punctuation\">{</span>string<span class=\"token punctuation\">}</span> pathname - The URL pathname to match.\n * <span class=\"token keyword\">@return</span> <span class=\"token punctuation\">{</span>Object<span class=\"token punctuation\">}</span> An object containing the matched route and parameters.\n */</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">matchRoute</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>method<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> pathname<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> router <span class=\"token keyword\">in</span> Router<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>routeMethod<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>routeParts<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>method <span class=\"token operator\">===</span> routeMethod<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> pathParts <span class=\"token operator\">=</span> pathname<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>routeMethod<span class=\"token punctuation\">,</span> routeParts<span class=\"token punctuation\">,</span> pathParts<span class=\"token punctuation\">,</span> pathname<span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>routeParts<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> pathParts<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> params<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token operator\">&gt;</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> match <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> routeParts<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>routeParts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">':'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            params<span class=\"token punctuation\">[</span>routeParts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pathParts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>routeParts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> pathParts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            match <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n            <span class=\"token keyword\">break</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> route<span class=\"token operator\">:</span> Router<span class=\"token punctuation\">[</span>router<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> params <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> route<span class=\"token operator\">:</span> notFound<span class=\"token punctuation\">,</span> params<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>",
      "date_published": "2024-07-11T00:00:00.000Z",
      "date_modified": "2024-12-17T10:16:46.000Z",
      "authors": [],
      "tags": [
        "Project"
      ]
    },
    {
      "title": "rest client 无法调试 localhost",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/016-rest-client-error.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/016-rest-client-error.html",
      "summary": "故障描述 REST Client 插件无法调试 localhost。 REST Client: v0.25.1 VS code: 1.91.1 本地启动 node 服务，使用 REST Client 发送请求： 报错报错 排查 初步怀疑是走了代理，但是查看代理软件日志，发现并没有可疑请求走了国外代理。 最终在 github 中找到了一个 issue: ...",
      "content_html": "<h2>故障描述</h2>\n<p>REST Client 插件无法调试 localhost。</p>\n<ul>\n<li>REST Client: v0.25.1</li>\n<li>VS code: 1.91.1</li>\n</ul>\n<p>本地启动 node 服务，使用 REST Client 发送请求：</p>\n<div class=\"language-http\" data-ext=\"http\" data-title=\"http\"><pre class=\"language-http\"><code><span class=\"token request-line\"><span class=\"token method property\">GET</span> <span class=\"token request-target url\">http://127.0.0.1:8000/</span> <span class=\"token http-version property\">HTTP/1.1</span></span>\n</code></pre></div><figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240719143258.png\" alt=\"报错\" tabindex=\"0\" loading=\"lazy\"><figcaption>报错</figcaption></figure>\n<h2>排查</h2>\n<p>初步怀疑是走了代理，但是查看代理软件日志，发现并没有可疑请求走了国外代理。</p>\n<p>最终在 github 中找到了一个 issue: <a href=\"https://github.com/Huachao/vscode-restclient/issues/1163\" target=\"_blank\" rel=\"noopener noreferrer\">Rest client ceased to work</a>。</p>\n<p>并在下方回答中找到：<a href=\"https://github.com/Huachao/vscode-restclient/issues/1145\" target=\"_blank\" rel=\"noopener noreferrer\">ECONNREFUSED - Connection was Rejected</a>。</p>\n<p>将代码改为以下即可成功：</p>\n<div class=\"language-http\" data-ext=\"http\" data-title=\"http\"><pre class=\"language-http\"><code><span class=\"token request-line\"><span class=\"token method property\">GET</span> <span class=\"token request-target url\">http://[::1]:8000/</span> <span class=\"token http-version property\">HTTP/1.1</span></span>\n</code></pre></div>",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240719143258.png",
      "date_published": "2024-07-19T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "dnd-kit 踩坑",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/001-dnd-kit.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/001-dnd-kit.html",
      "summary": "@dnd-kit - 用于 React 的轻量级、模块化、高性能、可访问和可扩展的拖放工具包。 Context Provider 踩坑 dnd kit 会将鼠标点击事件识别为拖拽事件 https://github.com/clauderic/dnd-kit/issues/1204 https://github.com/clauderic/dnd-kit...",
      "content_html": "<p>@dnd-kit - 用于 React 的轻量级、模块化、高性能、可访问和可扩展的拖放工具包。</p>\n<h2>Context Provider</h2>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">SortableItem</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  <span class=\"token function-variable function\">itemRender</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> ReactElement\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> attributes<span class=\"token punctuation\">,</span> listeners<span class=\"token punctuation\">,</span> setNodeRef<span class=\"token punctuation\">,</span> transform<span class=\"token punctuation\">,</span> transition <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span>\n    <span class=\"token function\">useSortable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    transform<span class=\"token operator\">:</span> <span class=\"token constant\">CSS</span><span class=\"token punctuation\">.</span>Transform<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span>transform<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    transition<span class=\"token operator\">:</span> transition<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n    cursor<span class=\"token operator\">:</span> <span class=\"token string\">'move'</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n      <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mr-2<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>setNodeRef<span class=\"token punctuation\">}</span></span>\n      <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>style <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>attributes<span class=\"token punctuation\">}</span></span>\n      <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>listeners<span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">itemRender</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div><h2>踩坑</h2>\n<h3>dnd kit 会将鼠标点击事件识别为拖拽事件</h3>\n<p><a href=\"https://github.com/clauderic/dnd-kit/issues/1204\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/clauderic/dnd-kit/issues/1204</a></p>\n<p><a href=\"https://github.com/clauderic/dnd-kit/issues/893\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/clauderic/dnd-kit/issues/893</a></p>\n<p>需要注册一些传感器：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> sensor <span class=\"token operator\">=</span> <span class=\"token function\">useSensor</span><span class=\"token punctuation\">(</span>PointerSensor<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">activationConstraint</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">distance</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h3>条件拖拽</h3>\n<p>让元素在某些条件下允许排序：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> attributes<span class=\"token punctuation\">,</span> listeners<span class=\"token punctuation\">,</span> setNodeRef<span class=\"token punctuation\">,</span> transform<span class=\"token punctuation\">,</span> transition <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span>\n  <span class=\"token function\">useSortable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">disabled</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>disabled <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div><h3>video 元素无法被拖拽</h3>\n<p>外层包裹一个 <code>div</code>。</p>\n<div class=\"language-tsx\" data-ext=\"tsx\" data-title=\"tsx\"><pre class=\"language-tsx\"><code><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n  <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>videoItem<span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">onMouseEnter</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    videoRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">onMouseLeave</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    videoRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span><span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span>\n    <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>videoRef<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">.</span>resourceUrl<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">controls</span>\n    <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">.</span>video<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">muted</span>\n    <span class=\"token attr-name\">loop</span>\n  <span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>track</span> <span class=\"token attr-name\">kind</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>captions<span class=\"token punctuation\">\"</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>video</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><h3>拖拽动画异常</h3>\n<p>排序策略</p>\n<p>需要选择默认</p>\n<h3>无限拖拽出现滚动条</h3>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code>modifiers<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>restrictToFirstScrollableAncestor<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n</code></pre></div><h3>鼠标跟手</h3>\n<p><a href=\"https://github.com/clauderic/dnd-kit/issues/122\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/clauderic/dnd-kit/issues/122</a><br>\n<a href=\"https://github.com/clauderic/dnd-kit/pull/334\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/clauderic/dnd-kit/pull/334</a></p>\n<p><a href=\"https://github.com/clauderic/dnd-kit/blob/master/stories/components/Draggable/DraggableOverlay.tsx\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/clauderic/dnd-kit/blob/master/stories/components/Draggable/DraggableOverlay.tsx</a></p>\n",
      "date_published": "2023-11-23T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "自动切换 node 版本",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/practice/015-auto-change-node.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/practice/015-auto-change-node.html",
      "summary": "环境准备 安装 nvm 安装 oh-my-zsh： 配置 .zshrc 在 .zshrc 下新增以下内容：vi ~/.zshrc 保存 .zshrc 文件后，重启终端或重新加载配置：source ~/.zshrc。 提示 oh-my-zsh 中的 nvm 提供了一些快捷命令和自动补全功能，使得使用 nvm (Node Version Manager) ...",
      "content_html": "<h2>环境准备</h2>\n<ol>\n<li>安装 <code>nvm</code><div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">curl</span> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.2/install.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span>\n</code></pre></div></li>\n<li>安装 <code>oh-my-zsh</code>：<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">sh</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span class=\"token variable\">)</span></span>\"</span>\n</code></pre></div></li>\n</ol>\n<h2>配置 <code>.zshrc</code></h2>\n<p>在 <code>.zshrc</code> 下新增以下内容：<code>vi ~/.zshrc</code></p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token comment\"># Load nvm and set up automatic version switching</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NVM_DIR</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token string\">\"<span class=\"token variable\">${XDG_CONFIG_HOME-}</span>\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">printf</span> %s <span class=\"token string\">\"<span class=\"token variable\">${<span class=\"token environment constant\">HOME</span>}</span>/.nvm\"</span> <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">printf</span> %s <span class=\"token string\">\"<span class=\"token variable\">${XDG_CONFIG_HOME}</span>/nvm\"</span><span class=\"token variable\">)</span></span>\"</span>\n<span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-s</span> <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/nvm.sh\"</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>. <span class=\"token string\">\"<span class=\"token variable\">$NVM_DIR</span>/nvm.sh\"</span> <span class=\"token comment\"># This loads nvm</span>\n\n<span class=\"token comment\"># Enable oh-my-zsh plugins</span>\n<span class=\"token assign-left variable\">plugins</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>git z nvm zsh-syntax-highlighting zsh-autosuggestions<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Load oh-my-zsh</span>\n<span class=\"token builtin class-name\">source</span> <span class=\"token variable\">$ZSH</span>/oh-my-zsh.sh\n\n<span class=\"token comment\"># oh-my-zsh nvm plugin settings</span>\nzstyle <span class=\"token string\">':omz:plugins:nvm'</span> lazy <span class=\"token function\">yes</span>\nzstyle <span class=\"token string\">':omz:plugins:nvm'</span> autoload <span class=\"token function\">yes</span>\nzstyle <span class=\"token string\">':omz:plugins:nvm'</span> silent-autoload <span class=\"token function\">yes</span>\n\n<span class=\"token comment\"># Load nvm automatically when changing directories</span>\nautoload <span class=\"token parameter variable\">-U</span> add-zsh-hook\n<span class=\"token function-name function\">load-nvmrc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> .nvmrc <span class=\"token operator\">&amp;&amp;</span> <span class=\"token parameter variable\">-r</span> .nvmrc <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    nvm use\n  <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>nvm version<span class=\"token variable\">)</span></span> <span class=\"token operator\">!=</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>nvm version default<span class=\"token variable\">)</span></span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    nvm use default\n  <span class=\"token keyword\">fi</span>\n<span class=\"token punctuation\">}</span>\nadd-zsh-hook chpwd load-nvmrc\nload-nvmrc\n</code></pre></div><p>保存 <code>.zshrc</code> 文件后，重启终端或重新加载配置：<code>source ~/.zshrc</code>。</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p><code>oh-my-zsh</code> 中的 <code>nvm</code> 提供了一些快捷命令和自动补全功能，使得使用 nvm (Node Version Manager) 更加便捷。</p>\n</div>\n<h2>添加 <code>.nvmrc</code></h2>\n<p>项目根目录下创建 <code>.nvmrc</code> 文件，内容为 <code>v20.10.0</code>。</p>\n<figure><img src=\"https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240718145716.png\" alt=\"auto-change-node\" tabindex=\"0\" loading=\"lazy\"><figcaption>auto-change-node</figcaption></figure>\n",
      "image": "https://raw.githubusercontent.com/dribble-njr/typora-njr/master/img/20240718145716.png",
      "date_published": "2024-07-18T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "practice"
      ]
    },
    {
      "title": "快速开始",
      "url": "https://dribble-njr.github.io/blog/blog/backend/database/sql/01-quick-start.html",
      "id": "https://dribble-njr.github.io/blog/blog/backend/database/sql/01-quick-start.html",
      "summary": "SQL (Structured Query Language:结构化查询语言) 是用于管理关系数据库管理系统。 SQL 通过一系列的语句和命令来执行数据定义、数据查询、数据操作和数据控制等功能,包括数据插入、查询、更新和删除，数据库模式创建和修改，以及数据访问控制。 SQL 是什么？ SQL 指结构化查询语言，全称是 Structured Query ...",
      "content_html": "<p>SQL (Structured Query Language:结构化查询语言) 是用于管理关系数据库管理系统。</p>\n<p>SQL 通过一系列的语句和命令来执行数据定义、数据查询、数据操作和数据控制等功能,包括数据插入、查询、更新和删除，数据库模式创建和修改，以及数据访问控制。</p>\n<h2>SQL 是什么？</h2>\n<ul>\n<li>SQL 指结构化查询语言，全称是 Structured Query Language。</li>\n<li>SQL 让您可以访问和处理数据库，包括数据插入、查询、更新和删除。</li>\n<li>SQL 语言采用英语关键词，使其易读易写。</li>\n<li>SQL 由国际标准化组织（ISO）和美国国家标准协会（ANSI）标准化。</li>\n<li>SQL 提供了丰富的操作数据的功能，从简单的查询到复杂的数据库管理操作。</li>\n</ul>\n<h2>SQL 能做什么？</h2>\n<ul>\n<li>SQL 面向数据库执行查询</li>\n<li>SQL 可从数据库取回数据</li>\n<li>SQL 可在数据库中插入新的记录</li>\n<li>SQL 可更新数据库中的数据</li>\n<li>SQL 可从数据库删除记录</li>\n<li>SQL 可创建新数据库</li>\n<li>SQL 可在数据库中创建新表</li>\n<li>SQL 可在数据库中创建存储过程</li>\n<li>SQL 可在数据库中创建视图</li>\n<li>SQL 可以设置表、存储过程和视图的权限</li>\n</ul>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>虽然 SQL 是一门 ANSI（American National Standards Institute 美国国家标准化组织）标准的计算机语言，但是仍然存在着多种不同版本的 SQL 语言。</p>\n<p>然而，为了与 ANSI 标准相兼容，它们必须以相似的方式共同地来支持一些主要的命令（比如 SELECT、UPDATE、DELETE、INSERT、WHERE 等等）。</p>\n</div>\n<h2>SQL 发展历史</h2>\n<p>以下是 SQL 发展历史的关键节点：</p>\n<h3>1970s: 起源与早期发展</h3>\n<ol>\n<li>1970 年：埃德加·科德（Edgar F. Codd）发表了《A Relational Model of Data for Large Shared Data Banks》论文，提出了关系数据库的概念，为 SQL 的发展奠定了理论基础。</li>\n<li>1973 年-1974 年：IBM 的研究人员 Donald D. Chamberlin 和 Raymond F. Boyce 在科德的理论基础上开发了一种名为 SEQUEL（Structured English Query Language）的语言，用于操作和管理 IBM 的 System R 关系数据库。</li>\n<li>1976 年：SEQUEL 更名为 SQL（Structured Query Language）。</li>\n</ol>\n<h3>1980s: 标准化与商业化</h3>\n<ol start=\"4\">\n<li>1981 年：IBM 推出了商用关系数据库系统 SQL/DS（Database System）和 DB2（Database 2）。</li>\n<li>1986 年：美国国家标准协会（ANSI）发布了第一个 SQL 标准 ANSI SQL-86（SQL-87）。</li>\n<li>1987 年：国际标准化组织（ISO）也采纳了 ANSI SQL-86 作为国际标准。</li>\n</ol>\n<h3>1990s: 扩展与改进</h3>\n<ol start=\"7\">\n<li>1992 年：发布了 SQL-92（SQL2）标准，显著扩展了 SQL 语言的功能，包括对新数据类型、嵌套查询和连接的支持。</li>\n<li>1999 年：发布了 SQL:1999（SQL3）标准，引入了对象关系数据库（ORDBMS）特性、递归查询、触发器和用户定义函数。</li>\n</ol>\n<h3>2000s: 持续演进与新特性</h3>\n<ol start=\"9\">\n<li>2003 年：发布了 SQL:2003 标准，引入了 XML 相关特性和窗口函数。</li>\n<li>2006 年：发布了 SQL:2006 标准，主要增强了对 XML 的支持。</li>\n<li>2008 年：发布了 SQL:2008 标准，进一步改进了语法和性能优化。</li>\n</ol>\n<h3>2010s: 新功能与大数据支持</h3>\n<ol start=\"12\">\n<li>2011 年：发布了 SQL:2011 标准，增加了对时间数据类型和时间旅行（temporal data）的支持。</li>\n<li>2016 年：发布了 SQL:2016 标准，引入了 JSON 数据类型和相关操作函数，适应了 NoSQL 数据库和大数据处理需求。</li>\n</ol>\n<h3>2020s: 现代化与标准更新</h3>\n<ol start=\"14\">\n<li>2023 年：最新的 SQL 标准持续改进，增加了对更现代化的数据库需求和特性的支持。</li>\n</ol>\n<h2>总结</h2>\n<p>SQL 从一种基于关系模型的查询语言发展成为现代数据库管理的核心语言，其标准在不断演进和扩展。</p>\n<p>各大数据库管理系统（如 MySQL、PostgreSQL、SQLite、SQL Server、Oracle 等）在遵循 SQL 标准的基础上，加入了自身的扩展和优化，使 SQL 成为数据操作和管理的强大工具。</p>\n<p>SQL 的发展不仅体现了技术的进步，也反映了数据管理需求的变化和增长。</p>\n",
      "date_published": "2024-07-17T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "database"
      ]
    },
    {
      "title": "修改提交",
      "url": "https://dribble-njr.github.io/blog/blog/reading/pro-git/06-change-commit.html",
      "id": "https://dribble-njr.github.io/blog/blog/reading/pro-git/06-change-commit.html",
      "summary": "修改提交信息 在 Git 中，修改提交是通过 git commit --amend 命令来完成的。 此时就能出现一个交互式的修改提交窗口，可以修改提交信息，添加文件，或者删除文件。 修改作者信息 由于某次提交时不小心将 git user 改成了其他账户，在后续 commit 时提交了错误的用户信息，需要手动修改：git rebase -i <commi...",
      "content_html": "<h2>修改提交信息</h2>\n<p>在 Git 中，修改提交是通过 <code>git commit --amend</code> 命令来完成的。</p>\n<div class=\"language-bash\" data-ext=\"sh\" data-title=\"sh\"><pre class=\"language-bash\"><code><span class=\"token function\">git</span> commit <span class=\"token parameter variable\">--amend</span>\n</code></pre></div><p>此时就能出现一个交互式的修改提交窗口，可以修改提交信息，添加文件，或者删除文件。</p>\n<h2>修改作者信息</h2>\n<p>由于某次提交时不小心将 <code>git user</code> 改成了其他账户，在后续 <code>commit</code> 时提交了错误的用户信息，需要手动修改：<code>git rebase -i &lt;commit-hash&gt;</code>。</p>\n<p>意为从当前 <code>commit</code> 后的所有提交。将 <code>pick</code> 改为 <code>edit</code>，并使用 <code>git commit --amend --author=\"Author Name &lt;email&gt;\"</code> 修改用户。</p>\n<p>满意后使用 <code>git rebase --continue</code> 关闭本次修改。</p>\n",
      "date_published": "2024-07-10T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "READING"
      ]
    },
    {
      "title": "手写 new 操作符",
      "url": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/014-implement-new.html",
      "id": "https://dribble-njr.github.io/blog/blog/frontend/basic/javascript/014-implement-new.html",
      "summary": "new 操作符的实现过程： 首先创建一个空对象； 将空对象的隐式原型 [[prototype]] 赋值为构造函数的 prototype 对象； 让构造函数的 this 指向这个空对象，执行构造函数的代码； 判断构造函数返回值的类型，如果是基本类型，则返回创建的对象，如果是引用类型，则返回这个引用类型。 那么具体实现可以这么做： ",
      "content_html": "<p><code>new</code> 操作符的实现过程：</p>\n<ol>\n<li>首先创建一个空对象；</li>\n<li>将空对象的隐式原型 <code>[[prototype]]</code> 赋值为构造函数的 <code>prototype</code> 对象；</li>\n<li>让构造函数的 <code>this</code> 指向这个空对象，执行构造函数的代码；</li>\n<li>判断构造函数返回值的类型，如果是基本类型，则返回创建的对象，如果是引用类型，则返回这个引用类型。</li>\n</ol>\n<p>那么具体实现可以这么做：</p>\n<div class=\"language-javascript\" data-ext=\"js\" data-title=\"js\"><pre class=\"language-javascript\"><code><span class=\"token keyword\">function</span> <span class=\"token function\">newOperator</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">constructor<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> constructor <span class=\"token operator\">!==</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'type error'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 创建一个新对象，并将构造函数的 prototype 对象作为它的原型</span>\n  <span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>constructor<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 执行构造函数的代码</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token function\">constructor</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 判断返回值的类型</span>\n  <span class=\"token keyword\">let</span> flag <span class=\"token operator\">=</span> res <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> res <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">typeof</span> res <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> flag <span class=\"token operator\">?</span> res <span class=\"token operator\">:</span> instance\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> age</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> person <span class=\"token operator\">=</span> <span class=\"token function\">newOperator</span><span class=\"token punctuation\">(</span>Person<span class=\"token punctuation\">,</span> <span class=\"token string\">'wang'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Person { name: 'wang', age: 18 }</span>\n</code></pre></div>",
      "date_published": "2022-08-23T00:00:00.000Z",
      "date_modified": "2024-11-06T15:43:46.000Z",
      "authors": [],
      "tags": [
        "JavaScript"
      ]
    }
  ]
}