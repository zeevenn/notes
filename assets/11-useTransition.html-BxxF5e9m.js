import{_ as s,c as a,e as t,o as p}from"./app-CyajsSgG.js";const e={};function o(c,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h2 id="ç¼“å­˜-promise" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜-promise"><span>ç¼“å­˜ promise</span></a></h2><p>ä¸‹è¿°ä»£ç è·å–å­˜åœ¨ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œæ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œéƒ½ä¼šé‡æ–°è°ƒç”¨ <code>fetchUser</code> å‡½æ•°ï¼Œè§¦å‘ä¸€ä¸ªæ–°çš„ fetch è¯·æ±‚ï¼Œè¿™ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè¿˜ä¼šå¯¼è‡´ <code>NumberInfo</code> ç»„ä»¶æŒ‚èµ·ï¼Œæ¸²æŸ“ <code>suspense</code> è¾¹ç•Œã€‚</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> user
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">NumberInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
			Hi </span><span class="token punctuation">{</span>userInfo<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">! You have clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times.
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Increment again!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å†³æ–¹æ³•æ˜¯æ·»åŠ ç¼“å­˜åˆ°æˆ‘ä»¬çš„ <code>fetchUser</code> å‡½æ•°ä¸­ã€‚è¿™æ ·ï¼Œå¦‚æœ <code>fetchUser</code> å‡½æ•°å†æ¬¡è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›ä¹‹å‰è¿”å›çš„ç›¸åŒ promiseï¼š</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">let</span> userPromise
<span class="token keyword">function</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	userPromise <span class="token operator">=</span> userPromise <span class="token operator">??</span> <span class="token function">fetchUserImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> userPromise
<span class="token punctuation">}</span>

<span class="token comment">// &quot;impl&quot; is short for &quot;implementation&quot;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchUserImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/user&#39;</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> user
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿”å›ç›¸åŒçš„ promiseï¼ŒReact ä¼šè·Ÿè¸ªè¯¥ç‰¹å®š promiseï¼Œå¹¶çŸ¥é“å®ƒæ˜¯å¦å·²ç» resolved å¹¶éœ€è¦æŒ‚èµ·ã€‚</p><p>å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ç¼“å­˜é€šå¸¸éœ€è¦æ›´å¤šçš„æ€è€ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æŒ‰ ID è·å–ç”¨æˆ·å‘¢ï¼Ÿæˆ‘ä»¬ä¸èƒ½åªæ‹¥æœ‰ <code>userPromise</code>ï¼Œç°åœ¨æˆ‘ä»¬å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªä»ç”¨æˆ· ID åˆ°è·å–è¯¥ç”¨æˆ·çš„ promise çš„æ˜ å°„ï¼š</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">const</span> userPromiseCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User<span class="token operator">&gt;&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> userPromise <span class="token operator">=</span> userPromiseCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token function">fetchUserImpl</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	userPromiseCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> userPromise<span class="token punctuation">)</span>
	<span class="token keyword">return</span> userPromise
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchUserImpl</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> user
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œå½“ä½ å¼€å§‹è€ƒè™‘ç”¨æˆ·æ•°æ®å¯èƒ½ä¼šæ”¹å˜ï¼Œç°åœ¨ä½ å¿…é¡»æ‹…å¿ƒç¼“å­˜å¤±æ•ˆã€‚ä½†é‡ç‚¹æ˜¯ï¼Œä½ éœ€è¦ç¼“å­˜ä½ çš„ promise ä»¥é¿å…ä¸å¿…è¦çš„é‡æ–°è·å–ã€‚</p><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>å¯ä»¥ä½¿ç”¨ <code>useMemo</code> æ¥ç¼“å­˜ promiseï¼Œè¿™æ ·ä¼šåœ¨ id æ”¹å˜æ—¶ï¼Œé‡æ–°è·å– promiseï¼Œæ— éœ€è€ƒè™‘ç¼“å­˜å¤±æ•ˆç­‰å¤æ‚é—®é¢˜ã€‚</p></div><h2 id="transitions" tabindex="-1"><a class="header-anchor" href="#transitions"><span>Transitions</span></a></h2><p>æ¯å½“è§¦å‘å¯¼è‡´æŒ‚èµ·ç»„ä»¶çš„çŠ¶æ€æ›´æ–°æ—¶ï¼Œæœ€è¿‘çš„ <code>suspense</code> è¾¹ç•Œä¼šè¢«æ‰¾åˆ°ï¼Œå¹¶æ¸²æŸ“å…¶ <code>fallback</code> å±æ€§ï¼Œç›´åˆ° promise è¢« resolveã€‚å¦‚æœ <code>suspense</code> è¾¹ç•Œç¦»è§¦å‘çŠ¶æ€æ›´æ–°çš„ç»„ä»¶å¾ˆè¿œï¼Œæˆ–è€…åŠ è½½çŠ¶æ€ä¸ resolved çŠ¶æ€éå¸¸ä¸åŒï¼Œè¿™ä¼šç»™ç”¨æˆ·å¸¦æ¥éå¸¸ç³Ÿç³•çš„ä½“éªŒã€‚</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Header</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Sidebar</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      
      </span><span class="token punctuation">{</span><span class="token comment">/* Suspense è¾¹ç•Œåœ¨è¿™é‡Œ - å¾ˆè¿œï¼ */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æ•´ä¸ªé¡µé¢åŠ è½½ä¸­...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MainContent</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">MainContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ProductList</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserStats</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">ProductList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>filter<span class="token punctuation">,</span> setFilter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;all&#39;</span><span class="token punctuation">)</span>
  
  <span class="token keyword">const</span> productsPromise <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/products?filter=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>filter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>filter<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
  
  <span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>productsPromise<span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token string">&#39;popular&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        çƒ­é—¨å•†å“  </span><span class="token punctuation">{</span><span class="token comment">/* ğŸ‘ˆ ç”¨æˆ·ç‚¹å‡»è¿™é‡Œ */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>products<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨æˆ·ç‚¹å‡»ã€Œçƒ­é—¨å•†å“ã€æŒ‰é’®åï¼š</p><ul><li>è§¦å‘çŠ¶æ€æ›´æ–° setFilter(&#39;popular&#39;)</li><li>ç»„ä»¶æŒ‚èµ· ProductList å› ä¸ºæ–°çš„ use(productsPromise) è€ŒæŒ‚èµ·</li><li>æ‰¾åˆ°è¾¹ç•Œ React å‘ä¸ŠæŸ¥æ‰¾ï¼Œæ‰¾åˆ° App ä¸­çš„ Suspense</li><li>çªå…€ä½“éªŒ æ•´ä¸ªé¡µé¢å†…å®¹æ¶ˆå¤±ï¼Œæ˜¾ç¤º&quot;æ•´ä¸ªé¡µé¢åŠ è½½ä¸­...&quot;</li></ul><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>ç”¨æˆ·çœ‹åˆ°çš„å˜åŒ–ï¼š
[Header] [Sidebar] [äº§å“åˆ—è¡¨] [ç”¨æˆ·ç»Ÿè®¡]
                    â†“ ç‚¹å‡»æŒ‰é’®
[Header] [Sidebar] [æ•´ä¸ªé¡µé¢åŠ è½½ä¸­...]  âš ï¸ çªå…€ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å±€éƒ¨-suspense" tabindex="-1"><a class="header-anchor" href="#å±€éƒ¨-suspense"><span>å±€éƒ¨ Suspense</span></a></h3><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">function</span> <span class="token function">ProductList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>filter<span class="token punctuation">,</span> setFilter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;all&#39;</span><span class="token punctuation">)</span>
  
  <span class="token keyword">const</span> productsPromise <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/products?filter=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>filter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>filter<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token string">&#39;popular&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        çƒ­é—¨å•†å“
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      
      </span><span class="token punctuation">{</span><span class="token comment">/* âœ… å±€éƒ¨ Suspenseï¼Œåªå½±å“äº§å“åˆ—è¡¨ */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ProductListSkeleton</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ProductGrid</span></span> <span class="token attr-name">productsPromise</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>productsPromise<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">ProductGrid</span><span class="token punctuation">(</span><span class="token punctuation">{</span> productsPromise <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span>productsPromise<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>products<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="usetransition" tabindex="-1"><a class="header-anchor" href="#usetransition"><span>useTransition</span></a></h3><p>ä¸ºäº†ä½¿ä»åŠ è½½åˆ° resolved çŠ¶æ€çš„è¿‡æ¸¡æ›´å¹³æ»‘ï¼Œå¯ä»¥ä½¿ç”¨ <code>useTransition</code> hookã€‚è¿™ä¸ª hook è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå€¼çš„å…ƒç»„ï¼šä¸€ä¸ªå¸ƒå°”å€¼å’Œä¸€ä¸ª <code>startTransition</code> å‡½æ•°ã€‚</p><ul><li>å½“ promise ä»å¤„äº pending çŠ¶æ€æ—¶ï¼Œå¸ƒå°”å€¼ä¸º <code>true</code>ï¼Œå½“ promise å·² resolved æ—¶ï¼Œå¸ƒå°”å€¼ä¸º <code>false</code>ã€‚è¿™å…è®¸ä½ æ˜¾ç¤ºä¸€ä¸ªåŠ è½½çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>suspense</code> è¾¹ç•Œ fallback UIã€‚è¿™é€šå¸¸ä¼šå¸¦æ¥æ›´å¹³æ»‘çš„ç”¨æˆ·ä½“éªŒã€‚</li><li><code>startTransition</code> å‡½æ•°æ˜¯ä¸€ä¸ªå›è°ƒï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿è¯æ—§ UI çš„å±•ç¤ºï¼Œé¿å…ç”¨æˆ·çœ‹åˆ°çªå…€çš„ UI å˜åŒ–ã€‚</li></ul><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">function</span> <span class="token function">ProductList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>filter<span class="token punctuation">,</span> setFilter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;all&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleFilterChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>newFilter<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setFilter</span><span class="token punctuation">(</span>newFilter<span class="token punctuation">)</span>  <span class="token comment">// éç´§æ€¥æ›´æ–°ï¼Œé¿å…æŒ‚èµ·</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// æ˜¾ç¤ºå½“å‰æ•°æ® + åŠ è½½æŒ‡ç¤ºå™¨ï¼Œè€Œä¸æ˜¯å®Œå…¨æŒ‚èµ·</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> 
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleFilterChange</span><span class="token punctuation">(</span><span class="token string">&#39;popular&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isPending<span class="token punctuation">}</span></span>
      <span class="token punctuation">&gt;</span></span><span class="token plain-text">
        çƒ­é—¨å•†å“ </span><span class="token punctuation">{</span>isPending <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;(åŠ è½½ä¸­...)&#39;</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* å…¶ä»–å†…å®¹ */</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>startTransition</code> çš„æ ¸å¿ƒæ˜¯ <strong>è°ƒåº¦æ›´æ–°ä¼˜å…ˆçº§</strong>ï¼Œè€Œã€Œæ—§ UI ä¿ç•™ã€åªæ˜¯å®ƒå¸¦æ¥çš„å‰¯ä½œç”¨ä½“éªŒï¼Œä¸æ˜¯å®ƒæœ¬è´¨ã€‚</p><p>React å†…éƒ¨æŠŠæ›´æ–°åˆ†æˆç´§æ€¥å’Œéç´§æ€¥ï¼š</p><ul><li>ç´§æ€¥æ›´æ–°ï¼šè¾“å…¥æ¡†ã€ç‚¹å‡» â†’ ç«‹å³å“åº”</li><li>éç´§æ€¥æ›´æ–°ï¼šåˆ—è¡¨æ¸²æŸ“ã€å¤§é‡ DOM æ›´æ–° â†’ å¯ä»¥å»¶è¿Ÿ</li></ul><p><code>startTransition</code> å°±æ˜¯å‘Šè¯‰ Reactï¼šè¿™æ¬¡æ›´æ–°ä¸é‡è¦ï¼Œå…ˆä¿è¯ç”¨æˆ·äº¤äº’æµç•…ï¼Œå†æ…¢æ…¢æ¸²æŸ“ã€‚</p><p>å½“ä½ æŠŠ <code>Suspense</code> æ”¾è¿› <code>Transition</code> æ—¶ï¼Œä¼šå¸¦æ¥ä¸€ä¸ªå‰¯ä½œç”¨ï¼šæ—§ UI ä¿ç•™ã€‚æ–°æ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ â†’ React ä¼šå…ˆä¿ç•™æ—§ UIï¼Œä¸ä¼šç«‹åˆ»åˆ‡åˆ° fallbackã€‚</p><p>è¿™ä¸ªè¡Œä¸ºæ˜¯ <strong>è°ƒåº¦ç­–ç•¥å¸¦æ¥çš„ä½“éªŒæ•ˆæœ</strong>ï¼Œè€Œä¸æ˜¯ <code>Transition</code> æœ¬èº«çš„ç›®æ ‡ã€‚</p><p>æ¢å¥è¯è¯´ï¼š</p><ul><li><code>Transition</code> ç›®æ ‡ï¼ˆè°ƒåº¦ç­–ç•¥ï¼‰ = é™ä½æ›´æ–°ä¼˜å…ˆçº§ï¼Œè®©äº¤äº’ä¸å¡é¡¿</li><li><code>UI</code> ä¿ç•™æ•ˆæœ = å› ä¸ºæ›´æ–°è¢«é™çº§äº†ï¼Œæ‰€ä»¥æ—§ UI è¿˜èƒ½æ˜¾ç¤º</li></ul><div class="hint-container tip"><p class="hint-container-title">æç¤º</p><p>React å•ç‹¬æä¾›äº† <code>useTransition</code> è¿”å›çš„ <code>startTransition</code> å‡½æ•°ï¼Œå½“ä½ ä¸éœ€è¦ <code>isPending</code> æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>startTransition</code> å‡½æ•°ã€‚</p></div>`,31)])])}const l=s(e,[["render",o],["__file","11-useTransition.html.vue"]]),u=JSON.parse('{"path":"/frontend/framework/react/11-useTransition.html","title":"useTransition","lang":"zh-CN","frontmatter":{"title":"useTransition","date":"2025-08-25T00:00:00.000Z","tags":["react","hooks"],"description":"ç¼“å­˜ promise ä¸‹è¿°ä»£ç è·å–å­˜åœ¨ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œæ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œéƒ½ä¼šé‡æ–°è°ƒç”¨ fetchUser å‡½æ•°ï¼Œè§¦å‘ä¸€ä¸ªæ–°çš„ fetch è¯·æ±‚ï¼Œè¿™ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè¿˜ä¼šå¯¼è‡´ NumberInfo ç»„ä»¶æŒ‚èµ·ï¼Œæ¸²æŸ“ suspense è¾¹ç•Œã€‚ è§£å†³æ–¹æ³•æ˜¯æ·»åŠ ç¼“å­˜åˆ°æˆ‘ä»¬çš„ fetchUser å‡½æ•°ä¸­ã€‚è¿™æ ·ï¼Œå¦‚æœ fetchUser å‡½æ•°å†æ¬¡è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›ä¹‹å‰è¿”å›çš„...","head":[["meta",{"property":"og:url","content":"https://dribble-njr.github.io/blog/blog/frontend/framework/react/11-useTransition.html"}],["meta",{"property":"og:title","content":"useTransition"}],["meta",{"property":"og:description","content":"ç¼“å­˜ promise ä¸‹è¿°ä»£ç è·å–å­˜åœ¨ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œæ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œéƒ½ä¼šé‡æ–°è°ƒç”¨ fetchUser å‡½æ•°ï¼Œè§¦å‘ä¸€ä¸ªæ–°çš„ fetch è¯·æ±‚ï¼Œè¿™ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè¿˜ä¼šå¯¼è‡´ NumberInfo ç»„ä»¶æŒ‚èµ·ï¼Œæ¸²æŸ“ suspense è¾¹ç•Œã€‚ è§£å†³æ–¹æ³•æ˜¯æ·»åŠ ç¼“å­˜åˆ°æˆ‘ä»¬çš„ fetchUser å‡½æ•°ä¸­ã€‚è¿™æ ·ï¼Œå¦‚æœ fetchUser å‡½æ•°å†æ¬¡è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›ä¹‹å‰è¿”å›çš„..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-27T10:38:24.000Z"}],["meta",{"property":"article:author","content":"njr"}],["meta",{"property":"article:tag","content":"react"}],["meta",{"property":"article:tag","content":"hooks"}],["meta",{"property":"article:published_time","content":"2025-08-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-27T10:38:24.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"useTransition\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-08-25T00:00:00.000Z\\",\\"dateModified\\":\\"2025-08-27T10:38:24.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"njr\\",\\"url\\":\\"https://github.com/dribble-njr/blog\\",\\"email\\":\\"wzw15292257101@163.com\\"}]}"]]},"headers":[{"level":2,"title":"1 ç¼“å­˜ promise","slug":"ç¼“å­˜-promise","link":"#ç¼“å­˜-promise","children":[]},{"level":2,"title":"2 Transitions","slug":"transitions","link":"#transitions","children":[{"level":3,"title":"2.1 å±€éƒ¨ Suspense","slug":"å±€éƒ¨-suspense","link":"#å±€éƒ¨-suspense","children":[]},{"level":3,"title":"2.2 useTransition","slug":"usetransition","link":"#usetransition","children":[]}]}],"git":{"createdTime":1756109409000,"updatedTime":1756291104000,"contributors":[{"name":"dribble-njr","email":"wzw15292257101@163.com","commits":2}]},"readingTime":{"minutes":4.16,"words":1247},"filePathRelative":"frontend/framework/react/11-useTransition.md","localizedDate":"2025å¹´8æœˆ25æ—¥","excerpt":"","autoDesc":true}');export{l as comp,u as data};
